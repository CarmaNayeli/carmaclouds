{
  "version": 3,
  "sources": ["../../owlbear-extension/chat.js"],
  "sourcesContent": ["/**\r\n * OwlCloud Chat Window Script\r\n *\r\n * Standalone chat interface for OwlCloud\r\n */\r\n\r\n/* global OBR */\r\n\r\n// ============== State ==============\r\n\r\nlet currentCharacter = null;\r\nlet isOwlbearReady = false;\r\nlet currentPlayerId = null;\r\nlet lastLoadedMessageId = null;\r\n\r\n// Supabase configuration\r\nconst SUPABASE_URL = 'https://luiesmfjdcmpywavvfqm.supabase.co';\r\nconst SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1aWVzbWZqZGNtcHl3YXZ2ZnFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4ODYxNDksImV4cCI6MjA4NTQ2MjE0OX0.oqjHFf2HhCLcanh0HVryoQH7iSV7E9dHHZJdYehxZ0U';\r\nconst SUPABASE_HEADERS = {\r\n  'apikey': SUPABASE_ANON_KEY,\r\n  'Content-Type': 'application/json'\r\n};\r\n\r\n// ============== Theme Synchronization ==============\r\n\r\n/**\r\n * Apply theme from sheet popover to chat window\r\n */\r\nfunction applyThemeFromSheet() {\r\n  try {\r\n    // Get current theme from localStorage (set by sheet popover)\r\n    const currentTheme = localStorage.getItem('owlcloud-theme');\r\n    if (!currentTheme) return;\r\n\r\n    // Define theme colors (same as sheet popover)\r\n    const themes = {\r\n      purple: {\r\n        primary: '#8B5CF6',\r\n        primaryLight: '#A78BFA',\r\n        primaryLighter: '#C4B5FD',\r\n        gradient: 'linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',\r\n        bgSecondary: 'rgba(26, 26, 46, 0.8)',\r\n        bgAccent: 'rgba(139, 92, 246, 0.15)',\r\n        bgCard: 'rgba(139, 92, 246, 0.1)',\r\n        bgHover: 'rgba(139, 92, 246, 0.2)',\r\n        textPrimary: '#e0e0e0',\r\n        textSecondary: '#c0c0c0',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      blue: {\r\n        primary: '#3B82F6',\r\n        primaryLight: '#60A5FA',\r\n        primaryLighter: '#93C5FD',\r\n        gradient: 'linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%)',\r\n        bgSecondary: 'rgba(15, 23, 42, 0.8)',\r\n        bgAccent: 'rgba(59, 130, 246, 0.15)',\r\n        bgCard: 'rgba(59, 130, 246, 0.1)',\r\n        bgHover: 'rgba(59, 130, 246, 0.2)',\r\n        textPrimary: '#e0e0e0',\r\n        textSecondary: '#c0c0c0',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      green: {\r\n        primary: '#10B981',\r\n        primaryLight: '#34D399',\r\n        primaryLighter: '#6EE7B7',\r\n        gradient: 'linear-gradient(135deg, #10B981 0%, #34D399 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #052e16 0%, #0a4d2a 50%, #0f6b3e 100%)',\r\n        bgSecondary: 'rgba(5, 46, 22, 0.8)',\r\n        bgAccent: 'rgba(16, 185, 129, 0.15)',\r\n        bgCard: 'rgba(16, 185, 129, 0.1)',\r\n        bgHover: 'rgba(16, 185, 129, 0.2)',\r\n        textPrimary: '#e0e0e0',\r\n        textSecondary: '#c0c0c0',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      red: {\r\n        primary: '#EF4444',\r\n        primaryLight: '#F87171',\r\n        primaryLighter: '#FCA5A5',\r\n        gradient: 'linear-gradient(135deg, #EF4444 0%, #F87171 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #450a0a 0%, #7f1d1d 50%, #991b1b 100%)',\r\n        bgSecondary: 'rgba(69, 10, 10, 0.8)',\r\n        bgAccent: 'rgba(239, 68, 68, 0.15)',\r\n        bgCard: 'rgba(239, 68, 68, 0.1)',\r\n        bgHover: 'rgba(239, 68, 68, 0.2)',\r\n        textPrimary: '#e0e0e0',\r\n        textSecondary: '#c0c0c0',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      orange: {\r\n        primary: '#F97316',\r\n        primaryLight: '#FB923C',\r\n        primaryLighter: '#FDBA74',\r\n        gradient: 'linear-gradient(135deg, #F97316 0%, #FB923C 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #431407 0%, #7c2d12 50%, #9a3412 100%)',\r\n        bgSecondary: 'rgba(67, 20, 7, 0.8)',\r\n        bgAccent: 'rgba(249, 115, 22, 0.15)',\r\n        bgCard: 'rgba(249, 115, 22, 0.1)',\r\n        bgHover: 'rgba(249, 115, 22, 0.2)',\r\n        textPrimary: '#e0e0e0',\r\n        textSecondary: '#c0c0c0',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      yellow: {\r\n        primary: '#EAB308',\r\n        primaryLight: '#FACC15',\r\n        primaryLighter: '#FDE047',\r\n        gradient: 'linear-gradient(135deg, #EAB308 0%, #FACC15 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #422006 0%, #713f12 50%, #854d0e 100%)',\r\n        bgSecondary: 'rgba(66, 34, 6, 0.8)',\r\n        bgAccent: 'rgba(234, 179, 8, 0.15)',\r\n        bgCard: 'rgba(234, 179, 8, 0.1)',\r\n        bgHover: 'rgba(234, 179, 8, 0.2)',\r\n        textPrimary: '#1f2937',\r\n        textSecondary: '#374151',\r\n        textMuted: '#6b7280',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      pink: {\r\n        primary: '#EC4899',\r\n        primaryLight: '#F472B6',\r\n        primaryLighter: '#F9A8D4',\r\n        gradient: 'linear-gradient(135deg, #EC4899 0%, #F472B6 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #500724 0%, #831843 50%, #9f1239 100%)',\r\n        bgSecondary: 'rgba(80, 7, 36, 0.8)',\r\n        bgAccent: 'rgba(236, 72, 153, 0.15)',\r\n        bgCard: 'rgba(236, 72, 153, 0.1)',\r\n        bgHover: 'rgba(236, 72, 153, 0.2)',\r\n        textPrimary: '#e0e0e0',\r\n        textSecondary: '#c0c0c0',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      brown: {\r\n        primary: '#92400E',\r\n        primaryLight: '#B45309',\r\n        primaryLighter: '#D97706',\r\n        gradient: 'linear-gradient(135deg, #92400E 0%, #B45309 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #1c0f0a 0%, #442c1e 50%, #5c341e 100%)',\r\n        bgSecondary: 'rgba(28, 15, 10, 0.8)',\r\n        bgAccent: 'rgba(146, 64, 14, 0.15)',\r\n        bgCard: 'rgba(146, 64, 14, 0.1)',\r\n        bgHover: 'rgba(146, 64, 14, 0.2)',\r\n        textPrimary: '#e0e0e0',\r\n        textSecondary: '#c0c0c0',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      grey: {\r\n        primary: '#6B7280',\r\n        primaryLight: '#9CA3AF',\r\n        primaryLighter: '#D1D5DB',\r\n        gradient: 'linear-gradient(135deg, #6B7280 0%, #9CA3AF 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #1f2937 0%, #374151 50%, #4b5563 100%)',\r\n        bgSecondary: 'rgba(31, 41, 55, 0.8)',\r\n        bgAccent: 'rgba(107, 114, 128, 0.15)',\r\n        bgCard: 'rgba(107, 114, 128, 0.1)',\r\n        bgHover: 'rgba(107, 114, 128, 0.2)',\r\n        textPrimary: '#e0e0e0',\r\n        textSecondary: '#c0c0c0',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      black: {\r\n        primary: '#1F2937',\r\n        primaryLight: '#374151',\r\n        primaryLighter: '#4B5563',\r\n        gradient: 'linear-gradient(135deg, #1F2937 0%, #374151 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #000000 0%, #111827 50%, #1f2937 100%)',\r\n        bgSecondary: 'rgba(0, 0, 0, 0.8)',\r\n        bgAccent: 'rgba(31, 41, 55, 0.15)',\r\n        bgCard: 'rgba(31, 41, 55, 0.1)',\r\n        bgHover: 'rgba(31, 41, 55, 0.2)',\r\n        textPrimary: '#ffffff',\r\n        textSecondary: '#e5e7eb',\r\n        textMuted: '#9ca3af',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      },\r\n      white: {\r\n        primary: '#F9FAFB',\r\n        primaryLight: '#F3F4F6',\r\n        primaryLighter: '#E5E7EB',\r\n        gradient: 'linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%)',\r\n        bgPrimary: 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 50%, #e2e8f0 100%)',\r\n        bgSecondary: 'rgba(248, 250, 252, 0.9)',\r\n        bgAccent: 'rgba(249, 250, 251, 0.5)',\r\n        bgCard: 'rgba(249, 250, 251, 0.8)',\r\n        bgHover: 'rgba(241, 245, 249, 0.9)',\r\n        textPrimary: '#1f2937',\r\n        textSecondary: '#374151',\r\n        textMuted: '#6b7280',\r\n        textOnPrimary: '#ffffff',\r\n        textOnLight: '#1f2937'\r\n      }\r\n    };\r\n\r\n    const theme = themes[currentTheme];\r\n    if (!theme) return;\r\n\r\n    const root = document.documentElement;\r\n    \r\n    // Update CSS variables\r\n    root.style.setProperty('--theme-primary', theme.primary);\r\n    root.style.setProperty('--theme-primary-light', theme.primaryLight);\r\n    root.style.setProperty('--theme-primary-lighter', theme.primaryLighter);\r\n    root.style.setProperty('--theme-gradient', theme.gradient);\r\n    root.style.setProperty('--theme-bg-primary', theme.bgPrimary);\r\n    root.style.setProperty('--theme-bg-secondary', theme.bgSecondary);\r\n    root.style.setProperty('--theme-bg-accent', theme.bgAccent);\r\n    root.style.setProperty('--theme-bg-card', theme.bgCard);\r\n    root.style.setProperty('--theme-bg-hover', theme.bgHover);\r\n    root.style.setProperty('--theme-text-primary', theme.textPrimary);\r\n    root.style.setProperty('--theme-text-secondary', theme.textSecondary);\r\n    root.style.setProperty('--theme-text-muted', theme.textMuted);\r\n    root.style.setProperty('--theme-text-on-primary', theme.textOnPrimary);\r\n    root.style.setProperty('--theme-text-on-light', theme.textOnLight);\r\n    \r\n    // Update body background and color\r\n    document.body.style.background = theme.bgPrimary;\r\n    document.body.style.color = theme.textPrimary;\r\n    \r\n    console.log(`\uD83C\uDFA8 Chat applied theme: ${currentTheme}`);\r\n  } catch (error) {\r\n    console.error('Failed to apply theme to chat:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Listen for theme changes from sheet popover\r\n */\r\nfunction setupThemeListener() {\r\n  // Listen for storage changes (when theme changes in sheet popover)\r\n  window.addEventListener('storage', (e) => {\r\n    if (e.key === 'owlcloud-theme') {\r\n      applyThemeFromSheet();\r\n    }\r\n  });\r\n  \r\n  // Also check periodically for theme changes\r\n  setInterval(() => {\r\n    applyThemeFromSheet();\r\n  }, 1000);\r\n}\r\n\r\n// ============== DOM Elements ==============\r\n\r\nconst chatMessages = document.getElementById('chat-messages');\r\nconst chatInput = document.getElementById('chat-input');\r\nconst chatSendBtn = document.getElementById('chat-send-btn');\r\nconst chatCloseBtn = document.getElementById('chat-close-btn');\r\nconst characterNameEl = document.getElementById('character-name');\r\n\r\n// ============== Owlbear SDK Initialization ==============\r\n\r\nOBR.onReady(async () => {\r\n  isOwlbearReady = true;\r\n  console.log('\uD83E\uDD89 Owlbear SDK ready in chat window');\r\n\r\n  // Initialize theme synchronization\r\n  setupThemeListener();\r\n  applyThemeFromSheet();\r\n\r\n  // Get player ID\r\n  currentPlayerId = await OBR.player.getId();\r\n\r\n  // Check for active character\r\n  await checkForActiveCharacter();\r\n\r\n  // Load chat history from metadata\r\n  await loadChatHistory();\r\n\r\n  // Listen for messages from character sheet\r\n  OBR.room.onMetadataChange((metadata) => {\r\n    const message = metadata['com.owlcloud.chat/latest-message'];\r\n    if (message && message.timestamp) {\r\n      handleCharacterSheetMessage(message);\r\n    }\r\n\r\n    // Listen for new chat messages\r\n    const messages = metadata['com.owlcloud.chat/messages'];\r\n    if (messages && Array.isArray(messages)) {\r\n      loadNewMessages(messages);\r\n    }\r\n  });\r\n\r\n  // Listen for roll mode changes from popover\r\n  OBR.player.onChange(async (player) => {\r\n    const rollMode = player.metadata?.['owlcloud.rollMode'];\r\n    updateRollModeIndicator(rollMode || 'normal');\r\n  });\r\n\r\n  // Set initial roll mode\r\n  const player = await OBR.player.getMetadata();\r\n  updateRollModeIndicator(player['owlcloud.rollMode'] || 'normal');\r\n});\r\n\r\n// ============== Character Management ==============\r\n\r\n/**\r\n * Check for active character\r\n */\r\nasync function checkForActiveCharacter() {\r\n  try {\r\n    const playerId = await OBR.player.getId();\r\n\r\n    const response = await fetch(\r\n      `${SUPABASE_URL}/functions/v1/characters?owlbear_player_id=${encodeURIComponent(playerId)}&fields=essential`,\r\n      { headers: SUPABASE_HEADERS }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      console.error('Failed to get character:', response.statusText);\r\n      return;\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    if (data.success && data.character) {\r\n      currentCharacter = data.character;\r\n      characterNameEl.textContent = currentCharacter.character_name || 'Unknown Character';\r\n    }\r\n  } catch (error) {\r\n    console.error('Error checking for active character:', error);\r\n  }\r\n}\r\n\r\n// ============== Message Handling ==============\r\n\r\nlet lastProcessedTimestamp = 0;\r\n\r\n/**\r\n * Handle messages from character sheet\r\n */\r\nfunction handleCharacterSheetMessage(message) {\r\n  // Prevent duplicate processing\r\n  if (message.timestamp <= lastProcessedTimestamp) {\r\n    return;\r\n  }\r\n  lastProcessedTimestamp = message.timestamp;\r\n\r\n  const characterName = message.character?.name || 'Character';\r\n\r\n  switch (message.type) {\r\n    case 'roll':\r\n      if (message.data) {\r\n        const { name, rolls, modifier, total } = message.data;\r\n        const rollsText = rolls.join(' + ');\r\n        const modText = modifier !== 0 ? ` ${modifier >= 0 ? '+' : ''}${modifier}` : '';\r\n        const text = `\uD83C\uDFB2 ${name}: ${rollsText}${modText} = <strong>${total}</strong>`;\r\n        addChatMessageToMetadata(text, 'roll', characterName);\r\n      }\r\n      break;\r\n\r\n    case 'action':\r\n      if (message.data) {\r\n        const { actionName, details } = message.data;\r\n        addChatMessageToMetadata(`\u2694\uFE0F ${actionName} - ${details}`, 'action', characterName);\r\n      }\r\n      break;\r\n\r\n    case 'spell':\r\n      if (message.data) {\r\n        const { spellName, level } = message.data;\r\n        const levelText = level === 0 ? 'Cantrip' : `Level ${level}`;\r\n        addChatMessageToMetadata(`\u2728 ${spellName} (${levelText})`, 'spell', characterName);\r\n      }\r\n      break;\r\n\r\n    case 'combat':\r\n      if (message.data && message.data.text) {\r\n        addChatMessageToMetadata(message.data.text, 'combat', characterName);\r\n      }\r\n      break;\r\n\r\n    default:\r\n      console.warn('Unknown message type:', message.type);\r\n  }\r\n}\r\n\r\n/**\r\n * Load chat history from room metadata\r\n */\r\nasync function loadChatHistory() {\r\n  try {\r\n    const metadata = await OBR.room.getMetadata();\r\n    const messages = metadata['com.owlcloud.chat/messages'];\r\n\r\n    if (messages && Array.isArray(messages)) {\r\n      messages.forEach(msg => {\r\n        displayChatMessage(msg.text, msg.type, msg.author, msg.timestamp, msg.details, msg.themeColor);\r\n        lastLoadedMessageId = msg.id;\r\n      });\r\n      scrollChatToBottom();\r\n    }\r\n  } catch (error) {\r\n    console.error('Error loading chat history:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Load new messages from metadata\r\n */\r\nfunction loadNewMessages(messages) {\r\n  if (!Array.isArray(messages)) return;\r\n\r\n  const newMessages = messages.filter(msg =>\r\n    !lastLoadedMessageId || msg.id > lastLoadedMessageId\r\n  );\r\n\r\n  newMessages.forEach(msg => {\r\n    displayChatMessage(msg.text, msg.type, msg.author, msg.timestamp, msg.details, msg.themeColor);\r\n    lastLoadedMessageId = msg.id;\r\n  });\r\n\r\n  if (newMessages.length > 0) {\r\n    scrollChatToBottom();\r\n  }\r\n}\r\n\r\n// ============== Chat Functions ==============\r\n\r\n/**\r\n * Scroll chat to bottom\r\n */\r\nfunction scrollChatToBottom() {\r\n  setTimeout(() => {\r\n    chatMessages.scrollTop = chatMessages.scrollHeight;\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Display a message in the chat UI (local only, doesn't save to metadata)\r\n * @param {string} text - Message text\r\n * @param {string} type - Message type: 'system', 'roll', 'action', 'spell', 'combat', 'user'\r\n * @param {string} author - Message author (optional)\r\n * @param {number} timestamp - Message timestamp (optional)\r\n * @param {object} details - Message details (optional)\r\n * @param {string} themeColor - Theme color for author name (optional)\r\n */\r\nfunction displayChatMessage(text, type = 'system', author = null, timestamp = null, details = null, themeColor = null) {\r\n  const messageDiv = document.createElement('div');\r\n  messageDiv.className = `chat-message ${type}`;\r\n\r\n  const now = timestamp ? new Date(timestamp) : new Date();\r\n  const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });\r\n\r\n  // Build message HTML\r\n  let messageHTML = '';\r\n\r\n  if (author) {\r\n    // Use theme color for author name if provided, otherwise use default\r\n    const authorStyle = themeColor ? `style=\"color: ${themeColor}\"` : '';\r\n    messageHTML = `\r\n      <div class=\"chat-message-header\">\r\n        <span class=\"chat-message-author\" ${authorStyle}>${author}</span>\r\n        <span class=\"chat-message-time\">${timeStr}</span>\r\n      </div>\r\n      <div class=\"chat-message-text\">${text}</div>\r\n    `;\r\n  } else {\r\n    messageHTML = `<div class=\"chat-message-text\">${text}</div>`;\r\n  }\r\n\r\n  // Add expandable details if present\r\n  if (details) {\r\n    const detailsHTML = typeof details === 'string' ? details : JSON.stringify(details, null, 2);\r\n    messageHTML += `\r\n      <div class=\"chat-message-details\" style=\"display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--theme-border); font-size: 12px; color: var(--theme-text-muted);\">\r\n        ${detailsHTML}\r\n      </div>\r\n    `;\r\n\r\n    // Make message clickable to toggle details\r\n    messageDiv.style.cursor = 'pointer';\r\n    messageDiv.title = 'Click to expand details';\r\n    messageDiv.onclick = function() {\r\n      const detailsEl = this.querySelector('.chat-message-details');\r\n      if (detailsEl) {\r\n        const isHidden = detailsEl.style.display === 'none';\r\n        detailsEl.style.display = isHidden ? 'block' : 'none';\r\n        this.title = isHidden ? 'Click to collapse' : 'Click to expand details';\r\n      }\r\n    };\r\n  }\r\n\r\n  messageDiv.innerHTML = messageHTML;\r\n  chatMessages.appendChild(messageDiv);\r\n\r\n  // Limit chat history to last 100 messages\r\n  const messages = chatMessages.querySelectorAll('.chat-message');\r\n  if (messages.length > 100) {\r\n    messages[0].remove();\r\n  }\r\n\r\n  scrollChatToBottom();\r\n}\r\n\r\n/**\r\n * Add a message to chat and save to room metadata (shared with all players)\r\n * @param {string} text - Message text\r\n * @param {string} type - Message type: 'system', 'roll', 'action', 'spell', 'combat', 'user'\r\n * @param {string} author - Message author (optional)\r\n */\r\nasync function addChatMessageToMetadata(text, type = 'system', author = null) {\r\n  if (!isOwlbearReady) return;\r\n\r\n  try {\r\n    const metadata = await OBR.room.getMetadata();\r\n    const messages = metadata['com.owlcloud.chat/messages'] || [];\r\n\r\n    // Strip HTML tags and truncate to reduce metadata size\r\n    const plainText = text.replace(/<[^>]*>/g, '');\r\n    const truncatedText = plainText.length > 500 ? plainText.substring(0, 497) + '...' : plainText;\r\n\r\n    // Get current theme color\r\n    const currentTheme = localStorage.getItem('owlcloud-theme') || 'purple';\r\n    const themeColors = {\r\n      purple: '#8B5CF6',\r\n      blue: '#3B82F6', \r\n      green: '#10B981',\r\n      red: '#EF4444',\r\n      orange: '#F97316',\r\n      yellow: '#EAB308',\r\n      pink: '#EC4899',\r\n      brown: '#92400E',\r\n      grey: '#6B7280',\r\n      black: '#1F2937',\r\n      white: '#F9FAFB'\r\n    };\r\n    const themeColor = themeColors[currentTheme] || themeColors.purple;\r\n\r\n    const newMessage = {\r\n      id: Date.now() + Math.random(), // Unique ID\r\n      text: truncatedText,\r\n      type: type,\r\n      author: author,\r\n      playerId: currentPlayerId,\r\n      timestamp: Date.now(),\r\n      themeColor: themeColor // Add theme color to message\r\n    };\r\n\r\n    // Auto-cleanup: Remove messages older than 30 minutes\r\n    const thirtyMinutesAgo = Date.now() - (30 * 60 * 1000);\r\n    const recentMessages = messages.filter(msg => msg.timestamp > thirtyMinutesAgo);\r\n\r\n    // Add new message and limit to last 10 messages (reduced from 20 to save space)\r\n    const updatedMessages = [...recentMessages, newMessage].slice(-10);\r\n\r\n    await OBR.room.setMetadata({\r\n      'com.owlcloud.chat/messages': updatedMessages\r\n    });\r\n  } catch (error) {\r\n    console.error('Error adding message to metadata:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Send a user message\r\n */\r\nasync function sendChatMessage() {\r\n  const text = chatInput.value.trim();\r\n  if (!text) return;\r\n\r\n  // Add user message to shared chat\r\n  const characterName = currentCharacter?.name || 'You';\r\n  await addChatMessageToMetadata(text, 'user', characterName);\r\n\r\n  // Clear input\r\n  chatInput.value = '';\r\n}\r\n\r\n// ============== Event Listeners ==============\r\n\r\nchatSendBtn.addEventListener('click', sendChatMessage);\r\n\r\nchatInput.addEventListener('keypress', (e) => {\r\n  if (e.key === 'Enter') {\r\n    sendChatMessage();\r\n  }\r\n});\r\n\r\nchatCloseBtn.addEventListener('click', async () => {\r\n  if (isOwlbearReady) {\r\n    try {\r\n      await OBR.popover.close('com.owlcloud.chat');\r\n    } catch (error) {\r\n      console.error('Error closing chat:', error);\r\n    }\r\n  }\r\n});\r\n\r\n// ============== Expose Chat Functions ==============\r\n\r\n// Expose chat functions for other windows to call\r\nwindow.owlcloudChat = {\r\n  addMessage: addChatMessageToMetadata,\r\n  announceRoll: async (rollName, formula, result) => {\r\n    const characterName = currentCharacter?.name || 'Character';\r\n    const text = `\uD83C\uDFB2 ${rollName}: ${formula} = <strong>${result}</strong>`;\r\n    await addChatMessageToMetadata(text, 'roll', characterName);\r\n  },\r\n  announceAction: async (actionName, details = '') => {\r\n    const characterName = currentCharacter?.name || 'Character';\r\n    const text = details ? `\u2694\uFE0F ${actionName} - ${details}` : `\u2694\uFE0F ${actionName}`;\r\n    await addChatMessageToMetadata(text, 'action', characterName);\r\n  },\r\n  announceSpell: async (spellName, level, details = '') => {\r\n    const characterName = currentCharacter?.name || 'Character';\r\n    const levelText = level === 0 ? 'Cantrip' : `Level ${level}`;\r\n    const text = details ? `\u2728 ${spellName} (${levelText}) - ${details}` : `\u2728 ${spellName} (${levelText})`;\r\n    await addChatMessageToMetadata(text, 'spell', characterName);\r\n  },\r\n  announceCombat: async (text) => {\r\n    const characterName = currentCharacter?.name || 'Character';\r\n    await addChatMessageToMetadata(text, 'combat', characterName);\r\n  }\r\n};\r\n\r\n// ============== Roll Mode Indicator ==============\r\n\r\n/**\r\n * Update the roll mode indicator badge\r\n */\r\nfunction updateRollModeIndicator(mode) {\r\n  const indicator = document.getElementById('roll-mode-indicator');\r\n  if (!indicator) return;\r\n\r\n  // Remove all mode classes\r\n  indicator.classList.remove('advantage', 'disadvantage');\r\n\r\n  // Set appropriate class and text\r\n  if (mode === 'advantage') {\r\n    indicator.classList.add('advantage');\r\n    indicator.textContent = 'ADV';\r\n  } else if (mode === 'disadvantage') {\r\n    indicator.classList.add('disadvantage');\r\n    indicator.textContent = 'DIS';\r\n  } else {\r\n    // Normal mode - hide indicator\r\n    indicator.textContent = '';\r\n  }\r\n}\r\n\r\nconsole.log('\uD83D\uDCAC Chat window initialized');\r\n"],
  "mappings": "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",
  "names": ["player"]
}
