{
  "version": 3,
  "sources": ["../../../../core/src/common/browser-polyfill.js", "../../../src/content/character-sheet-overlay.js"],
  "sourcesContent": ["/**\r\n * Browser API Compatibility Layer - Chrome & Firefox Support\r\n *\r\n * This provides a consistent browserAPI interface across Chrome and Firefox.\r\n * Firefox uses the 'browser' namespace (Promise-based), while Chrome uses 'chrome' (callback-based).\r\n */\r\n\r\nconsole.log('\uD83C\uDF10 Loading browser polyfill...');\r\n\r\n// Use 'self' for service workers, 'window' for content scripts/popups\r\nconst globalScope = typeof window !== 'undefined' ? window : self;\r\n\r\n// Detect browser and use appropriate API\r\nlet browserAPI;\r\n\r\nif (typeof browser !== 'undefined' && browser.runtime) {\r\n  // Firefox - uses native Promise-based API\r\n  console.log('\uD83E\uDD8A Detected Firefox');\r\n  browserAPI = browser;\r\n} else if (typeof chrome !== 'undefined' && chrome.runtime) {\r\n  // Chrome - wrap callback-based API to be consistent with Firefox\r\n  console.log('\uD83C\uDF10 Detected Chrome');\r\n  // Helper to check if Chrome extension context is valid\r\n  const isChromeContextValid = () => {\r\n    try {\r\n      return chrome && chrome.runtime && chrome.runtime.id;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  browserAPI = {\r\n    runtime: {\r\n      sendMessage: (message, callback) => {\r\n        // If callback is provided, use callback-based API\r\n        if (typeof callback === 'function') {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              console.error('\u274C Extension context invalidated');\r\n              callback(null);\r\n              return;\r\n            }\r\n            chrome.runtime.sendMessage(message, callback);\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            callback(null);\r\n          }\r\n          return;\r\n        }\r\n        // Otherwise return a Promise\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.runtime.sendMessage(message, (response) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(response);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            reject(error);\r\n          }\r\n        });\r\n      },\r\n      onMessage: chrome.runtime.onMessage,\r\n      getURL: (path) => {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.getURL(path);\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      getManifest: () => {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.getManifest();\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      get id() {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.id;\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      get lastError() {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.lastError;\r\n        } catch (error) {\r\n          return null;\r\n        }\r\n      },\r\n      connectNative: (application) => {\r\n        try {\r\n          if (!isChromeContextValid()) {\r\n            console.error('\u274C Extension context invalidated');\r\n            return null;\r\n          }\r\n          const port = chrome.runtime.connectNative(application);\r\n          // Check for immediate errors\r\n          if (chrome.runtime.lastError) {\r\n            console.warn('\u26A0\uFE0F Native messaging error:', chrome.runtime.lastError.message);\r\n            return null;\r\n          }\r\n          return port;\r\n        } catch (error) {\r\n          console.error('\u274C Native messaging error:', error.message);\r\n          return null;\r\n        }\r\n      }\r\n    },\r\n    storage: {\r\n      local: {\r\n        get: (keys) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.get(keys, (result) => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve(result);\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        set: (items) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.set(items, () => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        remove: (keys) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.remove(keys, () => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        clear: () => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.clear(() => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        }\r\n      }\r\n    },\r\n    tabs: {\r\n      query: (queryInfo) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.query(queryInfo, (tabs) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tabs);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      },\r\n      sendMessage: (tabId, message, callback) => {\r\n        // If callback is provided, use callback-based API\r\n        if (typeof callback === 'function') {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              console.error('\u274C Extension context invalidated');\r\n              callback(null);\r\n              return;\r\n            }\r\n            chrome.tabs.sendMessage(tabId, message, callback);\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            callback(null);\r\n          }\r\n          return;\r\n        }\r\n        // Otherwise return a Promise\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.sendMessage(tabId, message, (response) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(response);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            reject(error);\r\n          }\r\n        });\r\n      },\r\n      create: (createProperties) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.create(createProperties, (tab) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tab);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      },\r\n      update: (tabId, updateProperties) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.update(tabId, updateProperties, (tab) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tab);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      }\r\n    }\r\n  };\r\n} else {\r\n  console.error('\u274C FATAL: No browser API available!');\r\n  throw new Error('No browser API available');\r\n}\r\n\r\n// Expose as browserAPI for consistent naming\r\nglobalScope.browserAPI = browserAPI;\r\n\r\n// Verify API is available\r\nif (!globalScope.browserAPI || !globalScope.browserAPI.runtime) {\r\n  console.error('\u274C FATAL: Browser API not available!');\r\n  throw new Error('Browser API not available');\r\n}\r\n\r\nconsole.log('\u2705 Browser API ready:', (typeof browser !== 'undefined' && browserAPI === browser) ? 'Firefox' : 'Chrome');\r\n", "/**\r\n * Custom Character Sheet Overlay for Roll20\r\n * Displays Dice Cloud character data in a beautiful, interactive overlay\r\n */\r\n\r\n// Import browser polyfill for cross-browser compatibility\r\nimport '@carmaclouds/core/common/browser-polyfill.js';\r\n\r\n// Define debug for content script context\r\nconst debug = window.debug || {\r\n  log: console.log.bind(console),\r\n  warn: console.warn.bind(console),\r\n  error: console.error.bind(console),\r\n  info: console.info.bind(console),\r\n  group: console.group.bind(console),\r\n  groupEnd: console.groupEnd.bind(console),\r\n  table: console.table.bind(console),\r\n  time: console.time.bind(console),\r\n  timeEnd: console.timeEnd.bind(console),\r\n  isEnabled: () => true\r\n};\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  debug.log('\uD83C\uDFB2 FoundCloud: Custom sheet overlay loaded');\r\n\r\n  let characterData = null;\r\n  let overlayVisible = false;\r\n  let overlayElement = null;\r\n  let activePopupWindow = null; // Track the currently open popup to ensure only one at a time\r\n\r\n  // Roll statistics and history\r\n  const rollStats = {\r\n    history: [],\r\n    settings: {\r\n      enabled: true,\r\n      showNotifications: true,\r\n      showHistory: true,\r\n      maxHistorySize: 20,\r\n      advantageMode: 'normal' // 'normal', 'advantage', 'disadvantage'\r\n    },\r\n    stats: {\r\n      totalRolls: 0,\r\n      averageRoll: 0,\r\n      highestRoll: 0,\r\n      lowestRoll: Infinity,\r\n      criticalSuccesses: 0,\r\n      criticalFailures: 0\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Utility function to position popup within viewport bounds\r\n   * Cached viewport dimensions to avoid forced reflows\r\n   * @param {number} x - Initial X position (clientX)\r\n   * @param {number} y - Initial Y position (clientY)\r\n   * @param {number} width - Popup width (default: 200)\r\n   * @param {number} height - Popup height (default: 150)\r\n   * @returns {Object} - Adjusted x, y coordinates within viewport\r\n   */\r\n  const viewportCache = { width: 0, height: 0, lastUpdate: 0 };\r\n  function getPopupPosition(x, y, width = 200, height = 150) {\r\n    // Cache viewport dimensions for 100ms to avoid repeated layout reads\r\n    const now = Date.now();\r\n    if (now - viewportCache.lastUpdate > 100) {\r\n      viewportCache.width = window.innerWidth;\r\n      viewportCache.height = window.innerHeight;\r\n      viewportCache.lastUpdate = now;\r\n    }\r\n\r\n    const viewportWidth = viewportCache.width;\r\n    const viewportHeight = viewportCache.height;\r\n\r\n    // Adjust horizontal position\r\n    let adjustedX = x;\r\n    if (x + width > viewportWidth) {\r\n      adjustedX = viewportWidth - width - 10; // 10px margin from edge\r\n      if (adjustedX < 10) adjustedX = 10; // Ensure minimum margin from left edge\r\n    }\r\n\r\n    // Adjust vertical position\r\n    let adjustedY = y;\r\n    if (y + height > viewportHeight) {\r\n      adjustedY = viewportHeight - height - 10; // 10px margin from edge\r\n      if (adjustedY < 10) adjustedY = 10; // Ensure minimum margin from top edge\r\n    }\r\n\r\n    return { x: adjustedX, y: adjustedY };\r\n  }\r\n\r\n  /**\r\n   * Creates the custom character sheet overlay\r\n   */\r\n  function createOverlay() {\r\n    if (overlayElement) return;\r\n\r\n    overlayElement = document.createElement('div');\r\n    overlayElement.id = 'rollcloud-character-overlay';\r\n    overlayElement.innerHTML = `\r\n      <div class=\"rollcloud-sheet-container\">\r\n        <div class=\"rollcloud-header\">\r\n          <div class=\"sheet-title\">\r\n            <h2 id=\"character-name\">Character Name</h2>\r\n            <div class=\"character-subtitle\">\r\n              <span id=\"character-class\">Class</span> \r\n              <span id=\"character-level\">Level 1</span> \u2022 \r\n              <span id=\"character-race\">Race</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"sheet-controls\">\r\n            <button class=\"control-btn\" id=\"popout-btn\">\uD83D\uDD17 Pop Out</button>\r\n            <button class=\"control-btn\" id=\"sync-btn\">\uD83D\uDD04 Sync Data</button>\r\n            <button class=\"control-btn\" id=\"close-btn\">\u2715 Close</button>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"rollcloud-content\">\r\n          <!-- Abilities -->\r\n          <div class=\"section\">\r\n            <h3>\u26A1 Abilities</h3>\r\n            <div class=\"abilities-grid\">\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Strength Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">STR</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Dexterity Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">DEX</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Constitution Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">CON</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Intelligence Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">INT</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Wisdom Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">WIS</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Charisma Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">CHA</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Combat Stats -->\r\n          <div class=\"section\">\r\n            <h3>\u2694\uFE0F Combat</h3>\r\n            <div class=\"combat-stats\">\r\n              <div class=\"combat-stat\">\r\n                <label>Armor Class</label>\r\n                <div class=\"value\" id=\"ac\">10</div>\r\n              </div>\r\n              <div class=\"combat-stat\">\r\n                <label>Hit Points</label>\r\n                <div class=\"hp-input-group\">\r\n                  <input type=\"number\" id=\"hp-current\" class=\"hp-input\" value=\"10\" min=\"0\">\r\n                  <span class=\"hp-separator\">/</span>\r\n                  <input type=\"number\" id=\"hp-max\" class=\"hp-input\" value=\"10\" min=\"0\">\r\n                </div>\r\n              </div>\r\n              <div class=\"combat-stat\">\r\n                <label>Speed</label>\r\n                <div class=\"value\" id=\"speed\">30</div>\r\n              </div>\r\n              <div class=\"combat-stat\">\r\n                <label>Initiative</label>\r\n                <button class=\"initiative-btn\" id=\"initiative-btn\">+0</button>\r\n              </div>\r\n              <div class=\"combat-stat\">\r\n                <label>Proficiency</label>\r\n                <div class=\"value\" id=\"proficiency\">+2</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Saving Throws -->\r\n          <div class=\"section\">\r\n            <h3>\uD83D\uDEE1\uFE0F Saving Throws</h3>\r\n            <div class=\"saves-grid\">\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">STR</span>\r\n                <span class=\"save-bonus\" id=\"strength-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">DEX</span>\r\n                <span class=\"save-bonus\" id=\"dexterity-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">CON</span>\r\n                <span class=\"save-bonus\" id=\"constitution-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">INT</span>\r\n                <span class=\"save-bonus\" id=\"intelligence-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">WIS</span>\r\n                <span class=\"save-bonus\" id=\"wisdom-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">CHA</span>\r\n                <span class=\"save-bonus\" id=\"charisma-save\">+0</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Skills -->\r\n          <div class=\"section\">\r\n            <h3> Skills</h3>\r\n            <div class=\"skills-grid\">\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Acrobatics</span>\r\n                <span class=\"skill-bonus\" id=\"acrobatics\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Animal Handling</span>\r\n                <span class=\"skill-bonus\" id=\"animal-handling\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Arcana</span>\r\n                <span class=\"skill-bonus\" id=\"arcana\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Athletics</span>\r\n                <span class=\"skill-bonus\" id=\"athletics\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Deception</span>\r\n                <span class=\"skill-bonus\" id=\"deception\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">History</span>\r\n                <span class=\"skill-bonus\" id=\"history\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Insight</span>\r\n                <span class=\"skill-bonus\" id=\"insight\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Intimidation</span>\r\n                <span class=\"skill-bonus\" id=\"intimidation\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Investigation</span>\r\n                <span class=\"skill-bonus\" id=\"investigation\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Medicine</span>\r\n                <span class=\"skill-bonus\" id=\"medicine\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Nature</span>\r\n                <span class=\"skill-bonus\" id=\"nature\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Perception</span>\r\n                <span class=\"skill-bonus\" id=\"perception\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Performance</span>\r\n                <span class=\"skill-bonus\" id=\"performance\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Persuasion</span>\r\n                <span class=\"skill-bonus\" id=\"persuasion\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Religion</span>\r\n                <span class=\"skill-bonus\" id=\"religion\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Sleight of Hand</span>\r\n                <span class=\"skill-bonus\" id=\"sleight-of-hand\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Stealth</span>\r\n                <span class=\"skill-bonus\" id=\"stealth\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Survival</span>\r\n                <span class=\"skill-bonus\" id=\"survival\">+0</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Resources (Vexus Fields) -->\r\n          <div class=\"section\">\r\n            <h3>\uD83D\uDD2E Resources</h3>\r\n            <div class=\"resources-grid\">\r\n              <div class=\"resource-card\">\r\n                <label>Level 1 Slots</label>\r\n                <div class=\"value\" id=\"level1-slots\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Level 2 Slots</label>\r\n                <div class=\"value\" id=\"level2-slots\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Level 3 Slots</label>\r\n                <div class=\"value\" id=\"level3-slots\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Ki Points</label>\r\n                <div class=\"value\" id=\"ki\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Sorcery Points</label>\r\n                <div class=\"value\" id=\"sorcery-points\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Rages</label>\r\n                <div class=\"value\" id=\"rages\">0</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Additional Variables -->\r\n          <div class=\"section\" id=\"additional-variables\">\r\n            <h3>\uD83D\uDCCA Additional Variables</h3>\r\n            <div id=\"variables-grid\">\r\n              <!-- Dynamic content will be added here -->\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Spells -->\r\n          <div class=\"section spells-section\">\r\n            <h3>\uD83D\uDD2E Spells</h3>\r\n            <div class=\"spells-grid\" id=\"spells-grid\">\r\n              <div class=\"empty-state\">No spells available</div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Spell Slots -->\r\n          <div class=\"section spell-slots-section\">\r\n            <h3>\u2728 Spell Slots</h3>\r\n            <div class=\"spell-slots-grid\" id=\"spell-slots-grid\">\r\n              <div class=\"empty-state\">No spell slots available</div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Dice Cloud Panels -->\r\n          <div class=\"dicecloud-panels\">\r\n            <!-- Roll History Panel -->\r\n            <div class=\"panel-section\" id=\"roll-history-panel\">\r\n              <div class=\"panel-header\">\r\n                <span class=\"panel-title\">\uD83C\uDFB2 Roll History</span>\r\n                <button class=\"panel-toggle\" id=\"history-toggle\">\u2212</button>\r\n              </div>\r\n              <div class=\"panel-content\">\r\n                <div class=\"history-list\" id=\"roll-history-list\">\r\n                  <div class=\"empty-state\">No rolls yet. Make some rolls!</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Statistics Panel -->\r\n            <div class=\"panel-section\" id=\"stats-panel\">\r\n              <div class=\"panel-header\">\r\n                <span class=\"panel-title\">\uD83D\uDCCA Statistics</span>\r\n                <button class=\"panel-toggle\" id=\"stats-toggle\">\u2212</button>\r\n              </div>\r\n              <div class=\"panel-content\">\r\n                <div class=\"stats-grid\">\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">Total Rolls</span>\r\n                    <span class=\"stat-value\" id=\"stat-total\">0</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">Average</span>\r\n                    <span class=\"stat-value\" id=\"stat-average\">0.0</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">Highest</span>\r\n                    <span class=\"stat-value\" id=\"stat-highest\">0</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">Lowest</span>\r\n                    <span class=\"stat-value\" id=\"stat-lowest\">\u221E</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">\u2B50 Critical Hits</span>\r\n                    <span class=\"stat-value\" id=\"stat-crits\">0</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">\uD83D\uDC80 Critical Fails</span>\r\n                    <span class=\"stat-value\" id=\"stat-fails\">0</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Settings Panel -->\r\n            <div class=\"panel-section\" id=\"settings-panel\">\r\n              <div class=\"panel-header\">\r\n                <span class=\"panel-title\">\u2699\uFE0F Roll Settings</span>\r\n                <button class=\"panel-toggle\" id=\"settings-toggle\">\u2212</button>\r\n              </div>\r\n              <div class=\"panel-content\">\r\n                <div class=\"setting-group\">\r\n                  <label class=\"setting-label\">Roll Mode</label>\r\n                  <div class=\"toggle-buttons\">\r\n                    <button class=\"toggle-btn active\" data-mode=\"normal\">Normal</button>\r\n                    <button class=\"toggle-btn\" data-mode=\"advantage\">Advantage</button>\r\n                    <button class=\"toggle-btn\" data-mode=\"disadvantage\">Disadvantage</button>\r\n                  </div>\r\n                </div>\r\n                <div class=\"setting-description\">\r\n                  Choose how d20 rolls are calculated when forwarded to Roll20\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Add styles\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      #rollcloud-character-overlay {\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        background: rgba(0, 0, 0, 0.8);\r\n        backdrop-filter: blur(5px);\r\n        z-index: 999999;\r\n        display: none;\r\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n      }\r\n\r\n      .rollcloud-sheet-container {\r\n        position: absolute;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        width: 90%;\r\n        max-width: 1200px;\r\n        max-height: 90vh;\r\n        background: white;\r\n        border-radius: 16px;\r\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\r\n        overflow: hidden;\r\n        display: flex;\r\n        flex-direction: column;\r\n        border: 2px solid #4ECDC4;\r\n      }\r\n\r\n      .rollcloud-header {\r\n        background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);\r\n        color: white;\r\n        padding: 20px;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        border-bottom: 2px solid #4ECDC4;\r\n      }\r\n\r\n      .sheet-title h2 {\r\n        margin: 0 0 5px 0;\r\n        font-size: 1.8em;\r\n      }\r\n\r\n      .character-subtitle {\r\n        font-size: 1.1em;\r\n        opacity: 0.9;\r\n      }\r\n\r\n      .sheet-controls {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .control-btn {\r\n        background: rgba(255, 255, 255, 0.2);\r\n        border: none;\r\n        color: white;\r\n        padding: 8px 12px;\r\n        border-radius: 8px;\r\n        cursor: pointer;\r\n        font-size: 16px;\r\n        transition: background 0.2s;\r\n      }\r\n\r\n      .control-btn:hover {\r\n        background: rgba(255, 255, 255, 0.3);\r\n      }\r\n\r\n      .rollcloud-content {\r\n        padding: 20px;\r\n        overflow-y: auto;\r\n        flex: 1;\r\n      }\r\n\r\n      .section {\r\n        margin-bottom: 25px;\r\n      }\r\n\r\n      .section h3 {\r\n        margin: 0 0 15px 0;\r\n        color: #2C3E50;\r\n        border-bottom: 2px solid #4ECDC4;\r\n        padding-bottom: 5px;\r\n      }\r\n\r\n      .abilities-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\r\n        gap: 15px;\r\n      }\r\n\r\n      .ability-card {\r\n        background: linear-gradient(135deg, #f0fff4 0%, #e8f8f5 100%);\r\n        padding: 15px;\r\n        border-radius: 12px;\r\n        text-align: center;\r\n        border: 2px solid #4ECDC4;\r\n        transition: transform 0.2s;\r\n        position: relative;\r\n        cursor: pointer;\r\n      }\r\n\r\n      .ability-card:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);\r\n      }\r\n\r\n      .ability-card:active {\r\n        transform: translateY(0);\r\n      }\r\n\r\n      .roll-indicator {\r\n        position: absolute;\r\n        top: 5px;\r\n        right: 5px;\r\n        background: #27AE60;\r\n        color: white;\r\n        border: none;\r\n        width: 24px;\r\n        height: 24px;\r\n        border-radius: 50%;\r\n        font-size: 12px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);\r\n        pointer-events: none;\r\n      }\r\n\r\n      .skill-roll-btn {\r\n        background: #27AE60;\r\n        color: white;\r\n        border: none;\r\n        padding: 4px 8px;\r\n        border-radius: 4px;\r\n        font-size: 12px;\r\n        cursor: pointer;\r\n        transition: background 0.2s;\r\n      }\r\n\r\n      .skill-roll-btn:hover {\r\n        background: #229954;\r\n      }\r\n\r\n      .ability-name {\r\n        font-weight: bold;\r\n        color: #2C3E50;\r\n        font-size: 0.9em;\r\n        margin-bottom: 5px;\r\n      }\r\n\r\n      .ability-score {\r\n        font-size: 2em;\r\n        font-weight: bold;\r\n        color: #4ECDC4;\r\n        line-height: 1;\r\n      }\r\n\r\n      .ability-mod {\r\n        color: #27AE60;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .combat-stats, .resources-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\r\n        gap: 15px;\r\n      }\r\n\r\n      .combat-stat, .resource-card {\r\n        background: #f0fff4;\r\n        padding: 15px;\r\n        border-radius: 8px;\r\n        text-align: center;\r\n        border: 1px solid #4ECDC4;\r\n      }\r\n\r\n      .combat-stat label, .resource-card label {\r\n        display: block;\r\n        font-weight: bold;\r\n        color: #2C3E50;\r\n        margin-bottom: 8px;\r\n        font-size: 0.9em;\r\n      }\r\n\r\n      .combat-stat .value, .resource-card .value {\r\n        font-size: 1.4em;\r\n        font-weight: bold;\r\n        color: #4ECDC4;\r\n      }\r\n\r\n      .hp-input-group {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 5px;\r\n      }\r\n\r\n      .hp-input {\r\n        width: 50px;\r\n        text-align: center;\r\n        font-size: 1.2em;\r\n        font-weight: bold;\r\n        color: #4ECDC4;\r\n        background: white;\r\n        border: 2px solid #4ECDC4;\r\n        border-radius: 4px;\r\n        padding: 4px;\r\n      }\r\n\r\n      .hp-separator {\r\n        font-weight: bold;\r\n        color: #4ECDC4;\r\n        font-size: 1.2em;\r\n      }\r\n\r\n      .initiative-btn {\r\n        background: #4ECDC4;\r\n        color: white;\r\n        border: none;\r\n        padding: 8px 12px;\r\n        border-radius: 6px;\r\n        font-size: 1.2em;\r\n        font-weight: bold;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .initiative-btn:hover {\r\n        background: #44A08D;\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3);\r\n      }\r\n\r\n      .saves-grid, .skills-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\r\n        gap: 10px;\r\n      }\r\n\r\n      .save-card, .skill-card {\r\n        background: #f0fff4;\r\n        padding: 10px;\r\n        border-radius: 8px;\r\n        border: 1px solid #4ECDC4;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        cursor: pointer;\r\n        transition: transform 0.2s, box-shadow 0.2s;\r\n      }\r\n\r\n      .save-card:hover, .skill-card:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);\r\n      }\r\n\r\n      .save-name, .skill-name {\r\n        font-weight: bold;\r\n        color: #2C3E50;\r\n      }\r\n\r\n      .save-bonus, .skill-bonus {\r\n        font-weight: bold;\r\n        color: #4ECDC4;\r\n        background: white;\r\n        padding: 2px 8px;\r\n        border-radius: 12px;\r\n        border: 1px solid #4ECDC4;\r\n      }\r\n\r\n      #variables-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n        gap: 10px;\r\n      }\r\n\r\n      .variable-card {\r\n        background: #f0fff4;\r\n        padding: 10px;\r\n        border-radius: 8px;\r\n        border: 1px solid #4ECDC4;\r\n      }\r\n\r\n      .variable-name {\r\n        font-weight: bold;\r\n        color: #2C3E50;\r\n        font-size: 0.9em;\r\n      }\r\n\r\n      .variable-value {\r\n        color: #4ECDC4;\r\n        font-weight: bold;\r\n      }\r\n\r\n      /* Dice Cloud Panels */\r\n      .dicecloud-panels {\r\n        display: grid;\r\n        grid-template-columns: 1fr;\r\n        gap: 20px;\r\n        margin-top: 20px;\r\n      }\r\n\r\n      .panel-section {\r\n        background: #f0fff4;\r\n        border-radius: 12px;\r\n        border: 1px solid #4ECDC4;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .panel-header {\r\n        background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);\r\n        color: white;\r\n        padding: 15px 20px;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        cursor: pointer;\r\n      }\r\n\r\n      .panel-title {\r\n        font-weight: bold;\r\n        font-size: 1.1em;\r\n      }\r\n\r\n      .panel-toggle {\r\n        background: rgba(255, 255, 255, 0.2);\r\n        border: none;\r\n        color: white;\r\n        font-size: 20px;\r\n        cursor: pointer;\r\n        padding: 0;\r\n        width: 30px;\r\n        height: 30px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        border-radius: 6px;\r\n        transition: background 0.2s;\r\n      }\r\n\r\n      .panel-toggle:hover {\r\n        background: rgba(255, 255, 255, 0.3);\r\n      }\r\n\r\n      .panel-content {\r\n        padding: 20px;\r\n      }\r\n\r\n      .history-list {\r\n        max-height: 300px;\r\n        overflow-y: auto;\r\n      }\r\n\r\n      .history-item {\r\n        background: white;\r\n        padding: 12px;\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n        border: 1px solid #4ECDC4;\r\n        animation: slideIn 0.3s ease-out;\r\n      }\r\n\r\n      .history-item-header {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        margin-bottom: 5px;\r\n      }\r\n\r\n      .history-name {\r\n        font-weight: bold;\r\n        color: #2C3E50;\r\n      }\r\n\r\n      .history-time {\r\n        color: #6c757d;\r\n        font-size: 0.9em;\r\n      }\r\n\r\n      .history-formula {\r\n        font-family: 'Courier New', monospace;\r\n        color: #4ECDC4;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .history-badges {\r\n        margin-top: 5px;\r\n        display: flex;\r\n        gap: 5px;\r\n        flex-wrap: wrap;\r\n      }\r\n\r\n      .history-badge {\r\n        background: #e9ecef;\r\n        color: #495057;\r\n        padding: 2px 8px;\r\n        border-radius: 12px;\r\n        font-size: 0.8em;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .critical-success {\r\n        background: #d4edda;\r\n        color: #155724;\r\n      }\r\n\r\n      .critical-failure {\r\n        background: #f8d7da;\r\n        color: #721c24;\r\n      }\r\n\r\n      .stats-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(3, 1fr);\r\n        gap: 15px;\r\n      }\r\n\r\n      .stat-item {\r\n        background: white;\r\n        padding: 15px;\r\n        border-radius: 8px;\r\n        text-align: center;\r\n        border: 1px solid #dee2e6;\r\n      }\r\n\r\n      .stat-label {\r\n        display: block;\r\n        font-weight: bold;\r\n        color: #6c757d;\r\n        font-size: 0.9em;\r\n        margin-bottom: 8px;\r\n      }\r\n\r\n      .stat-value {\r\n        font-size: 1.5em;\r\n        font-weight: bold;\r\n        color: #667eea;\r\n      }\r\n\r\n      .setting-group {\r\n        margin-bottom: 20px;\r\n      }\r\n\r\n      .setting-label {\r\n        display: block;\r\n        font-weight: bold;\r\n        color: #495057;\r\n        margin-bottom: 10px;\r\n      }\r\n\r\n      .toggle-buttons {\r\n        display: grid;\r\n        grid-template-columns: repeat(3, 1fr);\r\n        gap: 8px;\r\n      }\r\n\r\n      .toggle-btn {\r\n        background: #e9ecef;\r\n        border: 2px solid #dee2e6;\r\n        color: #495057;\r\n        padding: 12px 16px;\r\n        border-radius: 8px;\r\n        cursor: pointer;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        transition: all 0.2s;\r\n        text-align: center;\r\n      }\r\n\r\n      .toggle-btn:hover {\r\n        background: #f8f9fa;\r\n        border-color: #adb5bd;\r\n        transform: translateY(-1px);\r\n      }\r\n\r\n      .toggle-btn.active {\r\n        background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);\r\n        border-color: #4ECDC4;\r\n        color: white;\r\n        box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3);\r\n      }\r\n\r\n      .setting-description {\r\n        background: rgba(78, 205, 196, 0.1);\r\n        padding: 12px;\r\n        border-radius: 8px;\r\n        font-size: 0.9em;\r\n        color: #2C3E50;\r\n        text-align: center;\r\n        margin-top: 10px;\r\n        border: 1px solid #4ECDC4;\r\n      }\r\n\r\n      .empty-state {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: #6c757d;\r\n        font-style: italic;\r\n      }\r\n\r\n      /* Spells Section */\r\n      .spells-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\r\n        gap: 12px;\r\n      }\r\n\r\n      .spell-card {\r\n        background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);\r\n        padding: 12px;\r\n        border-radius: 8px;\r\n        border: 1px solid #667eea;\r\n        cursor: pointer;\r\n        transition: transform 0.2s, box-shadow 0.2s;\r\n      }\r\n\r\n      .spell-card.spell-attack:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);\r\n        border-color: #e74c3c;\r\n      }\r\n\r\n      .spell-card.spell-utility:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);\r\n        border-color: #3498db;\r\n      }\r\n\r\n      .spell-header {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      .spell-name {\r\n        font-weight: bold;\r\n        color: #2C3E50;\r\n      }\r\n\r\n      .spell-action {\r\n        font-size: 16px;\r\n        opacity: 0.8;\r\n      }\r\n\r\n      .spell-details {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      .spell-level, .spell-school {\r\n        font-size: 11px;\r\n        padding: 2px 6px;\r\n        border-radius: 4px;\r\n        background: #667eea;\r\n        color: white;\r\n      }\r\n\r\n      .spell-casting-time {\r\n        font-size: 11px;\r\n        color: #7f8c8d;\r\n        font-style: italic;\r\n      }\r\n\r\n      @keyframes slideIn {\r\n        from {\r\n          opacity: 0;\r\n          transform: translateY(10px);\r\n        }\r\n        to {\r\n          opacity: 1;\r\n          transform: translateY(0);\r\n        }\r\n      }\r\n\r\n      @keyframes slideOut {\r\n        from {\r\n          opacity: 1;\r\n          transform: translateY(0);\r\n        }\r\n        to {\r\n          opacity: 0;\r\n          transform: translateY(-10px);\r\n        }\r\n      }\r\n\r\n      @keyframes fadeIn {\r\n        from {\r\n          opacity: 0;\r\n        }\r\n        to {\r\n          opacity: 1;\r\n        }\r\n      }\r\n\r\n      @keyframes fadeOut {\r\n        from {\r\n          opacity: 1;\r\n        }\r\n        to {\r\n          opacity: 0;\r\n        }\r\n      }\r\n    `;\r\n\r\n    document.head.appendChild(style);\r\n    document.body.appendChild(overlayElement);\r\n\r\n    // Add event listeners\r\n    const closeBtn = document.getElementById('close-btn');\r\n    const popoutBtn = document.getElementById('popout-btn');\r\n    const syncBtn = document.getElementById('sync-btn');\r\n    \r\n    if (closeBtn) {\r\n      closeBtn.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        debug.log('\uD83D\uDD34 Close button clicked');\r\n        hideOverlay();\r\n      });\r\n    } else {\r\n      debug.error('\u274C Close button not found');\r\n    }\r\n    \r\n    if (popoutBtn) {\r\n      popoutBtn.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        debug.log('\uD83D\uDD17 Pop out button clicked');\r\n        popOutCharacterSheet();\r\n      });\r\n    } else {\r\n      debug.error('\u274C Pop out button not found');\r\n    }\r\n    \r\n    if (syncBtn) {\r\n      syncBtn.addEventListener('click', () => {\r\n        debug.log('\uD83D\uDD04 Manual sync triggered from character sheet');\r\n        \r\n        // Show loading state\r\n        const originalText = syncBtn.innerHTML;\r\n        syncBtn.innerHTML = '\uD83D\uDD04 Syncing...';\r\n        syncBtn.disabled = true;\r\n        \r\n        // Reload character data from extension storage\r\n        loadCharacterData();\r\n        \r\n        // Reset button after a delay\r\n        setTimeout(() => {\r\n          syncBtn.innerHTML = originalText;\r\n          syncBtn.disabled = false;\r\n        }, 2000);\r\n      });\r\n    } else {\r\n      debug.error('\u274C Sync button not found');\r\n    }\r\n\r\n    // Add panel event listeners\r\n    document.getElementById('history-toggle').addEventListener('click', () => togglePanel('history'));\r\n    document.getElementById('stats-toggle').addEventListener('click', () => togglePanel('stats'));\r\n    document.getElementById('settings-toggle').addEventListener('click', () => togglePanel('settings'));\r\n\r\n    // Note: Dragging is not needed as overlay is shown in popup window\r\n  }\r\n\r\n  /**\r\n   * Opens the character sheet in a popup window\r\n   */\r\n  function popOutCharacterSheet() {\r\n    debug.log('\uD83D\uDD17 Opening character sheet in popup...');\r\n    showOverlay();\r\n  }\r\n\r\n  /**\r\n   * Loads character data from extension storage\r\n   */\r\n  function loadCharacterData() {\r\n    debug.log('\uD83D\uDD04 Loading character data from storage...');\r\n    browserAPI.runtime.sendMessage({ action: 'getCharacterData' }, (response) => {\r\n      if (browserAPI.runtime.lastError) {\r\n        debug.error('\u274C Extension context error:', browserAPI.runtime.lastError);\r\n        showNotification('Failed to load character data', 'error');\r\n        return;\r\n      }\r\n\r\n      if (response && response.data) {\r\n        debug.log('\u2705 Character data loaded:', response.data.name);\r\n        characterData = response.data;\r\n\r\n        showNotification('Character data synced! \uD83C\uDFB2', 'success');\r\n      } else {\r\n        debug.log('\uD83D\uDCCB No character data found');\r\n        showNotification('No character data found. Please sync from Dice Cloud first.', 'error');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Posts spell description to Roll20 chat\r\n   */\r\n  function postSpellDescriptionToChat(spellName, spellLevel, spellDescription) {\r\n    debug.log('\uD83D\uDD2E Posting spell description to chat:', spellName);\r\n\r\n    const message = `/em casts **${spellName}** (Level ${spellLevel})\\n${spellDescription || 'No description available'}`;\r\n\r\n    const success = postChatMessage(message);\r\n    if (success) {\r\n      showNotification(`${spellName} description posted to chat! \u2728`, 'success');\r\n    } else {\r\n      showNotification('Failed to post to chat. Make sure you are on Roll20.', 'error');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds roll event listeners to all rollable elements\r\n   */\r\n  function addRollEventListeners() {\r\n    // Add roll button listeners\r\n    document.querySelectorAll('.ability-card').forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const roll = card.getAttribute('data-roll');\r\n        const name = card.getAttribute('data-name');\r\n        debug.log(`\uD83C\uDFB2 Clicked ability card: ${name} (${roll})`);\r\n        rollSimultaneously(name, roll);\r\n      });\r\n    });\r\n\r\n    // Add spell card listeners\r\n    document.querySelectorAll('.spell-card').forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        debug.log('\uD83D\uDD2E Spell card clicked, checking data attributes...');\r\n        \r\n        const spellName = card.getAttribute('data-spell');\r\n        const spellLevel = card.getAttribute('data-spell-level');\r\n        const spellDescription = card.getAttribute('data-spell-description');\r\n        const clickAction = card.getAttribute('data-click-action');\r\n        \r\n        debug.log(`\uD83D\uDD2E Clicked spell: ${spellName} (Level ${spellLevel}) - Action: ${clickAction}`);\r\n        debug.log('\uD83D\uDD2E Spell description:', spellDescription);\r\n        \r\n        // Always show the description first\r\n        debug.log('\uD83D\uDD2E Posting spell description to chat');\r\n        postSpellDescriptionToChat(spellName, spellLevel, spellDescription);\r\n        \r\n        // Then roll if it's an attack spell\r\n        if (clickAction === 'rollAttack') {\r\n          // Create a spell attack roll (d20 + spell level + proficiency)\r\n          const spellAttackRoll = `1d20+${parseInt(spellLevel) || 0}+${characterData.proficiencyBonus || 2}`;\r\n          debug.log('\uD83D\uDD2E Rolling spell attack:', spellAttackRoll);\r\n          rollSimultaneously(`${spellName} Spell Attack`, spellAttackRoll);\r\n        }\r\n      });\r\n    });\r\n\r\n    // Add skill card listeners\r\n    document.querySelectorAll('.skill-card').forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const skillName = card.querySelector('.skill-name').textContent;\r\n        const skillBonus = card.querySelector('.skill-bonus').textContent;\r\n        debug.log(`\uD83C\uDFB2 Clicked skill card: ${skillName} (${skillBonus})`);\r\n        rollSimultaneously(skillName, `1d20${skillBonus}`);\r\n      });\r\n    });\r\n\r\n    // Add save card listeners\r\n    document.querySelectorAll('.save-card').forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const saveName = card.querySelector('.save-name').textContent;\r\n        const saveBonus = card.querySelector('.save-bonus').textContent;\r\n        debug.log(` Clicked save card: ${saveName} (${saveBonus})`);\r\n        rollSimultaneously(`${saveName} Save`, `1d20${saveBonus}`);\r\n      });\r\n    });\r\n\r\n    // Add settings toggle listeners (moved here to ensure buttons exist)\r\n    document.querySelectorAll('.toggle-btn').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        const mode = e.target.getAttribute('data-mode');\r\n        setAdvantageMode(mode);\r\n      });\r\n    });\r\n\r\n    // Add initiative button listener\r\n    const initiativeBtn = document.getElementById('initiative-btn');\r\n    if (initiativeBtn) {\r\n      initiativeBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const initiative = characterData.initiative || 0;\r\n        debug.log(`\uD83C\uDFB2 Initiative check: 1d20+${initiative}`);\r\n        rollSimultaneously('Initiative Check', `1d20+${initiative}`);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles panel visibility\r\n   */\r\n  function togglePanel(panelName) {\r\n    const panel = document.getElementById(`${panelName}-panel`);\r\n    const content = panel.querySelector('.panel-content');\r\n    const toggle = document.getElementById(`${panelName}-toggle`);\r\n    \r\n    if (content.style.display === 'none') {\r\n      content.style.display = 'block';\r\n      toggle.textContent = '\u2212';\r\n    } else {\r\n      content.style.display = 'none';\r\n      toggle.textContent = '+';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the advantage mode\r\n   */\r\n  function setAdvantageMode(mode) {\r\n    rollStats.settings.advantageMode = mode;\r\n    \r\n    // Update button states\r\n    document.querySelectorAll('.toggle-btn').forEach(btn => {\r\n      const btnMode = btn.getAttribute('data-mode');\r\n      if (btnMode === mode) {\r\n        btn.classList.add('active');\r\n      } else {\r\n        btn.classList.remove('active');\r\n      }\r\n    });\r\n    \r\n    debug.log(`\uD83C\uDFB2 Roll mode set to: ${mode}`);\r\n  }\r\n\r\n  /**\r\n   * Updates roll statistics\r\n   */\r\n  function updateRollStatistics(rollData) {\r\n    const result = parseInt(rollData.result);\r\n    if (isNaN(result)) return;\r\n\r\n    rollStats.stats.totalRolls++;\r\n    rollStats.stats.highestRoll = Math.max(rollStats.stats.highestRoll, result);\r\n    rollStats.stats.lowestRoll = Math.min(rollStats.stats.lowestRoll, result);\r\n\r\n    // Update average (running average)\r\n    rollStats.stats.averageRoll =\r\n      (rollStats.stats.averageRoll * (rollStats.stats.totalRolls - 1) + result) /\r\n      rollStats.stats.totalRolls;\r\n\r\n    // Check for criticals\r\n    const formula = rollData.formula.toLowerCase();\r\n    if (formula.includes('d20') || formula.includes('1d20')) {\r\n      if (result === 20) {\r\n        rollStats.stats.criticalSuccesses++;\r\n      } else if (result === 1) {\r\n        rollStats.stats.criticalFailures++;\r\n      }\r\n    }\r\n\r\n    updateStatsDisplay();\r\n  }\r\n\r\n  /**\r\n   * Updates statistics display\r\n   */\r\n  function updateStatsDisplay() {\r\n    // Check if elements exist (they won't exist if overlay is in popup window)\r\n    const statTotal = document.getElementById('stat-total');\r\n    if (!statTotal) return; // Overlay not on this page\r\n\r\n    statTotal.textContent = rollStats.stats.totalRolls;\r\n    document.getElementById('stat-average').textContent = rollStats.stats.averageRoll.toFixed(1);\r\n    document.getElementById('stat-highest').textContent = rollStats.stats.highestRoll;\r\n    document.getElementById('stat-lowest').textContent =\r\n      rollStats.stats.lowestRoll === Infinity ? '\u221E' : rollStats.stats.lowestRoll;\r\n    document.getElementById('stat-crits').textContent = rollStats.stats.criticalSuccesses;\r\n    document.getElementById('stat-fails').textContent = rollStats.stats.criticalFailures;\r\n  }\r\n\r\n  /**\r\n   * Adds roll to history\r\n   */\r\n  function addToRollHistory(rollData) {\r\n    const advantageType = rollStats.settings.advantageMode;\r\n    const criticalType = detectCritical(rollData);\r\n\r\n    rollStats.history.unshift({\r\n      ...rollData,\r\n      advantageType,\r\n      criticalType,\r\n      timestamp: Date.now()\r\n    });\r\n\r\n    // Trim history\r\n    if (rollStats.history.length > rollStats.settings.maxHistorySize) {\r\n      rollStats.history = rollStats.history.slice(0, rollStats.settings.maxHistorySize);\r\n    }\r\n\r\n    updateRollHistoryDisplay();\r\n    updateRollStatistics(rollData);\r\n  }\r\n\r\n  /**\r\n   * Updates roll history display\r\n   */\r\n  function updateRollHistoryDisplay() {\r\n    const historyList = document.getElementById('roll-history-list');\r\n    if (!historyList) return;\r\n\r\n    if (rollStats.history.length === 0) {\r\n      historyList.innerHTML = '<div class=\"empty-state\">No rolls yet. Make some rolls!</div>';\r\n      return;\r\n    }\r\n\r\n    historyList.innerHTML = rollStats.history.map((roll, index) => {\r\n      const timeAgo = getTimeAgo(roll.timestamp);\r\n      const criticalClass = roll.criticalType || '';\r\n\r\n      let badges = '';\r\n      if (roll.criticalType) {\r\n        badges += `<span class=\"history-badge ${roll.criticalType}\">${roll.criticalType.replace('-', ' ')}</span>`;\r\n      }\r\n      if (roll.advantageType && roll.advantageType !== 'normal') {\r\n        badges += `<span class=\"history-badge\">${roll.advantageType}</span>`;\r\n      }\r\n\r\n      return `\r\n        <div class=\"history-item ${criticalClass}\" style=\"animation-delay: ${index * 0.05}s\">\r\n          <div class=\"history-item-header\">\r\n            <span class=\"history-name\">${roll.name}</span>\r\n            <span class=\"history-time\">${timeAgo}</span>\r\n          </div>\r\n          <div class=\"history-formula\">${roll.formula} = <strong>${roll.result}</strong></div>\r\n          ${badges ? `<div class=\"history-badges\">${badges}</div>` : ''}\r\n        </div>\r\n      `;\r\n    }).join('');\r\n  }\r\n\r\n  /**\r\n   * Gets time ago string\r\n   */\r\n  function getTimeAgo(timestamp) {\r\n    const seconds = Math.floor((Date.now() - timestamp) / 1000);\r\n    if (seconds < 60) return 'just now';\r\n    if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\r\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\r\n    return `${Math.floor(seconds / 86400)}d ago`;\r\n  }\r\n\r\n  /**\r\n   * Rolls in Dice Cloud and then forwards to Roll20\r\n   */\r\n  function rollSimultaneously(name, formula) {\r\n    debug.log(`\uD83C\uDFB2 Rolling ${name} with formula ${formula}...`);\r\n\r\n    // Check advantage mode and modify formula for Roll20 syntax\r\n    const advantageMode = rollStats.settings.advantageMode;\r\n    let modifiedFormula = formula;\r\n\r\n    if (advantageMode === 'advantage') {\r\n      // Roll20 syntax for advantage: 2d20kh1 (keep highest)\r\n      modifiedFormula = formula.replace(/^1d20/, '2d20kh1');\r\n      debug.log(`\uD83C\uDFB2 Advantage mode: ${formula} \u2192 ${modifiedFormula}`);\r\n    } else if (advantageMode === 'disadvantage') {\r\n      // Roll20 syntax for disadvantage: 2d20kl1 (keep lowest)\r\n      modifiedFormula = formula.replace(/^1d20/, '2d20kl1');\r\n      debug.log(`\uD83C\uDFB2 Disadvantage mode: ${formula} \u2192 ${modifiedFormula}`);\r\n    }\r\n\r\n    // Post roll directly to Roll20 - no DiceCloud needed!\r\n    debug.log('\uD83C\uDFAF Posting roll directly to Roll20 (no DiceCloud!)');\r\n    showNotification(`Rolling ${name}... \uD83C\uDFB2`, 'info');\r\n\r\n    // Format roll for Roll20\r\n    const rollMessage = `&{template:default} {{name=${name}}} {{Roll=[[${modifiedFormula}]]}}`;\r\n\r\n    // Post to Roll20 chat\r\n    const success = postChatMessage(rollMessage);\r\n\r\n    if (success) {\r\n      debug.log('\u2705 Roll posted directly to Roll20!');\r\n      showNotification(`${name} rolled! \uD83C\uDFB2`, 'success');\r\n\r\n      // Track the roll in overlay history\r\n      addToRollHistory({\r\n        name: name,\r\n        formula: modifiedFormula,\r\n        timestamp: Date.now()\r\n      });\r\n\r\n      // Update overlay display if visible\r\n      if (overlayVisible) {\r\n        updateRollHistoryDisplay();\r\n        updateStatsDisplay();\r\n      }\r\n    } else {\r\n      debug.error('\u274C Failed to post roll to Roll20');\r\n      showNotification('Failed to roll. Make sure you\\'re on Roll20!', 'error');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initiates a roll in Dice Cloud by finding and clicking the appropriate button\r\n   */\r\n  function rollInDiceCloud(name, formula) {\r\n    return new Promise((resolve, reject) => {\r\n      // Check if we're on Dice Cloud\r\n      if (!window.location.hostname.includes('dicecloud.com')) {\r\n        reject(new Error('Not on Dice Cloud'));\r\n        return;\r\n      }\r\n\r\n      // Try to find the roll button in Dice Cloud\r\n      // This is a simplified approach - you may need to adjust based on Dice Cloud's actual UI\r\n      const rollButtons = document.querySelectorAll('[class*=\"roll\"], [class*=\"dice\"], button');\r\n      let found = false;\r\n\r\n      rollButtons.forEach(button => {\r\n        const buttonText = button.textContent || button.innerText || '';\r\n        if (buttonText.toLowerCase().includes(name.toLowerCase()) || \r\n            buttonText.toLowerCase().includes('roll')) {\r\n          debug.log('\uD83C\uDFAF Found potential roll button:', buttonText);\r\n          found = true;\r\n          button.click();\r\n          resolve();\r\n        }\r\n      });\r\n\r\n      if (!found) {\r\n        // Try to find by searching for the roll name in the page\r\n        const allElements = document.querySelectorAll('*');\r\n        for (let element of allElements) {\r\n          const text = element.textContent || element.innerText || '';\r\n          if (text.toLowerCase().includes(name.toLowerCase()) && \r\n              (element.tagName === 'BUTTON' || element.onclick)) {\r\n            debug.log('\uD83C\uDFAF Found roll element by text:', text);\r\n            element.click();\r\n            resolve();\r\n            return;\r\n          }\r\n        }\r\n        \r\n        reject(new Error('Could not find roll button in Dice Cloud'));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Direct roll in Roll20 (fallback)\r\n   */\r\n  function rollInRoll20(name, formula) {\r\n    const rollData = {\r\n      name: name,\r\n      formula: formula,\r\n      result: Math.floor(Math.random() * 20) + 1, // Simple fallback\r\n      timestamp: Date.now()\r\n    };\r\n\r\n    // Send to Roll20\r\n    browserAPI.runtime.sendMessage({\r\n      action: 'postRollToChat',\r\n      roll: rollData\r\n    }, (response) => {\r\n      if (browserAPI.runtime.lastError) {\r\n        debug.error('\u274C Error sending roll to Roll20:', browserAPI.runtime.lastError);\r\n      } else {\r\n        debug.log('\u2705 Roll sent to Roll20 directly');\r\n        showNotification(`${name} roll sent to Roll20! \uD83C\uDFB2`, 'success');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Posts a message to Roll20 chat (fallback for character sheet overlay)\r\n   */\r\n  function postChatMessage(message) {\r\n    try {\r\n      // Find the chat input textarea\r\n      const chatInput = document.querySelector('#textchat-input textarea');\r\n      if (chatInput) {\r\n        chatInput.value = message;\r\n        chatInput.focus();\r\n        \r\n        // Trigger the send button\r\n        const sendButton = document.querySelector('#textchat-input .btn');\r\n        if (sendButton) {\r\n          sendButton.click();\r\n          debug.log('\u2705 Message posted to Roll20 chat:', message);\r\n          return true;\r\n        } else {\r\n          debug.error('\u274C Could not find Roll20 chat send button');\r\n          return false;\r\n        }\r\n      } else {\r\n        debug.error('\u274C Could not find Roll20 chat input');\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      debug.error('\u274C Error posting to Roll20 chat:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Detects critical hits/misses\r\n   */\r\n  function detectCritical(rollData) {\r\n    const result = parseInt(rollData.result);\r\n    const formula = rollData.formula.toLowerCase();\r\n\r\n    // Check for d20 rolls\r\n    if (formula.includes('d20') || formula.includes('1d20')) {\r\n      if (result === 20) return 'critical-success';\r\n      if (result === 1) return 'critical-failure';\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Shows a notification message\r\n   */\r\n  function showNotification(message, type = 'info') {\r\n    // Add animation styles if not already present\r\n    if (!document.querySelector('#notification-styles')) {\r\n      const style = document.createElement('style');\r\n      style.id = 'notification-styles';\r\n      style.textContent = `\r\n        @keyframes slideIn {\r\n          from {\r\n            opacity: 0;\r\n            transform: translateX(100%);\r\n          }\r\n          to {\r\n            opacity: 1;\r\n            transform: translateX(0);\r\n          }\r\n        }\r\n        \r\n        @keyframes slideOut {\r\n          from {\r\n            opacity: 1;\r\n            transform: translateX(0);\r\n          }\r\n          to {\r\n            opacity: 0;\r\n            transform: translateX(100%);\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n\r\n    const notification = document.createElement('div');\r\n    notification.style.cssText = `\r\n      position: fixed;\r\n      top: 20px;\r\n      right: 20px;\r\n      background: ${type === 'success' ? '#27AE60' : type === 'error' ? '#E74C3C' : '#4ECDC4'};\r\n      color: white;\r\n      padding: 15px 20px;\r\n      border-radius: 8px;\r\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\r\n      z-index: 100002;\r\n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n      font-size: 14px;\r\n      max-width: 300px;\r\n      animation: slideIn 0.3s ease-out;\r\n    `;\r\n    notification.textContent = message;\r\n    \r\n    document.body.appendChild(notification);\r\n    \r\n    setTimeout(() => {\r\n      notification.style.animation = 'slideOut 0.3s ease-in';\r\n      setTimeout(() => notification.remove(), 300);\r\n    }, 3000);\r\n  }\r\n\r\n  /**\r\n   * Shows the overlay in a popup window instead of inline\r\n   */\r\n  function showOverlay() {\r\n    // Load character data first\r\n    browserAPI.runtime.sendMessage({ action: 'getCharacterData' }, (response) => {\r\n      if (browserAPI.runtime.lastError) {\r\n        debug.error('\u274C Extension context error:', browserAPI.runtime.lastError);\r\n        showNotification('Extension context error. Please refresh the page.', 'error');\r\n        return;\r\n      }\r\n\r\n      if (response && response.data) {\r\n        debug.log('\u2705 Character data loaded for popup:', response.data.name);\r\n\r\n        // Get the popup HTML file URL\r\n        const popupURL = browserAPI.runtime.getURL('src/popup-sheet.html');\r\n\r\n        let messageSent = false;\r\n        let popupWindow = null;\r\n\r\n        // Set up message listener BEFORE opening the window to avoid race condition\r\n        const messageHandler = (event) => {\r\n          if (event.data && event.data.action === 'popupReady' && popupWindow && !messageSent) {\r\n            debug.log('\u2705 Popup is ready, sending character data...');\r\n            messageSent = true;\r\n            try {\r\n              popupWindow.postMessage({\r\n                action: 'initCharacterSheet',\r\n                data: response.data\r\n              }, '*');\r\n              debug.log('\u2705 Character data sent to popup via postMessage');\r\n            } catch (error) {\r\n              debug.warn('\u26A0\uFE0F Could not send message to popup (Firefox security):', error.message);\r\n              // The popup will use storage fallback if postMessage fails\r\n            }\r\n            // Clean up listener after a delay\r\n            setTimeout(() => {\r\n              window.removeEventListener('message', messageHandler);\r\n            }, 1000);\r\n          }\r\n        };\r\n        window.addEventListener('message', messageHandler);\r\n\r\n        // Close any existing popup window before opening a new one\r\n        if (activePopupWindow && !activePopupWindow.closed) {\r\n          debug.log('\uD83D\uDCCB Closing existing popup window...');\r\n          try {\r\n            activePopupWindow.close();\r\n          } catch (error) {\r\n            debug.warn(' Could not close existing popup:', error.message);\r\n          }\r\n        }\r\n\r\n        // Now open the popup window\r\n        try {\r\n          popupWindow = window.open(popupURL, 'rollcloud-character-sheet', 'width=900,height=700,scrollbars=yes,resizable=yes,menubar=no,toolbar=no,location=no,status=no');\r\n        } catch (error) {\r\n          debug.error(' Error opening popup window:', error);\r\n          popupWindow = null;\r\n        }\r\n\r\n        if (!popupWindow) {\r\n          debug.error(' Failed to open popup window. Please allow popups for this site.');\r\n          showNotification('Popup blocked. Please allow popups for this site. Retrying...', 'error');\r\n          window.removeEventListener('message', messageHandler);\r\n          \r\n          // Retry after a short delay\r\n          setTimeout(() => {\r\n            debug.log(' Retrying popup window open...');\r\n            showOverlay();\r\n          }, 1000);\r\n          return;\r\n        }\r\n\r\n        // Store reference to the active popup\r\n        activePopupWindow = popupWindow;\r\n\r\n        // Fallback: Send data after a delay if popup hasn't sent ready message\r\n        // This handles cases where the popup loads faster than expected\r\n        setTimeout(() => {\r\n          if (!messageSent && popupWindow) {\r\n            try {\r\n              // Firefox can throw \"dead object\" error even when accessing .closed property\r\n              if (!popupWindow.closed) {\r\n                debug.log('\u23F1\uFE0F Fallback: Sending character data after timeout...');\r\n                messageSent = true;\r\n                popupWindow.postMessage({\r\n                  action: 'initCharacterSheet',\r\n                  data: response.data\r\n                }, '*');\r\n                debug.log('\u2705 Character data sent via fallback');\r\n              }\r\n            } catch (error) {\r\n              debug.warn('\u26A0\uFE0F Could not send fallback message to popup (Firefox security):', error.message);\r\n              // The popup will load data from storage if postMessage fails\r\n            }\r\n          }\r\n        }, 500);\r\n\r\n        overlayVisible = true;\r\n        showNotification('Character sheet opened! \uD83C\uDFB2', 'success');\r\n        debug.log('\u2705 Popup window opened successfully');\r\n\r\n      } else {\r\n        debug.log('\uD83D\uDCCB No character data found - asking user about GM mode');\r\n\r\n        // Ask user if they want to open GM mode instead\r\n        const userConfirmed = confirm('No character data found.\\n\\nWould you like to open GM mode instead?');\r\n\r\n        if (userConfirmed) {\r\n          // User clicked \"Yes\" - trigger GM mode via roll20.js\r\n          debug.log('\u2705 User confirmed - requesting GM mode via showCharacterSheet');\r\n          // Send message to roll20.js to open GM mode\r\n          // This will trigger the same flow as the popup button\r\n          const event = new CustomEvent('openGMMode');\r\n          document.dispatchEvent(event);\r\n          showNotification('Opening GM mode...', 'success');\r\n        } else {\r\n          // User clicked \"Cancel\" - just show error\r\n          debug.log('\u2139\uFE0F User cancelled GM mode opening');\r\n          showNotification('No character data found. Please sync from Dice Cloud first.', 'error');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Hides the overlay\r\n   */\r\n  function hideOverlay() {\r\n    if (overlayElement) {\r\n      overlayElement.style.display = 'none';\r\n    }\r\n    overlayVisible = false;\r\n  }\r\n\r\n  // NOTE: announceToRoll20() function removed - spell announcements now handled solely by roll20.js to prevent duplicates\r\n\r\n  // Listen for messages from popout window\r\n  window.addEventListener('message', (event) => {\r\n    // NOTE: rollFromPopout is handled by roll20.js - do NOT handle it here to avoid duplicate rolls\r\n    if (event.data.action === 'updateCharacterData') {\r\n      debug.log('\uD83D\uDCBE Received character data update from popup:', event.data.data);\r\n\r\n      // Save updated character data to storage\r\n      browserAPI.runtime.sendMessage({\r\n        action: 'storeCharacterData',\r\n        data: event.data.data\r\n      }, (response) => {\r\n        if (response && response.success) {\r\n          debug.log('\u2705 Character data updated successfully');\r\n        } else {\r\n          debug.error('\u274C Failed to update character data');\r\n        }\r\n      });\r\n    }\r\n\r\n    // NOTE: announceSpell is handled by roll20.js to prevent duplicate messages\r\n  });\r\n\r\n  // Listen for messages from background script\r\n  /**\r\n   * Makes a button draggable and adds hide/show functionality\r\n   */\r\n  function makeButtonDraggable(button, storageKey) {\r\n    let isDragging = false;\r\n    let startX, startY, initialLeft, initialTop;\r\n\r\n    // Helper function to validate if position is within viewport\r\n    function isPositionValid(left, top) {\r\n      const leftPx = parseFloat(left);\r\n      const topPx = parseFloat(top);\r\n\r\n      // Check if position is within reasonable viewport bounds\r\n      // Allow some negative values but not completely off-screen\r\n      const minTop = -20; // Allow slightly above viewport (for aesthetic dragging)\r\n      const maxTop = window.innerHeight - 20; // Ensure at least 20px visible at bottom\r\n      const minLeft = -100; // Allow partially off left edge\r\n      const maxLeft = window.innerWidth - 20; // Ensure at least 20px visible on right\r\n\r\n      return topPx >= minTop && topPx <= maxTop && leftPx >= minLeft && leftPx <= maxLeft;\r\n    }\r\n\r\n    // Load saved position\r\n    const savedPosition = localStorage.getItem(`${storageKey}_position`);\r\n    if (savedPosition) {\r\n      const { left, top } = JSON.parse(savedPosition);\r\n\r\n      // Validate position before applying it\r\n      if (isPositionValid(left, top)) {\r\n        button.style.left = left;\r\n        button.style.top = top;\r\n        button.style.transform = 'none'; // Remove centering transform when positioned\r\n      } else {\r\n        // Invalid position detected - clear it and log\r\n        debug.log(`\uD83D\uDD27 Clearing invalid button position: left=${left}, top=${top}`);\r\n        localStorage.removeItem(`${storageKey}_position`);\r\n        // Keep default centered position\r\n      }\r\n    }\r\n\r\n    // Load saved visibility\r\n    const savedVisibility = localStorage.getItem(`${storageKey}_hidden`);\r\n    if (savedVisibility === 'true') {\r\n      button.style.display = 'none';\r\n    }\r\n\r\n    button.addEventListener('mousedown', (e) => {\r\n      // Only start dragging on left click\r\n      if (e.button === 0) {\r\n        isDragging = true;\r\n        startX = e.clientX;\r\n        startY = e.clientY;\r\n\r\n        // Batch layout read before style writes to avoid forced reflow\r\n        const rect = button.getBoundingClientRect();\r\n        initialLeft = rect.left;\r\n        initialTop = rect.top;\r\n\r\n        // Defer style writes to next frame\r\n        requestAnimationFrame(() => {\r\n          button.style.cursor = 'grabbing';\r\n          button.style.transform = 'none'; // Remove any transform during drag\r\n        });\r\n\r\n        e.preventDefault();\r\n      }\r\n    });\r\n\r\n    document.addEventListener('mousemove', (e) => {\r\n      if (isDragging) {\r\n        const deltaX = e.clientX - startX;\r\n        const deltaY = e.clientY - startY;\r\n\r\n        const newLeft = initialLeft + deltaX;\r\n        const newTop = initialTop + deltaY;\r\n\r\n        // Use requestAnimationFrame to avoid forced reflow\r\n        requestAnimationFrame(() => {\r\n          button.style.left = `${newLeft}px`;\r\n          button.style.top = `${newTop}px`;\r\n        });\r\n      }\r\n    });\r\n\r\n    document.addEventListener('mouseup', () => {\r\n      if (isDragging) {\r\n        isDragging = false;\r\n        button.style.cursor = 'pointer';\r\n\r\n        // Validate and save position only if it's within viewport\r\n        if (isPositionValid(button.style.left, button.style.top)) {\r\n          localStorage.setItem(`${storageKey}_position`, JSON.stringify({\r\n            left: button.style.left,\r\n            top: button.style.top\r\n          }));\r\n        } else {\r\n          // Position is off-screen, don't save it\r\n          debug.log('\u26A0\uFE0F Button position is off-screen, not saving');\r\n        }\r\n      }\r\n    });\r\n\r\n    // Right-click context menu\r\n    button.addEventListener('contextmenu', (e) => {\r\n      e.preventDefault();\r\n\r\n      // Create context menu\r\n      const existingMenu = document.getElementById('rollcloud-context-menu');\r\n      if (existingMenu) existingMenu.remove();\r\n\r\n      const menu = document.createElement('div');\r\n      menu.id = 'rollcloud-context-menu';\r\n\r\n      // Get adjusted position within viewport bounds\r\n      const position = getPopupPosition(e.clientX, e.clientY, 200, 150);\r\n\r\n      menu.style.cssText = `\r\n        position: fixed;\r\n        left: ${position.x}px;\r\n        top: ${position.y}px;\r\n        background: white;\r\n        border: 1px solid #ccc;\r\n        border-radius: 4px;\r\n        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\r\n        z-index: 1000000;\r\n        padding: 5px 0;\r\n      `;\r\n\r\n      const hideOption = document.createElement('div');\r\n      hideOption.textContent = '\uD83D\uDE48 Hide Button';\r\n      hideOption.style.cssText = `\r\n        padding: 8px 16px;\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n      `;\r\n      hideOption.addEventListener('mouseenter', () => {\r\n        hideOption.style.background = '#f0f0f0';\r\n      });\r\n      hideOption.addEventListener('mouseleave', () => {\r\n        hideOption.style.background = 'white';\r\n      });\r\n      hideOption.addEventListener('click', () => {\r\n        button.style.display = 'none';\r\n        localStorage.setItem(`${storageKey}_hidden`, 'true');\r\n        menu.remove();\r\n        showNotification('Button hidden. Use extension popup to show it again.', 'info');\r\n      });\r\n\r\n      const resetOption = document.createElement('div');\r\n      resetOption.textContent = '\uD83D\uDD04 Reset Position';\r\n      resetOption.style.cssText = `\r\n        padding: 8px 16px;\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n        border-top: 1px solid #eee;\r\n      `;\r\n      resetOption.addEventListener('mouseenter', () => {\r\n        resetOption.style.background = '#f0f0f0';\r\n      });\r\n      resetOption.addEventListener('mouseleave', () => {\r\n        resetOption.style.background = 'white';\r\n      });\r\n      resetOption.addEventListener('click', () => {\r\n        localStorage.removeItem(`${storageKey}_position`);\r\n        if (storageKey === 'rollcloud-sheet-toggle') {\r\n          button.style.left = '50%';\r\n          button.style.top = '20px';\r\n          button.style.transform = 'translateX(-50%)';\r\n        } else {\r\n          button.style.left = '20px';\r\n          button.style.top = 'auto';\r\n          button.style.bottom = '20px';\r\n        }\r\n        menu.remove();\r\n        showNotification('Button position reset', 'success');\r\n      });\r\n\r\n      menu.appendChild(hideOption);\r\n      menu.appendChild(resetOption);\r\n      document.body.appendChild(menu);\r\n\r\n      // Close menu when clicking outside\r\n      setTimeout(() => {\r\n        document.addEventListener('click', () => {\r\n          menu.remove();\r\n        }, { once: true });\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates the toggle button for opening the character sheet\r\n   */\r\n  function createToggleButton() {\r\n    // Check if button already exists\r\n    if (document.getElementById('rollcloud-sheet-toggle')) {\r\n      debug.log('\u26A0\uFE0F Character sheet button already exists');\r\n      return;\r\n    }\r\n\r\n    const button = document.createElement('button');\r\n    button.id = 'rollcloud-sheet-toggle';\r\n    button.innerHTML = '\uD83D\uDCCB Character Sheet';\r\n    button.style.cssText = `\r\n      position: fixed;\r\n      top: 20px;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);\r\n      color: white;\r\n      border: none;\r\n      padding: 12px 20px;\r\n      border-radius: 8px;\r\n      cursor: pointer;\r\n      font-size: 14px;\r\n      font-weight: bold;\r\n      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.2);\r\n      z-index: 999998;\r\n      transition: transform 0.2s, box-shadow 0.2s;\r\n      user-select: none;\r\n    `;\r\n\r\n    // Hover effects\r\n    button.addEventListener('mouseenter', () => {\r\n      if (!button.style.left || button.style.left === '50%') {\r\n        button.style.transform = 'translateX(-50%) translateY(-2px)';\r\n      }\r\n      button.style.boxShadow = '0 6px 20px rgba(78, 205, 196, 0.3)';\r\n    });\r\n\r\n    button.addEventListener('mouseleave', () => {\r\n      if (!button.style.left || button.style.left === '50%') {\r\n        button.style.transform = 'translateX(-50%) translateY(0)';\r\n      }\r\n      button.style.boxShadow = '0 4px 15px rgba(78, 205, 196, 0.2)';\r\n    });\r\n\r\n    // Click to open popup\r\n    button.addEventListener('click', () => {\r\n      showOverlay();\r\n    });\r\n\r\n    document.body.appendChild(button);\r\n\r\n    // Make it draggable and add hide/show functionality\r\n    makeButtonDraggable(button, 'rollcloud-sheet-toggle');\r\n\r\n    debug.log('\u2705 Character sheet button created');\r\n  }\r\n\r\n  // Listen for messages from background script\r\n  browserAPI.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === 'postRollToChat') {\r\n      // Handle roll from DiceCloud\r\n      if (request.roll) {\r\n        debug.log('\uD83C\uDFB2 Received roll in overlay:', request.roll);\r\n\r\n        // Only add to history if it's an actual roll (has a formula)\r\n        // Announcements like spells/actions don't have formulas\r\n        if (request.roll.formula) {\r\n          addToRollHistory(request.roll);\r\n        }\r\n\r\n        // Show notification\r\n        showNotification(`Roll received: ${request.roll.name || 'dice roll'}`, 'success');\r\n\r\n        // Update overlay if visible\r\n        if (overlayVisible) {\r\n          updateRollHistoryDisplay();\r\n          updateStatsDisplay();\r\n        }\r\n      }\r\n      sendResponse({ success: true });\r\n    } else if (request.action === 'showCharacterSheetButton') {\r\n      // Show the character sheet button\r\n      const button = document.getElementById('rollcloud-sheet-toggle');\r\n      if (button) {\r\n        button.style.display = '';\r\n        localStorage.removeItem('rollcloud-sheet-toggle_hidden');\r\n        showNotification('Character Sheet button shown', 'success');\r\n      }\r\n      sendResponse({ success: true });\r\n    }\r\n    return true;\r\n  });\r\n\r\n  // Initialize - wait for page to be fully loaded\r\n  function initializeButton() {\r\n    if (document.body) {\r\n      // Clear any accidentally hidden state to ensure button is visible\r\n      const wasHidden = localStorage.getItem('rollcloud-sheet-toggle_hidden');\r\n      if (wasHidden === 'true') {\r\n        debug.log('\uD83D\uDD27 Clearing accidentally hidden button state');\r\n        localStorage.removeItem('rollcloud-sheet-toggle_hidden');\r\n      }\r\n\r\n      // Clear any off-screen position to ensure button is visible\r\n      const savedPosition = localStorage.getItem('rollcloud-sheet-toggle_position');\r\n      if (savedPosition) {\r\n        const { left, top } = JSON.parse(savedPosition);\r\n        const leftPx = parseFloat(left);\r\n        const topPx = parseFloat(top);\r\n\r\n        // Check if position is off-screen (especially negative Y or far outside viewport)\r\n        if (topPx < -20 || topPx > window.innerHeight - 20 || leftPx < -100 || leftPx > window.innerWidth - 20) {\r\n          debug.log(`\uD83D\uDD27 Clearing off-screen button position: left=${left}, top=${top}`);\r\n          localStorage.removeItem('rollcloud-sheet-toggle_position');\r\n        }\r\n      }\r\n\r\n      createToggleButton();\r\n      debug.log('\u2705 FoundCloud character sheet toggle button added');\r\n    } else {\r\n      debug.log('\u23F3 Waiting for document.body...');\r\n      setTimeout(initializeButton, 100);\r\n    }\r\n  }\r\n\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n      setTimeout(initializeButton, 1000);\r\n    });\r\n  } else {\r\n    setTimeout(initializeButton, 1000);\r\n  }\r\n\r\n  debug.log('\u2705 FoundCloud character sheet overlay script loaded');\r\n\r\n})();\r\n   "],
  "mappings": "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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+U3B,YAAM,QAAQ,SAAS,cAAc,OAAO;AAC5C,YAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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",
  "names": ["browserAPI"]
}
