{
  "version": 3,
  "sources": ["../../../../core/src/common/browser-polyfill.js", "../../../../core/src/supabase/config.js", "../../../src/popup/popup.js"],
  "sourcesContent": ["/**\r\n * Browser API Compatibility Layer - Chrome & Firefox Support\r\n *\r\n * This provides a consistent browserAPI interface across Chrome and Firefox.\r\n * Firefox uses the 'browser' namespace (Promise-based), while Chrome uses 'chrome' (callback-based).\r\n */\r\n\r\nconsole.log('\uD83C\uDF10 Loading browser polyfill...');\r\n\r\n// Use 'self' for service workers, 'window' for content scripts/popups\r\nconst globalScope = typeof window !== 'undefined' ? window : self;\r\n\r\n// Detect browser and use appropriate API\r\nlet browserAPI;\r\n\r\nif (typeof browser !== 'undefined' && browser.runtime) {\r\n  // Firefox - uses native Promise-based API\r\n  console.log('\uD83E\uDD8A Detected Firefox');\r\n  browserAPI = browser;\r\n} else if (typeof chrome !== 'undefined' && chrome.runtime) {\r\n  // Chrome - wrap callback-based API to be consistent with Firefox\r\n  console.log('\uD83C\uDF10 Detected Chrome');\r\n  // Helper to check if Chrome extension context is valid\r\n  const isChromeContextValid = () => {\r\n    try {\r\n      return chrome && chrome.runtime && chrome.runtime.id;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  browserAPI = {\r\n    runtime: {\r\n      sendMessage: (message, callback) => {\r\n        // If callback is provided, use callback-based API\r\n        if (typeof callback === 'function') {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              console.error('\u274C Extension context invalidated');\r\n              callback(null);\r\n              return;\r\n            }\r\n            chrome.runtime.sendMessage(message, callback);\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            callback(null);\r\n          }\r\n          return;\r\n        }\r\n        // Otherwise return a Promise\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.runtime.sendMessage(message, (response) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(response);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            reject(error);\r\n          }\r\n        });\r\n      },\r\n      onMessage: chrome.runtime.onMessage,\r\n      getURL: (path) => {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.getURL(path);\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      getManifest: () => {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.getManifest();\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      get id() {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.id;\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      get lastError() {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.lastError;\r\n        } catch (error) {\r\n          return null;\r\n        }\r\n      },\r\n      connectNative: (application) => {\r\n        try {\r\n          if (!isChromeContextValid()) {\r\n            console.error('\u274C Extension context invalidated');\r\n            return null;\r\n          }\r\n          const port = chrome.runtime.connectNative(application);\r\n          // Check for immediate errors\r\n          if (chrome.runtime.lastError) {\r\n            console.warn('\u26A0\uFE0F Native messaging error:', chrome.runtime.lastError.message);\r\n            return null;\r\n          }\r\n          return port;\r\n        } catch (error) {\r\n          console.error('\u274C Native messaging error:', error.message);\r\n          return null;\r\n        }\r\n      }\r\n    },\r\n    storage: {\r\n      local: {\r\n        get: (keys) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.get(keys, (result) => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve(result);\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        set: (items) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.set(items, () => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        remove: (keys) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.remove(keys, () => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        clear: () => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.clear(() => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        }\r\n      }\r\n    },\r\n    tabs: {\r\n      query: (queryInfo) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.query(queryInfo, (tabs) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tabs);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      },\r\n      sendMessage: (tabId, message, callback) => {\r\n        // If callback is provided, use callback-based API\r\n        if (typeof callback === 'function') {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              console.error('\u274C Extension context invalidated');\r\n              callback(null);\r\n              return;\r\n            }\r\n            chrome.tabs.sendMessage(tabId, message, callback);\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            callback(null);\r\n          }\r\n          return;\r\n        }\r\n        // Otherwise return a Promise\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.sendMessage(tabId, message, (response) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(response);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            reject(error);\r\n          }\r\n        });\r\n      },\r\n      create: (createProperties) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.create(createProperties, (tab) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tab);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      },\r\n      update: (tabId, updateProperties) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.update(tabId, updateProperties, (tab) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tab);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      }\r\n    }\r\n  };\r\n} else {\r\n  console.error('\u274C FATAL: No browser API available!');\r\n  throw new Error('No browser API available');\r\n}\r\n\r\n// Expose as browserAPI for consistent naming\r\nglobalScope.browserAPI = browserAPI;\r\n\r\n// Verify API is available\r\nif (!globalScope.browserAPI || !globalScope.browserAPI.runtime) {\r\n  console.error('\u274C FATAL: Browser API not available!');\r\n  throw new Error('Browser API not available');\r\n}\r\n\r\nconsole.log('\u2705 Browser API ready:', (typeof browser !== 'undefined' && browserAPI === browser) ? 'Firefox' : 'Chrome');\r\n", "/**\r\n * Supabase Configuration\r\n * Single Supabase instance shared across all CarmaClouds projects\r\n */\r\n\r\n// Shared Supabase instance\r\nexport const SUPABASE_URL = 'https://luiesmfjdcmpywavvfqm.supabase.co';\r\nexport const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1aWVzbWZqZGNtcHl3YXZ2ZnFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4ODYxNDksImV4cCI6MjA4NTQ2MjE0OX0.oqjHFf2HhCLcanh0HVryoQH7iSV7E9dHHZJdYehxZ0U';\r\n\r\n/**\r\n * Table names for different projects\r\n */\r\nexport const TABLES = {\r\n  // Shared tables\r\n  AUTH_TOKENS: 'auth_tokens',\r\n  PAIRINGS: 'clouds_pairings',\r\n\r\n  // Project-specific character tables\r\n  OWLCLOUD_CHARACTERS: 'clouds_characters',\r\n  ROLLCLOUD_CHARACTERS: 'rollcloud_characters',\r\n  FOUNDCLOUD_CHARACTERS: 'foundcloud_characters', // Future\r\n};\r\n\r\n/**\r\n * Project-specific configurations\r\n */\r\nexport const PROJECT_CONFIGS = {\r\n  owlcloud: {\r\n    characterTable: TABLES.OWLCLOUD_CHARACTERS,\r\n    pairingTable: TABLES.PAIRINGS,\r\n    cacheStorageKey: 'owlcloud_character_cache',\r\n  },\r\n  rollcloud: {\r\n    characterTable: TABLES.ROLLCLOUD_CHARACTERS,\r\n    pairingTable: TABLES.PAIRINGS,\r\n    cacheStorageKey: 'rollcloud_character_cache',\r\n  },\r\n  foundcloud: {\r\n    characterTable: TABLES.FOUNDCLOUD_CHARACTERS,\r\n    pairingTable: TABLES.PAIRINGS,\r\n    cacheStorageKey: 'foundcloud_character_cache',\r\n  },\r\n};\r\n\r\n/**\r\n * Get configuration for a specific project\r\n * @param {string} projectName - Project name (owlcloud, rollcloud, foundcloud)\r\n * @returns {Object} Project configuration\r\n */\r\nexport function getProjectConfig(projectName) {\r\n  const config = PROJECT_CONFIGS[projectName];\r\n  if (!config) {\r\n    throw new Error(`Unknown project: ${projectName}`);\r\n  }\r\n  return {\r\n    ...config,\r\n    supabaseUrl: SUPABASE_URL,\r\n    supabaseKey: SUPABASE_ANON_KEY,\r\n  };\r\n}\r\n", "/**\r\n * Popup UI Script\r\n * Handles user interactions in the extension popup\r\n */\r\n\r\n// Import browser polyfill for cross-browser compatibility\r\nimport '@carmaclouds/core/common/browser-polyfill.js';\r\n\r\n// Import Supabase config\r\nimport { SUPABASE_URL, SUPABASE_ANON_KEY } from '@carmaclouds/core/supabase/config.js';\r\n\r\n// Define debug for popup context\r\nconst debug = window.debug || {\r\n  log: console.log.bind(console),\r\n  warn: console.warn.bind(console),\r\n  error: console.error.bind(console),\r\n  info: console.info.bind(console),\r\n  group: console.group.bind(console),\r\n  groupEnd: console.groupEnd.bind(console),\r\n  table: console.table.bind(console),\r\n  time: console.time.bind(console),\r\n  timeEnd: console.timeEnd.bind(console),\r\n  isEnabled: () => true\r\n};\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  console.log('\uD83D\uDE80 Popup DOMContentLoaded fired');\r\n  \r\n  // Check if browserAPI is available\r\n  if (typeof browserAPI === 'undefined' && typeof window.browserAPI === 'undefined') {\r\n    console.error('\u274C FATAL: browserAPI is not defined!');\r\n    debug.error('\u274C FATAL: browserAPI is not defined!');\r\n    document.body.innerHTML = `\r\n      <div style=\"padding: 20px; color: red; font-family: Arial;\">\r\n        <h2>Error: Browser API Not Loaded</h2>\r\n        <p>The browser polyfill failed to load.</p>\r\n        <p><strong>Steps to fix:</strong></p>\r\n        <ol>\r\n          <li>Go to chrome://extensions/</li>\r\n          <li>Click \"Remove\" on FoundCloud</li>\r\n          <li>Reload the extension fresh</li>\r\n        </ol>\r\n        <p style=\"font-size: 12px; color: #666;\">\r\n          Check the console (F12) for more details.\r\n        </p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  console.log('\u2705 browserAPI is available');\r\n  debug.log('\u2705 browserAPI is available');\r\n\r\n  try {\r\n    console.log('\uD83D\uDE80 About to call initializePopup()');\r\n    initializePopup();\r\n    console.log('\u2705 initializePopup() completed');\r\n  } catch (error) {\r\n    // Try to use debug if available, otherwise use console\r\n    const logger = typeof debug !== 'undefined' ? debug : console;\r\n    console.error('\u274C Popup initialization error:', error);\r\n    logger.error('\u274C Popup initialization error:', error);\r\n    document.body.innerHTML = `\r\n      <div style=\"padding: 20px; color: red; font-family: Arial;\">\r\n        <h2>Initialization Error</h2>\r\n        <p>${error.message}</p>\r\n        <pre style=\"background: #f0f0f0; padding: 10px; overflow: auto;\">${error.stack}</pre>\r\n      </div>\r\n    `;\r\n  }\r\n\r\nfunction initializePopup() {\r\n  // Set version from manifest\r\n  try {\r\n    const manifest = browserAPI.runtime.getManifest();\r\n    const versionDisplay = document.getElementById('versionDisplay');\r\n    if (versionDisplay && manifest.version) {\r\n      versionDisplay.textContent = `v${manifest.version}`;\r\n    }\r\n  } catch (e) {\r\n    console.log('Could not read manifest version:', e);\r\n  }\r\n\r\n  // Check if this is an experimental build\r\n  checkExperimentalBuild();\r\n\r\n  // DOM Elements - Sections\r\n  const loginSection = document.getElementById('loginSection');\r\n  const mainSection = document.getElementById('mainSection');\r\n\r\n  // DOM Elements - Login\r\n  const autoConnectBtn = document.getElementById('autoConnectBtn');\r\n  const usernameLoginForm = document.getElementById('usernameLoginForm');\r\n  const usernameInput = document.getElementById('username');\r\n  const passwordInput = document.getElementById('password');\r\n  const usernameLoginBtn = document.getElementById('usernameLoginBtn');\r\n  const loginError = document.getElementById('loginError');\r\n\r\n  // DOM Elements - Main Interface\r\n  const logoutBtn = document.getElementById('logoutBtn');\r\n  const exportBtn = document.getElementById('exportBtn');\r\n  const importBtn = document.getElementById('importBtn');\r\n  const importFile = document.getElementById('importFile');\r\n  const cloudSyncBtn = document.getElementById('cloudSyncBtn');\r\n  const characterSelector = document.getElementById('characterSelector');\r\n  const characterSelect = document.getElementById('characterSelect');\r\n  const statusIcon = document.getElementById('statusIcon');\r\n  const statusText = document.getElementById('statusText');\r\n  const characterInfo = document.getElementById('characterInfo');\r\n  const charName = document.getElementById('charName');\r\n  const charLevel = document.getElementById('charLevel');\r\n  const charClass = document.getElementById('charClass');\r\n  const charRace = document.getElementById('charRace');\r\n  const syncBtn = document.getElementById('syncBtn');\r\n  const showSheetBtn = document.getElementById('showSheetBtn');\r\n  const clearBtn = document.getElementById('clearBtn');\r\n  const syncCharacterToCloudBtn = document.getElementById('syncCharacterToCloudBtn');\r\n  const howToBtn = document.getElementById('howToBtn');\r\n  const settingsBtn = document.getElementById('settingsBtn');\r\n  const settingsMenu = document.getElementById('settingsMenu');\r\n\r\n  // DOM Elements - Experimental Features\r\n  const autoBackwardsSyncToggle = document.getElementById('autoBackwardsSyncToggle');\r\n\r\n  // Enable button for testing\r\n  if (showSheetBtn) {\r\n    showSheetBtn.disabled = false;\r\n\r\n    // Add basic styling to make it visible\r\n    showSheetBtn.style.display = 'inline-block';\r\n    showSheetBtn.style.width = 'auto';\r\n    showSheetBtn.style.height = 'auto';\r\n    showSheetBtn.style.padding = '8px 16px';\r\n    showSheetBtn.style.margin = '5px';\r\n    showSheetBtn.style.visibility = 'visible';\r\n  }\r\n\r\n  // Initialize\r\n  checkLoginStatus();\r\n  \r\n  // Debug: Check if Supabase is available\r\n  debug.log('\uD83D\uDD0D Supabase availability check:', typeof SupabaseTokenManager !== 'undefined' ? 'Available' : 'Not available');\r\n  if (typeof SupabaseTokenManager !== 'undefined') {\r\n    const testManager = new SupabaseTokenManager();\r\n    debug.log('\uD83D\uDD0D Generated user ID:', testManager.generateUserId());\r\n  }\r\n  \r\n  // Listen for data sync notifications from content scripts\r\n  browserAPI.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n    if (message.action === 'dataSynced') {\r\n      debug.log('\uD83D\uDCE5 Received data sync notification:', message);\r\n      // Refresh character data to show the newly synced character\r\n      loadCharacterData();\r\n      showSuccess(`${message.characterName} synced successfully!`);\r\n    }\r\n  });\r\n  \r\n  // Fallback: Periodically check for new character data every 5 seconds\r\n  // This helps when background script communication is failing\r\n  let lastCharacterCount = 0;\r\n  setInterval(async () => {\r\n    try {\r\n      const result = await browserAPI.storage.local.get(['characterProfiles']);\r\n      const profiles = result.characterProfiles || {};\r\n      const currentCount = Object.keys(profiles).filter(id => profiles[id].type !== 'rollcloudPlayer').length;\r\n      \r\n      if (currentCount > lastCharacterCount) {\r\n        debug.log('\uD83D\uDD04 Detected new character data via polling');\r\n        loadCharacterData();\r\n        showSuccess('New character data detected!');\r\n      }\r\n      lastCharacterCount = currentCount;\r\n    } catch (error) {\r\n      // Silently ignore polling errors\r\n    }\r\n  }, 5000);\r\n\r\n  // Periodic session validity check to detect conflicts from other browsers\r\n  setInterval(async () => {\r\n    try {\r\n      if (typeof SupabaseTokenManager !== 'undefined') {\r\n        const supabaseManager = new SupabaseTokenManager();\r\n        const sessionCheck = await supabaseManager.checkSessionValidity();\r\n        \r\n        if (!sessionCheck.valid) {\r\n          debug.log('\u26A0\uFE0F Session conflict detected via polling, logging out:', sessionCheck.reason);\r\n          await handleSessionConflict(sessionCheck);\r\n          showLoginSection();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      debug.error('\u274C Error in periodic session check:', error);\r\n    }\r\n  }, 10000); // Check every 10 seconds\r\n\r\n  // Event Listeners - Login\r\n  autoConnectBtn.addEventListener('click', handleAutoConnect);\r\n  usernameLoginForm.addEventListener('submit', handleUsernameLogin);\r\n\r\n  // Event Listeners - Main Interface\r\n  logoutBtn.addEventListener('click', handleLogout);\r\n  characterSelect.addEventListener('change', handleCharacterChange);\r\n  syncBtn.addEventListener('click', handleSync);\r\n\r\n  if (showSheetBtn) {\r\n    showSheetBtn.addEventListener('click', handleShowSheet);\r\n  } else {\r\n    debug.error('\u274C showSheetBtn not found!');\r\n  }\r\n\r\n  if (howToBtn) {\r\n    howToBtn.addEventListener('click', handleHowTo);\r\n  }\r\n\r\n  if (syncCharacterToCloudBtn) {\r\n    syncCharacterToCloudBtn.addEventListener('click', handleSyncCharacterToCloud);\r\n  }\r\n\r\n  clearBtn.addEventListener('click', handleClear);\r\n\r\n  // Settings dropdown event listeners\r\n  if (settingsBtn && settingsMenu) {\r\n    settingsBtn.addEventListener('click', toggleSettingsMenu);\r\n    \r\n    // Close settings menu when clicking outside\r\n    document.addEventListener('click', (event) => {\r\n      if (!settingsBtn.contains(event.target) && !settingsMenu.contains(event.target)) {\r\n        settingsMenu.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Export/Import event listeners\r\n  if (exportBtn) {\r\n    exportBtn.addEventListener('click', handleExport);\r\n  }\r\n  if (importBtn && importFile) {\r\n    importBtn.addEventListener('click', () => importFile.click());\r\n    importFile.addEventListener('change', handleImport);\r\n  }\r\n  if (cloudSyncBtn) {\r\n    cloudSyncBtn.addEventListener('click', handleCloudSync);\r\n  }\r\n\r\n  // Modal event listeners\r\n  document.getElementById('closeSlotModal').addEventListener('click', closeSlotModal);\r\n\r\n  // Experimental features event listeners\r\n  if (autoBackwardsSyncToggle) {\r\n    // Load initial state\r\n    loadAutoBackwardsSyncState();\r\n    // Add change listener\r\n    autoBackwardsSyncToggle.addEventListener('change', handleAutoBackwardsSyncToggle);\r\n  }\r\n\r\n  // Discord integration event listeners\r\n  const setupDiscordBtn = document.getElementById('setupDiscordBtn');\r\n  const cancelPairingBtn = document.getElementById('cancelPairingBtn');\r\n  const disconnectDiscordBtn = document.getElementById('disconnectDiscordBtn');\r\n  const testDiscordWebhookBtn = document.getElementById('testDiscordWebhook');\r\n  const checkDiscordIntegrationBtn = document.getElementById('checkDiscordIntegration');\r\n  const checkDiscordIntegrationNotConnectedBtn = document.getElementById('checkDiscordIntegrationNotConnected');\r\n  const saveDiscordWebhookBtn = document.getElementById('saveDiscordWebhook');\r\n\r\n  if (setupDiscordBtn) {\r\n    // Load initial Discord state\r\n    loadDiscordConnectionState();\r\n    // Add event listeners\r\n    setupDiscordBtn.addEventListener('click', handleSetupDiscord);\r\n    if (cancelPairingBtn) cancelPairingBtn.addEventListener('click', handleCancelPairing);\r\n    if (disconnectDiscordBtn) disconnectDiscordBtn.addEventListener('click', handleDisconnectDiscord);\r\n    if (testDiscordWebhookBtn) testDiscordWebhookBtn.addEventListener('click', handleTestDiscordWebhook);\r\n    if (checkDiscordIntegrationBtn) checkDiscordIntegrationBtn.addEventListener('click', handleCheckDiscordIntegration);\r\n    if (checkDiscordIntegrationNotConnectedBtn) checkDiscordIntegrationNotConnectedBtn.addEventListener('click', handleCheckDiscordIntegration);\r\n    if (saveDiscordWebhookBtn) saveDiscordWebhookBtn.addEventListener('click', handleSaveDiscordWebhook);\r\n  }\r\n\r\n  /**\r\n   * Checks if the user is logged in and shows appropriate section\r\n   */\r\n  async function checkLoginStatus() {\r\n    try {\r\n      debug.log('\uD83D\uDD0D Checking login status...');\r\n      \r\n      // First check for session conflicts\r\n      if (typeof SupabaseTokenManager !== 'undefined') {\r\n        const supabaseManager = new SupabaseTokenManager();\r\n        const sessionCheck = await supabaseManager.checkSessionValidity();\r\n        \r\n        if (!sessionCheck.valid) {\r\n          debug.log('\u26A0\uFE0F Session conflict detected, logging out:', sessionCheck.reason);\r\n          await handleSessionConflict(sessionCheck);\r\n          showLoginSection();\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // Timeout after 3s in case the service worker is unresponsive (e.g., fresh install)\r\n      const response = await Promise.race([\r\n        browserAPI.runtime.sendMessage({ action: 'checkLoginStatus' }),\r\n        new Promise((_, reject) => setTimeout(() => reject(new Error('Service worker timeout')), 3000))\r\n      ]);\r\n      debug.log('\uD83D\uDCE5 Login status response:', response);\r\n\r\n      if (response.success && response.loggedIn) {\r\n        showMainSection();\r\n      } else {\r\n        debug.log('\uD83D\uDD04 Background script says not logged in, checking storage directly...');\r\n        // Try alternative method - check storage directly\r\n        try {\r\n          const result = await browserAPI.storage.local.get(['diceCloudToken', 'username', 'tokenExpires']);\r\n          debug.log('\uD83D\uDCE6 Direct storage check result:', result);\r\n          if (result.diceCloudToken) {\r\n            debug.log('\u2705 Found token in storage, showing main section');\r\n            showMainSection();\r\n          } else {\r\n            debug.log('\u274C No token found in storage, checking Supabase...');\r\n            // Check if user explicitly logged out - don't restore from Supabase in that case\r\n            const { explicitlyLoggedOut } = await browserAPI.storage.local.get('explicitlyLoggedOut');\r\n            if (explicitlyLoggedOut) {\r\n              debug.log('\u23ED\uFE0F Skipping Supabase restoration: user explicitly logged out');\r\n              showLoginSection();\r\n              return;\r\n            }\r\n            // Try Supabase for cross-session persistence\r\n            try {\r\n              if (typeof SupabaseTokenManager !== 'undefined') {\r\n                debug.log('\uD83C\uDF10 Attempting to retrieve token from Supabase...');\r\n                const supabaseManager = new SupabaseTokenManager();\r\n                const userId = supabaseManager.generateUserId();\r\n                debug.log('\uD83D\uDD0D Using user ID for Supabase lookup:', userId);\r\n\r\n                const supabaseResult = await supabaseManager.retrieveToken();\r\n                debug.log('\uD83D\uDCE5 Supabase retrieval result:', supabaseResult);\r\n\r\n                if (supabaseResult.success) {\r\n                  debug.log('\u2705 Found token in Supabase, restoring to local storage...');\r\n                  // Store token locally for faster access\r\n                  await browserAPI.storage.local.set({\r\n                    diceCloudToken: supabaseResult.token,\r\n                    username: supabaseResult.username,\r\n                    tokenExpires: supabaseResult.tokenExpires,\r\n                    diceCloudUserId: supabaseResult.userId,\r\n                    authId: supabaseResult.authId || supabaseResult.userId\r\n                  });\r\n                  // Clear explicitly logged out flag since user is restoring session\r\n                  await browserAPI.storage.local.remove('explicitlyLoggedOut');\r\n                  // Restore character data from local storage\r\n                  const localProfiles = await browserAPI.storage.local.get(['profiles']);\r\n                  if (localProfiles.profiles) {\r\n                    await browserAPI.storage.local.set({\r\n                      profiles: localProfiles.profiles\r\n                    });\r\n                  }\r\n                  debug.log('\u2705 Token and data restored from Supabase to local storage');\r\n                  showMainSection();\r\n                } else {\r\n                  debug.log('\u2139\uFE0F No token found in Supabase');\r\n                  showLoginSection();\r\n                }\r\n              } else {\r\n                debug.log('\u274C Supabase not available, showing login');\r\n                showLoginSection();\r\n              }\r\n            } catch (error) {\r\n              debug.error('\u274C Error retrieving from Supabase:', error);\r\n              showLoginSection();\r\n            }\r\n          }\r\n        } catch (storageError) {\r\n          debug.error('\u274C Storage check failed:', storageError);\r\n          showLoginSection();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      debug.error('\u274C Error checking login status:', error);\r\n      // Try alternative method - check storage directly\r\n      try {\r\n        const result = await browserAPI.storage.local.get(['diceCloudToken', 'username', 'tokenExpires']);\r\n        debug.log('\uD83D\uDCE6 Direct storage check result (error fallback):', result);\r\n        if (result.diceCloudToken) {\r\n          debug.log('\u2705 Found token in storage, showing main section');\r\n          showMainSection();\r\n        } else {\r\n          debug.log('\u274C No token found in storage, checking Supabase...');\r\n          // Check if user explicitly logged out - don't restore from Supabase in that case\r\n          const { explicitlyLoggedOut } = await browserAPI.storage.local.get('explicitlyLoggedOut');\r\n          if (explicitlyLoggedOut) {\r\n            debug.log('\u23ED\uFE0F Skipping Supabase restoration (error fallback): user explicitly logged out');\r\n            showLoginSection();\r\n            return;\r\n          }\r\n          // Try Supabase for cross-session persistence\r\n          try {\r\n            if (typeof SupabaseTokenManager !== 'undefined') {\r\n              const supabaseManager = new SupabaseTokenManager();\r\n              const supabaseResult = await supabaseManager.retrieveToken();\r\n\r\n              if (supabaseResult.success) {\r\n                debug.log('\u2705 Found token in Supabase (error fallback), restoring to local storage...');\r\n                // Store token locally for faster access\r\n                await browserAPI.storage.local.set({\r\n                  diceCloudToken: supabaseResult.token,\r\n                  username: supabaseResult.username,\r\n                  tokenExpires: supabaseResult.tokenExpires\r\n                });\r\n                // Clear explicitly logged out flag since user is restoring session\r\n                await browserAPI.storage.local.remove('explicitlyLoggedOut');\r\n                showMainSection();\r\n              } else {\r\n                debug.log('\u274C No token found in Supabase, showing login');\r\n                showLoginSection();\r\n              }\r\n            } else {\r\n              debug.log('\u274C Supabase not available, showing login');\r\n              showLoginSection();\r\n            }\r\n          } catch (supabaseError) {\r\n            debug.error('\u274C Supabase check failed:', supabaseError);\r\n            showLoginSection();\r\n          }\r\n        }\r\n      } catch (storageError) {\r\n        debug.error('\u274C Storage check failed:', storageError);\r\n        showLoginSection();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles session conflict when another browser logs in\r\n   */\r\n  async function handleSessionConflict(sessionCheck) {\r\n    try {\r\n      debug.log('\u26A0\uFE0F Handling session conflict:', sessionCheck);\r\n      \r\n      // Clear local authentication data\r\n      await browserAPI.storage.local.remove([\r\n        'diceCloudToken', \r\n        'username', \r\n        'tokenExpires', \r\n        'diceCloudUserId', \r\n        'authId',\r\n        'currentSessionId',\r\n        'sessionStartTime'\r\n      ]);\r\n      \r\n      // Show conflict warning\r\n      let conflictMessage = 'You have been logged out because FoundCloud was opened in a different browser.';\r\n      \r\n      if (sessionCheck.reason === 'conflict_detected' && sessionCheck.conflict) {\r\n        const conflict = sessionCheck.conflict.conflictingSession;\r\n        const detectedTime = new Date(conflict.detectedAt).toLocaleString();\r\n        \r\n        if (conflict.username && conflict.browserInfo) {\r\n          const browserName = conflict.browserInfo.userAgent.includes('Chrome') ? 'Chrome' : \r\n                           conflict.browserInfo.userAgent.includes('Firefox') ? 'Firefox' : \r\n                           conflict.browserInfo.userAgent.includes('Edge') ? 'Edge' : 'another browser';\r\n          \r\n          conflictMessage = `You have been logged out because FoundCloud was opened in ${browserName} as \"${conflict.username}\" at ${detectedTime}.`;\r\n        }\r\n      } else if (sessionCheck.reason === 'token_mismatch') {\r\n        conflictMessage = 'You have been logged out because your login session was invalidated by another device.';\r\n      } else if (sessionCheck.reason === 'session_not_found') {\r\n        conflictMessage = 'Your session has expired. Please log in again.';\r\n      }\r\n      \r\n      // Show the conflict warning in the login form\r\n      showLoginError(conflictMessage);\r\n      \r\n      // Clear conflict info after showing\r\n      if (typeof SupabaseTokenManager !== 'undefined') {\r\n        const supabaseManager = new SupabaseTokenManager();\r\n        await supabaseManager.clearConflictInfo();\r\n      }\r\n      \r\n      debug.log('\u2705 Session conflict handled, user logged out');\r\n    } catch (error) {\r\n      debug.error('\u274C Error handling session conflict:', error);\r\n      showLoginError('You have been logged out. Please log in again.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows the login section\r\n   */\r\n  function showLoginSection() {\r\n    loginSection.classList.remove('hidden');\r\n    mainSection.classList.add('hidden');\r\n  }\r\n\r\n  /**\r\n   * Shows the main section\r\n   */\r\n  function showMainSection() {\r\n    loginSection.classList.add('hidden');\r\n    mainSection.classList.remove('hidden');\r\n    loadCharacterData();\r\n  }\r\n\r\n  /**\r\n   * Handles auto-connect - checks for DiceCloud tab or opens one\r\n   */\r\n  async function handleAutoConnect() {\r\n    try {\r\n      autoConnectBtn.disabled = true;\r\n      autoConnectBtn.textContent = '\u23F3 Checking...';\r\n      hideLoginError();\r\n\r\n      // First, check if the current active tab is DiceCloud\r\n      const [activeTab] = await browserAPI.tabs.query({ active: true, currentWindow: true });\r\n      let dicecloudTab = null;\r\n\r\n      if (activeTab && activeTab.url && activeTab.url.includes('dicecloud.com')) {\r\n        // User is currently on DiceCloud - use this tab\r\n        dicecloudTab = activeTab;\r\n        debug.log('Using current active DiceCloud tab');\r\n      } else {\r\n        // Check if any other tab has DiceCloud open\r\n        const tabs = await browserAPI.tabs.query({ url: 'https://dicecloud.com/*' });\r\n        if (tabs.length > 0) {\r\n          dicecloudTab = tabs[0];\r\n          debug.log('Found DiceCloud tab:', dicecloudTab.id);\r\n        }\r\n      }\r\n\r\n      if (dicecloudTab) {\r\n        // DiceCloud is open - try to capture token\r\n        autoConnectBtn.textContent = '\u23F3 Capturing token...';\r\n\r\n        try {\r\n          // Send message to DiceCloud tab to extract token using runtime.sendMessage\r\n          console.log('\uD83D\uDCE1 About to send message to tab:', dicecloudTab.id);\r\n          debug.log('\uD83D\uDCE1 About to send message to tab:', dicecloudTab.id);\r\n          \r\n          const response = await new Promise((resolve) => {\r\n            browserAPI.runtime.sendMessage({\r\n              action: 'extractAuthToken',\r\n              tabId: dicecloudTab.id\r\n            }, (response) => {\r\n              console.log('\uD83D\uDCE1 Received callback response:', response);\r\n              debug.log('\uD83D\uDCE1 Received callback response:', response);\r\n              // Extract the actual data from the background script response\r\n              const actualResponse = response.success ? response.data : response;\r\n              console.log('\uD83D\uDCE1 Actual response object:', actualResponse);\r\n              debug.log('\uD83D\uDCE1 Actual response object:', actualResponse);\r\n              resolve(actualResponse);\r\n            });\r\n          });\r\n          \r\n          console.log('\uD83D\uDCE1 Received Promise response:', response);\r\n          debug.log('\uD83D\uDCE1 Received Promise response:', response);\r\n\r\n          debug.log('\uD83D\uDCE5 Token capture response:', response);\r\n          console.log('\uD83D\uDCE5 Token capture response (console):', response);\r\n\r\n          if (response && response.success && response.token) {\r\n            // Store the token with metadata - use direct storage as primary method\r\n            try {\r\n              debug.log('\uD83D\uDCBE Storing token directly in storage...');\r\n              const storageData = {\r\n                diceCloudToken: response.token,\r\n                diceCloudUserId: response.userId,\r\n                tokenExpires: response.tokenExpires,\r\n                username: response.username,\r\n                authId: response.authId\r\n              };\r\n\r\n              await browserAPI.storage.local.set(storageData);\r\n              // Clear explicitly logged out flag since user is logging in\r\n              await browserAPI.storage.local.remove('explicitlyLoggedOut');\r\n              debug.log('\u2705 Token stored successfully in direct storage:', storageData);\r\n\r\n              // Also store in Supabase for cross-session persistence\r\n              try {\r\n                if (typeof SupabaseTokenManager !== 'undefined') {\r\n                  const supabaseManager = new SupabaseTokenManager();\r\n                  const supabaseResult = await supabaseManager.storeToken({\r\n                    token: response.token,\r\n                    userId: response.userId,\r\n                    tokenExpires: response.tokenExpires,\r\n                    username: response.username, // Display username\r\n                    authId: response.authId // Auth ID for database\r\n                  });\r\n\r\n                  if (supabaseResult.success) {\r\n                    debug.log('\u2705 Token also stored in Supabase for cross-session persistence');\r\n                  } else {\r\n                    debug.log('\u26A0\uFE0F Supabase storage failed (non-critical):', supabaseResult.error);\r\n                  }\r\n                }\r\n              } catch (supabaseError) {\r\n                debug.log('\u26A0\uFE0F Supabase not available (non-critical):', supabaseError);\r\n              }\r\n\r\n              hideLoginError();\r\n              showMainSection();\r\n              loadCharacterData();\r\n            } catch (storageError) {\r\n              debug.error('\u274C Direct storage failed:', storageError);\r\n              showLoginError('Failed to save login. Please try again.');\r\n              return;\r\n            }\r\n          } else {\r\n            // Not logged in - show error and keep DiceCloud tab open\r\n            showLoginError('Please log in to DiceCloud, then click the button again.');\r\n            // Focus the DiceCloud tab\r\n            await browserAPI.tabs.update(dicecloudTab.id, { active: true });\r\n          }\r\n        } catch (error) {\r\n          debug.error('Error capturing token:', error);\r\n          showLoginError('Error: ' + error.message);\r\n        }\r\n      } else {\r\n        // No DiceCloud tab - open one\r\n        autoConnectBtn.textContent = '\u23F3 Opening DiceCloud...';\r\n\r\n        await browserAPI.tabs.create({\r\n          url: 'https://dicecloud.com',\r\n          active: true\r\n        });\r\n\r\n        showLoginError('DiceCloud opened in new tab. Log in, then click this button again.');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Auto-connect error:', error);\r\n      showLoginError('Error: ' + error.message);\r\n    } finally {\r\n      autoConnectBtn.disabled = false;\r\n      autoConnectBtn.textContent = '\uD83D\uDD10 Connect with DiceCloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles username/password login\r\n   */\r\n  async function handleUsernameLogin(event) {\r\n    event.preventDefault();\r\n\r\n    const username = usernameInput.value.trim();\r\n    const password = passwordInput.value;\r\n\r\n    if (!username || !password) {\r\n      showLoginError('Please enter both username and password');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      usernameLoginBtn.disabled = true;\r\n      usernameLoginBtn.textContent = '\u23F3 Logging in...';\r\n      hideLoginError();\r\n\r\n      const response = await browserAPI.runtime.sendMessage({\r\n        action: 'loginToDiceCloud',\r\n        username: username,\r\n        password: password\r\n      });\r\n\r\n      if (response.success) {\r\n        usernameLoginForm.reset();\r\n        showMainSection();\r\n        loadCharacterData();\r\n      } else {\r\n        showLoginError(response.error || 'Login failed');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Login error:', error);\r\n      showLoginError('Login failed: ' + error.message);\r\n    } finally {\r\n      usernameLoginBtn.disabled = false;\r\n      usernameLoginBtn.textContent = '\uD83D\uDD10 Login to DiceCloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles logout\r\n   */\r\n  async function handleLogout() {\r\n    try {\r\n      // Delete from Supabase\r\n      try {\r\n        if (typeof SupabaseTokenManager !== 'undefined') {\r\n          const supabaseManager = new SupabaseTokenManager();\r\n          const supabaseResult = await supabaseManager.deleteToken();\r\n          \r\n          if (supabaseResult.success) {\r\n            debug.log('\u2705 Token deleted from Supabase');\r\n          } else {\r\n            debug.log('\u26A0\uFE0F Supabase deletion failed (non-critical):', supabaseResult.error);\r\n          }\r\n        }\r\n      } catch (supabaseError) {\r\n        debug.log('\u26A0\uFE0F Supabase not available for logout (non-critical):', supabaseError);\r\n      }\r\n\r\n      // Logout from background script\r\n      await browserAPI.runtime.sendMessage({ action: 'logout' });\r\n      showLoginSection();\r\n      clearCharacterDisplay();\r\n    } catch (error) {\r\n      debug.error('Logout error:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows login error message\r\n   */\r\n  function showLoginError(message) {\r\n    loginError.textContent = message;\r\n    loginError.classList.remove('hidden');\r\n  }\r\n\r\n  /**\r\n   * Hides login error message\r\n   */\r\n  function hideLoginError() {\r\n    loginError.classList.add('hidden');\r\n    loginError.textContent = '';\r\n  }\r\n\r\n  /**\r\n   * Loads all character profiles and populates dropdown\r\n   */\r\n  async function loadCharacterData() {\r\n    try {\r\n      // Get all character profiles (local + database)\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n\r\n      // Get the active character ID\r\n      const storageResult = await browserAPI.storage.local.get(['activeCharacterId']);\r\n      const activeCharacterId = storageResult.activeCharacterId;\r\n\r\n      // Resolve active character from the merged profiles so dropdown and\r\n      // display always agree. Fall back to getCharacterData only if the ID\r\n      // isn't in the merged set (legacy / migration path).\r\n      let activeCharacter = null;\r\n      if (activeCharacterId && profiles[activeCharacterId]) {\r\n        activeCharacter = profiles[activeCharacterId];\r\n      } else {\r\n        const activeResponse = await browserAPI.runtime.sendMessage({ action: 'getCharacterData' });\r\n        activeCharacter = activeResponse.success ? activeResponse.data : null;\r\n      }\r\n\r\n      // Populate character dropdown (exclude GM player data)\r\n      const characterIds = Object.keys(profiles).filter(id =>\r\n        profiles[id].type !== 'rollcloudPlayer'\r\n      );\r\n      if (characterIds.length > 0) {\r\n        characterSelect.innerHTML = '';\r\n        characterIds.forEach(id => {\r\n          const char = profiles[id];\r\n          const option = document.createElement('option');\r\n          option.value = id;\r\n          option.textContent = `${char.name || 'Unknown'} (${char.class || 'No Class'} ${char.level || '?'})`;\r\n          if (id === activeCharacterId) {\r\n            option.selected = true;\r\n          }\r\n          characterSelect.appendChild(option);\r\n        });\r\n\r\n        // Always show character selector when characters exist\r\n        characterSelector.classList.remove('hidden');\r\n\r\n        // Show sync character button if there's an active character\r\n        if (activeCharacter) {\r\n          syncCharacterToCloudBtn.classList.remove('hidden');\r\n        } else {\r\n          syncCharacterToCloudBtn.classList.add('hidden');\r\n        }\r\n      } else {\r\n        characterSelect.innerHTML = '<option value=\"\">No characters synced</option>';\r\n        characterSelector.classList.add('hidden');\r\n        syncCharacterToCloudBtn.classList.add('hidden');\r\n      }\r\n\r\n      // Display active character data\r\n      if (activeCharacter) {\r\n        displayCharacterData(activeCharacter);\r\n      } else {\r\n        clearCharacterDisplay();\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error loading character data:', error);\r\n      clearCharacterDisplay();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles character selection change\r\n   */\r\n  async function handleCharacterChange() {\r\n    try {\r\n      const selectedId = characterSelect.value;\r\n      if (!selectedId) {\r\n        // Hide sync character button when no character is selected\r\n        syncCharacterToCloudBtn.classList.add('hidden');\r\n        return;\r\n      }\r\n\r\n      // Show sync character button when a character is selected\r\n      syncCharacterToCloudBtn.classList.remove('hidden');\r\n\r\n      // If this is a database character (db- prefix), copy it to local storage first\r\n      if (selectedId.startsWith('db-')) {\r\n        const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n        const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n        const dbChar = profiles[selectedId];\r\n        if (dbChar) {\r\n          await browserAPI.runtime.sendMessage({\r\n            action: 'storeCharacterData',\r\n            data: dbChar,\r\n            slotId: selectedId\r\n          });\r\n        }\r\n      }\r\n\r\n      // Set this character as active\r\n      await browserAPI.runtime.sendMessage({\r\n        action: 'setActiveCharacter',\r\n        characterId: selectedId\r\n      });\r\n\r\n      // Reload character data\r\n      await loadCharacterData();\r\n      showSuccess('Switched to selected character');\r\n    } catch (error) {\r\n      debug.error('Error changing character:', error);\r\n      showError('Failed to switch character');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Displays character data in the popup\r\n   */\r\n  function displayCharacterData(data) {\r\n    statusIcon.textContent = '\u2705';\r\n    statusText.textContent = 'Character data synced';\r\n    characterInfo.classList.remove('hidden');\r\n    charName.textContent = data.name || '-';\r\n    charLevel.textContent = data.level || '-';\r\n    charClass.textContent = data.class || '-';\r\n    charRace.textContent = data.race || '-';\r\n    showSheetBtn.disabled = false;\r\n    clearBtn.disabled = false;\r\n  }\r\n\r\n  /**\r\n   * Clears character display\r\n   */\r\n  function clearCharacterDisplay() {\r\n    statusIcon.textContent = '\u23F3';\r\n    statusText.textContent = 'No character data synced';\r\n    characterInfo.classList.add('hidden');\r\n    charName.textContent = '-';\r\n    charLevel.textContent = '-';\r\n    charClass.textContent = '-';\r\n    charRace.textContent = '-';\r\n    // Keep showSheetBtn enabled for testing\r\n    showSheetBtn.disabled = false;\r\n    clearBtn.disabled = false;\r\n  }\r\n\r\n  /**\r\n   * Handles refresh characters button click - pulls data from local storage and database\r\n   */\r\n  async function handleSync() {\r\n    try {\r\n      syncBtn.disabled = true;\r\n      syncBtn.textContent = '\u23F3 Refreshing...';\r\n      statusIcon.textContent = '\u23F3';\r\n      statusText.textContent = 'Refreshing characters...';\r\n\r\n      // First, refresh from local storage\r\n      await refreshFromLocalStorage();\r\n      \r\n      // Then, refresh from database/cloud\r\n      await refreshFromDatabase();\r\n      \r\n      // Finally, reload character data to update UI\r\n      await loadCharacterData();\r\n      \r\n      showSuccess('Characters refreshed successfully!');\r\n    } catch (error) {\r\n      debug.error('Error refreshing characters:', error);\r\n      showError('Error: ' + error.message);\r\n    } finally {\r\n      syncBtn.disabled = false;\r\n      syncBtn.textContent = '\uD83D\uDD04 Refresh Characters';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes character data from local storage\r\n   */\r\n  async function refreshFromLocalStorage() {\r\n    try {\r\n      // Get all character profiles from local storage\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n      \r\n      const characterCount = Object.keys(profiles).filter(id => \r\n        profiles[id].type !== 'rollcloudPlayer'\r\n      ).length;\r\n      \r\n      console.log(`Found ${characterCount} characters in local storage`);\r\n      return profiles;\r\n    } catch (error) {\r\n      console.error('Error refreshing from local storage:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes character data from database/cloud\r\n   */\r\n  async function refreshFromDatabase() {\r\n    try {\r\n      // Check if Supabase is available\r\n      if (typeof SupabaseTokenManager === 'undefined') {\r\n        console.log('Cloud sync not available, skipping database refresh');\r\n        return;\r\n      }\r\n\r\n      const supabaseManager = new SupabaseTokenManager();\r\n      \r\n      // Get current token from storage\r\n      const result = await browserAPI.storage.local.get(['diceCloudToken', 'username', 'tokenExpires', 'diceCloudUserId', 'authId']);\r\n      \r\n      if (!result.diceCloudToken) {\r\n        console.log('No token found, skipping database refresh');\r\n        return;\r\n      }\r\n\r\n      // Refresh token in cloud\r\n      const supabaseResult = await supabaseManager.storeToken({\r\n        token: result.diceCloudToken,\r\n        userId: result.diceCloudUserId,\r\n        tokenExpires: result.tokenExpires,\r\n        username: result.username || 'DiceCloud User',\r\n        authId: result.authId || result.diceCloudUserId\r\n      });\r\n\r\n      if (supabaseResult.success) {\r\n        console.log('Account data refreshed to cloud');\r\n        \r\n        // Try to pull character data from cloud\r\n        const characterData = await supabaseManager.getCharacterData(result.diceCloudUserId);\r\n        if (characterData.success && characterData.characters) {\r\n          console.log(`Pulled ${Object.keys(characterData.characters).length} characters from cloud`);\r\n          \r\n          // Merge cloud data with local storage\r\n          await mergeCloudDataToLocal(characterData.characters);\r\n        }\r\n      } else {\r\n        console.error('Failed to refresh account to cloud:', supabaseResult.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error refreshing from database:', error);\r\n      // Don't throw error here, allow local storage refresh to succeed\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Merges cloud character data with local storage\r\n   */\r\n  async function mergeCloudDataToLocal(cloudCharacters) {\r\n    try {\r\n      // Get current local profiles\r\n      const localResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const localProfiles = localResponse.success ? localResponse.profiles : {};\r\n      \r\n      // Merge cloud data with local data (local takes precedence)\r\n      for (const [characterId, cloudData] of Object.entries(cloudCharacters)) {\r\n        if (!localProfiles[characterId]) {\r\n          // Only add cloud data if it doesn't exist locally\r\n          await browserAPI.runtime.sendMessage({\r\n            action: 'storeCharacterData',\r\n            data: cloudData.characterData,\r\n            slotId: characterId\r\n          });\r\n          console.log(`Added cloud character ${characterId} to local storage`);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error merging cloud data:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows the slot selection modal\r\n   */\r\n  async function showSlotSelectionModal(tab) {\r\n    const modal = document.getElementById('slotModal');\r\n    const slotGrid = document.getElementById('slotGrid');\r\n\r\n    // Get all character profiles\r\n    const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n    const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n\r\n    // Create 10 slots\r\n    slotGrid.innerHTML = '';\r\n    const MAX_SLOTS = 10;\r\n\r\n    for (let i = 1; i <= MAX_SLOTS; i++) {\r\n      const slotId = `slot-${i}`;\r\n      const existingChar = profiles[slotId];\r\n\r\n      const slotCard = document.createElement('div');\r\n      slotCard.className = existingChar ? 'slot-card' : 'slot-card empty';\r\n      slotCard.dataset.slotId = slotId;\r\n\r\n      if (existingChar) {\r\n        slotCard.innerHTML = `\r\n          <div class=\"slot-header\">\r\n            <span class=\"slot-number\">Slot ${i}</span>\r\n            <span class=\"slot-badge occupied\">Occupied</span>\r\n          </div>\r\n          <div class=\"slot-info\">\r\n            <strong>${existingChar.name || 'Unknown'}</strong>\r\n          </div>\r\n          <div class=\"slot-details\">\r\n            ${existingChar.class || 'No Class'} ${existingChar.level || '?'} \u2022 ${existingChar.race || 'Unknown Race'}\r\n          </div>\r\n        `;\r\n      } else {\r\n        slotCard.innerHTML = `\r\n          <div class=\"slot-header\">\r\n            <span class=\"slot-number\">Slot ${i}</span>\r\n            <span class=\"slot-badge empty\">Empty</span>\r\n          </div>\r\n          <div class=\"slot-info empty-text\">\r\n            Click to save character here\r\n          </div>\r\n        `;\r\n      }\r\n\r\n      // Add click handler\r\n      slotCard.addEventListener('click', () => handleSlotSelection(slotId, tab));\r\n\r\n      slotGrid.appendChild(slotCard);\r\n    }\r\n\r\n    // Show modal\r\n    modal.classList.remove('hidden');\r\n  }\r\n\r\n  /**\r\n   * Closes the slot selection modal\r\n   */\r\n  function closeSlotModal() {\r\n    const modal = document.getElementById('slotModal');\r\n    modal.classList.add('hidden');\r\n  }\r\n\r\n  /**\r\n   * Handles slot selection and performs sync\r\n   */\r\n  async function handleSlotSelection(slotId, tab) {\r\n    try {\r\n      // Close modal\r\n      closeSlotModal();\r\n\r\n      // Show syncing status\r\n      syncBtn.disabled = true;\r\n      syncBtn.textContent = '\u23F3 Syncing...';\r\n      statusIcon.textContent = '\u23F3';\r\n      statusText.textContent = 'Syncing from Dice Cloud...';\r\n\r\n      // Send message to content script to sync data with slot ID\r\n      const response = await browserAPI.tabs.sendMessage(tab.id, {\r\n        action: 'syncCharacter',\r\n        slotId: slotId\r\n      });\r\n\r\n      if (response && response.success) {\r\n        // Reload character data to display\r\n        await loadCharacterData();\r\n        showSuccess(`Character synced to ${slotId.replace('slot-', 'Slot ')}!`);\r\n      } else {\r\n        showError(response?.error || 'Failed to sync character data');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error syncing character:', error);\r\n      showError('Error: ' + error.message);\r\n    } finally {\r\n      syncBtn.disabled = false;\r\n      syncBtn.textContent = '\uD83D\uDD04 Sync from Dice Cloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles show sheet button click\r\n   */\r\n  async function handleShowSheet() {\r\n    try {\r\n      showSheetBtn.disabled = true;\r\n      showSheetBtn.textContent = '\u23F3 Opening...';\r\n\r\n      // Get current tab\r\n      const [tab] = await browserAPI.tabs.query({ active: true, currentWindow: true });\r\n\r\n      // Check if we're on Roll20\r\n      if (!tab.url || !tab.url.includes('roll20.net')) {\r\n        showError('Please navigate to Roll20 first');\r\n        showSheetBtn.disabled = false;\r\n        showSheetBtn.textContent = '\uD83D\uDCCB Show Character Sheet';\r\n        return;\r\n      }\r\n\r\n      // Check if there's any synced character data (excluding GM player data)\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n      // Only count actual character slots, not rollcloudPlayer entries\r\n      const hasCharacters = Object.keys(profiles).some(key =>\r\n        profiles[key].type !== 'rollcloudPlayer'\r\n      );\r\n\r\n      if (!hasCharacters) {\r\n        // No character data - ask if user wants to go to GM mode\r\n        const userConfirmed = confirm('No character data found.\\n\\nWould you like to open GM mode instead?');\r\n\r\n        if (!userConfirmed) {\r\n          showSheetBtn.disabled = false;\r\n          showSheetBtn.textContent = '\uD83D\uDCCB Show Character Sheet';\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Send message to Roll20 content script to show sheet\r\n      const response = await browserAPI.tabs.sendMessage(tab.id, { action: 'showCharacterSheet' });\r\n\r\n      if (response && response.success) {\r\n        showSuccess('Character sheet opened!');\r\n      } else if (!hasCharacters) {\r\n        // If no characters, the GM mode was opened\r\n        showSuccess('GM mode opened!');\r\n      } else {\r\n        debug.error('Failed to open character sheet:', response);\r\n        showError('Failed to open character sheet');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error showing character sheet:', error);\r\n      showError('Error: ' + error.message);\r\n    } finally {\r\n      showSheetBtn.disabled = false;\r\n      showSheetBtn.textContent = '\uD83D\uDCCB Show Character Sheet';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle settings menu dropdown\r\n   */\r\n  function toggleSettingsMenu(event) {\r\n    event.stopPropagation();\r\n    settingsMenu.classList.toggle('hidden');\r\n  }\r\n\r\n  /**\r\n   * Handles \"How to Use\" button click - opens welcome screen\r\n   */\r\n  function handleHowTo() {\r\n    // Open the welcome screen (options page)\r\n    if (typeof browser !== 'undefined' && browser.runtime && browser.runtime.openOptionsPage) {\r\n      browser.runtime.openOptionsPage();\r\n    } else if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.openOptionsPage) {\r\n      chrome.runtime.openOptionsPage();\r\n    } else {\r\n      // Fallback: try to open the welcome screen directly\r\n      const welcomeUrl = browserAPI.runtime.getURL('src/options/welcome.html');\r\n      browserAPI.tabs.create({ url: welcomeUrl });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles sync character to cloud button click\r\n   */\r\n  async function handleSyncCharacterToCloud() {\r\n    try {\r\n      syncCharacterToCloudBtn.disabled = true;\r\n      syncCharacterToCloudBtn.textContent = '\u23F3 Syncing...';\r\n\r\n      // Get currently selected character ID\r\n      const selectedId = characterSelect.value;\r\n\r\n      if (!selectedId) {\r\n        showError('No character selected');\r\n        return;\r\n      }\r\n\r\n      // Get character data\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n      let characterData = profiles[selectedId];\r\n\r\n      if (!characterData) {\r\n        showError('Character data not found');\r\n        return;\r\n      }\r\n\r\n      // For database profiles (db- prefix), extract full character data from _fullData.raw_dicecloud_data\r\n      // Database profiles only contain a summary at the top level, while the full data is nested\r\n      if (characterData.source === 'database' && characterData._fullData) {\r\n        const fullData = characterData._fullData.raw_dicecloud_data;\r\n        if (fullData && typeof fullData === 'object') {\r\n          debug.log('\uD83D\uDCE6 Using full character data from database raw_dicecloud_data');\r\n          // Merge the full data with metadata\r\n          characterData = {\r\n            ...fullData,\r\n            source: 'database',\r\n            lastUpdated: characterData.lastUpdated || characterData._fullData.updated_at\r\n          };\r\n        } else {\r\n          debug.warn('\u26A0\uFE0F Database profile missing raw_dicecloud_data, using summary only');\r\n        }\r\n      }\r\n\r\n      // Get DiceCloud user ID from login status\r\n      const loginStatus = await browserAPI.runtime.sendMessage({ action: 'checkLoginStatus' });\r\n      const dicecloudUserId = loginStatus.userId; // This is the DiceCloud Meteor ID\r\n\r\n      debug.log('\uD83C\uDFAD Syncing character to cloud:', {\r\n        characterId: selectedId,\r\n        characterName: characterData.name,\r\n        dicecloudUserId: dicecloudUserId\r\n      });\r\n\r\n      // Use background script's syncCharacterToCloud which has all the linking logic\r\n      const result = await browserAPI.runtime.sendMessage({\r\n        action: 'syncCharacterToCloud',\r\n        characterData: {\r\n          ...characterData,\r\n          id: selectedId,\r\n          dicecloudUserId: dicecloudUserId, // Include DiceCloud user ID\r\n          userId: dicecloudUserId // Also as userId for backwards compatibility\r\n        }\r\n      });\r\n\r\n      if (result.success) {\r\n        showSuccess('Character synced to cloud!');\r\n      } else {\r\n        showError('Cloud sync failed: ' + (result.error || 'Unknown error'));\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error syncing character to cloud:', error);\r\n      showError('Cloud sync error: ' + error.message);\r\n    } finally {\r\n      syncCharacterToCloudBtn.disabled = false;\r\n      syncCharacterToCloudBtn.textContent = '\u2601\uFE0F Sync Character to Cloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles clear button click\r\n   */\r\n  async function handleClear() {\r\n    try {\r\n      clearBtn.disabled = true;\r\n\r\n      // Get currently selected character ID\r\n      const selectedId = characterSelect.value;\r\n\r\n      if (selectedId) {\r\n        // Clear specific character\r\n        await browserAPI.runtime.sendMessage({\r\n          action: 'clearCharacterData',\r\n          characterId: selectedId\r\n        });\r\n        showSuccess('Character data cleared');\r\n      } else {\r\n        // Clear all if no character is selected\r\n        await browserAPI.runtime.sendMessage({ action: 'clearCharacterData' });\r\n        showSuccess('All character data cleared');\r\n      }\r\n\r\n      // Reload to update UI\r\n      await loadCharacterData();\r\n    } catch (error) {\r\n      debug.error('Error clearing data:', error);\r\n      showError('Error clearing data');\r\n    } finally {\r\n      clearBtn.disabled = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles export button click - exports all characters to JSON file\r\n   */\r\n  async function handleExport() {\r\n    try {\r\n      exportBtn.disabled = true;\r\n      exportBtn.textContent = '\u23F3 Exporting...';\r\n\r\n      // Get all character profiles\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n\r\n      // Filter out non-character entries (like rollcloudPlayer)\r\n      const characterProfiles = {};\r\n      for (const [key, value] of Object.entries(profiles)) {\r\n        if (!key.startsWith('rollcloudPlayer')) {\r\n          characterProfiles[key] = value;\r\n        }\r\n      }\r\n\r\n      if (Object.keys(characterProfiles).length === 0) {\r\n        showError('No characters to export');\r\n        return;\r\n      }\r\n\r\n      // Create export data\r\n      const exportData = {\r\n        version: '1.0',\r\n        exportDate: new Date().toISOString(),\r\n        characters: characterProfiles\r\n      };\r\n\r\n      // Create and download JSON file\r\n      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `rollcloud-characters-${new Date().toISOString().split('T')[0]}.json`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n\r\n      showSuccess(`Exported ${Object.keys(characterProfiles).length} character(s)`);\r\n    } catch (error) {\r\n      debug.error('Error exporting characters:', error);\r\n      showError('Error exporting: ' + error.message);\r\n    } finally {\r\n      exportBtn.disabled = false;\r\n      exportBtn.textContent = '\uD83D\uDCE4 Export Characters';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles import file selection - imports characters from JSON file\r\n   */\r\n  async function handleImport(event) {\r\n    const file = event.target.files[0];\r\n    if (!file) return;\r\n\r\n    try {\r\n      importBtn.disabled = true;\r\n      importBtn.textContent = '\u23F3 Importing...';\r\n\r\n      const text = await file.text();\r\n      const importData = JSON.parse(text);\r\n\r\n      // Validate import data\r\n      if (!importData.characters || typeof importData.characters !== 'object') {\r\n        showError('Invalid import file format');\r\n        return;\r\n      }\r\n\r\n      // Import each character\r\n      let importedCount = 0;\r\n      for (const [characterId, characterData] of Object.entries(importData.characters)) {\r\n        await browserAPI.runtime.sendMessage({\r\n          action: 'storeCharacterData',\r\n          data: characterData,\r\n          slotId: characterId\r\n        });\r\n        importedCount++;\r\n      }\r\n\r\n      // Reload character data\r\n      await loadCharacterData();\r\n      showSuccess(`Imported ${importedCount} character(s)`);\r\n    } catch (error) {\r\n      debug.error('Error importing characters:', error);\r\n      if (error instanceof SyntaxError) {\r\n        showError('Invalid JSON file');\r\n      } else {\r\n        showError('Error importing: ' + error.message);\r\n      }\r\n    } finally {\r\n      importBtn.disabled = false;\r\n      importBtn.textContent = '\uD83D\uDCE5 Import Characters';\r\n      // Reset file input so the same file can be selected again\r\n      event.target.value = '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles cloud sync button click - manually syncs token to Supabase\r\n   */\r\n  async function handleCloudSync() {\r\n    try {\r\n      cloudSyncBtn.disabled = true;\r\n      cloudSyncBtn.textContent = '\u23F3 Syncing...';\r\n\r\n      // Get current token from storage\r\n      const result = await browserAPI.storage.local.get(['diceCloudToken', 'username', 'tokenExpires', 'diceCloudUserId', 'authId']);\r\n\r\n      if (!result.diceCloudToken) {\r\n        showError('No token to sync. Please log in first.');\r\n        return;\r\n      }\r\n\r\n      // Check if Supabase is available\r\n      if (typeof SupabaseTokenManager === 'undefined') {\r\n        showError('Cloud sync not available');\r\n        return;\r\n      }\r\n\r\n      const supabaseManager = new SupabaseTokenManager();\r\n      debug.log('\uD83C\uDF10 Manual cloud sync - Browser ID:', supabaseManager.generateUserId());\r\n\r\n      const supabaseResult = await supabaseManager.storeToken({\r\n        token: result.diceCloudToken,\r\n        userId: result.diceCloudUserId,\r\n        tokenExpires: result.tokenExpires,\r\n        username: result.username || 'DiceCloud User',\r\n        authId: result.authId || result.diceCloudUserId\r\n      });\r\n\r\n      if (supabaseResult.success) {\r\n        showSuccess('Token synced to cloud!');\r\n      } else {\r\n        showError('Cloud sync failed: ' + (supabaseResult.error || 'Unknown error'));\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error syncing to cloud:', error);\r\n      showError('Cloud sync error: ' + error.message);\r\n    } finally {\r\n      cloudSyncBtn.disabled = false;\r\n      cloudSyncBtn.textContent = '\u2601\uFE0F Sync to Cloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows success message\r\n   */\r\n  function showSuccess(message) {\r\n    statusIcon.textContent = '\u2705';\r\n    statusText.textContent = message;\r\n    setTimeout(() => {\r\n      loadCharacterData();\r\n    }, 2000);\r\n  }\r\n\r\n  /**\r\n   * Shows error message\r\n   */\r\n  function showError(message) {\r\n    statusIcon.textContent = '\u274C';\r\n    statusText.textContent = message;\r\n    setTimeout(() => {\r\n      loadCharacterData();\r\n    }, 3000);\r\n  }\r\n\r\n  /**\r\n   * Loads the auto backwards sync state from storage\r\n   */\r\n  async function loadAutoBackwardsSyncState() {\r\n    try {\r\n      const result = await browserAPI.storage.local.get(['autoBackwardsSync']);\r\n      const isEnabled = result.autoBackwardsSync !== false; // Default to true\r\n\r\n      if (autoBackwardsSyncToggle) {\r\n        autoBackwardsSyncToggle.checked = isEnabled;\r\n      }\r\n\r\n      debug.log('Auto backwards sync state loaded:', isEnabled);\r\n    } catch (error) {\r\n      debug.error('Error loading auto backwards sync state:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles auto backwards sync toggle change\r\n   */\r\n  async function handleAutoBackwardsSyncToggle() {\r\n    try {\r\n      const isEnabled = autoBackwardsSyncToggle.checked;\r\n\r\n      // Save to storage\r\n      await browserAPI.storage.local.set({ autoBackwardsSync: isEnabled });\r\n\r\n      // Notify Roll20 content script to enable/disable sync\r\n      const tabs = await browserAPI.tabs.query({ url: '*://app.roll20.net/*' });\r\n      for (const tab of tabs) {\r\n        try {\r\n          await browserAPI.tabs.sendMessage(tab.id, {\r\n            action: 'setAutoBackwardsSync',\r\n            enabled: isEnabled\r\n          });\r\n          debug.log('Sent auto backwards sync state to Roll20 tab:', tab.id, isEnabled);\r\n        } catch (error) {\r\n          debug.log('Could not send message to tab:', tab.id, error.message);\r\n        }\r\n      }\r\n\r\n      debug.log('Auto backwards sync toggled:', isEnabled);\r\n\r\n      // Show feedback\r\n      const previousText = statusText.textContent;\r\n      const previousIcon = statusIcon.textContent;\r\n      statusIcon.textContent = '\u2705';\r\n      statusText.textContent = `Auto backwards sync ${isEnabled ? 'enabled' : 'disabled'}`;\r\n      setTimeout(() => {\r\n        statusIcon.textContent = previousIcon;\r\n        statusText.textContent = previousText;\r\n      }, 2000);\r\n    } catch (error) {\r\n      debug.error('Error toggling auto backwards sync:', error);\r\n      showError('Failed to toggle auto backwards sync');\r\n    }\r\n  }\r\n\r\n  // ============================================================================\r\n  // Discord Integration (Pip Bot Pairing)\r\n  // ============================================================================\r\n\r\n  let pairingPollInterval = null;\r\n  let pairingExpiresAt = null;\r\n\r\n  /**\r\n   * Load Discord connection state on popup open\r\n   */\r\n  async function loadDiscordConnectionState() {\r\n    try {\r\n      const response = await browserAPI.runtime.sendMessage({ action: 'getDiscordWebhook' });\r\n      if (response.success && response.webhookUrl) {\r\n        // Already connected\r\n        showDiscordConnected(response.serverName || 'Discord Server');\r\n      } else {\r\n        // Not connected\r\n        showDiscordNotConnected();\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error loading Discord state:', error);\r\n      showDiscordNotConnected();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the \"not connected\" state\r\n   */\r\n  function showDiscordNotConnected() {\r\n    document.getElementById('discordNotConnected').style.display = 'block';\r\n    document.getElementById('discordPairing').style.display = 'none';\r\n    document.getElementById('discordConnected').style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * Show the \"pairing in progress\" state\r\n   */\r\n  function showDiscordPairing(code) {\r\n    document.getElementById('discordNotConnected').style.display = 'none';\r\n    document.getElementById('discordPairing').style.display = 'block';\r\n    document.getElementById('discordConnected').style.display = 'none';\r\n    document.getElementById('pairingCode').textContent = code;\r\n  }\r\n\r\n  /**\r\n   * Show the \"connected\" state\r\n   */\r\n  function showDiscordConnected(serverName) {\r\n    document.getElementById('discordNotConnected').style.display = 'none';\r\n    document.getElementById('discordPairing').style.display = 'none';\r\n    document.getElementById('discordConnected').style.display = 'block';\r\n    document.getElementById('discordServerName').textContent = serverName || 'Discord Server';\r\n  }\r\n\r\n  /**\r\n   * Generate a random 6-character pairing code\r\n   */\r\n  function generatePairingCode() {\r\n    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // No I, O, 0, 1\r\n    let code = '';\r\n    for (let i = 0; i < 6; i++) {\r\n      code += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return code;\r\n  }\r\n\r\n  /**\r\n   * Handle \"Setup Discord\" button click\r\n   */\r\n  async function handleSetupDiscord() {\r\n    try {\r\n      const setupBtn = document.getElementById('setupDiscordBtn');\r\n      setupBtn.disabled = true;\r\n      setupBtn.textContent = '\u23F3 Setting up...';\r\n\r\n      // Check for installer-provided pairing code first\r\n      let code = null;\r\n      let installerProvided = false;\r\n\r\n      try {\r\n        // First, request fresh code from installer via native messaging\r\n        debug.log('\uD83D\uDD0D Requesting pairing code from installer...');\r\n        await browserAPI.runtime.sendMessage({ action: 'requestPairingCodeFromInstaller' });\r\n\r\n        // Small delay to allow native messaging response\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n        // Check if installer provided a code\r\n        const stored = await browserAPI.storage.local.get(['installerPairingCode']);\r\n        if (stored.installerPairingCode) {\r\n          code = stored.installerPairingCode;\r\n          installerProvided = true;\r\n          debug.log('\uD83D\uDCE5 Using installer-provided pairing code:', code);\r\n          // Clear the stored code so it's not reused\r\n          await browserAPI.storage.local.remove(['installerPairingCode']);\r\n        }\r\n      } catch (e) {\r\n        debug.warn('Could not check for installer pairing code:', e);\r\n      }\r\n\r\n      // If no installer code, generate one locally\r\n      if (!code) {\r\n        code = generatePairingCode();\r\n        debug.log('\uD83C\uDFB2 Generated local pairing code:', code);\r\n      }\r\n\r\n      // Get DiceCloud user info\r\n      const loginStatus = await browserAPI.runtime.sendMessage({ action: 'checkLoginStatus' });\r\n      const diceCloudUsername = loginStatus.username || 'Unknown';\r\n      const diceCloudUserId = loginStatus.userId; // This is the Meteor ID\r\n\r\n      // Store in Supabase (only if we generated locally - installer code already exists)\r\n      if (!installerProvided) {\r\n        const storeResult = await browserAPI.runtime.sendMessage({\r\n          action: 'createDiscordPairing',\r\n          code: code,\r\n          username: diceCloudUsername,\r\n          diceCloudUserId: diceCloudUserId\r\n        });\r\n\r\n        if (!storeResult.success) {\r\n          throw new Error(storeResult.error || 'Failed to create pairing');\r\n        }\r\n      }\r\n\r\n      // Show pairing state with instructions\r\n      showDiscordPairing(code);\r\n\r\n      // Start polling for connection\r\n      pairingExpiresAt = Date.now() + 30 * 60 * 1000; // 30 minutes\r\n      startPairingPoll(code);\r\n\r\n    } catch (error) {\r\n      debug.error('Discord setup error:', error);\r\n      showDiscordStatus(`Setup failed: ${error.message}`, 'error');\r\n      showDiscordNotConnected();\r\n    } finally {\r\n      const setupBtn = document.getElementById('setupDiscordBtn');\r\n      if (setupBtn) {\r\n        setupBtn.disabled = false;\r\n        setupBtn.textContent = '\uD83C\uDFAE Setup Discord';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start polling Supabase for pairing completion\r\n   */\r\n  function startPairingPoll(code) {\r\n    // Update countdown display\r\n    const updateCountdown = () => {\r\n      const remaining = Math.max(0, Math.floor((pairingExpiresAt - Date.now()) / 1000));\r\n      const mins = Math.floor(remaining / 60);\r\n      const secs = remaining % 60;\r\n      const countdownEl = document.getElementById('pairingCountdown');\r\n      if (countdownEl) {\r\n        countdownEl.textContent = `(${mins}:${secs.toString().padStart(2, '0')})`;\r\n      }\r\n      if (remaining <= 0) {\r\n        handleCancelPairing();\r\n        showDiscordStatus('Pairing expired. Please try again.', 'error');\r\n      }\r\n    };\r\n\r\n    // Poll every 3 seconds\r\n    pairingPollInterval = setInterval(async () => {\r\n      updateCountdown();\r\n\r\n      try {\r\n        const result = await browserAPI.runtime.sendMessage({\r\n          action: 'checkDiscordPairing',\r\n          code: code\r\n        });\r\n\r\n        debug.log('\uD83D\uDCE5 Pairing check result:', {\r\n          success: result.success,\r\n          connected: result.connected,\r\n          hasWebhookUrl: !!result.webhookUrl,\r\n          webhookUrlPreview: result.webhookUrl ? `${result.webhookUrl.substring(0, 50)}...` : '(empty)',\r\n          serverName: result.serverName,\r\n          pairingId: result.pairingId\r\n        });\r\n\r\n        if (result.success && result.connected && result.webhookUrl) {\r\n          // Connected! Save webhook and update UI\r\n          clearInterval(pairingPollInterval);\r\n          pairingPollInterval = null;\r\n\r\n          debug.log('\uD83D\uDD17 Saving Discord webhook from pairing:', {\r\n            webhookUrl: result.webhookUrl ? `${result.webhookUrl.substring(0, 50)}...` : '(empty)',\r\n            serverName: result.serverName,\r\n            pairingId: result.pairingId\r\n          });\r\n\r\n          const setResult = await browserAPI.runtime.sendMessage({\r\n            action: 'setDiscordWebhook',\r\n            webhookUrl: result.webhookUrl,\r\n            enabled: true,\r\n            serverName: result.serverName,\r\n            pairingId: result.pairingId, // For command polling\r\n            discordUserId: result.discordUserId // Link to auth_tokens\r\n          });\r\n\r\n          debug.log('\uD83D\uDCDD setDiscordWebhook response:', setResult);\r\n\r\n          showDiscordConnected(result.serverName);\r\n          showDiscordStatus('Connected to Discord!', 'success');\r\n\r\n          // Re-sync character to cloud with the new Discord user ID\r\n          debug.log('\uD83D\uDD04 Re-syncing character to cloud with Discord user ID');\r\n          try {\r\n            await handleSyncCharacterToCloud();\r\n          } catch (e) {\r\n            debug.warn('Could not re-sync character after Discord link:', e);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        debug.error('Pairing poll error:', error);\r\n      }\r\n    }, 3000);\r\n\r\n    // Initial countdown update\r\n    updateCountdown();\r\n  }\r\n\r\n  /**\r\n   * Handle cancel pairing button\r\n   */\r\n  function handleCancelPairing() {\r\n    if (pairingPollInterval) {\r\n      clearInterval(pairingPollInterval);\r\n      pairingPollInterval = null;\r\n    }\r\n    showDiscordNotConnected();\r\n  }\r\n\r\n  /**\r\n   * Handle disconnect Discord button\r\n   */\r\n  async function handleDisconnectDiscord() {\r\n    try {\r\n      await browserAPI.runtime.sendMessage({\r\n        action: 'setDiscordWebhook',\r\n        webhookUrl: '',\r\n        enabled: false\r\n      });\r\n      showDiscordNotConnected();\r\n      showDiscordStatus('Disconnected from Discord', 'success');\r\n    } catch (error) {\r\n      debug.error('Disconnect error:', error);\r\n      showDiscordStatus(`Error: ${error.message}`, 'error');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles testing the Discord webhook\r\n   */\r\n  async function handleTestDiscordWebhook() {\r\n    const testBtn = document.getElementById('testDiscordWebhook');\r\n\r\n    try {\r\n      testBtn.disabled = true;\r\n      testBtn.textContent = '\u23F3 Testing...';\r\n\r\n      const response = await browserAPI.runtime.sendMessage({\r\n        action: 'testDiscordWebhook'\r\n      });\r\n\r\n      if (response.success) {\r\n        showDiscordStatus('Test sent! Check Discord.', 'success');\r\n      } else {\r\n        showDiscordStatus(`Test failed: ${response.error}`, 'error');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Discord test error:', error);\r\n      showDiscordStatus(`Error: ${error.message}`, 'error');\r\n    } finally {\r\n      testBtn.disabled = false;\r\n      testBtn.textContent = '\uD83E\uDDEA Test';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles saving manual webhook URL\r\n   */\r\n  async function handleSaveDiscordWebhook() {\r\n    const webhookUrl = document.getElementById('discordWebhookUrl').value.trim();\r\n    const saveBtn = document.getElementById('saveDiscordWebhook');\r\n\r\n    if (!webhookUrl) {\r\n      showDiscordStatus('Please enter a webhook URL', 'error');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = '\u23F3 Saving...';\r\n\r\n      await browserAPI.runtime.sendMessage({\r\n        action: 'setDiscordWebhook',\r\n        webhookUrl: webhookUrl,\r\n        enabled: true\r\n      });\r\n\r\n      showDiscordConnected('Manual Webhook');\r\n      showDiscordStatus('Webhook saved!', 'success');\r\n    } catch (error) {\r\n      debug.error('Save webhook error:', error);\r\n      showDiscordStatus(`Error: ${error.message}`, 'error');\r\n    } finally {\r\n      saveBtn.disabled = false;\r\n      saveBtn.textContent = '\uD83D\uDCBE Save Webhook URL';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles checking Discord integration for current character\r\n   */\r\n  async function handleCheckDiscordIntegration() {\r\n    // Get the button that was clicked (could be either connected or not connected state)\r\n    const checkBtn = document.getElementById('checkDiscordIntegration') || document.getElementById('checkDiscordIntegrationNotConnected');\r\n    \r\n    if (!checkBtn) {\r\n      debug.error('Check Discord integration button not found');\r\n      showDiscordStatus('Error: Button not found', 'error');\r\n      return;\r\n    }\r\n\r\n    const originalText = checkBtn.textContent;\r\n\r\n    try {\r\n      checkBtn.disabled = true;\r\n      checkBtn.textContent = '\u23F3 Checking...';\r\n\r\n      // Get current character data\r\n      const result = await browserAPI.storage.local.get(['activeCharacterId', 'characterProfiles']);\r\n      const activeCharacterId = result.activeCharacterId;\r\n      const characterProfiles = result.characterProfiles || {};\r\n\r\n      if (!activeCharacterId || !characterProfiles[activeCharacterId]) {\r\n        showDiscordStatus('No active character found', 'error');\r\n        return;\r\n      }\r\n\r\n      const currentCharacter = characterProfiles[activeCharacterId];\r\n      debug.log('\uD83D\uDD0D Checking Discord integration for character:', currentCharacter.name);\r\n\r\n      // Send message to background script to check Discord integration\r\n      const response = await browserAPI.runtime.sendMessage({\r\n        action: 'checkDiscordCharacterIntegration',\r\n        characterName: currentCharacter.name,\r\n        characterId: currentCharacter.id\r\n      });\r\n\r\n      if (response.success) {\r\n        if (response.found) {\r\n          showDiscordStatus(`\u2705 ${currentCharacter.name} is active in Discord server: ${response.serverName}`, 'success');\r\n        } else {\r\n          let message = `\u274C ${currentCharacter.name} is not currently active in any Discord server`;\r\n          \r\n          if (response.message === 'Discord integration not configured') {\r\n            message = `\u274C Discord integration not configured. Please set up Discord integration first.`;\r\n          } else if (response.availableCharacter && response.availableCharacter.name !== currentCharacter.name) {\r\n            message = `\u274C ${currentCharacter.name} is not active. Currently active: ${response.availableCharacter.name} (Level ${response.availableCharacter.level} ${response.availableCharacter.race} ${response.availableCharacter.class})`;\r\n          }\r\n          \r\n          showDiscordStatus(message, 'warning');\r\n        }\r\n      } else {\r\n        showDiscordStatus(`Error checking integration: ${response.error}`, 'error');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Check Discord integration error:', error);\r\n      showDiscordStatus(`Error: ${error.message}`, 'error');\r\n    } finally {\r\n      if (checkBtn) {\r\n        checkBtn.disabled = false;\r\n        checkBtn.textContent = originalText;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows Discord status message\r\n   */\r\n  function showDiscordStatus(message, type) {\r\n    const statusDiv = document.getElementById('discordStatus');\r\n    if (statusDiv) {\r\n      statusDiv.style.display = 'block';\r\n      statusDiv.textContent = message;\r\n      statusDiv.style.color = type === 'success' ? '#27ae60' : '#e74c3c';\r\n\r\n      setTimeout(() => {\r\n        statusDiv.style.display = 'none';\r\n      }, 3000);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks if this is an experimental build and updates UI accordingly\r\n   */\r\n  function checkExperimentalBuild() {\r\n    // Check for experimental build indicators\r\n    // Only explicit indicators - manifest name or version suffix\r\n    const experimentalIndicators = [\r\n      () => {\r\n        try {\r\n          const manifest = browserAPI.runtime.getManifest();\r\n          return manifest && manifest.name && manifest.name.includes('Experimental');\r\n        } catch (e) {\r\n          debug.log('\uD83D\uDD0D Could not check manifest name:', e);\r\n          return false;\r\n        }\r\n      },\r\n      () => {\r\n        try {\r\n          const manifest = browserAPI.runtime.getManifest();\r\n          // Only mark as experimental if version has 4 parts ending in .1 (e.g., 1.2.2.1)\r\n          const version = manifest && manifest.version;\r\n          if (!version) return false;\r\n          const parts = version.split('.');\r\n          return parts.length === 4 && parts[3] === '1';\r\n        } catch (e) {\r\n          debug.log('\uD83D\uDD0D Could not check manifest version:', e);\r\n          return false;\r\n        }\r\n      }\r\n    ];\r\n\r\n    // Check if any indicator returns true (using Promise.all for compatibility)\r\n    Promise.all(experimentalIndicators.map(check => \r\n      Promise.resolve(check()).catch(() => false)\r\n    )).then(results => {\r\n      const isExperimental = results.some(result => result === true);\r\n      \r\n      if (isExperimental) {\r\n        const experimentalNotice = document.getElementById('experimentalNotice');\r\n        const versionDisplay = document.getElementById('versionDisplay');\r\n        const experimentalInstructions = document.getElementById('experimentalInstructions');\r\n        \r\n        if (experimentalNotice) {\r\n          experimentalNotice.classList.remove('hidden');\r\n        }\r\n        \r\n        if (versionDisplay) {\r\n          try {\r\n            const manifest = browserAPI.runtime.getManifest();\r\n            versionDisplay.textContent = `v${manifest.version} - Experimental Sync`;\r\n          } catch (e) {\r\n            versionDisplay.textContent = 'Experimental Sync';\r\n          }\r\n        }\r\n        \r\n        if (experimentalInstructions) {\r\n          experimentalInstructions.classList.remove('hidden');\r\n        }\r\n        \r\n        debug.log('\uD83E\uDDEA Experimental build detected');\r\n      } else {\r\n        debug.log('\uD83D\uDCE6 Standard build detected');\r\n      }\r\n    }).catch(error => {\r\n      debug.log('\uD83D\uDD0D Error checking experimental build:', error);\r\n      debug.log('\uD83D\uDCE6 Assuming standard build');\r\n    });\r\n  }\r\n} // End initializePopup\r\n}); // End DOMContentLoaded\r\n"],
  "mappings": "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",
  "names": ["browserAPI", "response"]
}
