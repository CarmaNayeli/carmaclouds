{
  "version": 3,
  "sources": ["../../src/status-bar.js"],
  "sourcesContent": ["/**\r\n * Compact Status Bar\r\n * Displays HP, concentration, buffs/debuffs, resources, and advantage toggle\r\n */\r\n\r\nlet characterData = null;\r\nlet advantageState = 'normal';\r\n\r\n// Effect icons mapping\r\nconst EFFECT_ICONS = {\r\n  // Buffs\r\n  'Bless': '\uD83D\uDE4F',\r\n  'Guidance': '\uD83E\uDDED',\r\n  'Bardic Inspiration': '\uD83C\uDFB5',\r\n  'Shield of Faith': '\uD83D\uDEE1\uFE0F',\r\n  'Haste': '\u26A1',\r\n  'Heroism': '\uD83E\uDDB8',\r\n  'Aid': '\uD83D\uDCAA',\r\n  'Protection from Evil': '\u271D\uFE0F',\r\n  'Sanctuary': '\uD83C\uDFDB\uFE0F',\r\n  'Blur': '\uD83D\uDC7B',\r\n  'Mirror Image': '\uD83E\uDE9E',\r\n  'Invisibility': '\uD83D\uDC41\uFE0F',\r\n  'Greater Invisibility': '\uD83D\uDC41\uFE0F',\r\n  'Freedom of Movement': '\uD83C\uDFC3',\r\n  'Death Ward': '\uD83D\uDC80',\r\n  // Debuffs\r\n  'Bane': '\uD83D\uDE30',\r\n  'Poisoned': '\uD83E\uDD22',\r\n  'Frightened': '\uD83D\uDE31',\r\n  'Charmed': '\uD83D\uDC95',\r\n  'Stunned': '\uD83D\uDCAB',\r\n  'Paralyzed': '\uD83E\uDDCA',\r\n  'Blinded': '\uD83D\uDE48',\r\n  'Deafened': '\uD83D\uDE49',\r\n  'Restrained': '\u26D3\uFE0F',\r\n  'Grappled': '\uD83E\uDD1D',\r\n  'Prone': '\uD83D\uDECF\uFE0F',\r\n  'Incapacitated': '\uD83D\uDE35',\r\n  'Exhaustion': '\uD83D\uDE2B',\r\n  'Unconscious': '\uD83D\uDCA4',\r\n  'Petrified': '\uD83D\uDDFF',\r\n  'Concentration': '\uD83E\uDDE0',\r\n  'Hexed': '\uD83D\uDD2E'\r\n};\r\n\r\n// Initialize when DOM is ready\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  if (typeof debug !== 'undefined') debug.log('\uD83D\uDCCA Status bar loaded');\r\n\r\n  // Close button\r\n  document.getElementById('close-btn').addEventListener('click', () => window.close());\r\n\r\n  // Advantage toggle buttons\r\n  document.getElementById('adv-btn').addEventListener('click', () => setAdvantage('advantage'));\r\n  document.getElementById('norm-btn').addEventListener('click', () => setAdvantage('normal'));\r\n  document.getElementById('dis-btn').addEventListener('click', () => setAdvantage('disadvantage'));\r\n\r\n  // Spell slots dropdown toggle\r\n  document.getElementById('slots-header').addEventListener('click', () => {\r\n    document.getElementById('slots-row').classList.toggle('open');\r\n  });\r\n\r\n  // Request character data from parent window\r\n  if (window.opener && !window.opener.closed) {\r\n    window.opener.postMessage({ action: 'requestStatusData' }, '*');\r\n  } else {\r\n    document.getElementById('character-name').textContent = 'No parent';\r\n  }\r\n});\r\n\r\n// Listen for messages from parent\r\nwindow.addEventListener('message', (event) => {\r\n  if (event.data && event.data.action === 'updateStatusData') {\r\n    characterData = event.data.data;\r\n    updateDisplay();\r\n  } else if (event.data && event.data.action === 'updateAdvantageState') {\r\n    setAdvantageUI(event.data.state);\r\n  }\r\n});\r\n\r\nfunction setAdvantage(state) {\r\n  advantageState = state;\r\n  setAdvantageUI(state);\r\n\r\n  // Send to parent window\r\n  if (window.opener && !window.opener.closed) {\r\n    window.opener.postMessage({ action: 'setAdvantageState', state: state }, '*');\r\n  }\r\n}\r\n\r\nfunction setAdvantageUI(state) {\r\n  advantageState = state;\r\n  document.querySelectorAll('.adv-btn').forEach(btn => btn.classList.remove('active'));\r\n\r\n  if (state === 'advantage') {\r\n    document.getElementById('adv-btn').classList.add('active');\r\n  } else if (state === 'disadvantage') {\r\n    document.getElementById('dis-btn').classList.add('active');\r\n  } else {\r\n    document.getElementById('norm-btn').classList.add('active');\r\n  }\r\n}\r\n\r\nfunction updateDisplay() {\r\n  if (!characterData) return;\r\n\r\n  // Character name\r\n  document.getElementById('character-name').textContent = characterData.name || 'Unknown';\r\n\r\n  updateHP();\r\n  updateConcentration();\r\n  updateSpellSlots();\r\n  updateResources();\r\n  updateEffects();\r\n}\r\n\r\nfunction updateHP() {\r\n  const hp = characterData.hitPoints || characterData.hit_points || {};\r\n  const current = hp.current || 0;\r\n  const max = hp.max || 1;\r\n  const tempHP = characterData.temporaryHP || hp.temp || 0;\r\n\r\n  const percentage = Math.max(0, Math.min(100, (current / max) * 100));\r\n\r\n  const hpFill = document.getElementById('hp-fill');\r\n  const hpText = document.getElementById('hp-text');\r\n  const tempHPEl = document.getElementById('temp-hp');\r\n\r\n  hpFill.style.width = `${percentage}%`;\r\n  hpText.textContent = `${current}/${max}`;\r\n\r\n  hpFill.className = 'hp-fill';\r\n  if (percentage <= 25) hpFill.classList.add('critical');\r\n  else if (percentage <= 50) hpFill.classList.add('low');\r\n\r\n  tempHPEl.textContent = tempHP > 0 ? `+${tempHP}` : '';\r\n}\r\n\r\nfunction updateConcentration() {\r\n  const concEl = document.getElementById('concentration');\r\n  const spellEl = document.getElementById('conc-spell');\r\n\r\n  const spell = characterData.concentrationSpell || '';\r\n\r\n  if (spell) {\r\n    concEl.classList.remove('inactive');\r\n    concEl.classList.add('active');\r\n    spellEl.textContent = spell;\r\n  } else {\r\n    concEl.classList.remove('active');\r\n    concEl.classList.add('inactive');\r\n    spellEl.textContent = '\u2014';\r\n  }\r\n}\r\n\r\nfunction updateSpellSlots() {\r\n  const spellSlots = characterData.spellSlots || {};\r\n  const slotsRow = document.getElementById('slots-row');\r\n  const dropdown = document.getElementById('slots-dropdown');\r\n  const summary = document.getElementById('slots-summary');\r\n\r\n  const slots = [];\r\n  let totalCurrent = 0;\r\n  let totalMax = 0;\r\n\r\n  // Regular spell slots (levels 1-9)\r\n  for (let level = 1; level <= 9; level++) {\r\n    const current = spellSlots[`level${level}SpellSlots`] || 0;\r\n    const max = spellSlots[`level${level}SpellSlotsMax`] || 0;\r\n\r\n    if (max > 0) {\r\n      slots.push({ level: level, current, max, type: 'regular' });\r\n      totalCurrent += current;\r\n      totalMax += max;\r\n    }\r\n  }\r\n\r\n  // Pact Magic\r\n  const pactCurrent = spellSlots.pactMagicSlots || 0;\r\n  const pactMax = spellSlots.pactMagicSlotsMax || 0;\r\n  const pactLevel = spellSlots.pactMagicLevel || 0;\r\n\r\n  if (pactMax > 0) {\r\n    slots.push({ level: `P${pactLevel}`, current: pactCurrent, max: pactMax, type: 'pact' });\r\n    totalCurrent += pactCurrent;\r\n    totalMax += pactMax;\r\n  }\r\n\r\n  if (slots.length === 0) {\r\n    slotsRow.style.display = 'none';\r\n    return;\r\n  }\r\n\r\n  slotsRow.style.display = 'block';\r\n  summary.textContent = `${totalCurrent}/${totalMax}`;\r\n\r\n  dropdown.innerHTML = slots.map(slot => `\r\n    <div class=\"slot-item ${slot.type === 'pact' ? 'pact' : ''}\">\r\n      <span class=\"lvl\">${slot.type === 'pact' ? 'Pact' : 'Lv' + slot.level}</span>\r\n      <span class=\"val ${slot.current === 0 ? 'empty' : ''}\">${slot.current}/${slot.max}</span>\r\n    </div>\r\n  `).join('');\r\n}\r\n\r\nfunction updateResources() {\r\n  const resources = characterData.resources || [];\r\n  const resourcesRow = document.getElementById('resources-row');\r\n  const resourcesList = document.getElementById('resources-list');\r\n\r\n  // Filter out HP, Lucky, and zero-max resources\r\n  const filteredResources = resources.filter(r => {\r\n    const name = (r.name || '').toLowerCase();\r\n    return r.max > 0 && !name.includes('hit points') && !name.includes('lucky');\r\n  });\r\n\r\n  if (filteredResources.length === 0) {\r\n    resourcesRow.style.display = 'none';\r\n    return;\r\n  }\r\n\r\n  resourcesRow.style.display = 'block';\r\n  resourcesList.innerHTML = filteredResources.slice(0, 4).map(r => `\r\n    <div class=\"resource-item\">\r\n      <span class=\"name\" title=\"${r.name}\">${r.name}</span>\r\n      <span class=\"val\">${r.current}/${r.max}</span>\r\n    </div>\r\n  `).join('');\r\n}\r\n\r\nfunction updateEffects() {\r\n  const buffs = characterData.activeBuffs || [];\r\n  const debuffs = characterData.activeDebuffs || [];\r\n  const effectsRow = document.getElementById('effects-row');\r\n\r\n  const allEffects = [\r\n    ...buffs.map(b => ({ name: typeof b === 'string' ? b : b.name, type: 'buff' })),\r\n    ...debuffs.map(d => ({ name: typeof d === 'string' ? d : d.name, type: 'debuff' }))\r\n  ];\r\n\r\n  if (allEffects.length === 0) {\r\n    effectsRow.innerHTML = '<span class=\"no-effects\">No effects</span>';\r\n    return;\r\n  }\r\n\r\n  effectsRow.innerHTML = allEffects.map(e => {\r\n    const icon = EFFECT_ICONS[e.name] || (e.type === 'buff' ? '\u2728' : '\uD83D\uDC80');\r\n    return `<span class=\"effect-badge\" title=\"${e.name}\">${icon}<span class=\"tooltip\">${e.name}</span></span>`;\r\n  }).join('');\r\n}\r\n\r\n// Request updates periodically\r\nsetInterval(() => {\r\n  if (window.opener && !window.opener.closed) {\r\n    window.opener.postMessage({ action: 'requestStatusData' }, '*');\r\n  } else {\r\n    window.close();\r\n  }\r\n}, 5000);\r\n"],
  "mappings": "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",
  "names": []
}
