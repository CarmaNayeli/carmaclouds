{
  "version": 3,
  "sources": ["../../../src/popup/adapters/foundcloud/adapter.js", "../../../src/popup/adapters/owlcloud/adapter.js", "../../../src/content/dicecloud-extraction.js", "../../../src/popup/adapters/rollcloud/adapter.js", "../../../src/popup/popup.js"],
  "sourcesContent": ["/**\r\n * FoundCloud Adapter\r\n * Foundry VTT integration for CarmaClouds\r\n * Currently under development\r\n */\r\n\r\nexport async function init(containerEl) {\r\n  console.log('FoundCloud adapter - not yet implemented');\r\n\r\n  // Show \"not yet implemented\" message\r\n  containerEl.innerHTML = `\r\n    <div style=\"padding: 40px 20px; text-align: center; color: #b0b0b0;\">\r\n      <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#16a75a\" stroke-width=\"2\" style=\"margin-bottom: 20px; opacity: 0.5;\">\r\n        <circle cx=\"12\" cy=\"12\" r=\"10\"></circle>\r\n        <line x1=\"12\" y1=\"16\" x2=\"12\" y2=\"12\"></line>\r\n        <line x1=\"12\" y1=\"8\" x2=\"12.01\" y2=\"8\"></line>\r\n      </svg>\r\n      <h2 style=\"color: #e0e0e0; margin-bottom: 12px;\">FoundCloud - Coming Soon</h2>\r\n      <p style=\"margin-bottom: 20px; font-size: 14px; line-height: 1.6;\">\r\n        Foundry VTT integration is currently under development.\r\n      </p>\r\n      <p style=\"font-size: 13px; opacity: 0.7;\">\r\n        For now, use RollCloud or OwlCloud to sync your characters.\r\n      </p>\r\n    </div>\r\n  `;\r\n}\r\n", "/**\r\n * OwlCloud Adapter\r\n * Owlbear Rodeo integration for CarmaClouds\r\n * Loads the full OwlCloud popup UI\r\n */\r\n\r\n// Detect browser API (Firefox uses 'browser', Chrome uses 'chrome')\r\nconst browserAPI = (typeof browser !== 'undefined' && browser.runtime) ? browser : chrome;\r\n\r\nexport async function init(containerEl) {\r\n  console.log('Initializing OwlCloud adapter...');\r\n\r\n  try {\r\n    // Show loading state\r\n    containerEl.innerHTML = '<div class=\"loading\">Loading OwlCloud...</div>';\r\n\r\n    // Fetch synced characters and DiceCloud user ID from storage\r\n    const result = await browserAPI.storage.local.get(['carmaclouds_characters', 'diceCloudUserId']) || {};\r\n    const characters = result.carmaclouds_characters || [];\r\n    const diceCloudUserId = result.diceCloudUserId;\r\n\r\n    console.log('Found', characters.length, 'synced characters');\r\n    console.log('DiceCloud User ID:', diceCloudUserId);\r\n\r\n    // Get the most recent character (for now - later we'll add character selection)\r\n    const character = characters.length > 0 ? characters[0] : null;\r\n\r\n    // Fetch the OwlCloud popup HTML\r\n    const htmlPath = browserAPI.runtime.getURL('src/popup/adapters/owlcloud/popup.html');\r\n    const response = await fetch(htmlPath);\r\n    const html = await response.text();\r\n\r\n    // Extract only the main content (not the full HTML document with header/footer)\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    const mainContent = doc.querySelector('main');\r\n\r\n    // Wrap content in a scoped container to prevent CSS conflicts\r\n    const wrapper = document.createElement('div');\r\n    wrapper.className = 'owlcloud-adapter-scope';\r\n    wrapper.innerHTML = mainContent ? mainContent.innerHTML : doc.body.innerHTML;\r\n    containerEl.innerHTML = '';\r\n    containerEl.appendChild(wrapper);\r\n\r\n    // Load and inject the CSS with scoping\r\n    const cssPath = browserAPI.runtime.getURL('src/popup/adapters/owlcloud/popup.css');\r\n    const cssResponse = await fetch(cssPath);\r\n    let css = await cssResponse.text();\r\n\r\n    // Scope all CSS rules to the adapter container\r\n    css = css.replace(/(^|\\})\\s*([^{}@]+)\\s*\\{/gm, (match, closer, selector) => {\r\n      // Don't scope @media, @keyframes, etc.\r\n      if (selector.trim().startsWith('@')) return match;\r\n      // Scope the selector\r\n      const scopedSelector = selector.split(',').map(s => `.owlcloud-adapter-scope ${s.trim()}`).join(', ');\r\n      return `${closer} ${scopedSelector} {`;\r\n    });\r\n\r\n    const style = document.createElement('style');\r\n    style.textContent = css;\r\n    containerEl.appendChild(style);\r\n\r\n    const SUPABASE_URL = 'https://luiesmfjdcmpywavvfqm.supabase.co';\r\n    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1aWVzbWZqZGNtcHl3YXZ2ZnFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4ODYxNDksImV4cCI6MjA4NTQ2MjE0OX0.oqjHFf2HhCLcanh0HVryoQH7iSV7E9dHHZJdYehxZ0U';\r\n\r\n    const loginPrompt = wrapper.querySelector('#loginPrompt');\r\n    const syncBox = wrapper.querySelector('#syncBox');\r\n    const pushedCharactersList = wrapper.querySelector('#pushedCharactersList');\r\n    const noPushedCharacters = wrapper.querySelector('#noPushedCharacters');\r\n\r\n    // Function to fetch and display pushed characters from database\r\n    async function loadPushedCharacters() {\r\n      if (!diceCloudUserId || !pushedCharactersList) return;\r\n\r\n      try {\r\n        const response = await fetch(\r\n          `${SUPABASE_URL}/rest/v1/clouds_characters?user_id_dicecloud=eq.${diceCloudUserId}&select=dicecloud_character_id,character_name,level,class,race`,\r\n          {\r\n            headers: {\r\n              'apikey': SUPABASE_ANON_KEY,\r\n              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`\r\n            }\r\n          }\r\n        );\r\n\r\n        if (response.ok) {\r\n          const pushedChars = await response.json();\r\n          pushedCharactersList.innerHTML = '';\r\n\r\n          if (pushedChars.length > 0) {\r\n            if (noPushedCharacters) noPushedCharacters.classList.add('hidden');\r\n\r\n            pushedChars.forEach(char => {\r\n              const card = document.createElement('div');\r\n              card.style.cssText = 'background: #1a1a1a; padding: 12px; border-radius: 8px; border: 1px solid #333;';\r\n              card.innerHTML = `\r\n                <h4 style=\"color: #16a75a; margin: 0 0 6px 0; font-size: 14px;\">${char.character_name || 'Unknown'}</h4>\r\n                <div style=\"display: flex; gap: 8px; font-size: 12px; color: #888;\">\r\n                  <span>Lvl ${char.level || '?'}</span>\r\n                  <span>\u2022</span>\r\n                  <span>${char.class || 'Unknown'}</span>\r\n                  <span>\u2022</span>\r\n                  <span>${char.race || 'Unknown'}</span>\r\n                </div>\r\n              `;\r\n              pushedCharactersList.appendChild(card);\r\n            });\r\n          } else {\r\n            if (noPushedCharacters) noPushedCharacters.classList.remove('hidden');\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to load pushed characters:', error);\r\n      }\r\n    }\r\n\r\n    // Check if user is logged in to BOTH DiceCloud AND Supabase\r\n    const supabase = window.supabaseClient;\r\n    let supabaseUserId = null;\r\n    if (supabase) {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      supabaseUserId = session?.user?.id;\r\n    }\r\n\r\n    if (!diceCloudUserId || !supabaseUserId) {\r\n      // Show login prompt - need both logins\r\n      if (loginPrompt) {\r\n        loginPrompt.classList.remove('hidden');\r\n        const titleEl = loginPrompt.querySelector('h3');\r\n        const promptText = loginPrompt.querySelector('p');\r\n        const openAuthBtn = loginPrompt.querySelector('#openAuthModalBtn');\r\n\r\n        if (!diceCloudUserId) {\r\n          // DiceCloud not logged in - show standard DiceCloud login prompt\r\n          if (titleEl) titleEl.textContent = 'Login Required';\r\n          if (promptText) promptText.textContent = 'Please login to DiceCloud to sync your characters.';\r\n          if (openAuthBtn) {\r\n            openAuthBtn.textContent = '\uD83D\uDD10 Login to DiceCloud';\r\n            openAuthBtn.addEventListener('click', () => {\r\n              // Trigger the main popup's DiceCloud auth modal\r\n              const authButton = document.querySelector('#dicecloud-auth-button');\r\n              if (authButton) authButton.click();\r\n            });\r\n          }\r\n        } else {\r\n          // DiceCloud logged in but Supabase not - show \"heads up\" notification\r\n          if (titleEl) titleEl.textContent = '\u26A0\uFE0F Heads Up!';\r\n          if (promptText) {\r\n            promptText.innerHTML = 'To auto-sync characters, you need a database username and password. <strong>It is NOT your DiceCloud login.</strong> Please register or sign in below.';\r\n          }\r\n          if (openAuthBtn) {\r\n            openAuthBtn.textContent = '\uD83D\uDC64 Go to Account Tab';\r\n            openAuthBtn.addEventListener('click', () => {\r\n              // Open the auth modal first\r\n              const authButton = document.querySelector('#dicecloud-auth-button');\r\n              if (authButton) authButton.click();\r\n\r\n              // Then switch to the Account (Supabase) tab manually\r\n              setTimeout(() => {\r\n                // Deactivate DiceCloud tab\r\n                const dicecloudTab = document.querySelector('[data-auth-tab=\"dicecloud\"]');\r\n                const dicecloudContent = document.querySelector('#dicecloud-auth-content');\r\n                if (dicecloudTab) dicecloudTab.classList.remove('active');\r\n                if (dicecloudContent) dicecloudContent.classList.remove('active');\r\n\r\n                // Activate Supabase tab\r\n                const supabaseTab = document.querySelector('[data-auth-tab=\"supabase\"]');\r\n                const supabaseContent = document.querySelector('#supabase-auth-content');\r\n                if (supabaseTab) supabaseTab.classList.add('active');\r\n                if (supabaseContent) {\r\n                  supabaseContent.classList.add('active');\r\n                  supabaseContent.style.display = 'block';\r\n                }\r\n              }, 100);\r\n            });\r\n          }\r\n        }\r\n      }\r\n      if (syncBox) syncBox.classList.add('hidden');\r\n    } else if (characters.length > 0 && characters[0]?.raw) {\r\n      // User is logged in and has character data - show sync box\r\n      const character = characters[0];\r\n\r\n      if (loginPrompt) loginPrompt.classList.add('hidden');\r\n      if (syncBox) syncBox.classList.remove('hidden');\r\n\r\n      // Populate sync box with current character\r\n      const nameEl = wrapper.querySelector('#syncCharName');\r\n      const levelEl = wrapper.querySelector('#syncCharLevel');\r\n      const classEl = wrapper.querySelector('#syncCharClass');\r\n      const raceEl = wrapper.querySelector('#syncCharRace');\r\n\r\n      if (nameEl) nameEl.textContent = character.name || 'Unknown';\r\n      if (levelEl) levelEl.textContent = `Lvl ${character.preview?.level || '?'}`;\r\n      if (classEl) classEl.textContent = character.preview?.class || 'Unknown';\r\n      if (raceEl) raceEl.textContent = character.preview?.race || 'Unknown';\r\n\r\n      // Add push to VTT button handler\r\n      const pushBtn = wrapper.querySelector('#pushToVttBtn');\r\n      if (pushBtn) {\r\n        pushBtn.addEventListener('click', async () => {\r\n          const originalText = pushBtn.innerHTML;\r\n          try {\r\n            pushBtn.disabled = true;\r\n            pushBtn.innerHTML = '\u23F3 Pushing...';\r\n\r\n            // Get Supabase user ID if authenticated\r\n            const supabase = window.supabaseClient;\r\n            let supabaseUserId = null;\r\n            if (supabase) {\r\n              const { data: { session } } = await supabase.auth.getSession();\r\n              supabaseUserId = session?.user?.id;\r\n            }\r\n\r\n            // Prepare character data with ALL info including supabase_user_id\r\n            const characterData = {\r\n              dicecloud_character_id: character.id,\r\n              character_name: character.name || 'Unknown',\r\n              user_id_dicecloud: diceCloudUserId,\r\n              level: character.preview?.level || null,\r\n              class: character.preview?.class || null,\r\n              race: character.preview?.race || null,\r\n              raw_dicecloud_data: character.raw,\r\n              is_active: false,\r\n              updated_at: new Date().toISOString()\r\n            };\r\n\r\n            // Include Supabase user ID for cross-device sync\r\n            if (supabaseUserId) {\r\n              characterData.supabase_user_id = supabaseUserId;\r\n              console.log('\u2705 Including Supabase user ID:', supabaseUserId);\r\n            }\r\n\r\n            // Push to database\r\n            const response = await fetch(\r\n              `${SUPABASE_URL}/rest/v1/clouds_characters?on_conflict=user_id_dicecloud,dicecloud_character_id`,\r\n              {\r\n                method: 'POST',\r\n                headers: {\r\n                  'apikey': SUPABASE_ANON_KEY,\r\n                  'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n                  'Content-Type': 'application/json',\r\n                  'Prefer': 'resolution=merge-duplicates,return=representation'\r\n                },\r\n                body: JSON.stringify(characterData)\r\n              }\r\n            );\r\n\r\n            if (response.ok) {\r\n              console.log('\u2705 Character pushed:', character.name);\r\n              pushBtn.innerHTML = '\u2705 Pushed!';\r\n\r\n              // Reload pushed characters list\r\n              await loadPushedCharacters();\r\n\r\n              setTimeout(() => {\r\n                pushBtn.innerHTML = originalText;\r\n                pushBtn.disabled = false;\r\n              }, 2000);\r\n            } else {\r\n              const errorText = await response.text();\r\n              throw new Error(`Push failed: ${errorText}`);\r\n            }\r\n          } catch (error) {\r\n            console.error('Error pushing character:', error);\r\n            pushBtn.innerHTML = '\u274C Failed';\r\n            alert(`Failed to push: ${error.message}`);\r\n            setTimeout(() => {\r\n              pushBtn.innerHTML = originalText;\r\n              pushBtn.disabled = false;\r\n            }, 2000);\r\n          }\r\n        });\r\n      }\r\n\r\n      // Load and display pushed characters\r\n      await loadPushedCharacters();\r\n    } else {\r\n      // Logged in but no character data from DiceCloud\r\n      if (loginPrompt) loginPrompt.classList.add('hidden');\r\n      if (syncBox) syncBox.classList.add('hidden');\r\n      if (noPushedCharacters) {\r\n        noPushedCharacters.textContent = 'No character data found. Sync a character from DiceCloud first.';\r\n        noPushedCharacters.classList.remove('hidden');\r\n      }\r\n    }\r\n\r\n    // Add copy button handler\r\n    const copyBtn = wrapper.querySelector('#copyOwlbearUrlBtn');\r\n    if (copyBtn) {\r\n      copyBtn.addEventListener('click', async () => {\r\n        const urlInput = wrapper.querySelector('#owlbearExtensionUrl');\r\n        if (urlInput) {\r\n          try {\r\n            await navigator.clipboard.writeText(urlInput.value);\r\n            const originalText = copyBtn.textContent;\r\n            copyBtn.textContent = '\u2713 Copied!';\r\n            setTimeout(() => {\r\n              copyBtn.textContent = originalText;\r\n            }, 2000);\r\n          } catch (err) {\r\n            console.error('Failed to copy:', err);\r\n            copyBtn.textContent = '\u2717 Failed';\r\n            setTimeout(() => {\r\n              copyBtn.textContent = 'Copy';\r\n            }, 2000);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    // Listen for Supabase auth state changes to refresh the UI\r\n    if (supabase) {\r\n      supabase.auth.onAuthStateChange((event, session) => {\r\n        console.log('\uD83D\uDD10 OwlCloud adapter detected Supabase auth change:', event);\r\n        // Reload the entire adapter when auth state changes\r\n        init(containerEl);\r\n      });\r\n    }\r\n\r\n    // Listen for data sync notifications to refresh the UI\r\n    browserAPI.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n      if (message.action === 'dataSynced') {\r\n        console.log('\uD83D\uDCE5 OwlCloud adapter received data sync notification:', message.characterName);\r\n        // Reload the entire adapter to show updated character data\r\n        init(containerEl);\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Failed to load OwlCloud UI:', error);\r\n    containerEl.innerHTML = `\r\n      <div class=\"error\">\r\n        <strong>Failed to load OwlCloud</strong>\r\n        <p>${error.message}</p>\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n", "/**\r\n * Comprehensive DiceCloud character data extraction\r\n * Copied from proven OwlCloud implementation\r\n */\r\n\r\n// Standardized DiceCloud variable names\r\nconst STANDARD_VARS = {\r\n  abilities: ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma'],\r\n  abilityMods: ['strengthMod', 'dexterityMod', 'constitutionMod', 'intelligenceMod', 'wisdomMod', 'charismaMod'],\r\n  saves: ['strengthSave', 'dexteritySave', 'constitutionSave', 'intelligenceSave', 'wisdomSave', 'charismaSave'],\r\n  skills: [\r\n    'acrobatics', 'animalHandling', 'arcana', 'athletics', 'deception', 'history',\r\n    'insight', 'intimidation', 'investigation', 'medicine', 'nature', 'perception',\r\n    'performance', 'persuasion', 'religion', 'sleightOfHand', 'stealth', 'survival'\r\n  ],\r\n  combat: ['armorClass', 'hitPoints', 'speed', 'initiative', 'proficiencyBonus']\r\n};\r\n\r\n/**\r\n * Determines hit die type from character class (D&D 5e)\r\n */\r\nfunction getHitDieTypeFromClass(levels) {\r\n  const hitDiceMap = {\r\n    'barbarian': 'd12',\r\n    'fighter': 'd10',\r\n    'paladin': 'd10',\r\n    'ranger': 'd10',\r\n    'bard': 'd8',\r\n    'cleric': 'd8',\r\n    'druid': 'd8',\r\n    'monk': 'd8',\r\n    'rogue': 'd8',\r\n    'warlock': 'd8',\r\n    'sorcerer': 'd6',\r\n    'wizard': 'd6'\r\n  };\r\n\r\n  if (levels && levels.length > 0) {\r\n    const primaryClass = levels[0]?.name?.toLowerCase() || '';\r\n    for (const [classKey, die] of Object.entries(hitDiceMap)) {\r\n      if (primaryClass.includes(classKey)) {\r\n        return die;\r\n      }\r\n    }\r\n  }\r\n\r\n  return 'd8'; // Default\r\n}\r\n\r\n/**\r\n * Parses API response into structured character data\r\n */\r\nexport function parseCharacterData(apiData, characterId) {\r\n  console.log('CarmaClouds: Parsing character data...');\r\n\r\n  if (!apiData.creatures || apiData.creatures.length === 0) {\r\n    console.error('CarmaClouds: No creatures found in API response');\r\n    throw new Error('No character data found in API response');\r\n  }\r\n\r\n  const creature = apiData.creatures[0];\r\n  const variables = (apiData.creatureVariables && apiData.creatureVariables[0]) || {};\r\n  const properties = apiData.creatureProperties || [];\r\n\r\n  console.log('CarmaClouds: Creature:', creature.name);\r\n  console.log('CarmaClouds: Variables count:', Object.keys(variables).length);\r\n  console.log('CarmaClouds: Properties count:', properties.length);\r\n\r\n  // Extract character name early to ensure proper scope\r\n  const characterName = creature.name || '';\r\n\r\n  // Calculate AC from multiple sources\r\n  const calculateArmorClass = () => {\r\n    // Helper: try to coerce a variety of shapes into a numeric AC\r\n    const extractNumeric = (val) => {\r\n      if (val === null || val === undefined) return null;\r\n      if (typeof val === 'number' && !isNaN(val)) return val;\r\n      if (typeof val === 'string') {\r\n        const parsed = parseFloat(val);\r\n        return isNaN(parsed) ? null : parsed;\r\n      }\r\n      if (typeof val === 'object') {\r\n        if (val.total !== undefined && typeof val.total === 'number') return val.total;\r\n        if (val.value !== undefined && typeof val.value === 'number') return val.value;\r\n        if (val.calculation && typeof val.calculation === 'string') {\r\n          const bm = val.calculation.match(/^(\\d+)/);\r\n          if (bm) return parseInt(bm[1]);\r\n        }\r\n      }\r\n      return null;\r\n    };\r\n\r\n    // Check if Dicecloud provided a calculated AC (most reliable)\r\n    if (variables.armorClass && (variables.armorClass.total || variables.armorClass.value)) {\r\n      const variableAC = variables.armorClass.total || variables.armorClass.value;\r\n      console.log(`CarmaClouds: Using Dicecloud's calculated AC: ${variableAC}`);\r\n      return variableAC;\r\n    }\r\n\r\n    // Try denormalizedStats\r\n    if (creature && creature.denormalizedStats) {\r\n      const tryKeys = ['armorClass', 'ac', 'armor'];\r\n      for (const k of tryKeys) {\r\n        if (creature.denormalizedStats.hasOwnProperty(k)) {\r\n          const num = extractNumeric(creature.denormalizedStats[k]);\r\n          if (num !== null) {\r\n            console.log(`CarmaClouds: Using denormalizedStats.${k}:`, num);\r\n            return num;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Check variables for AC\r\n    const varNamesToCheck = ['armor', 'armorClass', 'armor_class', 'ac', 'acTotal'];\r\n    for (const vn of varNamesToCheck) {\r\n      if (variables.hasOwnProperty(vn)) {\r\n        const v = variables[vn];\r\n        const candidate = extractNumeric(v && (v.total ?? v.value ?? v));\r\n        if (candidate !== null) {\r\n          console.log(`CarmaClouds: Using variable ${vn}:`, candidate);\r\n          return candidate;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Calculate from properties (base + armor + bonuses)\r\n    let baseAC = 10;\r\n    let armorAC = null;\r\n    const acBonuses = [];\r\n\r\n    properties.forEach(prop => {\r\n      if (prop.inactive || prop.disabled) return;\r\n\r\n      const hasArmorStat = prop.stat === 'armor' ||\r\n                          (Array.isArray(prop.stats) && prop.stats.includes('armor'));\r\n\r\n      if (hasArmorStat) {\r\n        let amount = null;\r\n        if (typeof prop.amount === 'number') {\r\n          amount = prop.amount;\r\n        } else if (typeof prop.amount === 'string') {\r\n          amount = parseFloat(prop.amount);\r\n        }\r\n\r\n        if (amount !== null && !isNaN(amount)) {\r\n          const operation = prop.operation || '';\r\n\r\n          if (operation === 'base' || operation === 'Base value') {\r\n            if (armorAC === null || amount > armorAC) {\r\n              armorAC = amount;\r\n            }\r\n          } else if (operation === 'add' || operation === 'Add') {\r\n            acBonuses.push({ name: prop.name, amount });\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    let finalAC = armorAC !== null ? armorAC : baseAC;\r\n    acBonuses.forEach(bonus => {\r\n      finalAC += bonus.amount;\r\n    });\r\n\r\n    console.log('CarmaClouds: Calculated AC:', finalAC);\r\n    return finalAC;\r\n  };\r\n\r\n  // Extract race, class, and level from properties\r\n  let characterRace = 'Unknown';\r\n  let characterClass = '';\r\n  let characterLevel = 0;\r\n  const uniqueClasses = new Set();\r\n  let raceFound = false;\r\n\r\n  console.log('CarmaClouds: Extracting basic character info...');\r\n\r\n  // Debug: Log all property types to help identify race\r\n  const propertyTypes = {};\r\n  properties.forEach(prop => {\r\n    if (prop && prop.type) {\r\n      propertyTypes[prop.type] = (propertyTypes[prop.type] || 0) + 1;\r\n    }\r\n  });\r\n  console.log('CarmaClouds: Property types in character:', propertyTypes);\r\n\r\n  // Check if race is stored directly on creature\r\n  if (creature.race) {\r\n    console.log('CarmaClouds: Found race on creature:', creature.race);\r\n    characterRace = creature.race;\r\n    raceFound = true;\r\n  }\r\n  if (creature.denormalizedStats && creature.denormalizedStats.race) {\r\n    console.log('CarmaClouds: Found race in denormalizedStats:', creature.denormalizedStats.race);\r\n    characterRace = creature.denormalizedStats.race;\r\n    raceFound = true;\r\n  }\r\n\r\n  for (const prop of properties) {\r\n    if (!prop) continue;\r\n\r\n    // Check for race as a folder (DiceCloud often stores races as folders)\r\n    // Look for folders with common race names at the top level\r\n    if (!raceFound && prop.type === 'folder' && prop.name) {\r\n      const commonRaces = ['human', 'elf', 'dwarf', 'halfling', 'gnome', 'half-elf', 'half-orc', 'dragonborn', 'tiefling', 'orc', 'goblin', 'kobold', 'warforged', 'tabaxi', 'kenku', 'aarakocra', 'genasi', 'aasimar', 'firbolg', 'goliath', 'triton', 'yuan-ti', 'tortle', 'lizardfolk', 'bugbear', 'hobgoblin', 'changeling', 'shifter', 'kalashtar'];\r\n      const nameMatchesRace = commonRaces.some(race => prop.name.toLowerCase().includes(race));\r\n      if (nameMatchesRace) {\r\n        const parentDepth = prop.ancestors ? prop.ancestors.length : 0;\r\n        if (parentDepth <= 2) { // Top-level or near top-level folder\r\n          console.log('CarmaClouds: Found race folder:', prop.name);\r\n          characterRace = prop.name;\r\n          raceFound = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Extract race for preview - check multiple possible types\r\n    if (!raceFound && (prop.type === 'race' || prop.type === 'species' || prop.type === 'characterRace')) {\r\n      if (prop.name) {\r\n        console.log('CarmaClouds: Found race property:', prop.type, prop.name);\r\n        characterRace = prop.name;\r\n        raceFound = true;\r\n      }\r\n    }\r\n\r\n    // Check if it's a constant named \"Race\" (DiceCloud v2 stores race as a constant)\r\n    if (!raceFound && prop.type === 'constant' && prop.name && prop.name.toLowerCase() === 'race') {\r\n      if (prop.value) {\r\n        console.log('CarmaClouds: Found race as constant:', prop.value);\r\n        characterRace = prop.value;\r\n        raceFound = true;\r\n      }\r\n    }\r\n\r\n    // Extract class for preview\r\n    if (prop.type === 'class' && prop.name && !prop.inactive && !prop.disabled) {\r\n      const cleanName = prop.name.replace(/\\s*\\[Multiclass\\]/i, '').trim();\r\n      const normalizedClassName = cleanName.toLowerCase().trim();\r\n      if (!uniqueClasses.has(normalizedClassName)) {\r\n        uniqueClasses.add(normalizedClassName);\r\n        if (characterClass) {\r\n          characterClass += ` / ${cleanName}`;\r\n        } else {\r\n          characterClass = cleanName;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Extract level for preview\r\n    if (prop.type === 'classLevel' && !prop.inactive && !prop.disabled) {\r\n      characterLevel += 1;\r\n    }\r\n  }\r\n\r\n  // Fallback: Check for race in variables if not found in properties\r\n  if (!raceFound && (!characterRace || characterRace === 'Unknown')) {\r\n    console.log('CarmaClouds: Race not found in properties, checking variables...');\r\n    const raceVars = Object.keys(variables).filter(key =>\r\n      key.toLowerCase().includes('race') || key.toLowerCase().includes('species')\r\n    );\r\n\r\n    if (raceVars.length > 0) {\r\n      console.log('CarmaClouds: Found race-related variables:', raceVars);\r\n\r\n      // Log raw data for each race variable\r\n      raceVars.forEach(varName => {\r\n        console.log(`CarmaClouds: Raw data for \"${varName}\":`, variables[varName]);\r\n      });\r\n\r\n      // Helper function to format camelCase race names\r\n      const formatRaceName = (name) => {\r\n        if (!name) return null;\r\n        if (name.toLowerCase() === 'custom' || name.toLowerCase() === 'customlineage') {\r\n          return 'Custom Lineage';\r\n        }\r\n        let formatted = name.replace(/([a-z])([A-Z])/g, '$1 $2');\r\n        formatted = formatted.split(' ').map(word =>\r\n          word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()\r\n        ).join(' ');\r\n        return formatted;\r\n      };\r\n\r\n      // Helper function to extract race name from variable name\r\n      const extractRaceFromVarName = (varName) => {\r\n        const raceName = varName.replace(/race$/i, '').replace(/^race$/i, '');\r\n        if (raceName && raceName !== varName.toLowerCase()) {\r\n          return raceName.charAt(0).toUpperCase() + raceName.slice(1);\r\n        }\r\n        return null;\r\n      };\r\n\r\n      let raceName = null;\r\n      let subraceName = null;\r\n\r\n      // Check for subRace first\r\n      const subRaceVar = raceVars.find(key => key.toLowerCase() === 'subrace');\r\n      if (subRaceVar) {\r\n        const subRaceValue = variables[subRaceVar];\r\n        console.log('CarmaClouds: Found subRace variable:', subRaceValue);\r\n        if (typeof subRaceValue === 'object' && subRaceValue !== null) {\r\n          if (subRaceValue.name) {\r\n            subraceName = formatRaceName(subRaceValue.name);\r\n          } else if (subRaceValue.text) {\r\n            subraceName = formatRaceName(subRaceValue.text);\r\n          } else if (subRaceValue.value) {\r\n            subraceName = formatRaceName(subRaceValue.value);\r\n          }\r\n        } else if (typeof subRaceValue === 'string') {\r\n          subraceName = formatRaceName(subRaceValue);\r\n        }\r\n      }\r\n\r\n      // Check for race variable\r\n      const raceVar = raceVars.find(key => key.toLowerCase() === 'race');\r\n      if (raceVar) {\r\n        const raceValue = variables[raceVar];\r\n        console.log('CarmaClouds: Found race variable:', raceValue);\r\n        if (typeof raceValue === 'object' && raceValue !== null) {\r\n          // Check for nested value.value (DiceCloud constants have this structure)\r\n          if (raceValue.value && typeof raceValue.value === 'object' && raceValue.value.value) {\r\n            raceName = formatRaceName(raceValue.value.value);\r\n            console.log('CarmaClouds: Extracted race from nested value.value:', raceName);\r\n          } else if (raceValue.value && typeof raceValue.value === 'string') {\r\n            raceName = formatRaceName(raceValue.value);\r\n          } else if (raceValue.name) {\r\n            raceName = formatRaceName(raceValue.name);\r\n          } else if (raceValue.text) {\r\n            raceName = formatRaceName(raceValue.text);\r\n          }\r\n        } else if (typeof raceValue === 'string') {\r\n          raceName = formatRaceName(raceValue);\r\n        }\r\n      }\r\n\r\n      // If we didn't find race/subrace with names, look for specific race variables\r\n      if (!raceName) {\r\n        for (const varName of raceVars) {\r\n          const varValue = variables[varName];\r\n          if (typeof varValue === 'object' && varValue !== null && varValue.value === true) {\r\n            const extracted = extractRaceFromVarName(varName);\r\n            if (extracted) {\r\n              raceName = extracted;\r\n              console.log('CarmaClouds: Extracted race from variable name:', varName, '->', raceName);\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Combine race and subrace if we have both\r\n      if (raceName && subraceName) {\r\n        characterRace = `${raceName} - ${subraceName}`;\r\n        console.log('CarmaClouds: Combined race and subrace:', characterRace);\r\n      } else if (subraceName) {\r\n        characterRace = subraceName;\r\n        console.log('CarmaClouds: Using subrace as race:', characterRace);\r\n      } else if (raceName) {\r\n        characterRace = raceName;\r\n        console.log('CarmaClouds: Using race:', characterRace);\r\n      } else {\r\n        console.log('CarmaClouds: Could not determine race from variables');\r\n      }\r\n    } else {\r\n      console.log('CarmaClouds: No race variables found');\r\n    }\r\n  }\r\n\r\n  console.log('CarmaClouds: Character preview:', characterName, characterLevel, characterRace, characterClass);\r\n\r\n  // Store just raw data + metadata - parsing happens per-VTT when tabs load\r\n  const characterData = {\r\n    // Metadata\r\n    id: creature._id || characterId,\r\n    name: characterName,\r\n    url: window.location.href,\r\n    timestamp: new Date().toISOString(),\r\n    source: 'dicecloud',\r\n\r\n    // Preview info (for character lists, etc.)\r\n    preview: {\r\n      race: characterRace,\r\n      class: characterClass || 'Unknown',\r\n      level: characterLevel\r\n    },\r\n\r\n    // Raw DiceCloud API data - VTT adapters will parse this as needed\r\n    raw: {\r\n      creature: creature,\r\n      variables: variables,\r\n      properties: properties\r\n    }\r\n  };\r\n\r\n  console.log('CarmaClouds: Successfully stored character data:', characterData.name);\r\n  return characterData;\r\n}\r\n\r\n/**\r\n * Parse raw DiceCloud data into Roll20-specific format\r\n * Called by RollCloud adapter when tab is loaded\r\n */\r\nexport function parseForRollCloud(rawData) {\r\n  if (!rawData || !rawData.creature || !rawData.variables || !rawData.properties) {\r\n    throw new Error('Invalid raw data format');\r\n  }\r\n\r\n  const { creature, variables, properties } = rawData;\r\n\r\n  // Extract character name early to ensure proper scope\r\n  const characterName = creature.name || '';\r\n\r\n  // Extract race, class, level\r\n  let race = 'Unknown';\r\n  let characterClass = '';\r\n  let level = 0;\r\n  const uniqueClasses = new Set();\r\n  let raceFound = false;\r\n\r\n  for (const prop of properties) {\r\n    if (!prop) continue;\r\n\r\n    // Check for race as a folder (DiceCloud often stores races as folders)\r\n    if (!raceFound && prop.type === 'folder' && prop.name) {\r\n      const commonRaces = ['human', 'elf', 'dwarf', 'halfling', 'gnome', 'half-elf', 'half-orc', 'dragonborn', 'tiefling', 'orc', 'goblin', 'kobold', 'warforged', 'tabaxi', 'kenku', 'aarakocra', 'genasi', 'aasimar', 'firbolg', 'goliath', 'triton', 'yuan-ti', 'tortle', 'lizardfolk', 'bugbear', 'hobgoblin', 'changeling', 'shifter', 'kalashtar'];\r\n      const nameMatchesRace = commonRaces.some(r => prop.name.toLowerCase().includes(r));\r\n      if (nameMatchesRace) {\r\n        const parentDepth = prop.ancestors ? prop.ancestors.length : 0;\r\n        if (parentDepth <= 2) {\r\n          race = prop.name;\r\n          raceFound = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Check for race property types\r\n    if (!raceFound && (prop.type === 'race' || prop.type === 'species' || prop.type === 'characterRace')) {\r\n      if (prop.name) {\r\n        race = prop.name;\r\n        raceFound = true;\r\n      }\r\n    }\r\n\r\n    // DiceCloud v2 stores race as a constant\r\n    if (!raceFound && prop.type === 'constant' && prop.name && prop.name.toLowerCase() === 'race') {\r\n      if (prop.value) {\r\n        race = prop.value;\r\n        raceFound = true;\r\n      }\r\n    }\r\n\r\n    if (prop.type === 'class' && prop.name && !prop.inactive && !prop.disabled) {\r\n      const cleanName = prop.name.replace(/\\s*\\[Multiclass\\]/i, '').trim();\r\n      const normalizedClassName = cleanName.toLowerCase().trim();\r\n      if (!uniqueClasses.has(normalizedClassName)) {\r\n        uniqueClasses.add(normalizedClassName);\r\n        characterClass = characterClass ? `${characterClass} / ${cleanName}` : cleanName;\r\n      }\r\n    }\r\n\r\n    if (prop.type === 'classLevel' && !prop.inactive && !prop.disabled) {\r\n      level += 1;\r\n    }\r\n  }\r\n\r\n  // Fallback: Check for race in variables if not found in properties\r\n  if (!raceFound && (!race || race === 'Unknown')) {\r\n    const raceVars = Object.keys(variables).filter(key =>\r\n      key.toLowerCase().includes('race') || key.toLowerCase().includes('species')\r\n    );\r\n\r\n    if (raceVars.length > 0) {\r\n      // Log raw data for each race variable\r\n      raceVars.forEach(varName => {\r\n        console.log(`parseForRollCloud: Raw data for \"${varName}\":`, variables[varName]);\r\n      });\r\n\r\n      // Helper function to format camelCase race names\r\n      const formatRaceName = (name) => {\r\n        if (!name) return null;\r\n        if (name.toLowerCase() === 'custom' || name.toLowerCase() === 'customlineage') {\r\n          return 'Custom Lineage';\r\n        }\r\n        let formatted = name.replace(/([a-z])([A-Z])/g, '$1 $2');\r\n        formatted = formatted.split(' ').map(word =>\r\n          word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()\r\n        ).join(' ');\r\n        return formatted;\r\n      };\r\n\r\n      // Helper function to extract race name from variable name\r\n      const extractRaceFromVarName = (varName) => {\r\n        const raceName = varName.replace(/race$/i, '').replace(/^race$/i, '');\r\n        if (raceName && raceName !== varName.toLowerCase()) {\r\n          return raceName.charAt(0).toUpperCase() + raceName.slice(1);\r\n        }\r\n        return null;\r\n      };\r\n\r\n      let raceName = null;\r\n      let subraceName = null;\r\n\r\n      // Check for subRace first\r\n      const subRaceVar = raceVars.find(key => key.toLowerCase() === 'subrace');\r\n      if (subRaceVar) {\r\n        const subRaceValue = variables[subRaceVar];\r\n        if (typeof subRaceValue === 'object' && subRaceValue !== null) {\r\n          if (subRaceValue.name) {\r\n            subraceName = formatRaceName(subRaceValue.name);\r\n          } else if (subRaceValue.text) {\r\n            subraceName = formatRaceName(subRaceValue.text);\r\n          } else if (subRaceValue.value) {\r\n            subraceName = formatRaceName(subRaceValue.value);\r\n          }\r\n        } else if (typeof subRaceValue === 'string') {\r\n          subraceName = formatRaceName(subRaceValue);\r\n        }\r\n      }\r\n\r\n      // Check for race variable\r\n      const raceVar = raceVars.find(key => key.toLowerCase() === 'race');\r\n      if (raceVar) {\r\n        const raceValue = variables[raceVar];\r\n        if (typeof raceValue === 'object' && raceValue !== null) {\r\n          // Check for nested value.value (DiceCloud constants have this structure)\r\n          if (raceValue.value && typeof raceValue.value === 'object' && raceValue.value.value) {\r\n            raceName = formatRaceName(raceValue.value.value);\r\n          } else if (raceValue.value && typeof raceValue.value === 'string') {\r\n            raceName = formatRaceName(raceValue.value);\r\n          } else if (raceValue.name) {\r\n            raceName = formatRaceName(raceValue.name);\r\n          } else if (raceValue.text) {\r\n            raceName = formatRaceName(raceValue.text);\r\n          }\r\n        } else if (typeof raceValue === 'string') {\r\n          raceName = formatRaceName(raceValue);\r\n        }\r\n      }\r\n\r\n      // If we didn't find race/subrace with names, look for specific race variables\r\n      if (!raceName) {\r\n        for (const varName of raceVars) {\r\n          const varValue = variables[varName];\r\n          if (typeof varValue === 'object' && varValue !== null && varValue.value === true) {\r\n            const extracted = extractRaceFromVarName(varName);\r\n            if (extracted) {\r\n              raceName = extracted;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Combine race and subrace if we have both\r\n      if (raceName && subraceName) {\r\n        race = `${raceName} - ${subraceName}`;\r\n      } else if (subraceName) {\r\n        race = subraceName;\r\n      } else if (raceName) {\r\n        race = raceName;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Build attributes\r\n  const attributes = {};\r\n  STANDARD_VARS.abilities.forEach(ability => {\r\n    attributes[ability] = variables[ability]?.total || variables[ability]?.value || 10;\r\n  });\r\n\r\n  // Calculate modifiers\r\n  const attributeMods = {};\r\n  Object.keys(attributes).forEach(attr => {\r\n    attributeMods[attr] = Math.floor((attributes[attr] - 10) / 2);\r\n  });\r\n\r\n  // Extract saves\r\n  const saves = {};\r\n  STANDARD_VARS.saves.forEach(save => {\r\n    if (variables[save]) {\r\n      const abilityName = save.replace('Save', '');\r\n      saves[abilityName] = variables[save].total || variables[save].value || 0;\r\n    }\r\n  });\r\n\r\n  // Extract skills\r\n  const skills = {};\r\n  STANDARD_VARS.skills.forEach(skill => {\r\n    if (variables[skill]) {\r\n      skills[skill] = variables[skill].total || variables[skill].value || 0;\r\n    }\r\n  });\r\n\r\n  // Calculate AC using the comprehensive logic\r\n  const calculateAC = () => {\r\n    const extractNumeric = (val) => {\r\n      if (val === null || val === undefined) return null;\r\n      if (typeof val === 'number' && !isNaN(val)) return val;\r\n      if (typeof val === 'string') {\r\n        const parsed = parseFloat(val);\r\n        return isNaN(parsed) ? null : parsed;\r\n      }\r\n      if (typeof val === 'object') {\r\n        if (val.total !== undefined && typeof val.total === 'number') return val.total;\r\n        if (val.value !== undefined && typeof val.value === 'number') return val.value;\r\n      }\r\n      return null;\r\n    };\r\n\r\n    if (variables.armorClass?.total || variables.armorClass?.value) {\r\n      return variables.armorClass.total || variables.armorClass.value;\r\n    }\r\n\r\n    if (creature.denormalizedStats) {\r\n      const tryKeys = ['armorClass', 'ac', 'armor'];\r\n      for (const k of tryKeys) {\r\n        if (creature.denormalizedStats.hasOwnProperty(k)) {\r\n          const num = extractNumeric(creature.denormalizedStats[k]);\r\n          if (num !== null) return num;\r\n        }\r\n      }\r\n    }\r\n\r\n    const varNamesToCheck = ['armor', 'armorClass', 'armor_class', 'ac', 'acTotal'];\r\n    for (const vn of varNamesToCheck) {\r\n      if (variables.hasOwnProperty(vn)) {\r\n        const candidate = extractNumeric(variables[vn]?.total ?? variables[vn]?.value ?? variables[vn]);\r\n        if (candidate !== null) return candidate;\r\n      }\r\n    }\r\n\r\n    let baseAC = 10;\r\n    let armorAC = null;\r\n    const acBonuses = [];\r\n\r\n    properties.forEach(prop => {\r\n      if (prop.inactive || prop.disabled) return;\r\n\r\n      const hasArmorStat = prop.stat === 'armor' || (Array.isArray(prop.stats) && prop.stats.includes('armor'));\r\n\r\n      if (hasArmorStat) {\r\n        let amount = typeof prop.amount === 'number' ? prop.amount : parseFloat(prop.amount);\r\n        if (!isNaN(amount)) {\r\n          const operation = prop.operation || '';\r\n          if (operation === 'base' || operation === 'Base value') {\r\n            if (armorAC === null || amount > armorAC) armorAC = amount;\r\n          } else if (operation === 'add' || operation === 'Add') {\r\n            acBonuses.push({ name: prop.name, amount });\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    let finalAC = armorAC !== null ? armorAC : baseAC;\r\n    acBonuses.forEach(bonus => finalAC += bonus.amount);\r\n    return finalAC;\r\n  };\r\n\r\n  // Helper to extract text from DiceCloud text objects\r\n  const extractText = (field) => {\r\n    if (!field) return '';\r\n    if (typeof field === 'string') return field;\r\n    if (typeof field === 'object' && field.text) return field.text;\r\n    return '';\r\n  };\r\n\r\n  // Parse spells from properties with child attack/damage extraction\r\n  const spells = properties\r\n    .filter(p => p.type === 'spell')\r\n    .map(spell => {\r\n      // Find child properties (attack rolls, damage) for this spell\r\n      const spellChildren = properties.filter(p => {\r\n        if (p.type !== 'roll' && p.type !== 'damage' && p.type !== 'attack') return false;\r\n        if (p.ancestors && Array.isArray(p.ancestors)) {\r\n          return p.ancestors.some(ancestor => {\r\n            const ancestorId = typeof ancestor === 'object' ? ancestor.id : ancestor;\r\n            return ancestorId === spell._id;\r\n          });\r\n        }\r\n        return false;\r\n      });\r\n\r\n      // Extract attack roll from children\r\n      let attackRoll = '';\r\n      const attackChild = spellChildren.find(c => c.type === 'attack' || (c.type === 'roll' && c.name && c.name.toLowerCase().includes('attack')));\r\n      if (attackChild && attackChild.roll) {\r\n        if (typeof attackChild.roll === 'string') {\r\n          attackRoll = attackChild.roll;\r\n        } else if (typeof attackChild.roll === 'object') {\r\n          attackRoll = attackChild.roll.calculation || attackChild.roll.value || 'use_spell_attack_bonus';\r\n        }\r\n      }\r\n\r\n      // Extract damage rolls from children\r\n      const damageRolls = [];\r\n      spellChildren.filter(c => c.type === 'damage' || (c.type === 'roll' && c.name && (c.name.toLowerCase().includes('damage') || c.name.toLowerCase().includes('heal')))).forEach(damageChild => {\r\n        let formula = '';\r\n        // Try amount field first (standard damage property)\r\n        if (damageChild.amount) {\r\n          if (typeof damageChild.amount === 'string') {\r\n            formula = damageChild.amount;\r\n          } else if (typeof damageChild.amount === 'object') {\r\n            formula = damageChild.amount.calculation || String(damageChild.amount.value || '');\r\n          }\r\n        }\r\n        // Fallback to roll field (alternative structure)\r\n        else if (damageChild.roll) {\r\n          if (typeof damageChild.roll === 'string') {\r\n            formula = damageChild.roll;\r\n          } else if (typeof damageChild.roll === 'object') {\r\n            formula = damageChild.roll.calculation || String(damageChild.roll.value || '');\r\n          }\r\n        }\r\n        // Fallback to damage field\r\n        else if (damageChild.damage) {\r\n          if (typeof damageChild.damage === 'string') {\r\n            formula = damageChild.damage;\r\n          } else if (typeof damageChild.damage === 'object') {\r\n            formula = damageChild.damage.calculation || String(damageChild.damage.value || '');\r\n          }\r\n        }\r\n\r\n        if (formula) {\r\n          damageRolls.push({\r\n            formula: formula,\r\n            type: damageChild.damageType || '',\r\n            name: damageChild.name || ''\r\n          });\r\n        }\r\n      });\r\n\r\n      // First damage roll for backward compatibility\r\n      const damage = damageRolls.length > 0 ? damageRolls[0].formula : '';\r\n      const damageType = damageRolls.length > 0 ? damageRolls[0].type : '';\r\n\r\n      // Determine spell type (damage, healing, utility)\r\n      let spellType = 'utility';\r\n      if (damageRolls.length > 0) {\r\n        // Check if any damage roll is healing type\r\n        const hasHealingRoll = damageRolls.some(roll =>\r\n          roll.name.toLowerCase().includes('heal') ||\r\n          roll.type.toLowerCase().includes('heal')\r\n        );\r\n\r\n        // Also check spell name for healing keywords\r\n        const spellName = (spell.name || '').toLowerCase();\r\n        const hasHealingName = spellName.includes('heal') ||\r\n          spellName.includes('cure') ||\r\n          spellName.includes('regenerat') ||\r\n          spellName.includes('revivif') ||\r\n          spellName.includes('restoration') ||\r\n          spellName.includes('raise') ||\r\n          spellName.includes('resurrect');\r\n\r\n        // Check description for healing keywords\r\n        const spellDesc = extractText(spell.description).toLowerCase();\r\n        const hasHealingDesc = spellDesc.includes('regain') && spellDesc.includes('hit point');\r\n\r\n        spellType = (hasHealingRoll || hasHealingName || hasHealingDesc) ? 'healing' : 'damage';\r\n      }\r\n\r\n      return {\r\n        id: spell._id,\r\n        name: spell.name || 'Unnamed Spell',\r\n        level: spell.level || 0,\r\n        school: spell.school || '',\r\n        spellType: spellType,\r\n        castingTime: spell.castingTime || '',\r\n        range: spell.range || '',\r\n        components: spell.components || '',\r\n        duration: spell.duration || '',\r\n        description: extractText(spell.description),\r\n        summary: extractText(spell.summary),\r\n        ritual: spell.ritual || false,\r\n        concentration: spell.concentration || false,\r\n        prepared: spell.prepared !== false,\r\n        alwaysPrepared: spell.alwaysPrepared || false,\r\n        attackRoll: attackRoll,\r\n        damage: damage,\r\n        damageType: damageType,\r\n        damageRolls: damageRolls\r\n      };\r\n    });\r\n\r\n  // Parse actions from properties (exclude inactive/disabled)\r\n  const actions = properties\r\n    .filter(p => p.type === 'action' && p.name && !p.inactive && !p.disabled)\r\n    .map(action => {\r\n      // Extract attack roll and damage from the action\r\n      let attackRoll = '';\r\n      if (action.attackRoll) {\r\n        attackRoll = typeof action.attackRoll === 'string' ? action.attackRoll : String(action.attackRoll.value || action.attackRoll.calculation || '');\r\n      }\r\n\r\n      let damage = '';\r\n      let damageType = '';\r\n      if (action.damage) {\r\n        damage = typeof action.damage === 'string' ? action.damage : String(action.damage.value || action.damage.calculation || '');\r\n      }\r\n      if (action.damageType) {\r\n        damageType = action.damageType;\r\n      }\r\n\r\n      return {\r\n        id: action._id,\r\n        name: action.name,\r\n        actionType: action.actionType || 'action',\r\n        description: extractText(action.description),\r\n        summary: extractText(action.summary),\r\n        attackRoll: attackRoll,\r\n        damage: damage,\r\n        damageType: damageType,\r\n        uses: action.uses || 0,\r\n        usesUsed: action.usesUsed || 0,\r\n        reset: action.reset || '',\r\n        resources: action.resources || {},\r\n        tags: action.tags || []\r\n      };\r\n    });\r\n\r\n  // Parse spell slots from variables\r\n  // DiceCloud uses: slotLevel1, slotLevel2, etc.\r\n  const spellSlots = {};\r\n  for (let level = 1; level <= 9; level++) {\r\n    const slotVar = variables[`slotLevel${level}`];\r\n    if (slotVar) {\r\n      const current = slotVar.value || 0;\r\n      const max = slotVar.total || slotVar.max || slotVar.value || 0;\r\n      spellSlots[`level${level}SpellSlots`] = current;\r\n      spellSlots[`level${level}SpellSlotsMax`] = max;\r\n    }\r\n  }\r\n\r\n  // Parse resources from properties (only resource-type attributes)\r\n  const resources = properties\r\n    .filter(p => p.type === 'resource' || (p.type === 'attribute' && p.attributeType === 'resource'))\r\n    .map(resource => ({\r\n      id: resource._id,\r\n      name: resource.name || 'Unnamed Resource',\r\n      current: resource.value || resource.currentValue || 0,\r\n      max: resource.total || resource.max || 0,\r\n      reset: resource.reset || '',\r\n      variableName: resource.variableName || resource.varName || ''\r\n    }));\r\n\r\n  // Parse inventory from properties (items, equipment, and containers, exclude inactive)\r\n  const inventory = properties\r\n    .filter(p => (p.type === 'item' || p.type === 'equipment' || p.type === 'container') && !p.inactive)\r\n    .map(item => ({\r\n      id: item._id,\r\n      name: item.name || 'Unnamed Item',\r\n      quantity: item.quantity || 1,\r\n      weight: item.weight || 0,\r\n      value: item.value || 0,\r\n      description: extractText(item.description),\r\n      summary: extractText(item.summary),\r\n      equipped: item.equipped || false,\r\n      attuned: item.attuned || false,\r\n      requiresAttunement: item.requiresAttunement || false\r\n    }));\r\n\r\n  return {\r\n    name: characterName,\r\n    race,\r\n    class: characterClass || 'Unknown',\r\n    level,\r\n    background: '',\r\n    alignment: creature.alignment || '',\r\n    attributes,\r\n    attributeMods,\r\n    saves,\r\n    skills,\r\n    hitPoints: {\r\n      current: variables.hitPoints?.currentValue ?? variables.hitPoints?.value ?? 0,\r\n      max: variables.hitPoints?.total ?? variables.hitPoints?.max ?? 0\r\n    },\r\n    temporaryHP: variables.temporaryHitPoints?.value ?? variables.temporaryHitPoints?.currentValue ?? 0,\r\n    armorClass: calculateAC(),\r\n    speed: variables.speed?.total || variables.speed?.value || 30,\r\n    initiative: variables.initiative?.total || variables.initiative?.value || 0,\r\n    proficiencyBonus: variables.proficiencyBonus?.total || variables.proficiencyBonus?.value || 0,\r\n    spellSlots,\r\n    resources,\r\n    inventory,\r\n    spells,\r\n    actions\r\n  };\r\n}\r\n\r\n/**\r\n * Parse raw DiceCloud data into Owlbear Rodeo-specific format\r\n * Called by OwlCloud adapter when tab is loaded\r\n */\r\nexport function parseForOwlCloud(rawData) {\r\n  // For now, use same format as Roll20\r\n  return parseForRollCloud(rawData);\r\n}\r\n\r\n/**\r\n * Parse raw DiceCloud data into Foundry VTT-specific format\r\n * Called by FoundCloud adapter when tab is loaded\r\n */\r\nexport function parseForFoundCloud(rawData) {\r\n  // For now, use same format as Roll20\r\n  // TODO: Customize for Foundry VTT's data structure\r\n  return parseForRollCloud(rawData);\r\n}\r\n", "/**\r\n * RollCloud Adapter\r\n * Roll20 integration for CarmaClouds\r\n * Loads the full RollCloud popup UI\r\n */\r\n\r\nimport { parseForRollCloud } from '../../../content/dicecloud-extraction.js';\r\n\r\n// Detect browser API (Firefox uses 'browser', Chrome uses 'chrome')\r\nconst browserAPI = (typeof browser !== 'undefined' && browser.runtime) ? browser : chrome;\r\n\r\nexport async function init(containerEl) {\r\n  console.log('Initializing RollCloud adapter...');\r\n\r\n  try {\r\n    // Show loading state\r\n    containerEl.innerHTML = '<div class=\"loading\">Loading RollCloud...</div>';\r\n\r\n    // Fetch synced characters from storage\r\n    const result = await browserAPI.storage.local.get('carmaclouds_characters') || {};\r\n    const characters = result.carmaclouds_characters || [];\r\n\r\n    console.log('Found', characters.length, 'synced characters');\r\n\r\n    // Get the most recent character (for now - later we'll add character selection)\r\n    const character = characters.length > 0 ? characters[0] : null;\r\n\r\n    let parsedData = null;\r\n    if (character && character.raw) {\r\n      // Parse raw DiceCloud data for Roll20\r\n      containerEl.innerHTML = '<div class=\"loading\">Parsing character data...</div>';\r\n\r\n      console.log('Parsing character for Roll20:', character.name);\r\n      parsedData = parseForRollCloud(character.raw);\r\n      console.log('Parsed data:', parsedData);\r\n    }\r\n\r\n    // Fetch the RollCloud popup HTML\r\n    const htmlPath = browserAPI.runtime.getURL('src/popup/adapters/rollcloud/popup.html');\r\n    const response = await fetch(htmlPath);\r\n    const html = await response.text();\r\n\r\n    // Extract only the main content (not the full HTML document with header/footer)\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    const mainContent = doc.querySelector('main');\r\n\r\n    // Wrap content in a scoped container to prevent CSS conflicts\r\n    const wrapper = document.createElement('div');\r\n    wrapper.className = 'rollcloud-adapter-scope';\r\n    wrapper.innerHTML = mainContent ? mainContent.innerHTML : doc.body.innerHTML;\r\n    containerEl.innerHTML = '';\r\n    containerEl.appendChild(wrapper);\r\n\r\n    // Load and inject the CSS with scoping\r\n    const cssPath = browserAPI.runtime.getURL('src/popup/adapters/rollcloud/popup.css');\r\n    const cssResponse = await fetch(cssPath);\r\n    let css = await cssResponse.text();\r\n\r\n    // Scope all CSS rules to the adapter container\r\n    css = css.replace(/(^|\\})\\s*([^{}@]+)\\s*\\{/gm, (match, closer, selector) => {\r\n      // Don't scope @media, @keyframes, etc.\r\n      if (selector.trim().startsWith('@')) return match;\r\n      // Scope the selector\r\n      const scopedSelector = selector.split(',').map(s => `.rollcloud-adapter-scope ${s.trim()}`).join(', ');\r\n      return `${closer} ${scopedSelector} {`;\r\n    });\r\n\r\n    const style = document.createElement('style');\r\n    style.textContent = css;\r\n    containerEl.appendChild(style);\r\n\r\n    // Populate character info directly if we have data\r\n    if (parsedData && character) {\r\n      // Show character info card\r\n      const characterInfo = wrapper.querySelector('#characterInfo');\r\n      const statusSection = wrapper.querySelector('#status');\r\n\r\n      if (characterInfo) {\r\n        characterInfo.classList.remove('hidden');\r\n\r\n        // Populate character fields\r\n        const nameEl = characterInfo.querySelector('#charName');\r\n        const levelEl = characterInfo.querySelector('#charLevel');\r\n        const classEl = characterInfo.querySelector('#charClass');\r\n        const raceEl = characterInfo.querySelector('#charRace');\r\n\r\n        if (nameEl) nameEl.textContent = character.name || '-';\r\n        if (levelEl) levelEl.textContent = character.preview?.level || '-';\r\n        if (classEl) classEl.textContent = character.preview?.class || '-';\r\n        if (raceEl) raceEl.textContent = character.preview?.race || 'Unknown';\r\n\r\n        // Add push to VTT button handler\r\n        const pushBtn = characterInfo.querySelector('#pushToVttBtn');\r\n        if (pushBtn) {\r\n          pushBtn.addEventListener('click', async () => {\r\n            const originalText = pushBtn.innerHTML;\r\n            try {\r\n              pushBtn.disabled = true;\r\n              pushBtn.innerHTML = '\u23F3 Pushing...';\r\n\r\n              // Store Roll20-specific parsed data in database\r\n              console.log('\uD83D\uDCBE Storing Roll20 parsed data to database...');\r\n              const SUPABASE_URL = 'https://luiesmfjdcmpywavvfqm.supabase.co';\r\n              const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1aWVzbWZqZGNtcHl3YXZ2ZnFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4ODYxNDksImV4cCI6MjA4NTQ2MjE0OX0.oqjHFf2HhCLcanh0HVryoQH7iSV7E9dHHZJdYehxZ0U';\r\n\r\n              try {\r\n                const updateResponse = await fetch(\r\n                  `${SUPABASE_URL}/rest/v1/clouds_characters?dicecloud_character_id=eq.${character.id}`,\r\n                  {\r\n                    method: 'PATCH',\r\n                    headers: {\r\n                      'apikey': SUPABASE_ANON_KEY,\r\n                      'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n                      'Content-Type': 'application/json',\r\n                      'Prefer': 'return=representation'\r\n                    },\r\n                    body: JSON.stringify({\r\n                      roll20_data: parsedData,\r\n                      updated_at: new Date().toISOString()\r\n                    })\r\n                  }\r\n                );\r\n                if (updateResponse.ok) {\r\n                  console.log('\u2705 Roll20 data stored in database');\r\n                } else {\r\n                  console.warn('\u26A0\uFE0F Failed to store Roll20 data:', await updateResponse.text());\r\n                }\r\n              } catch (dbError) {\r\n                console.warn('\u26A0\uFE0F Database update failed (non-fatal):', dbError);\r\n              }\r\n\r\n              // Also update local storage with parsed data so popup can use it\r\n              console.log('\uD83D\uDCBE Updating local storage with parsed data...');\r\n              try {\r\n                // Add the character ID to parsed data so storage can find it\r\n                const dataToStore = {\r\n                  ...parsedData,\r\n                  id: character.id,\r\n                  dicecloud_character_id: character.id\r\n                };\r\n\r\n                await browserAPI.runtime.sendMessage({\r\n                  action: 'storeCharacterData',\r\n                  data: dataToStore,\r\n                  slotId: character.slotId || 'slot-1'\r\n                });\r\n                console.log('\u2705 Local storage updated with parsed Roll20 data');\r\n\r\n                // Notify any open popup to refresh and show the updated character\r\n                browserAPI.runtime.sendMessage({\r\n                  action: 'dataSynced',\r\n                  characterName: dataToStore.name || 'Character'\r\n                }).catch(() => {\r\n                  console.log('\u2139\uFE0F No popup open to notify (normal)');\r\n                });\r\n              } catch (storageError) {\r\n                console.warn('\u26A0\uFE0F Local storage update failed (non-fatal):', storageError);\r\n              }\r\n\r\n              // Get the active Roll20 tab\r\n              const tabs = await browserAPI.tabs.query({ url: '*://app.roll20.net/*' });\r\n              if (tabs.length === 0) {\r\n                throw new Error('No Roll20 tab found. Please open Roll20 first.');\r\n              }\r\n\r\n              // Send character data to Roll20 content script\r\n              await browserAPI.tabs.sendMessage(tabs[0].id, {\r\n                type: 'PUSH_CHARACTER',\r\n                data: parsedData\r\n              });\r\n\r\n              pushBtn.innerHTML = '\u2705 Pushed!';\r\n              setTimeout(() => {\r\n                pushBtn.innerHTML = originalText;\r\n                pushBtn.disabled = false;\r\n              }, 2000);\r\n            } catch (error) {\r\n              console.error('Error pushing to Roll20:', error);\r\n              pushBtn.innerHTML = '\u274C Failed';\r\n              alert(`Failed to push to Roll20: ${error.message}`);\r\n              setTimeout(() => {\r\n                pushBtn.innerHTML = originalText;\r\n                pushBtn.disabled = false;\r\n              }, 2000);\r\n            }\r\n          });\r\n        }\r\n      }\r\n\r\n      // Update status to show success\r\n      if (statusSection) {\r\n        const statusIcon = statusSection.querySelector('#statusIcon');\r\n        const statusText = statusSection.querySelector('#statusText');\r\n        if (statusIcon) statusIcon.textContent = '\u2705';\r\n        if (statusText) statusText.textContent = `Character synced: ${character.name}`;\r\n      }\r\n    }\r\n\r\n    // Listen for data sync notifications to refresh the UI\r\n    browserAPI.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n      if (message.action === 'dataSynced') {\r\n        console.log('\uD83D\uDCE5 RollCloud adapter received data sync notification:', message.characterName);\r\n        // Reload the entire adapter to show updated character data\r\n        init(containerEl);\r\n      }\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Failed to load RollCloud UI:', error);\r\n    containerEl.innerHTML = `\r\n      <div class=\"error\">\r\n        <strong>Failed to load RollCloud</strong>\r\n        <p>${error.message}</p>\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n", "/**\r\n * CarmaClouds Unified Popup\r\n * Tab-based interface with lazy loading for VTT adapters\r\n */\r\n\r\n// Detect browser API (Firefox uses 'browser', Chrome uses 'chrome')\r\nconst browserAPI = (typeof browser !== 'undefined' && browser.runtime) ? browser : chrome;\r\n\r\n// Track loaded adapters\r\nconst loadedAdapters = {\r\n  rollcloud: null,\r\n  owlcloud: null,\r\n  foundcloud: null\r\n};\r\n\r\n// Get saved settings\r\nasync function getSettings() {\r\n  const result = await browserAPI.storage.local.get('carmaclouds_settings') || {};\r\n  return result.carmaclouds_settings || {\r\n    lastActiveTab: 'rollcloud',\r\n    enabledVTTs: ['rollcloud', 'owlcloud', 'foundcloud']\r\n  };\r\n}\r\n\r\n// Save settings\r\nasync function saveSettings(settings) {\r\n  await browserAPI.storage.local.set({ carmaclouds_settings: settings });\r\n}\r\n\r\n// Show login required message\r\nfunction showLoginRequired(contentEl, tabName) {\r\n  const tabNames = {\r\n    rollcloud: 'RollCloud',\r\n    owlcloud: 'OwlCloud',\r\n    foundcloud: 'FoundCloud'\r\n  };\r\n\r\n  contentEl.innerHTML = `\r\n    <div style=\"display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; text-align: center;\">\r\n      <svg width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"#16a75a\" stroke-width=\"2\" style=\"margin-bottom: 20px;\">\r\n        <rect x=\"3\" y=\"11\" width=\"18\" height=\"11\" rx=\"2\" ry=\"2\"></rect>\r\n        <path d=\"M7 11V7a5 5 0 0 1 10 0v4\"></path>\r\n      </svg>\r\n      <h2 style=\"color: #e0e0e0; margin: 0 0 10px 0; font-size: 20px;\">DiceCloud Login Required</h2>\r\n      <p style=\"color: #b0b0b0; margin: 0 0 20px 0; font-size: 14px; line-height: 1.5;\">\r\n        ${tabNames[tabName]} needs access to your DiceCloud account to sync characters.<br>\r\n        Click the <strong style=\"color: #16a75a;\">Login</strong> button in the header to get started.\r\n      </p>\r\n      <button\r\n        id=\"open-auth-from-tab\"\r\n        style=\"background: #16a75a; color: #000; font-weight: 700; border: none; padding: 12px 24px; border-radius: 6px; font-size: 14px; cursor: pointer; transition: background 0.2s ease;\"\r\n      >\r\n        \uD83D\uDD10 Open Login Modal\r\n      </button>\r\n    </div>\r\n  `;\r\n\r\n  // Add event listeners to the button\r\n  const btn = contentEl.querySelector('#open-auth-from-tab');\r\n  if (btn) {\r\n    btn.addEventListener('click', openAuthModal);\r\n    btn.addEventListener('mouseover', () => {\r\n      btn.style.background = '#1bc76b';\r\n    });\r\n    btn.addEventListener('mouseout', () => {\r\n      btn.style.background = '#16a75a';\r\n    });\r\n  }\r\n}\r\n\r\n// Switch to a tab\r\nasync function switchTab(tabName) {\r\n  console.log(`Switching to ${tabName} tab`);\r\n\r\n  // Update tab buttons\r\n  document.querySelectorAll('.tab-button').forEach(btn => {\r\n    btn.classList.toggle('active', btn.dataset.tab === tabName);\r\n  });\r\n\r\n  // Update tab panes\r\n  document.querySelectorAll('.tab-pane').forEach(pane => {\r\n    pane.classList.toggle('active', pane.id === `${tabName}-content`);\r\n  });\r\n\r\n  const contentEl = document.getElementById(`${tabName}-content`);\r\n\r\n  // Check if user is authenticated\r\n  const token = await getAuthToken();\r\n  if (!token) {\r\n    // Show login required message\r\n    showLoginRequired(contentEl, tabName);\r\n    // Clear the loaded adapter so it can be reloaded after login\r\n    loadedAdapters[tabName] = null;\r\n  } else {\r\n    // Lazy load adapter if not already loaded\r\n    if (!loadedAdapters[tabName]) {\r\n      console.log(`Loading ${tabName} adapter for the first time...`);\r\n      try {\r\n        const module = await import(`./adapters/${tabName}/adapter.js`);\r\n        loadedAdapters[tabName] = module;\r\n\r\n        // Initialize the adapter\r\n        if (module.init && typeof module.init === 'function') {\r\n          await module.init(contentEl);\r\n        }\r\n      } catch (error) {\r\n        console.error(`Failed to load ${tabName} adapter:`, error);\r\n        contentEl.innerHTML = `\r\n          <div class=\"error\">\r\n            <strong>Failed to load ${tabName}</strong>\r\n            <p>${error.message}</p>\r\n          </div>\r\n        `;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Save last active tab\r\n  const settings = await getSettings();\r\n  settings.lastActiveTab = tabName;\r\n  await saveSettings(settings);\r\n}\r\n\r\n// Settings modal functions\r\nfunction openSettingsModal() {\r\n  const modal = document.getElementById('settings-modal');\r\n  modal.classList.add('active');\r\n}\r\n\r\nfunction closeSettingsModal() {\r\n  const modal = document.getElementById('settings-modal');\r\n  modal.classList.remove('active');\r\n}\r\n\r\n// DiceCloud Auth modal functions\r\nfunction openAuthModal() {\r\n  const modal = document.getElementById('dicecloud-auth-modal');\r\n  modal.classList.add('active');\r\n  updateAuthView();\r\n}\r\n\r\nfunction closeAuthModal() {\r\n  const modal = document.getElementById('dicecloud-auth-modal');\r\n  modal.classList.remove('active');\r\n}\r\n\r\n// Get auth token from storage\r\nasync function getAuthToken() {\r\n  const result = await browserAPI.storage.local.get('dicecloud_auth_token');\r\n  return result?.dicecloud_auth_token || null;\r\n}\r\n\r\n// Save auth token to storage\r\nasync function saveAuthToken(token, userId = null, username = null) {\r\n  console.log('\uD83D\uDCBE Saving auth token with userId:', userId || 'not provided', 'username:', username || 'not provided');\r\n\r\n  // Store token, user ID, and username\r\n  const storageData = { dicecloud_auth_token: token };\r\n  if (userId) {\r\n    storageData.diceCloudUserId = userId;\r\n  }\r\n  if (username) {\r\n    storageData.username = username;\r\n  }\r\n\r\n  await browserAPI.storage.local.set(storageData);\r\n  await updateAuthStatus();\r\n  await updateAuthView();\r\n\r\n  // Also sync to database if SupabaseTokenManager is available\r\n  try {\r\n    if (typeof SupabaseTokenManager !== 'undefined') {\r\n      const supabaseManager = new SupabaseTokenManager();\r\n\r\n      // Get user info for the token\r\n      const result = await browserAPI.storage.local.get(['username', 'diceCloudUserId']);\r\n\r\n      console.log('\uD83D\uDCE4 Syncing to database with data:', {\r\n        hasToken: !!token,\r\n        userId: userId || result.diceCloudUserId || 'none',\r\n        username: username || result.username || 'none'\r\n      });\r\n\r\n      // Store token in database\r\n      const dbResult = await supabaseManager.storeToken({\r\n        token: token,\r\n        userId: userId || result.diceCloudUserId,\r\n        tokenExpires: new Date(Date.now() + (24 * 60 * 60 * 1000)).toISOString(), // 24 hours from now\r\n        username: username || result.username || 'DiceCloud User'\r\n      });\r\n\r\n      if (dbResult.success) {\r\n        console.log('\u2705 Auth token synced to database');\r\n      } else {\r\n        console.log('\u26A0\uFE0F Failed to sync auth token to database:', dbResult.error);\r\n      }\r\n    }\r\n  } catch (dbError) {\r\n    console.log('\u26A0\uFE0F Database sync not available:', dbError);\r\n    // Don't show error to user as this is non-critical\r\n  }\r\n\r\n  // Reload current tab to show adapter content\r\n  await reloadCurrentTab();\r\n}\r\n\r\n// Clear auth token\r\nasync function clearAuthToken() {\r\n  await browserAPI.storage.local.remove('dicecloud_auth_token');\r\n  updateAuthStatus();\r\n  updateAuthView();\r\n  // Reload current tab to show login message\r\n  await reloadCurrentTab();\r\n}\r\n\r\n// Reload the currently active tab\r\nasync function reloadCurrentTab() {\r\n  const activeTab = document.querySelector('.tab-button.active');\r\n  if (activeTab) {\r\n    const tabName = activeTab.dataset.tab;\r\n    // Clear the loaded adapter\r\n    loadedAdapters[tabName] = null;\r\n    // Reload the tab\r\n    await switchTab(tabName);\r\n  }\r\n}\r\n\r\n// Update auth status in header button\r\nasync function updateAuthStatus() {\r\n  const token = await getAuthToken();\r\n  const statusText = document.getElementById('auth-status-text');\r\n\r\n  if (token) {\r\n    statusText.textContent = 'Logged In';\r\n    statusText.style.color = '#000000'; // Black text on green background\r\n  } else {\r\n    statusText.textContent = 'Login';\r\n    statusText.style.color = 'white';\r\n  }\r\n}\r\n\r\n// Update auth view in modal\r\nasync function updateAuthView() {\r\n  const token = await getAuthToken();\r\n  const loginView = document.getElementById('auth-login-view');\r\n  const loggedInView = document.getElementById('auth-logged-in-view');\r\n\r\n  if (token) {\r\n    loginView.classList.add('hidden');\r\n    loggedInView.classList.remove('hidden');\r\n  } else {\r\n    loginView.classList.remove('hidden');\r\n    loggedInView.classList.add('hidden');\r\n  }\r\n}\r\n\r\n// Auto-connect to DiceCloud\r\nasync function autoConnect() {\r\n  const btn = document.getElementById('autoConnectBtn');\r\n  const errorDiv = document.getElementById('loginError');\r\n\r\n  try {\r\n    btn.disabled = true;\r\n    btn.textContent = '\u23F3 Checking...';\r\n    errorDiv.classList.add('hidden');\r\n\r\n    // Check if user has a DiceCloud tab open\r\n    const tabs = await browserAPI.tabs.query({ url: '*://*.dicecloud.com/*' });\r\n\r\n    if (!tabs || tabs.length === 0) {\r\n      // No DiceCloud tab found\r\n      errorDiv.innerHTML = '<div style=\"background: #0d4a30; color: #16a75a; padding: 12px; border-radius: 6px; border: 1px solid #16a75a;\"><strong>Navigate to DiceCloud First</strong><br>Open <a href=\"https://dicecloud.com\" target=\"_blank\" style=\"color: #1bc76b; text-decoration: underline;\">dicecloud.com</a> in a tab, log in, then click this button to connect.</div>';\r\n      errorDiv.classList.remove('hidden');\r\n      btn.disabled = false;\r\n      btn.textContent = '\uD83D\uDD10 Connect with DiceCloud';\r\n      return;\r\n    }\r\n\r\n    // Try to inject a content script to get auth data from the page\r\n    try {\r\n      // Use different APIs for Chrome vs Firefox\r\n      let results;\r\n      \r\n      if (typeof chrome !== 'undefined' && browserAPI.scripting) {\r\n        // Chrome (Manifest V3) - use browserAPI.scripting\r\n        results = await browserAPI.scripting.executeScript({\r\n          target: { tabId: tabs[0].id },\r\n          func: () => {\r\n            // Try to get auth data from localStorage, sessionStorage, or window object\r\n            const authData = {\r\n              localStorage: {},\r\n              sessionStorage: {},\r\n              meteor: null,\r\n              authToken: null\r\n            };\r\n            \r\n            // Check localStorage\r\n            for (let i = 0; i < localStorage.length; i++) {\r\n              const key = localStorage.key(i);\r\n              if (key && (key.includes('auth') || key.includes('token') || key.includes('meteor') || key.includes('login'))) {\r\n                authData.localStorage[key] = localStorage.getItem(key);\r\n              }\r\n            }\r\n            \r\n            // Check sessionStorage\r\n            for (let i = 0; i < sessionStorage.length; i++) {\r\n              const key = sessionStorage.key(i);\r\n              if (key && (key.includes('auth') || key.includes('token') || key.includes('meteor') || key.includes('login'))) {\r\n                authData.sessionStorage[key] = sessionStorage.getItem(key);\r\n              }\r\n            }\r\n            \r\n            // Check for Meteor/MongoDB auth (common in DiceCloud)\r\n            // Meteor stores auth data in localStorage with specific keys\r\n            const meteorUserId = localStorage.getItem('Meteor.userId');\r\n            const meteorLoginToken = localStorage.getItem('Meteor.loginToken');\r\n\r\n            if (meteorUserId || meteorLoginToken) {\r\n              authData.meteor = {\r\n                userId: meteorUserId,\r\n                loginToken: meteorLoginToken\r\n              };\r\n\r\n              // TODO: Fix username extraction - currently still returns 'DiceCloud User' as fallback\r\n              // Need to investigate why Meteor.user() doesn't return username properly\r\n              // May need to check localStorage for serialized user data or use different approach\r\n              // Try to get username from Meteor.user() if available\r\n              if (window.Meteor && window.Meteor.user) {\r\n                try {\r\n                  const user = window.Meteor.user();\r\n                  if (user) {\r\n                    authData.meteor.username = user.username ||\r\n                                               user.emails?.[0]?.address ||\r\n                                               user.profile?.username ||\r\n                                               user.profile?.name ||\r\n                                               null;\r\n                  }\r\n                } catch (e) {\r\n                  // Meteor.user() might not be available, that's okay\r\n                }\r\n              }\r\n            }\r\n            \r\n            // Check for any global auth variables\r\n            if (window.authToken) authData.authToken = window.authToken;\r\n            if (window.token) authData.authToken = window.token;\r\n            \r\n            return authData;\r\n          }\r\n        });\r\n      } else if (typeof browser !== 'undefined' && browser.tabs) {\r\n        // Firefox (Manifest V2) - use browser.tabs.executeScript\r\n        // Wrap in IIFE to prevent \"redeclaration of const\" errors on repeated clicks\r\n        results = await browser.tabs.executeScript(tabs[0].id, {\r\n          code: `\r\n            (() => {\r\n              // Try to get auth data from localStorage, sessionStorage, or window object\r\n              const authData = {\r\n                localStorage: {},\r\n                sessionStorage: {},\r\n                meteor: null,\r\n                authToken: null\r\n              };\r\n\r\n              // Check localStorage\r\n              for (let i = 0; i < localStorage.length; i++) {\r\n                const key = localStorage.key(i);\r\n                if (key && (key.includes('auth') || key.includes('token') || key.includes('meteor') || key.includes('login'))) {\r\n                  authData.localStorage[key] = localStorage.getItem(key);\r\n                }\r\n              }\r\n\r\n              // Check sessionStorage\r\n              for (let i = 0; i < sessionStorage.length; i++) {\r\n                const key = sessionStorage.key(i);\r\n                if (key && (key.includes('auth') || key.includes('token') || key.includes('meteor') || key.includes('login'))) {\r\n                  authData.sessionStorage[key] = sessionStorage.getItem(key);\r\n                }\r\n              }\r\n\r\n              // Check for Meteor/MongoDB auth (common in DiceCloud)\r\n              // Meteor stores auth data in localStorage with specific keys\r\n              const meteorUserId = localStorage.getItem('Meteor.userId');\r\n              const meteorLoginToken = localStorage.getItem('Meteor.loginToken');\r\n\r\n              if (meteorUserId || meteorLoginToken) {\r\n                authData.meteor = {\r\n                  userId: meteorUserId,\r\n                  loginToken: meteorLoginToken\r\n                };\r\n\r\n                // TODO: Fix username extraction - currently still returns 'DiceCloud User' as fallback\r\n                // Need to investigate why Meteor.user() doesn't return username properly\r\n                // May need to check localStorage for serialized user data or use different approach\r\n                // Try to get username from Meteor.user() if available\r\n                if (window.Meteor && window.Meteor.user) {\r\n                  try {\r\n                    const user = window.Meteor.user();\r\n                    if (user) {\r\n                      authData.meteor.username = user.username ||\r\n                                                 user.emails?.[0]?.address ||\r\n                                                 user.profile?.username ||\r\n                                                 user.profile?.name ||\r\n                                                 null;\r\n                    }\r\n                  } catch (e) {\r\n                    // Meteor.user() might not be available, that's okay\r\n                  }\r\n                }\r\n              }\r\n\r\n              // Check for any global auth variables\r\n              if (window.authToken) authData.authToken = window.authToken;\r\n              if (window.token) authData.authToken = window.token;\r\n\r\n              return authData;\r\n            })();\r\n          `\r\n        });\r\n      } else {\r\n        throw new Error('No scripting API available');\r\n      }\r\n\r\n      // Firefox returns results directly in array, Chrome wraps in .result property\r\n      const authData = (typeof chrome !== 'undefined' && browserAPI.scripting)\r\n        ? results[0]?.result\r\n        : results[0];\r\n      console.log('Auth data from DiceCloud page:', authData);\r\n\r\n      // Try to extract a token and user info from the collected data\r\n      let token = null;\r\n      let userId = null;\r\n      let username = null;\r\n\r\n      if (authData?.meteor?.loginToken) {\r\n        token = authData.meteor.loginToken;\r\n        userId = authData.meteor.userId;\r\n        username = authData.meteor.username;\r\n      } else if (authData?.authToken) {\r\n        token = authData.authToken;\r\n      } else {\r\n        // Check localStorage for tokens\r\n        for (const [key, value] of Object.entries(authData?.localStorage || {})) {\r\n          if (value && value.length > 10) { // Assume tokens are longer than 10 chars\r\n            token = value;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n\r\n      console.log('\uD83D\uDD11 Extracted from DiceCloud:', {\r\n        hasToken: !!token,\r\n        userId: userId || 'not found',\r\n        username: username || 'not found'\r\n      });\r\n\r\n      if (token) {\r\n        await saveAuthToken(token, userId, username);\r\n        errorDiv.classList.add('hidden');\r\n        closeAuthModal();\r\n        return;\r\n      }\r\n      \r\n    } catch (scriptError) {\r\n      console.warn('Could not inject script:', scriptError);\r\n    }\r\n\r\n    // Fallback to cookie method if script injection fails\r\n    const cookies = await browserAPI.cookies.getAll({ domain: '.dicecloud.com' });\r\n    console.log('Available DiceCloud cookies:', cookies.map(c => ({ name: c.name, domain: c.domain, value: c.value ? '***' : 'empty' })));\r\n    \r\n    const authCookie = cookies.find(c =>\r\n      c.name === 'dicecloud_auth' ||\r\n      c.name === 'meteor_login_token' ||\r\n      c.name === 'authToken' ||\r\n      c.name === 'loginToken' ||\r\n      c.name === 'userId' ||\r\n      c.name === 'token' ||\r\n      c.name === 'x_mtok' ||  // Meteor token cookie used by DiceCloud\r\n      c.name.includes('auth') ||\r\n      c.name.includes('token')\r\n    );\r\n\r\n    if (authCookie && authCookie.value) {\r\n      await saveAuthToken(authCookie.value);\r\n      errorDiv.classList.add('hidden');\r\n      closeAuthModal();\r\n    } else {\r\n      const cookieNames = cookies.map(c => c.name).join(', ');\r\n      const cookieCount = cookies.length;\r\n      errorDiv.innerHTML = `<div style=\"color: #ff6b6b;\">No login detected. Found ${cookieCount} cookies: ${cookieNames || 'none'}. Make sure you're logged in to DiceCloud in your open tab, then click the button again.</div>`;\r\n      errorDiv.classList.remove('hidden');\r\n      btn.disabled = false;\r\n      btn.textContent = '\uD83D\uDD10 Connect with DiceCloud';\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Auto-connect error:', error);\r\n    errorDiv.innerHTML = `<div style=\"color: #ff6b6b;\">Error: ${error.message}</div>`;\r\n    errorDiv.classList.remove('hidden');\r\n    btn.disabled = false;\r\n    btn.textContent = '\uD83D\uDD10 Connect with DiceCloud';\r\n  }\r\n}\r\n\r\n// Manual login to DiceCloud\r\nasync function manualLogin(username, password) {\r\n  const btn = document.getElementById('usernameLoginBtn');\r\n  const errorDiv = document.getElementById('loginError');\r\n\r\n  try {\r\n    btn.disabled = true;\r\n    btn.textContent = '\u23F3 Logging in...';\r\n    errorDiv.classList.add('hidden');\r\n\r\n    // Try multiple possible DiceCloud API endpoints\r\n    const endpoints = [\r\n      'https://dicecloud.com/api/login',\r\n      'https://v2.dicecloud.com/api/login',\r\n      'https://app.dicecloud.com/api/login',\r\n      'https://dicecloud.com/login',\r\n      'https://v2.dicecloud.com/login'\r\n    ];\r\n\r\n    let lastError = null;\r\n    let success = false;\r\n\r\n    for (const endpoint of endpoints) {\r\n      try {\r\n        console.log(`Trying login endpoint: ${endpoint}`);\r\n        \r\n        const response = await fetch(endpoint, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ username, password }),\r\n          mode: 'cors',\r\n          credentials: 'omit'\r\n        });\r\n\r\n        console.log(`Response status: ${response.status}`);\r\n\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          console.log(`Success with ${endpoint}:`, data);\r\n          \r\n          if (data.token || data.authToken || data.loginToken) {\r\n            const token = data.token || data.authToken || data.loginToken;\r\n            await saveAuthToken(token);\r\n            errorDiv.classList.add('hidden');\r\n            closeAuthModal();\r\n            success = true;\r\n            break;\r\n          }\r\n        } else {\r\n          console.warn(`Failed with ${endpoint}: ${response.status} ${response.statusText}`);\r\n        }\r\n      } catch (endpointError) {\r\n        console.warn(`Failed with ${endpoint}:`, endpointError.message);\r\n        lastError = endpointError;\r\n      }\r\n    }\r\n\r\n    if (!success) {\r\n      throw new Error(`Login failed. Tried ${endpoints.length} endpoints. Last error: ${lastError?.message || 'Unknown error'}`);\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Manual login error:', error);\r\n    errorDiv.innerHTML = `<div style=\"color: #ff6b6b;\">${error.message}</div>`;\r\n    errorDiv.classList.remove('hidden');\r\n  } finally {\r\n    btn.disabled = false;\r\n    btn.textContent = '\uD83D\uDD10 Login to DiceCloud';\r\n  }\r\n}\r\n\r\n// Logout\r\nasync function logout() {\r\n  await clearAuthToken();\r\n  closeAuthModal();\r\n}\r\n\r\n/**\r\n * Check and update auth token if available\r\n * This function validates the current auth token and updates the auth_tokens table if necessary\r\n */\r\nasync function checkAndUpdateAuthToken() {\r\n  try {\r\n    // Check if SupabaseTokenManager is available\r\n    if (typeof SupabaseTokenManager === 'undefined') {\r\n      console.log('\u26A0\uFE0F SupabaseTokenManager not available, skipping auth token check');\r\n      return;\r\n    }\r\n\r\n    const supabaseManager = new SupabaseTokenManager();\r\n\r\n    // Get current token from storage (check both old and new key names)\r\n    const result = await browserAPI.storage.local.get(['diceCloudToken', 'dicecloud_auth_token', 'username', 'tokenExpires', 'diceCloudUserId', 'authId']);\r\n\r\n    console.log('\uD83D\uDD0D Storage contents:', {\r\n      diceCloudToken: result.diceCloudToken ? '***found***' : 'NOT FOUND',\r\n      dicecloud_auth_token: result.dicecloud_auth_token ? '***found***' : 'NOT FOUND',\r\n      username: result.username,\r\n      diceCloudUserId: result.diceCloudUserId\r\n    });\r\n\r\n    const token = result.diceCloudToken || result.dicecloud_auth_token;\r\n\r\n    if (!token) {\r\n      console.log('\u26A0\uFE0F No auth token found, skipping auth token check');\r\n      return;\r\n    }\r\n\r\n    console.log('\uD83D\uDD0D Checking auth token validity...');\r\n    console.log('\uD83D\uDD11 Using token:', token ? '***found***' : 'NOT FOUND');\r\n\r\n    // Always try to sync the current token to database to ensure it's up to date\r\n    try {\r\n      const syncResult = await supabaseManager.storeToken({\r\n        token: token,\r\n        userId: result.diceCloudUserId || result.username,\r\n        tokenExpires: result.tokenExpires || new Date(Date.now() + (24 * 60 * 60 * 1000)).toISOString(),\r\n        username: result.username || 'DiceCloud User'\r\n      });\r\n      \r\n      if (syncResult.success) {\r\n        console.log('\u2705 Auth token synced to database');\r\n      } else {\r\n        console.log('\u26A0\uFE0F Failed to sync auth token to database:', syncResult.error);\r\n      }\r\n    } catch (syncError) {\r\n      console.log('\u26A0\uFE0F Database sync failed:', syncError);\r\n    }\r\n    \r\n    // Check session validity\r\n    const sessionCheck = await supabaseManager.checkSessionValidity();\r\n    \r\n    if (!sessionCheck.valid) {\r\n      console.log('\u26A0\uFE0F Auth token session is invalid, attempting to refresh...');\r\n      \r\n      // Try to refresh the token\r\n      const refreshResult = await supabaseManager.refreshToken();\r\n      \r\n      if (refreshResult.success) {\r\n        console.log('\u2705 Auth token refreshed successfully');\r\n        \r\n        // Update local storage with new token\r\n        await browserAPI.storage.local.set({\r\n          diceCloudToken: refreshResult.token,\r\n          tokenExpires: refreshResult.expires,\r\n          diceCloudUserId: refreshResult.userId\r\n        });\r\n        \r\n        // Sync the refreshed token to database\r\n        try {\r\n          await supabaseManager.storeToken({\r\n            token: refreshResult.token,\r\n            userId: refreshResult.userId,\r\n            expires: refreshResult.expires,\r\n            lastChecked: new Date().toISOString()\r\n          });\r\n          console.log('\u2705 Refreshed token synced to database');\r\n        } catch (refreshSyncError) {\r\n          console.log('\u26A0\uFE0F Failed to sync refreshed token:', refreshSyncError);\r\n        }\r\n        \r\n        // Update auth status display\r\n        await updateAuthStatus();\r\n        \r\n        showNotification('\u2705 Authentication refreshed', 'success');\r\n      } else {\r\n        console.log('\u274C Failed to refresh auth token');\r\n        showNotification('\u274C Authentication expired. Please log in again.', 'error');\r\n      }\r\n    } else {\r\n      console.log('\u2705 Auth token is valid and synced');\r\n    }\r\n  } catch (error) {\r\n    console.error('\u274C Error checking auth token:', error);\r\n    // Don't show error to user as this is non-critical functionality\r\n  }\r\n}\r\n\r\n// Update Supabase auth UI based on user state\r\nfunction updateSupabaseAuthUI(user) {\r\n  console.log('\uD83D\uDD04 Updating Supabase auth UI, user:', user);\r\n  const loginView = document.getElementById('supabase-login-view');\r\n  const loggedInView = document.getElementById('supabase-logged-in-view');\r\n  const emailDisplay = document.getElementById('supabase-user-email');\r\n\r\n  if (user) {\r\n    // User is signed in\r\n    console.log('\u2705 User signed in, showing logged in view');\r\n    loginView.classList.add('hidden');\r\n    loggedInView.classList.remove('hidden');\r\n    if (emailDisplay) {\r\n      emailDisplay.textContent = user.email;\r\n    }\r\n  } else {\r\n    // User is not signed in\r\n    console.log('\u274C No user, showing login view');\r\n    loginView.classList.remove('hidden');\r\n    loggedInView.classList.add('hidden');\r\n  }\r\n}\r\n\r\n// Initialize popup\r\nasync function init() {\r\n  console.log('Initializing CarmaClouds popup...');\r\n\r\n  // Get settings\r\n  const settings = await getSettings();\r\n  const lastTab = settings.lastActiveTab || 'rollcloud';\r\n\r\n  // Set up tab click handlers\r\n  document.querySelectorAll('.tab-button').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      switchTab(btn.dataset.tab);\r\n    });\r\n  });\r\n\r\n  // Set up settings button\r\n  document.getElementById('settings-button').addEventListener('click', openSettingsModal);\r\n  document.getElementById('close-settings').addEventListener('click', (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    closeSettingsModal();\r\n  });\r\n\r\n  // Set up refresh button\r\n  document.getElementById('refresh-button').addEventListener('click', async () => {\r\n    // Get current active tab\r\n    const activeTab = document.querySelector('.tab-button.active')?.dataset.tab;\r\n    if (activeTab) {\r\n      // Check and update auth token if available\r\n      await checkAndUpdateAuthToken();\r\n      \r\n      // Clear the loaded adapter\r\n      loadedAdapters[activeTab] = null;\r\n      // Reload the current tab\r\n      await switchTab(activeTab);\r\n    }\r\n  });\r\n\r\n  // Close modal when clicking outside\r\n  document.getElementById('settings-modal').addEventListener('click', (e) => {\r\n    if (e.target.id === 'settings-modal') {\r\n      closeSettingsModal();\r\n    }\r\n  });\r\n\r\n  // Set up auth button and modal\r\n  document.getElementById('dicecloud-auth-button').addEventListener('click', openAuthModal);\r\n  document.getElementById('close-dicecloud-auth').addEventListener('click', (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    closeAuthModal();\r\n  });\r\n\r\n  // Close auth modal when clicking outside\r\n  document.getElementById('dicecloud-auth-modal').addEventListener('click', (e) => {\r\n    if (e.target.id === 'dicecloud-auth-modal') {\r\n      closeAuthModal();\r\n    }\r\n  });\r\n\r\n  // Auto-connect button\r\n  document.getElementById('autoConnectBtn').addEventListener('click', autoConnect);\r\n\r\n  // Manual login form\r\n  document.getElementById('usernameLoginForm').addEventListener('submit', (e) => {\r\n    e.preventDefault();\r\n    const username = document.getElementById('username').value;\r\n    const password = document.getElementById('password').value;\r\n    manualLogin(username, password);\r\n  });\r\n\r\n  // Logout button\r\n  document.getElementById('logoutBtn').addEventListener('click', logout);\r\n\r\n  // Set up auth modal tab switching\r\n  document.querySelectorAll('[data-auth-tab]').forEach(btn => {\r\n    btn.addEventListener('click', () => {\r\n      const tabName = btn.dataset.authTab;\r\n\r\n      // Update tab buttons\r\n      document.querySelectorAll('[data-auth-tab]').forEach(b => {\r\n        b.classList.toggle('active', b.dataset.authTab === tabName);\r\n      });\r\n\r\n      // Update tab panes\r\n      document.querySelectorAll('.auth-tab-pane').forEach(pane => {\r\n        pane.style.display = pane.id === `${tabName}-auth-content` ? 'block' : 'none';\r\n      });\r\n    });\r\n  });\r\n\r\n  // Password toggle functionality\r\n  const passwordToggle = document.getElementById('supabase-password-toggle');\r\n  const passwordField = document.getElementById('supabase-password');\r\n\r\n  if (passwordToggle && passwordField) {\r\n    const eyeIcon = '<svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\"></path><circle cx=\"12\" cy=\"12\" r=\"3\"></circle></svg>';\r\n    const eyeSlashIcon = '<svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24\"></path><line x1=\"1\" y1=\"1\" x2=\"23\" y2=\"23\"></line></svg>';\r\n\r\n    passwordToggle.addEventListener('click', () => {\r\n      if (passwordField.type === 'password') {\r\n        passwordField.type = 'text';\r\n        passwordToggle.innerHTML = eyeSlashIcon;\r\n        passwordToggle.setAttribute('aria-label', 'Hide password');\r\n      } else {\r\n        passwordField.type = 'password';\r\n        passwordToggle.innerHTML = eyeIcon;\r\n        passwordToggle.setAttribute('aria-label', 'Show password');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Supabase auth error formatting\r\n  function formatAuthError(error) {\r\n    const message = error?.message || '';\r\n\r\n    if (message.includes('Invalid login credentials')) {\r\n      return 'Incorrect email or password. Please try again.';\r\n    }\r\n    if (message.includes('Email not confirmed')) {\r\n      return 'Please check your email and click the confirmation link before signing in.';\r\n    }\r\n    if (message.includes('User already registered')) {\r\n      return 'An account with this email already exists. Try signing in instead.';\r\n    }\r\n    if (message.includes('Password should be at least 6 characters')) {\r\n      return 'Password must be at least 6 characters long.';\r\n    }\r\n    if (message.includes('invalid format') || message.includes('Unable to validate email')) {\r\n      return 'Please enter a valid email address.';\r\n    }\r\n    if (message.includes('rate limit') || message.includes('Email rate limit exceeded')) {\r\n      return 'Too many attempts. Please wait a few minutes and try again.';\r\n    }\r\n    if (message.includes('Signup requires email')) {\r\n      return 'Please enter your email address.';\r\n    }\r\n    if (message.includes('network') || message.includes('fetch')) {\r\n      return 'Network error. Please check your connection and try again.';\r\n    }\r\n\r\n    return 'Authentication failed. Please try again.';\r\n  }\r\n\r\n  // Show success message that fades out after 2 seconds\r\n  function showSuccessMessage(message) {\r\n    const successDiv = document.getElementById('supabase-auth-success');\r\n    const errorDiv = document.getElementById('supabase-auth-error');\r\n\r\n    if (!successDiv) return;\r\n\r\n    // Hide error message\r\n    errorDiv.classList.add('hidden');\r\n\r\n    // Show success message\r\n    successDiv.textContent = message;\r\n    successDiv.classList.remove('hidden');\r\n    successDiv.style.opacity = '1';\r\n\r\n    // Fade out after 2 seconds\r\n    setTimeout(() => {\r\n      successDiv.style.opacity = '0';\r\n      setTimeout(() => {\r\n        successDiv.classList.add('hidden');\r\n      }, 300); // Wait for fade animation to complete\r\n    }, 2000);\r\n  }\r\n\r\n  // Supabase auth handlers\r\n  const supabase = window.supabaseClient;\r\n  if (supabase) {\r\n    // Check current Supabase auth state\r\n    const { data: { session } } = await supabase.auth.getSession();\r\n    updateSupabaseAuthUI(session?.user);\r\n\r\n    // Listen for auth state changes\r\n    supabase.auth.onAuthStateChange((event, session) => {\r\n      updateSupabaseAuthUI(session?.user);\r\n    });\r\n\r\n    // Sign in form\r\n    document.getElementById('supabase-auth-form').addEventListener('submit', async (e) => {\r\n      e.preventDefault();\r\n      const email = document.getElementById('supabase-email').value.trim();\r\n      const password = document.getElementById('supabase-password').value;\r\n      const errorDiv = document.getElementById('supabase-auth-error');\r\n      const signInBtn = document.getElementById('supabase-signin-btn');\r\n\r\n      // Disable button and show loading state\r\n      if (signInBtn) {\r\n        signInBtn.disabled = true;\r\n        signInBtn.textContent = 'Signing in...';\r\n      }\r\n\r\n      try {\r\n        console.log('\uD83D\uDD10 Attempting sign in...');\r\n        const { data, error } = await supabase.auth.signInWithPassword({ email, password });\r\n        console.log('\uD83D\uDD10 Sign in response:', { data, error });\r\n        if (error) throw error;\r\n        errorDiv.classList.add('hidden');\r\n        console.log('\u2705 Sign in successful, showing success message');\r\n        showSuccessMessage('\u2705 Signed in successfully!');\r\n      } catch (error) {\r\n        console.error('\u274C Sign in error:', error);\r\n        errorDiv.textContent = formatAuthError(error);\r\n        errorDiv.classList.remove('hidden');\r\n      } finally {\r\n        // Re-enable button\r\n        if (signInBtn) {\r\n          signInBtn.disabled = false;\r\n          signInBtn.textContent = 'Sign In';\r\n        }\r\n      }\r\n    });\r\n\r\n    // Sign up button\r\n    document.getElementById('supabase-signup-btn').addEventListener('click', async () => {\r\n      const email = document.getElementById('supabase-email').value.trim();\r\n      const password = document.getElementById('supabase-password').value;\r\n      const errorDiv = document.getElementById('supabase-auth-error');\r\n      const signUpBtn = document.getElementById('supabase-signup-btn');\r\n\r\n      if (!email || !password) {\r\n        errorDiv.textContent = 'Please enter email and password';\r\n        errorDiv.classList.remove('hidden');\r\n        return;\r\n      }\r\n\r\n      // Validate email format\r\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n      if (!emailRegex.test(email)) {\r\n        errorDiv.textContent = 'Please enter a valid email address';\r\n        errorDiv.classList.remove('hidden');\r\n        return;\r\n      }\r\n\r\n      if (password.length < 6) {\r\n        errorDiv.textContent = 'Password must be at least 6 characters long';\r\n        errorDiv.classList.remove('hidden');\r\n        return;\r\n      }\r\n\r\n      // Disable button and show loading state\r\n      if (signUpBtn) {\r\n        signUpBtn.disabled = true;\r\n        signUpBtn.textContent = 'Creating account...';\r\n      }\r\n\r\n      try {\r\n        const { data, error } = await supabase.auth.signUp({ email, password });\r\n        if (error) throw error;\r\n        errorDiv.classList.add('hidden');\r\n        showSuccessMessage('\u2705 Account created successfully!');\r\n      } catch (error) {\r\n        errorDiv.textContent = formatAuthError(error);\r\n        errorDiv.classList.remove('hidden');\r\n      } finally {\r\n        // Re-enable button\r\n        if (signUpBtn) {\r\n          signUpBtn.disabled = false;\r\n          signUpBtn.textContent = 'Sign Up';\r\n        }\r\n      }\r\n    });\r\n\r\n    // Sign out button\r\n    document.getElementById('supabase-signout-btn').addEventListener('click', async () => {\r\n      try {\r\n        await supabase.auth.signOut();\r\n      } catch (error) {\r\n        console.error('Error signing out:', error);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Check and update auth status\r\n  await updateAuthStatus();\r\n\r\n  // Set up external links\r\n  document.getElementById('open-website').addEventListener('click', (e) => {\r\n    e.preventDefault();\r\n    browserAPI.tabs.create({ url: 'https://carmaclouds.vercel.app' });\r\n  });\r\n\r\n  document.getElementById('open-github').addEventListener('click', (e) => {\r\n    e.preventDefault();\r\n    browserAPI.tabs.create({ url: 'https://github.com/CarmaNayeli/carmaclouds' });\r\n  });\r\n\r\n  document.getElementById('open-issues').addEventListener('click', (e) => {\r\n    e.preventDefault();\r\n    browserAPI.tabs.create({ url: 'https://github.com/CarmaNayeli/carmaclouds/issues' });\r\n  });\r\n\r\n  document.getElementById('open-sponsor').addEventListener('click', (e) => {\r\n    e.preventDefault();\r\n    browserAPI.tabs.create({ url: 'https://github.com/sponsors/CarmaNayeli/' });\r\n  });\r\n\r\n  // Set up sync to CarmaClouds button\r\n  const syncBtn = document.getElementById('syncToCarmaCloudsBtn');\r\n  if (syncBtn) {\r\n    syncBtn.addEventListener('click', handleSyncToCarmaClouds);\r\n  }\r\n\r\n  // Load the last active tab\r\n  await switchTab(lastTab);\r\n}\r\n\r\n// Handle sync to CarmaClouds button click\r\nasync function handleSyncToCarmaClouds() {\r\n  const btn = document.getElementById('syncToCarmaCloudsBtn');\r\n  const statusDiv = document.getElementById('syncStatus');\r\n\r\n  if (!btn || !statusDiv) return;\r\n\r\n  const originalText = btn.innerHTML;\r\n\r\n  try {\r\n    btn.disabled = true;\r\n    btn.innerHTML = '\u23F3 Syncing...';\r\n    statusDiv.textContent = 'Fetching character data from DiceCloud...';\r\n    statusDiv.style.color = '#b0b0b0';\r\n\r\n    // Get character data from background script\r\n    const response = await browserAPI.runtime.sendMessage({ action: 'getCharacterData' });\r\n\r\n    if (!response || !response.success || !response.data) {\r\n      throw new Error('No character data available. Please sync from DiceCloud first.');\r\n    }\r\n\r\n    const characterData = response.data;\r\n    console.log('\uD83D\uDCE6 Character data received:', characterData);\r\n\r\n    // Store in local storage first\r\n    statusDiv.textContent = 'Storing character locally...';\r\n\r\n    const existingData = await browserAPI.storage.local.get('carmaclouds_characters');\r\n    const characters = existingData.carmaclouds_characters || [];\r\n\r\n    // Update or add character (remove old version if exists)\r\n    const existingIndex = characters.findIndex(c => c.id === characterData.id);\r\n    if (existingIndex >= 0) {\r\n      characters[existingIndex] = characterData;\r\n    } else {\r\n      characters.unshift(characterData); // Add to beginning\r\n    }\r\n\r\n    await browserAPI.storage.local.set({ carmaclouds_characters: characters });\r\n    console.log('\u2705 Character stored in local storage');\r\n\r\n    // Store character in Supabase database\r\n    statusDiv.textContent = 'Syncing to database...';\r\n\r\n    if (typeof SupabaseTokenManager !== 'undefined') {\r\n      const supabaseManager = new SupabaseTokenManager();\r\n\r\n      // Get auth info\r\n      const authResult = await browserAPI.storage.local.get(['diceCloudUserId', 'username']);\r\n\r\n      const dbResult = await supabaseManager.storeCharacter({\r\n        ...characterData,\r\n        user_id_dicecloud: authResult.diceCloudUserId,\r\n        username: authResult.username\r\n      });\r\n\r\n      if (dbResult.success) {\r\n        console.log('\u2705 Character synced to database');\r\n        statusDiv.textContent = '\u2705 Character synced successfully!';\r\n        statusDiv.style.color = '#16a75a';\r\n        btn.innerHTML = '\u2705 Synced!';\r\n\r\n        // Reload the current adapter to show updated character\r\n        const activeTab = document.querySelector('.tab-button.active');\r\n        if (activeTab) {\r\n          await switchTab(activeTab.dataset.tab);\r\n        }\r\n      } else {\r\n        throw new Error(dbResult.error || 'Failed to store character');\r\n      }\r\n    } else {\r\n      throw new Error('SupabaseTokenManager not available');\r\n    }\r\n\r\n    setTimeout(() => {\r\n      btn.innerHTML = originalText;\r\n      btn.disabled = false;\r\n    }, 2000);\r\n\r\n  } catch (error) {\r\n    console.error('\u274C Sync error:', error);\r\n    statusDiv.textContent = `\u274C Error: ${error.message}`;\r\n    statusDiv.style.color = '#ff6b6b';\r\n    btn.innerHTML = '\u274C Failed';\r\n\r\n    setTimeout(() => {\r\n      btn.innerHTML = originalText;\r\n      btn.disabled = false;\r\n    }, 3000);\r\n  }\r\n}\r\n\r\n// Start when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', init);\r\n} else {\r\n  init();\r\n}\r\n"],
  "mappings": "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",
  "names": ["adapter_exports", "init", "response", "character", "supabase", "supabaseUserId", "init_adapter", "raceName", "level", "adapter_exports", "init", "browserAPI", "init_adapter", "browserAPI", "authData", "init", "session"]
}
