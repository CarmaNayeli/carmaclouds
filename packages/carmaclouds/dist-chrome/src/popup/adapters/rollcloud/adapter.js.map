{
  "version": 3,
  "sources": ["../../../../../../core/src/common/browser-polyfill.js", "../../../../../src/popup/adapters/rollcloud/rollcloud-popup.js", "../../../../../src/popup/adapters/rollcloud/adapter.js"],
  "sourcesContent": ["/**\r\n * Browser API Compatibility Layer - Chrome & Firefox Support\r\n *\r\n * This provides a consistent browserAPI interface across Chrome and Firefox.\r\n * Firefox uses the 'browser' namespace (Promise-based), while Chrome uses 'chrome' (callback-based).\r\n */\r\n\r\nconsole.log('\uD83C\uDF10 Loading browser polyfill...');\r\n\r\n// Use 'self' for service workers, 'window' for content scripts/popups\r\nconst globalScope = typeof window !== 'undefined' ? window : self;\r\n\r\n// Detect browser and use appropriate API\r\nlet browserAPI;\r\n\r\nif (typeof browser !== 'undefined' && browser.runtime) {\r\n  // Firefox - uses native Promise-based API\r\n  console.log('\uD83E\uDD8A Detected Firefox');\r\n  browserAPI = browser;\r\n} else if (typeof chrome !== 'undefined' && chrome.runtime) {\r\n  // Chrome - wrap callback-based API to be consistent with Firefox\r\n  console.log('\uD83C\uDF10 Detected Chrome');\r\n  // Helper to check if Chrome extension context is valid\r\n  const isChromeContextValid = () => {\r\n    try {\r\n      return chrome && chrome.runtime && chrome.runtime.id;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  browserAPI = {\r\n    runtime: {\r\n      sendMessage: (message, callback) => {\r\n        // If callback is provided, use callback-based API\r\n        if (typeof callback === 'function') {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              console.error('\u274C Extension context invalidated');\r\n              callback(null);\r\n              return;\r\n            }\r\n            chrome.runtime.sendMessage(message, callback);\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            callback(null);\r\n          }\r\n          return;\r\n        }\r\n        // Otherwise return a Promise\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.runtime.sendMessage(message, (response) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(response);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            reject(error);\r\n          }\r\n        });\r\n      },\r\n      onMessage: chrome.runtime.onMessage,\r\n      getURL: (path) => {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.getURL(path);\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      getManifest: () => {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.getManifest();\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      get id() {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.id;\r\n        } catch (error) {\r\n          console.error('\u274C Extension context error:', error.message);\r\n          return null;\r\n        }\r\n      },\r\n      get lastError() {\r\n        try {\r\n          if (!isChromeContextValid()) return null;\r\n          return chrome.runtime.lastError;\r\n        } catch (error) {\r\n          return null;\r\n        }\r\n      },\r\n      connectNative: (application) => {\r\n        try {\r\n          if (!isChromeContextValid()) {\r\n            console.error('\u274C Extension context invalidated');\r\n            return null;\r\n          }\r\n          const port = chrome.runtime.connectNative(application);\r\n          // Check for immediate errors\r\n          if (chrome.runtime.lastError) {\r\n            console.warn('\u26A0\uFE0F Native messaging error:', chrome.runtime.lastError.message);\r\n            return null;\r\n          }\r\n          return port;\r\n        } catch (error) {\r\n          console.error('\u274C Native messaging error:', error.message);\r\n          return null;\r\n        }\r\n      }\r\n    },\r\n    storage: {\r\n      local: {\r\n        get: (keys) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.get(keys, (result) => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve(result);\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        set: (items) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.set(items, () => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        remove: (keys) => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.remove(keys, () => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        },\r\n        clear: () => {\r\n          return new Promise((resolve, reject) => {\r\n            try {\r\n              if (!isChromeContextValid()) {\r\n                reject(new Error('Extension context invalidated'));\r\n                return;\r\n              }\r\n              chrome.storage.local.clear(() => {\r\n                if (chrome.runtime.lastError) {\r\n                  reject(new Error(chrome.runtime.lastError.message));\r\n                } else {\r\n                  resolve();\r\n                }\r\n              });\r\n            } catch (error) {\r\n              reject(new Error('Extension context invalidated'));\r\n            }\r\n          });\r\n        }\r\n      }\r\n    },\r\n    tabs: {\r\n      query: (queryInfo) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.query(queryInfo, (tabs) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tabs);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      },\r\n      sendMessage: (tabId, message, callback) => {\r\n        // If callback is provided, use callback-based API\r\n        if (typeof callback === 'function') {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              console.error('\u274C Extension context invalidated');\r\n              callback(null);\r\n              return;\r\n            }\r\n            chrome.tabs.sendMessage(tabId, message, callback);\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            callback(null);\r\n          }\r\n          return;\r\n        }\r\n        // Otherwise return a Promise\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.sendMessage(tabId, message, (response) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(response);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            // Handle \"Extension context invalidated\" error in Chrome\r\n            console.error('\u274C Extension context error:', error.message);\r\n            reject(error);\r\n          }\r\n        });\r\n      },\r\n      create: (createProperties) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.create(createProperties, (tab) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tab);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      },\r\n      update: (tabId, updateProperties) => {\r\n        return new Promise((resolve, reject) => {\r\n          try {\r\n            if (!isChromeContextValid()) {\r\n              reject(new Error('Extension context invalidated'));\r\n              return;\r\n            }\r\n            chrome.tabs.update(tabId, updateProperties, (tab) => {\r\n              if (chrome.runtime.lastError) {\r\n                reject(new Error(chrome.runtime.lastError.message));\r\n              } else {\r\n                resolve(tab);\r\n              }\r\n            });\r\n          } catch (error) {\r\n            reject(new Error('Extension context invalidated'));\r\n          }\r\n        });\r\n      }\r\n    }\r\n  };\r\n} else {\r\n  console.error('\u274C FATAL: No browser API available!');\r\n  throw new Error('No browser API available');\r\n}\r\n\r\n// Expose as browserAPI for consistent naming\r\nglobalScope.browserAPI = browserAPI;\r\n\r\n// Verify API is available\r\nif (!globalScope.browserAPI || !globalScope.browserAPI.runtime) {\r\n  console.error('\u274C FATAL: Browser API not available!');\r\n  throw new Error('Browser API not available');\r\n}\r\n\r\nconsole.log('\u2705 Browser API ready:', (typeof browser !== 'undefined' && browserAPI === browser) ? 'Firefox' : 'Chrome');\r\n", "/**\r\n * Popup UI Script\r\n * Handles user interactions in the extension popup\r\n */\r\n\r\n// Import browser polyfill for cross-browser compatibility\r\nimport '@carmaclouds/core/common/browser-polyfill.js';\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  console.log('\uD83D\uDE80 Popup DOMContentLoaded fired');\r\n  \r\n  // Check if browserAPI is available\r\n  if (typeof browserAPI === 'undefined' && typeof window.browserAPI === 'undefined') {\r\n    console.error('\u274C FATAL: browserAPI is not defined!');\r\n    debug.error('\u274C FATAL: browserAPI is not defined!');\r\n    document.body.innerHTML = `\r\n      <div style=\"padding: 20px; color: red; font-family: Arial;\">\r\n        <h2>Error: Browser API Not Loaded</h2>\r\n        <p>The browser polyfill failed to load.</p>\r\n        <p><strong>Steps to fix:</strong></p>\r\n        <ol>\r\n          <li>Go to chrome://extensions/</li>\r\n          <li>Click \"Remove\" on RollCloud</li>\r\n          <li>Reload the extension fresh</li>\r\n        </ol>\r\n        <p style=\"font-size: 12px; color: #666;\">\r\n          Check the console (F12) for more details.\r\n        </p>\r\n      </div>\r\n    `;\r\n    return;\r\n  }\r\n\r\n  console.log('\u2705 browserAPI is available');\r\n  debug.log('\u2705 browserAPI is available');\r\n\r\n  // Chrome MV3 storage wrapper for popup context\r\n  const storage = {\r\n    async get(keys) {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          const result = browserAPI.storage.local.get(keys);\r\n          if (result && typeof result.then === 'function') {\r\n            result.then(resolve).catch(reject);\r\n          } else {\r\n            browserAPI.runtime.lastError ? reject(new Error(browserAPI.runtime.lastError.message)) : resolve(result);\r\n          }\r\n        } catch (error) {\r\n          reject(error);\r\n        }\r\n      });\r\n    },\r\n    async set(items) {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          const result = browserAPI.storage.local.set(items);\r\n          if (result && typeof result.then === 'function') {\r\n            result.then(resolve).catch(reject);\r\n          } else {\r\n            browserAPI.runtime.lastError ? reject(new Error(browserAPI.runtime.lastError.message)) : resolve();\r\n          }\r\n        } catch (error) {\r\n          reject(error);\r\n        }\r\n      });\r\n    },\r\n    async remove(keys) {\r\n      return new Promise((resolve, reject) => {\r\n        try {\r\n          const result = browserAPI.storage.local.remove(keys);\r\n          if (result && typeof result.then === 'function') {\r\n            result.then(resolve).catch(reject);\r\n          } else {\r\n            browserAPI.runtime.lastError ? reject(new Error(browserAPI.runtime.lastError.message)) : resolve();\r\n          }\r\n        } catch (error) {\r\n          reject(error);\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  try {\r\n    console.log('\uD83D\uDE80 About to call initializePopup()');\r\n    initializePopup();\r\n    console.log('\u2705 initializePopup() completed');\r\n  } catch (error) {\r\n    // Try to use debug if available, otherwise use console\r\n    const logger = typeof debug !== 'undefined' ? debug : console;\r\n    console.error('\u274C Popup initialization error:', error);\r\n    logger.error('\u274C Popup initialization error:', error);\r\n    document.body.innerHTML = `\r\n      <div style=\"padding: 20px; color: red; font-family: Arial;\">\r\n        <h2>Initialization Error</h2>\r\n        <p>${error.message}</p>\r\n        <pre style=\"background: #f0f0f0; padding: 10px; overflow: auto;\">${error.stack}</pre>\r\n      </div>\r\n    `;\r\n  }\r\n\r\nfunction initializePopup() {\r\n  // Set version from manifest\r\n  try {\r\n    const manifest = browserAPI.runtime.getManifest();\r\n    const versionDisplay = document.getElementById('versionDisplay');\r\n    if (versionDisplay && manifest.version) {\r\n      versionDisplay.textContent = `v${manifest.version}`;\r\n    }\r\n  } catch (e) {\r\n    console.log('Could not read manifest version:', e);\r\n  }\r\n\r\n  // Check if this is an experimental build\r\n  checkExperimentalBuild();\r\n\r\n  // DOM Elements - Sections\r\n  const loginSection = document.getElementById('loginSection');\r\n  const mainSection = document.getElementById('mainSection');\r\n\r\n  // DOM Elements - Login\r\n  const autoConnectBtn = document.getElementById('autoConnectBtn');\r\n  const usernameLoginForm = document.getElementById('usernameLoginForm');\r\n  const usernameInput = document.getElementById('username');\r\n  const passwordInput = document.getElementById('password');\r\n  const usernameLoginBtn = document.getElementById('usernameLoginBtn');\r\n  const loginError = document.getElementById('loginError');\r\n\r\n  // DOM Elements - Main Interface\r\n  const logoutBtn = document.getElementById('logoutBtn');\r\n  const exportBtn = document.getElementById('exportBtn');\r\n  const importBtn = document.getElementById('importBtn');\r\n  const importFile = document.getElementById('importFile');\r\n  const cloudSyncBtn = document.getElementById('cloudSyncBtn');\r\n  const characterSelector = document.getElementById('characterSelector');\r\n  const characterSelect = document.getElementById('characterSelect');\r\n  const statusIcon = document.getElementById('statusIcon');\r\n  const statusText = document.getElementById('statusText');\r\n  const characterInfo = document.getElementById('characterInfo');\r\n  const charName = document.getElementById('charName');\r\n  const charLevel = document.getElementById('charLevel');\r\n  const charClass = document.getElementById('charClass');\r\n  const charRace = document.getElementById('charRace');\r\n  const syncBtn = document.getElementById('syncBtn');\r\n  const showSheetBtn = document.getElementById('showSheetBtn');\r\n  const clearLocalBtn = document.getElementById('clearLocalBtn');\r\n  const clearCloudBtn = document.getElementById('clearCloudBtn');\r\n  const syncCharacterToCloudBtn = document.getElementById('syncCharacterToCloudBtn');\r\n  const howToBtn = document.getElementById('howToBtn');\r\n  const settingsBtn = document.getElementById('settingsBtn');\r\n  const settingsMenu = document.getElementById('settingsMenu');\r\n\r\n  // DOM Elements - Experimental Features\r\n  const autoBackwardsSyncToggle = document.getElementById('autoBackwardsSyncToggle');\r\n\r\n  // Enable button for testing\r\n  if (showSheetBtn) {\r\n    showSheetBtn.disabled = false;\r\n\r\n    // Add basic styling to make it visible\r\n    showSheetBtn.style.display = 'inline-block';\r\n    showSheetBtn.style.width = 'auto';\r\n    showSheetBtn.style.height = 'auto';\r\n    showSheetBtn.style.padding = '8px 16px';\r\n    showSheetBtn.style.margin = '5px';\r\n    showSheetBtn.style.visibility = 'visible';\r\n  }\r\n\r\n  // Initialize - render cached UI immediately, then verify in background\r\n  renderFromCache().then(() => {\r\n    // After cached UI rendered, run full login/status checks\r\n    checkLoginStatus();\r\n  }).catch((e) => {\r\n    console.warn('Error rendering from cache:', e);\r\n    // Still run full check if cache render fails\r\n    checkLoginStatus();\r\n  });\r\n\r\n  // DEBUG: Force show main section after 5 seconds if still on login screen\r\n  // This helps diagnose issues in Chrome/Opera where auto-login might be failing\r\n  setTimeout(() => {\r\n    if (!mainSection.classList.contains('hidden')) {\r\n      console.log('\u2705 Main section already visible');\r\n      return;\r\n    }\r\n\r\n    console.warn('\u26A0\uFE0F Main section still hidden after 5s - checking storage one more time...');\r\n    browserAPI.storage.local.get(['diceCloudToken', 'diceCloudUserId', 'characterProfiles'])\r\n      .then((result) => {\r\n        console.log('\uD83D\uDCE6 Storage check:', {\r\n          hasToken: !!result.diceCloudToken,\r\n          hasUserId: !!result.diceCloudUserId,\r\n          hasProfiles: !!result.characterProfiles,\r\n          profileCount: result.characterProfiles ? Object.keys(result.characterProfiles).length : 0\r\n        });\r\n\r\n        if (result.diceCloudToken || result.characterProfiles) {\r\n          console.log('\u2705 Found data in storage - forcing main section to show');\r\n          showMainSection();\r\n        } else {\r\n          console.log('\u2139\uFE0F No data in storage - login screen is correct');\r\n          console.log('\uD83D\uDC49 Please visit DiceCloud and log in, then refresh this popup');\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.error('\u274C Storage check failed:', err);\r\n      });\r\n  }, 5000);\r\n\r\n  /**\r\n   * Render UI from cached storage values so the popup shows instant data\r\n   * before any network/Supabase checks run.\r\n   */\r\n  async function renderFromCache() {\r\n    try {\r\n      console.log('\uD83D\uDD0D renderFromCache: Checking storage for auth data...');\r\n      const result = await storage.get(['diceCloudToken', 'username', 'characterProfiles', 'activeCharacterId', 'tokenExpires']);\r\n      console.log('\uD83D\uDD0D renderFromCache: Storage result:', result);\r\n      \r\n      // If no token cached, show login section and return\r\n      if (!result.diceCloudToken) {\r\n        console.log('\uD83D\uDD0D renderFromCache: No token found, showing login section');\r\n        showLoginSection();\r\n        return;\r\n      }\r\n\r\n      // Show main section immediately\r\n      showMainSection();\r\n\r\n      // Populate username if available\r\n      if (result.username) {\r\n        const userLabel = document.getElementById('usernameLabel');\r\n        if (userLabel) userLabel.textContent = result.username;\r\n      }\r\n\r\n      // Load cached character profiles if present\r\n      const profiles = result.characterProfiles || {};\r\n      const characterIds = Object.keys(profiles).filter(id => profiles[id].type !== 'rollcloudPlayer');\r\n\r\n      if (characterIds.length > 0) {\r\n        characterSelect.innerHTML = '';\r\n        characterIds.forEach(id => {\r\n          const char = profiles[id];\r\n          const option = document.createElement('option');\r\n          option.value = id;\r\n          option.textContent = `${char.name || 'Unknown'} (${char.class || 'No Class'} ${char.level || '?'})`;\r\n          if (id === result.activeCharacterId) option.selected = true;\r\n          characterSelect.appendChild(option);\r\n        });\r\n        characterSelector.classList.remove('hidden');\r\n        if (result.activeCharacterId && profiles[result.activeCharacterId]) {\r\n          displayCharacterData(profiles[result.activeCharacterId]);\r\n        } else {\r\n          clearCharacterDisplay();\r\n        }\r\n      } else {\r\n        characterSelect.innerHTML = '<option value=\"\">No characters synced</option>';\r\n        characterSelector.classList.add('hidden');\r\n        clearCharacterDisplay();\r\n      }\r\n    } catch (error) {\r\n      debug.warn('Failed to render from cache:', error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // Debug: Check if Supabase is available\r\n  debug.log('\uD83D\uDD0D Supabase availability check:', typeof SupabaseTokenManager !== 'undefined' ? 'Available' : 'Not available');\r\n  if (typeof SupabaseTokenManager !== 'undefined') {\r\n    const testManager = new SupabaseTokenManager();\r\n    debug.log('\uD83D\uDD0D Generated user ID:', testManager.generateUserId());\r\n  }\r\n  \r\n  // Listen for data sync notifications from content scripts\r\n  browserAPI.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n    if (message.action === 'dataSynced') {\r\n      debug.log('\uD83D\uDCE5 Received data sync notification:', message);\r\n      // Refresh character data to show the newly synced character\r\n      loadCharacterData();\r\n      showSuccess(`${message.characterName} synced successfully!`);\r\n    }\r\n  });\r\n  \r\n  // Fallback: Periodically check for new character data every 5 seconds\r\n  // This helps when background script communication is failing\r\n  let lastCharacterCount = 0;\r\n  setInterval(async () => {\r\n    try {\r\n      const result = await browserAPI.storage.local.get(['characterProfiles']);\r\n      const profiles = result.characterProfiles || {};\r\n      const currentCount = Object.keys(profiles).filter(id => profiles[id].type !== 'rollcloudPlayer').length;\r\n      \r\n      if (currentCount > lastCharacterCount) {\r\n        debug.log('\uD83D\uDD04 Detected new character data via polling');\r\n        loadCharacterData();\r\n        showSuccess('New character data detected!');\r\n      }\r\n      lastCharacterCount = currentCount;\r\n    } catch (error) {\r\n      // Silently ignore polling errors\r\n    }\r\n  }, 5000);\r\n\r\n  // Periodic session validity check to detect conflicts from other browsers\r\n  setInterval(async () => {\r\n    try {\r\n      if (typeof SupabaseTokenManager !== 'undefined') {\r\n        const supabaseManager = new SupabaseTokenManager();\r\n        const sessionCheck = await supabaseManager.checkSessionValidity();\r\n        \r\n        if (!sessionCheck.valid) {\r\n          debug.log('\u26A0\uFE0F Session conflict detected via polling, logging out:', sessionCheck.reason);\r\n          await handleSessionConflict(sessionCheck);\r\n          showLoginSection();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      debug.error('\u274C Error in periodic session check:', error);\r\n    }\r\n  }, 10000); // Check every 10 seconds\r\n\r\n  // Event Listeners - Login\r\n  autoConnectBtn.addEventListener('click', handleAutoConnect);\r\n  usernameLoginForm.addEventListener('submit', handleUsernameLogin);\r\n\r\n  // Debug: Skip login button\r\n  const debugSkipLoginBtn = document.getElementById('debugSkipLoginBtn');\r\n  if (debugSkipLoginBtn) {\r\n    debugSkipLoginBtn.addEventListener('click', () => {\r\n      console.log('\uD83D\uDE80 Debug: Forcing main section to show');\r\n      showMainSection();\r\n    });\r\n  }\r\n\r\n  // Event Listeners - Main Interface\r\n  logoutBtn.addEventListener('click', handleLogout);\r\n  characterSelect.addEventListener('change', handleCharacterChange);\r\n  syncBtn.addEventListener('click', handleSync);\r\n\r\n  if (showSheetBtn) {\r\n    showSheetBtn.addEventListener('click', handleShowSheet);\r\n  } else {\r\n    debug.error('\u274C showSheetBtn not found!');\r\n  }\r\n\r\n  if (howToBtn) {\r\n    howToBtn.addEventListener('click', handleHowTo);\r\n  }\r\n\r\n  if (syncCharacterToCloudBtn) {\r\n    syncCharacterToCloudBtn.addEventListener('click', handleSyncCharacterToCloud);\r\n  }\r\n\r\n  if (clearLocalBtn) {\r\n    clearLocalBtn.addEventListener('click', handleClearLocal);\r\n  }\r\n  if (clearCloudBtn) {\r\n    clearCloudBtn.addEventListener('click', handleClearCloud);\r\n  }\r\n\r\n  // Settings dropdown event listeners\r\n  if (settingsBtn && settingsMenu) {\r\n    settingsBtn.addEventListener('click', toggleSettingsMenu);\r\n    \r\n    // Close settings menu when clicking outside\r\n    document.addEventListener('click', (event) => {\r\n      if (!settingsBtn.contains(event.target) && !settingsMenu.contains(event.target)) {\r\n        settingsMenu.classList.add('hidden');\r\n      }\r\n    });\r\n  }\r\n\r\n  // Export/Import event listeners\r\n  if (exportBtn) {\r\n    exportBtn.addEventListener('click', handleExport);\r\n  }\r\n  if (importBtn && importFile) {\r\n    importBtn.addEventListener('click', () => importFile.click());\r\n    importFile.addEventListener('change', handleImport);\r\n  }\r\n  if (cloudSyncBtn) {\r\n    cloudSyncBtn.addEventListener('click', handleCloudSync);\r\n  }\r\n\r\n  // Modal event listeners\r\n  document.getElementById('closeSlotModal').addEventListener('click', closeSlotModal);\r\n\r\n  // Experimental features event listeners\r\n  if (autoBackwardsSyncToggle) {\r\n    // Load initial state\r\n    loadAutoBackwardsSyncState();\r\n    // Add change listener\r\n    autoBackwardsSyncToggle.addEventListener('change', handleAutoBackwardsSyncToggle);\r\n  }\r\n\r\n  // Discord integration event listeners\r\n  const setupDiscordBtn = document.getElementById('setupDiscordBtn');\r\n  const cancelPairingBtn = document.getElementById('cancelPairingBtn');\r\n  const disconnectDiscordBtn = document.getElementById('disconnectDiscordBtn');\r\n  const testDiscordWebhookBtn = document.getElementById('testDiscordWebhook');\r\n  const checkDiscordIntegrationBtn = document.getElementById('checkDiscordIntegration');\r\n  const checkDiscordIntegrationNotConnectedBtn = document.getElementById('checkDiscordIntegrationNotConnected');\r\n  const saveDiscordWebhookBtn = document.getElementById('saveDiscordWebhook');\r\n\r\n  if (setupDiscordBtn) {\r\n    // Load initial Discord state\r\n    loadDiscordConnectionState();\r\n    // Check if we should prompt the user to re-sync Discord after install/update\r\n    checkDiscordResyncPrompt();\r\n    // Add event listeners\r\n    setupDiscordBtn.addEventListener('click', handleSetupDiscord);\r\n    if (cancelPairingBtn) cancelPairingBtn.addEventListener('click', handleCancelPairing);\r\n    if (disconnectDiscordBtn) disconnectDiscordBtn.addEventListener('click', handleDisconnectDiscord);\r\n    if (testDiscordWebhookBtn) testDiscordWebhookBtn.addEventListener('click', handleTestDiscordWebhook);\r\n    if (checkDiscordIntegrationBtn) checkDiscordIntegrationBtn.addEventListener('click', handleCheckDiscordIntegration);\r\n    if (checkDiscordIntegrationNotConnectedBtn) checkDiscordIntegrationNotConnectedBtn.addEventListener('click', handleCheckDiscordIntegration);\r\n    if (saveDiscordWebhookBtn) saveDiscordWebhookBtn.addEventListener('click', handleSaveDiscordWebhook);\r\n  }\r\n\r\n    // Show a prompt if install/update requires the user to re-sync Discord\r\n    async function checkDiscordResyncPrompt() {\r\n      try {\r\n        const stored = await browserAPI.storage.local.get(['requireDiscordResync']);\r\n        if (stored && stored.requireDiscordResync) {\r\n          const prompt = document.getElementById('discordResyncPrompt');\r\n          if (prompt) prompt.style.display = 'block';\r\n\r\n          const resyncBtn = document.getElementById('discordResyncBtn');\r\n          const dismissBtn = document.getElementById('discordDismissResyncBtn');\r\n\r\n          if (resyncBtn) resyncBtn.addEventListener('click', async () => {\r\n            try {\r\n              // Clear the flag and open Discord setup\r\n              await browserAPI.storage.local.remove('requireDiscordResync');\r\n            } catch (e) {\r\n              console.warn('Failed to clear requireDiscordResync:', e);\r\n            }\r\n            if (prompt) prompt.style.display = 'none';\r\n            handleSetupDiscord();\r\n          });\r\n\r\n          if (dismissBtn) dismissBtn.addEventListener('click', async () => {\r\n            try {\r\n              await browserAPI.storage.local.remove('requireDiscordResync');\r\n            } catch (e) {\r\n              console.warn('Failed to clear requireDiscordResync:', e);\r\n            }\r\n            if (prompt) prompt.style.display = 'none';\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.warn('Error checking discord resync prompt:', error);\r\n      }\r\n    }\r\n\r\n  /**\r\n   * Checks if the user is logged in and shows appropriate section\r\n   */\r\n  async function checkLoginStatus() {\r\n    try {\r\n      debug.log('\uD83D\uDD0D Checking login status...');\r\n      \r\n      // First check for session conflicts\r\n      if (typeof SupabaseTokenManager !== 'undefined') {\r\n        const supabaseManager = new SupabaseTokenManager();\r\n        const sessionCheck = await supabaseManager.checkSessionValidity();\r\n        \r\n        if (!sessionCheck.valid) {\r\n          debug.log('\u26A0\uFE0F Session conflict detected, logging out:', sessionCheck.reason);\r\n          await handleSessionConflict(sessionCheck);\r\n          showLoginSection();\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // Timeout after 3s in case the service worker is unresponsive (e.g., fresh install)\r\n      const response = await Promise.race([\r\n        browserAPI.runtime.sendMessage({ action: 'checkLoginStatus' }),\r\n        new Promise((_, reject) => setTimeout(() => reject(new Error('Service worker timeout')), 3000))\r\n      ]);\r\n      debug.log('\uD83D\uDCE5 Login status response:', response);\r\n\r\n      if (response.success && response.loggedIn) {\r\n        showMainSection();\r\n      } else {\r\n        debug.log('\uD83D\uDD04 Background script says not logged in, checking storage directly...');\r\n        // Try alternative method - check storage directly\r\n        try {\r\n          const result = await storage.get(['diceCloudToken', 'username', 'tokenExpires']);\r\n          debug.log('\uD83D\uDCE6 Direct storage check result:', result);\r\n          if (result.diceCloudToken) {\r\n            debug.log('\u2705 Found token in storage, showing main section');\r\n            showMainSection();\r\n          } else {\r\n            debug.log('\u274C No token found in storage, checking Supabase...');\r\n            // Check if user explicitly logged out - don't restore from Supabase in that case\r\n            const { explicitlyLoggedOut } = await storage.get('explicitlyLoggedOut');\r\n            if (explicitlyLoggedOut) {\r\n              debug.log('\u23ED\uFE0F Skipping Supabase restoration: user explicitly logged out');\r\n              showLoginSection();\r\n              return;\r\n            }\r\n            // Try Supabase for cross-session persistence\r\n            try {\r\n              if (typeof SupabaseTokenManager !== 'undefined') {\r\n                debug.log('\uD83C\uDF10 Attempting to retrieve token from Supabase...');\r\n                const supabaseManager = new SupabaseTokenManager();\r\n                const userId = supabaseManager.generateUserId();\r\n                debug.log('\uD83D\uDD0D Using user ID for Supabase lookup:', userId);\r\n\r\n                const supabaseResult = await supabaseManager.retrieveToken();\r\n                debug.log('\uD83D\uDCE5 Supabase retrieval result:', supabaseResult);\r\n\r\n                if (supabaseResult.success) {\r\n                  debug.log('\u2705 Found token in Supabase, restoring to local storage...');\r\n                  // Store token locally for faster access\r\n                  await storage.set({\r\n                    diceCloudToken: supabaseResult.token,\r\n                    username: supabaseResult.username,\r\n                    tokenExpires: supabaseResult.tokenExpires,\r\n                    diceCloudUserId: supabaseResult.userId,\r\n                    authId: supabaseResult.authId || supabaseResult.userId\r\n                  });\r\n                  // Clear explicitly logged out flag since user is restoring session\r\n                  await storage.remove('explicitlyLoggedOut');\r\n                  // Restore character data from local storage\r\n                  const localProfiles = await storage.get(['profiles']);\r\n                  if (localProfiles.profiles) {\r\n                    await storage.set({\r\n                      profiles: localProfiles.profiles\r\n                    });\r\n                  }\r\n                  debug.log('\u2705 Token and data restored from Supabase to local storage');\r\n                  showMainSection();\r\n                } else {\r\n                  debug.log('\u2139\uFE0F No token found in Supabase');\r\n                  showLoginSection();\r\n                }\r\n              } else {\r\n                debug.log('\u274C Supabase not available, showing login');\r\n                showLoginSection();\r\n              }\r\n            } catch (error) {\r\n              debug.error('\u274C Error retrieving from Supabase:', error);\r\n              showLoginSection();\r\n            }\r\n          }\r\n        } catch (storageError) {\r\n          debug.error('\u274C Storage check failed:', storageError);\r\n          showLoginSection();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      debug.error('\u274C Error checking login status:', error);\r\n      // Try alternative method - check storage directly\r\n      try {\r\n        const result = await browserAPI.storage.local.get(['diceCloudToken', 'username', 'tokenExpires']);\r\n        debug.log('\uD83D\uDCE6 Direct storage check result (error fallback):', result);\r\n        if (result.diceCloudToken) {\r\n          debug.log('\u2705 Found token in storage, showing main section');\r\n          showMainSection();\r\n        } else {\r\n          debug.log('\u274C No token found in storage, checking Supabase...');\r\n          // Check if user explicitly logged out - don't restore from Supabase in that case\r\n          const { explicitlyLoggedOut } = await browserAPI.storage.local.get('explicitlyLoggedOut');\r\n          if (explicitlyLoggedOut) {\r\n            debug.log('\u23ED\uFE0F Skipping Supabase restoration (error fallback): user explicitly logged out');\r\n            showLoginSection();\r\n            return;\r\n          }\r\n          // Try Supabase for cross-session persistence\r\n          try {\r\n            if (typeof SupabaseTokenManager !== 'undefined') {\r\n              const supabaseManager = new SupabaseTokenManager();\r\n              const supabaseResult = await supabaseManager.retrieveToken();\r\n\r\n              if (supabaseResult.success) {\r\n                debug.log('\u2705 Found token in Supabase (error fallback), restoring to local storage...');\r\n                // Store token locally for faster access\r\n                await browserAPI.storage.local.set({\r\n                  diceCloudToken: supabaseResult.token,\r\n                  username: supabaseResult.username,\r\n                  tokenExpires: supabaseResult.tokenExpires\r\n                });\r\n                // Clear explicitly logged out flag since user is restoring session\r\n                await browserAPI.storage.local.remove('explicitlyLoggedOut');\r\n                showMainSection();\r\n              } else {\r\n                debug.log('\u274C No token found in Supabase, showing login');\r\n                showLoginSection();\r\n              }\r\n            } else {\r\n              debug.log('\u274C Supabase not available, showing login');\r\n              showLoginSection();\r\n            }\r\n          } catch (supabaseError) {\r\n            debug.error('\u274C Supabase check failed:', supabaseError);\r\n            showLoginSection();\r\n          }\r\n        }\r\n      } catch (storageError) {\r\n        debug.error('\u274C Storage check failed:', storageError);\r\n        showLoginSection();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles session conflict when another browser logs in\r\n   */\r\n  async function handleSessionConflict(sessionCheck) {\r\n    try {\r\n      debug.log('\u26A0\uFE0F Handling session conflict:', sessionCheck);\r\n      \r\n      // Clear local authentication data\r\n      await browserAPI.storage.local.remove([\r\n        'diceCloudToken', \r\n        'username', \r\n        'tokenExpires', \r\n        'diceCloudUserId', \r\n        'authId',\r\n        'currentSessionId',\r\n        'sessionStartTime'\r\n      ]);\r\n      \r\n      // Show conflict warning\r\n      let conflictMessage = 'You have been logged out because RollCloud was opened in a different browser.';\r\n      \r\n      if (sessionCheck.reason === 'conflict_detected' && sessionCheck.conflict) {\r\n        const conflict = sessionCheck.conflict.conflictingSession;\r\n        const detectedTime = new Date(conflict.detectedAt).toLocaleString();\r\n        \r\n        if (conflict.username && conflict.browserInfo) {\r\n          const browserName = conflict.browserInfo.userAgent.includes('Chrome') ? 'Chrome' : \r\n                           conflict.browserInfo.userAgent.includes('Firefox') ? 'Firefox' : \r\n                           conflict.browserInfo.userAgent.includes('Edge') ? 'Edge' : 'another browser';\r\n          \r\n          conflictMessage = `You have been logged out because RollCloud was opened in ${browserName} as \"${conflict.username}\" at ${detectedTime}.`;\r\n        }\r\n      } else if (sessionCheck.reason === 'token_mismatch') {\r\n        conflictMessage = 'You have been logged out because your login session was invalidated by another device.';\r\n      } else if (sessionCheck.reason === 'session_not_found') {\r\n        conflictMessage = 'Your session has expired. Please log in again.';\r\n      }\r\n      \r\n      // Show the conflict warning in the login form\r\n      showLoginError(conflictMessage);\r\n      \r\n      // Clear conflict info after showing\r\n      if (typeof SupabaseTokenManager !== 'undefined') {\r\n        const supabaseManager = new SupabaseTokenManager();\r\n        await supabaseManager.clearConflictInfo();\r\n      }\r\n      \r\n      debug.log('\u2705 Session conflict handled, user logged out');\r\n    } catch (error) {\r\n      debug.error('\u274C Error handling session conflict:', error);\r\n      showLoginError('You have been logged out. Please log in again.');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows the login section\r\n   */\r\n  function showLoginSection() {\r\n    loginSection.classList.remove('hidden');\r\n    mainSection.classList.add('hidden');\r\n  }\r\n\r\n  /**\r\n   * Shows the main section\r\n   */\r\n  function showMainSection() {\r\n    loginSection.classList.add('hidden');\r\n    mainSection.classList.remove('hidden');\r\n    loadCharacterData();\r\n    \r\n    // Update Discord button now that user is logged in\r\n    showDiscordNotConnected();\r\n  }\r\n\r\n  /**\r\n   * Handles auto-connect - checks for DiceCloud tab or opens one\r\n   */\r\n  async function handleAutoConnect() {\r\n    try {\r\n      autoConnectBtn.disabled = true;\r\n      autoConnectBtn.textContent = '\u23F3 Checking...';\r\n      hideLoginError();\r\n\r\n      // Check if browserAPI.tabs is available\r\n      if (!browserAPI || !browserAPI.tabs || typeof browserAPI.tabs.query !== 'function') {\r\n        showLoginError('Extension error: tabs API not available. Please reload the extension.');\r\n        return;\r\n      }\r\n\r\n      // First, check if the current active tab is DiceCloud\r\n      const [activeTab] = await browserAPI.tabs.query({ active: true, currentWindow: true });\r\n      let dicecloudTab = null;\r\n\r\n      if (activeTab && activeTab.url && activeTab.url.includes('dicecloud.com')) {\r\n        // User is currently on DiceCloud - use this tab\r\n        dicecloudTab = activeTab;\r\n        debug.log('Using current active DiceCloud tab');\r\n      } else {\r\n        // Check if any other tab has DiceCloud open\r\n        const tabs = await browserAPI.tabs.query({ url: 'https://dicecloud.com/*' });\r\n        if (tabs.length > 0) {\r\n          dicecloudTab = tabs[0];\r\n          debug.log('Found DiceCloud tab:', dicecloudTab.id);\r\n        }\r\n      }\r\n\r\n      if (dicecloudTab) {\r\n        // DiceCloud is open - try to capture token\r\n        autoConnectBtn.textContent = '\u23F3 Capturing token...';\r\n\r\n        try {\r\n          // Send message to DiceCloud tab to extract token using runtime.sendMessage\r\n          console.log('\uD83D\uDCE1 About to send message to tab:', dicecloudTab.id);\r\n          debug.log('\uD83D\uDCE1 About to send message to tab:', dicecloudTab.id);\r\n          \r\n          const response = await new Promise((resolve) => {\r\n            browserAPI.runtime.sendMessage({\r\n              action: 'extractAuthToken',\r\n              tabId: dicecloudTab.id\r\n            }, (response) => {\r\n              console.log('\uD83D\uDCE1 Received callback response:', response);\r\n              debug.log('\uD83D\uDCE1 Received callback response:', response);\r\n              // Extract the actual data from the background script response\r\n              const actualResponse = response.success ? response.data : response;\r\n              console.log('\uD83D\uDCE1 Actual response object:', actualResponse);\r\n              debug.log('\uD83D\uDCE1 Actual response object:', actualResponse);\r\n              resolve(actualResponse);\r\n            });\r\n          });\r\n          \r\n          console.log('\uD83D\uDCE1 Received Promise response:', response);\r\n          debug.log('\uD83D\uDCE1 Received Promise response:', response);\r\n\r\n          debug.log('\uD83D\uDCE5 Token capture response:', response);\r\n          console.log('\uD83D\uDCE5 Token capture response (console):', response);\r\n\r\n          if (response && response.success && response.token) {\r\n            // Store the token with metadata - use direct storage as primary method\r\n            try {\r\n              debug.log('\uD83D\uDCBE Storing token directly in storage...');\r\n              const storageData = {\r\n                diceCloudToken: response.token,\r\n                diceCloudUserId: response.userId,\r\n                tokenExpires: response.tokenExpires,\r\n                username: response.username,\r\n                authId: response.authId\r\n              };\r\n\r\n              await browserAPI.storage.local.set(storageData);\r\n              // Clear explicitly logged out flag since user is logging in\r\n              await browserAPI.storage.local.remove('explicitlyLoggedOut');\r\n              debug.log('\u2705 Token stored successfully in direct storage:', storageData);\r\n\r\n              // Also store in Supabase for cross-session persistence\r\n              try {\r\n                if (typeof SupabaseTokenManager !== 'undefined') {\r\n                  const supabaseManager = new SupabaseTokenManager();\r\n                  const supabaseResult = await supabaseManager.storeToken({\r\n                    token: response.token,\r\n                    userId: response.userId,\r\n                    tokenExpires: response.tokenExpires,\r\n                    username: response.username, // Display username\r\n                    authId: response.authId // Auth ID for database\r\n                  });\r\n\r\n                  if (supabaseResult.success) {\r\n                    debug.log('\u2705 Token also stored in Supabase for cross-session persistence');\r\n                  } else {\r\n                    debug.log('\u26A0\uFE0F Supabase storage failed (non-critical):', supabaseResult.error);\r\n                  }\r\n                }\r\n              } catch (supabaseError) {\r\n                debug.log('\u26A0\uFE0F Supabase not available (non-critical):', supabaseError);\r\n              }\r\n\r\n              hideLoginError();\r\n              showMainSection();\r\n              loadCharacterData();\r\n            } catch (storageError) {\r\n              debug.error('\u274C Direct storage failed:', storageError);\r\n              showLoginError('Failed to save login. Please try again.');\r\n              return;\r\n            }\r\n          } else {\r\n            // Not logged in - show error and keep DiceCloud tab open\r\n            showLoginError('Please log in to DiceCloud, then click the button again.');\r\n            // Focus the DiceCloud tab\r\n            try {\r\n              if (browserAPI && browserAPI.tabs && typeof browserAPI.tabs.update === 'function') {\r\n                await browserAPI.tabs.update(dicecloudTab.id, { active: true });\r\n              }\r\n            } catch (tabError) {\r\n              debug.log('\u26A0\uFE0F Could not focus DiceCloud tab:', tabError.message);\r\n            }\r\n          }\r\n        } catch (error) {\r\n          debug.error('Error capturing token:', error);\r\n          showLoginError('Error: ' + error.message);\r\n        }\r\n      } else {\r\n        // No DiceCloud tab - open one\r\n        autoConnectBtn.textContent = '\u23F3 Opening DiceCloud...';\r\n\r\n        try {\r\n          if (browserAPI && browserAPI.tabs && typeof browserAPI.tabs.create === 'function') {\r\n            await browserAPI.tabs.create({\r\n              url: 'https://dicecloud.com',\r\n              active: true\r\n            });\r\n            showLoginError('DiceCloud opened in new tab. Log in, then click this button again.');\r\n          } else {\r\n            showLoginError('Cannot open DiceCloud tab. Please open https://dicecloud.com manually, log in, and try again.');\r\n          }\r\n        } catch (tabError) {\r\n          debug.error('Could not create DiceCloud tab:', tabError);\r\n          showLoginError('Cannot open DiceCloud tab. Please open https://dicecloud.com manually, log in, and try again.');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      debug.error('Auto-connect error:', error);\r\n      showLoginError('Error: ' + error.message);\r\n    } finally {\r\n      autoConnectBtn.disabled = false;\r\n      autoConnectBtn.textContent = '\uD83D\uDD10 Connect with DiceCloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles username/password login\r\n   */\r\n  async function handleUsernameLogin(event) {\r\n    event.preventDefault();\r\n\r\n    const username = usernameInput.value.trim();\r\n    const password = passwordInput.value;\r\n\r\n    if (!username || !password) {\r\n      showLoginError('Please enter both username and password');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      usernameLoginBtn.disabled = true;\r\n      usernameLoginBtn.textContent = '\u23F3 Logging in...';\r\n      hideLoginError();\r\n\r\n      const response = await browserAPI.runtime.sendMessage({\r\n        action: 'loginToDiceCloud',\r\n        username: username,\r\n        password: password\r\n      });\r\n\r\n      if (response.success) {\r\n        usernameLoginForm.reset();\r\n        showMainSection();\r\n        loadCharacterData();\r\n      } else {\r\n        showLoginError(response.error || 'Login failed');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Login error:', error);\r\n      showLoginError('Login failed: ' + error.message);\r\n    } finally {\r\n      usernameLoginBtn.disabled = false;\r\n      usernameLoginBtn.textContent = '\uD83D\uDD10 Login to DiceCloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles logout\r\n   */\r\n  async function handleLogout() {\r\n    try {\r\n      // Delete from Supabase\r\n      try {\r\n        if (typeof SupabaseTokenManager !== 'undefined') {\r\n          await SupabaseTokenManager.deleteToken();\r\n        }\r\n      } catch (supabaseError) {\r\n        debug.log('\u26A0\uFE0F Supabase not available for logout (non-critical):', supabaseError);\r\n      }\r\n\r\n      // Logout from background script\r\n      await browserAPI.runtime.sendMessage({ action: 'logout' });\r\n      showLoginSection();\r\n      clearCharacterDisplay();\r\n      \r\n      // Update Discord button to show \"Sync Account First\" since user is now logged out\r\n      showDiscordNotConnected();\r\n    } catch (error) {\r\n      debug.error('Logout error:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows login error message\r\n   */\r\n  function showLoginError(message) {\r\n    loginError.textContent = message;\r\n    loginError.classList.remove('hidden');\r\n  }\r\n\r\n  /**\r\n   * Hides login error message\r\n   */\r\n  function hideLoginError() {\r\n    loginError.classList.add('hidden');\r\n    loginError.textContent = '';\r\n  }\r\n\r\n  /**\r\n   * Loads all character profiles and populates dropdown\r\n   */\r\n  async function loadCharacterData() {\r\n    try {\r\n      // Get all character profiles (local + database)\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n\r\n      // Get the active character ID\r\n      const storageResult = await browserAPI.storage.local.get(['activeCharacterId']);\r\n      const activeCharacterId = storageResult.activeCharacterId;\r\n\r\n      // Resolve active character from the merged profiles so dropdown and\r\n      // display always agree. Fall back to getCharacterData only if the ID\r\n      // isn't in the merged set (legacy / migration path).\r\n      let activeCharacter = null;\r\n      if (activeCharacterId && profiles[activeCharacterId]) {\r\n        activeCharacter = profiles[activeCharacterId];\r\n      } else {\r\n        const activeResponse = await browserAPI.runtime.sendMessage({ action: 'getCharacterData' });\r\n        activeCharacter = activeResponse.success ? activeResponse.data : null;\r\n      }\r\n\r\n      // Populate character dropdown (exclude GM player data)\r\n      const characterIds = Object.keys(profiles).filter(id =>\r\n        profiles[id].type !== 'rollcloudPlayer'\r\n      );\r\n      if (characterIds.length > 0) {\r\n        characterSelect.innerHTML = '';\r\n        characterIds.forEach(id => {\r\n          const char = profiles[id];\r\n          const option = document.createElement('option');\r\n          option.value = id;\r\n          option.textContent = `${char.name || 'Unknown'} (${char.class || 'No Class'} ${char.level || '?'})`;\r\n          if (id === activeCharacterId) {\r\n            option.selected = true;\r\n          }\r\n          characterSelect.appendChild(option);\r\n        });\r\n\r\n        // Always show character selector when characters exist\r\n        characterSelector.classList.remove('hidden');\r\n\r\n        // Show sync character button if there's an active character\r\n        if (activeCharacter) {\r\n          syncCharacterToCloudBtn.classList.remove('hidden');\r\n        } else {\r\n          syncCharacterToCloudBtn.classList.add('hidden');\r\n        }\r\n      } else {\r\n        characterSelect.innerHTML = '<option value=\"\">No characters synced</option>';\r\n        characterSelector.classList.add('hidden');\r\n        syncCharacterToCloudBtn.classList.add('hidden');\r\n      }\r\n\r\n      // Display active character data\r\n      if (activeCharacter) {\r\n        displayCharacterData(activeCharacter);\r\n      } else {\r\n        clearCharacterDisplay();\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error loading character data:', error);\r\n      clearCharacterDisplay();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles character selection change\r\n   */\r\n  async function handleCharacterChange() {\r\n    try {\r\n      const selectedId = characterSelect.value;\r\n      if (!selectedId) {\r\n        // Hide sync character button when no character is selected\r\n        syncCharacterToCloudBtn.classList.add('hidden');\r\n        return;\r\n      }\r\n\r\n      // Show sync character button when a character is selected\r\n      syncCharacterToCloudBtn.classList.remove('hidden');\r\n\r\n      // If this is a database character (db- prefix), copy it to local storage first\r\n      if (selectedId.startsWith('db-')) {\r\n        const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n        const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n        const dbChar = profiles[selectedId];\r\n        if (dbChar) {\r\n          await browserAPI.runtime.sendMessage({\r\n            action: 'storeCharacterData',\r\n            data: dbChar,\r\n            slotId: selectedId\r\n          });\r\n        }\r\n      }\r\n\r\n      // Set this character as active\r\n      await browserAPI.runtime.sendMessage({\r\n        action: 'setActiveCharacter',\r\n        characterId: selectedId\r\n      });\r\n\r\n      // Reload character data\r\n      await loadCharacterData();\r\n      showSuccess('Switched to selected character');\r\n    } catch (error) {\r\n      debug.error('Error changing character:', error);\r\n      showError('Failed to switch character');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Displays character data in the popup\r\n   */\r\n  function displayCharacterData(data) {\r\n    statusIcon.textContent = '\u2705';\r\n    statusText.textContent = 'Character data synced';\r\n    characterInfo.classList.remove('hidden');\r\n    charName.textContent = data.name || '-';\r\n    charLevel.textContent = data.level || '-';\r\n    charClass.textContent = data.class || '-';\r\n    charRace.textContent = data.race || '-';\r\n    showSheetBtn.disabled = false;\r\n    if (clearLocalBtn) clearLocalBtn.disabled = false;\r\n    if (clearCloudBtn) clearCloudBtn.disabled = false;\r\n  }\r\n\r\n  /**\r\n   * Clears character display\r\n   */\r\n  function clearCharacterDisplay() {\r\n    statusIcon.textContent = '\u23F3';\r\n    statusText.textContent = 'No character data synced';\r\n    characterInfo.classList.add('hidden');\r\n    charName.textContent = '-';\r\n    charLevel.textContent = '-';\r\n    charClass.textContent = '-';\r\n    charRace.textContent = '-';\r\n    // Keep showSheetBtn enabled for testing\r\n    showSheetBtn.disabled = false;\r\n    if (clearLocalBtn) clearLocalBtn.disabled = false;\r\n    if (clearCloudBtn) clearCloudBtn.disabled = false;\r\n  }\r\n\r\n  /**\r\n   * Handles refresh characters button click - pulls data from local storage and database\r\n   */\r\n  async function handleSync() {\r\n    try {\r\n      syncBtn.disabled = true;\r\n      syncBtn.textContent = '\u23F3 Refreshing...';\r\n      statusIcon.textContent = '\u23F3';\r\n      statusText.textContent = 'Refreshing characters...';\r\n\r\n      // First, refresh from local storage\r\n      await refreshFromLocalStorage();\r\n      \r\n      // Then, refresh from database/cloud\r\n      await refreshFromDatabase();\r\n      \r\n      // Finally, reload character data to update UI\r\n      await loadCharacterData();\r\n      \r\n      showSuccess('Characters refreshed successfully!');\r\n    } catch (error) {\r\n      debug.error('Error refreshing characters:', error);\r\n      showError('Error: ' + error.message);\r\n    } finally {\r\n      syncBtn.disabled = false;\r\n      syncBtn.textContent = '\uD83D\uDD04 Refresh Characters';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes character data from local storage\r\n   */\r\n  async function refreshFromLocalStorage() {\r\n    try {\r\n      // Get all character profiles from local storage\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n      \r\n      const characterCount = Object.keys(profiles).filter(id => \r\n        profiles[id].type !== 'rollcloudPlayer'\r\n      ).length;\r\n      \r\n      console.log(`Found ${characterCount} characters in local storage`);\r\n      return profiles;\r\n    } catch (error) {\r\n      console.error('Error refreshing from local storage:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes character data from database/cloud\r\n   */\r\n  async function refreshFromDatabase() {\r\n    try {\r\n      // Check if Supabase is available\r\n      if (typeof SupabaseTokenManager === 'undefined') {\r\n        console.log('Cloud sync not available, skipping database refresh');\r\n        return;\r\n      }\r\n\r\n      const supabaseManager = new SupabaseTokenManager();\r\n      \r\n      // Get current token from storage\r\n      const result = await browserAPI.storage.local.get(['diceCloudToken', 'username', 'tokenExpires', 'diceCloudUserId', 'authId']);\r\n      \r\n      if (!result.diceCloudToken) {\r\n        console.log('No token found, skipping database refresh');\r\n        return;\r\n      }\r\n\r\n      // Refresh token in cloud\r\n      const supabaseResult = await supabaseManager.storeToken({\r\n        token: result.diceCloudToken,\r\n        userId: result.diceCloudUserId,\r\n        tokenExpires: result.tokenExpires,\r\n        username: result.username || 'DiceCloud User',\r\n        authId: result.authId || result.diceCloudUserId\r\n      });\r\n\r\n      if (supabaseResult.success) {\r\n        console.log('Account data refreshed to cloud');\r\n        \r\n        // Try to pull character data from cloud\r\n        const characterData = await supabaseManager.getCharacterData(result.diceCloudUserId);\r\n        if (characterData.success && characterData.characters) {\r\n          console.log(`Pulled ${Object.keys(characterData.characters).length} characters from cloud`);\r\n          \r\n          // Merge cloud data with local storage\r\n          await mergeCloudDataToLocal(characterData.characters);\r\n        }\r\n      } else {\r\n        console.error('Failed to refresh account to cloud:', supabaseResult.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error refreshing from database:', error);\r\n      // Don't throw error here, allow local storage refresh to succeed\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Merges cloud character data with local storage\r\n   */\r\n  async function mergeCloudDataToLocal(cloudCharacters) {\r\n    try {\r\n      // Get current local profiles\r\n      const localResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const localProfiles = localResponse.success ? localResponse.profiles : {};\r\n      \r\n      // Merge cloud data with local data (local takes precedence)\r\n      for (const [characterId, cloudData] of Object.entries(cloudCharacters)) {\r\n        if (!localProfiles[characterId]) {\r\n          // Only add cloud data if it doesn't exist locally\r\n          await browserAPI.runtime.sendMessage({\r\n            action: 'storeCharacterData',\r\n            data: cloudData.characterData,\r\n            slotId: characterId\r\n          });\r\n          console.log(`Added cloud character ${characterId} to local storage`);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error merging cloud data:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows the slot selection modal\r\n   */\r\n  async function showSlotSelectionModal(tab) {\r\n    const modal = document.getElementById('slotModal');\r\n    const slotGrid = document.getElementById('slotGrid');\r\n\r\n    // Get all character profiles\r\n    const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n    const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n\r\n    // Create 10 slots\r\n    slotGrid.innerHTML = '';\r\n    const MAX_SLOTS = 10;\r\n\r\n    for (let i = 1; i <= MAX_SLOTS; i++) {\r\n      const slotId = `slot-${i}`;\r\n      const existingChar = profiles[slotId];\r\n\r\n      const slotCard = document.createElement('div');\r\n      slotCard.className = existingChar ? 'slot-card' : 'slot-card empty';\r\n      slotCard.dataset.slotId = slotId;\r\n\r\n      if (existingChar) {\r\n        slotCard.innerHTML = `\r\n          <div class=\"slot-header\">\r\n            <span class=\"slot-number\">Slot ${i}</span>\r\n            <span class=\"slot-badge occupied\">Occupied</span>\r\n          </div>\r\n          <div class=\"slot-info\">\r\n            <strong>${existingChar.name || 'Unknown'}</strong>\r\n          </div>\r\n          <div class=\"slot-details\">\r\n            ${existingChar.class || 'No Class'} ${existingChar.level || '?'} \u2022 ${existingChar.race || 'Unknown Race'}\r\n          </div>\r\n        `;\r\n      } else {\r\n        slotCard.innerHTML = `\r\n          <div class=\"slot-header\">\r\n            <span class=\"slot-number\">Slot ${i}</span>\r\n            <span class=\"slot-badge empty\">Empty</span>\r\n          </div>\r\n          <div class=\"slot-info empty-text\">\r\n            Click to save character here\r\n          </div>\r\n        `;\r\n      }\r\n\r\n      // Add click handler\r\n      slotCard.addEventListener('click', () => handleSlotSelection(slotId, tab));\r\n\r\n      slotGrid.appendChild(slotCard);\r\n    }\r\n\r\n    // Show modal\r\n    modal.classList.remove('hidden');\r\n  }\r\n\r\n  /**\r\n   * Closes the slot selection modal\r\n   */\r\n  function closeSlotModal() {\r\n    const modal = document.getElementById('slotModal');\r\n    modal.classList.add('hidden');\r\n  }\r\n\r\n  /**\r\n   * Handles slot selection and performs sync\r\n   */\r\n  async function handleSlotSelection(slotId, tab) {\r\n    try {\r\n      // Close modal\r\n      closeSlotModal();\r\n\r\n      // Show syncing status\r\n      syncBtn.disabled = true;\r\n      syncBtn.textContent = '\u23F3 Syncing...';\r\n      statusIcon.textContent = '\u23F3';\r\n      statusText.textContent = 'Syncing from Dice Cloud...';\r\n\r\n      // Send message to content script to sync data with slot ID\r\n      const response = await browserAPI.tabs.sendMessage(tab.id, {\r\n        action: 'syncCharacter',\r\n        slotId: slotId\r\n      });\r\n\r\n      if (response && response.success) {\r\n        // Reload character data to display\r\n        await loadCharacterData();\r\n        showSuccess(`Character synced to ${slotId.replace('slot-', 'Slot ')}!`);\r\n      } else {\r\n        showError(response?.error || 'Failed to sync character data');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error syncing character:', error);\r\n      showError('Error: ' + error.message);\r\n    } finally {\r\n      syncBtn.disabled = false;\r\n      syncBtn.textContent = '\uD83D\uDD04 Sync from Dice Cloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles show sheet button click\r\n   * Opera-compatible with timeout handling\r\n   */\r\n  async function handleShowSheet() {\r\n    try {\r\n      showSheetBtn.disabled = true;\r\n      showSheetBtn.textContent = '\u23F3 Opening...';\r\n\r\n      // Get current tab\r\n      const [tab] = await browserAPI.tabs.query({ active: true, currentWindow: true });\r\n\r\n      // Check if we're on Roll20\r\n      if (!tab.url || !tab.url.includes('roll20.net')) {\r\n        showError('Please navigate to Roll20 first');\r\n        showSheetBtn.disabled = false;\r\n        showSheetBtn.textContent = '\uD83D\uDCCB Show Character Sheet';\r\n        return;\r\n      }\r\n\r\n      // Check if there's any synced character data (excluding GM player data)\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n      // Only count actual character slots, not rollcloudPlayer entries\r\n      const hasCharacters = Object.keys(profiles).some(key =>\r\n        profiles[key].type !== 'rollcloudPlayer'\r\n      );\r\n\r\n      if (!hasCharacters) {\r\n        // No character data - ask if user wants to go to GM mode\r\n        const userConfirmed = confirm('No character data found.\\n\\nWould you like to open GM mode instead?');\r\n\r\n        if (!userConfirmed) {\r\n          showSheetBtn.disabled = false;\r\n          showSheetBtn.textContent = '\uD83D\uDCCB Show Character Sheet';\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Send message to Roll20 content script to show sheet with timeout (Opera compatibility)\r\n      const messagePromise = browserAPI.tabs.sendMessage(tab.id, { action: 'showCharacterSheet' });\r\n      const timeoutPromise = new Promise((_, reject) =>\r\n        setTimeout(() => reject(new Error('Content script timeout - try refreshing Roll20 page')), 5000)\r\n      );\r\n\r\n      const response = await Promise.race([messagePromise, timeoutPromise]);\r\n\r\n      if (response && response.success) {\r\n        showSuccess('Character sheet opened!');\r\n      } else if (!hasCharacters) {\r\n        // If no characters, the GM mode was opened\r\n        showSuccess('GM mode opened!');\r\n      } else {\r\n        debug.error('Failed to open character sheet:', response);\r\n        showError('Failed to open character sheet');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error showing character sheet:', error);\r\n\r\n      // Provide helpful error message\r\n      if (error.message && error.message.includes('timeout')) {\r\n        showError('Roll20 content script not responding. Try refreshing the page.');\r\n      } else if (error.message && error.message.includes('not find')) {\r\n        showError('Roll20 content script not loaded. Try refreshing the page.');\r\n      } else {\r\n        showError('Error: ' + error.message);\r\n      }\r\n    } finally {\r\n      showSheetBtn.disabled = false;\r\n      showSheetBtn.textContent = '\uD83D\uDCCB Show Character Sheet';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggle settings menu dropdown\r\n   */\r\n  function toggleSettingsMenu(event) {\r\n    event.stopPropagation();\r\n    settingsMenu.classList.toggle('hidden');\r\n  }\r\n\r\n  /**\r\n   * Handles \"How to Use\" button click - opens welcome screen\r\n   */\r\n  function handleHowTo() {\r\n    // Open the welcome screen (options page)\r\n    if (typeof browser !== 'undefined' && browser.runtime && browser.runtime.openOptionsPage) {\r\n      browser.runtime.openOptionsPage();\r\n    } else if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.openOptionsPage) {\r\n      chrome.runtime.openOptionsPage();\r\n    } else {\r\n      // Fallback: try to open the welcome screen directly\r\n      const welcomeUrl = browserAPI.runtime.getURL('src/options/welcome.html');\r\n      browserAPI.tabs.create({ url: welcomeUrl });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles sync character to cloud button click\r\n   */\r\n  async function handleSyncCharacterToCloud() {\r\n    try {\r\n      syncCharacterToCloudBtn.disabled = true;\r\n      syncCharacterToCloudBtn.textContent = '\u23F3 Syncing...';\r\n\r\n      // Get currently selected character ID\r\n      const selectedId = characterSelect.value;\r\n\r\n      if (!selectedId) {\r\n        showError('No character selected');\r\n        return;\r\n      }\r\n\r\n      // Get character data\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n      let characterData = profiles[selectedId];\r\n\r\n      if (!characterData) {\r\n        showError('Character data not found');\r\n        return;\r\n      }\r\n\r\n      // For database profiles (db- prefix), extract full character data from _fullData.raw_dicecloud_data\r\n      // Database profiles only contain a summary at the top level, while the full data is nested\r\n      if (characterData.source === 'database' && characterData._fullData) {\r\n        const fullData = characterData._fullData.raw_dicecloud_data;\r\n        if (fullData && typeof fullData === 'object') {\r\n          debug.log('\uD83D\uDCE6 Using full character data from database raw_dicecloud_data');\r\n          // Merge the full data with metadata\r\n          characterData = {\r\n            ...fullData,\r\n            source: 'database',\r\n            lastUpdated: characterData.lastUpdated || characterData._fullData.updated_at\r\n          };\r\n        } else {\r\n          debug.warn('\u26A0\uFE0F Database profile missing raw_dicecloud_data, using summary only');\r\n        }\r\n      }\r\n\r\n      // Get DiceCloud user ID from login status\r\n      const loginStatus = await browserAPI.runtime.sendMessage({ action: 'checkLoginStatus' });\r\n      const dicecloudUserId = loginStatus.userId; // This is the DiceCloud Meteor ID\r\n\r\n      debug.log('\uD83C\uDFAD Syncing character to cloud:', {\r\n        characterId: selectedId,\r\n        characterName: characterData.name,\r\n        dicecloudUserId: dicecloudUserId\r\n      });\r\n\r\n      // Use background script's syncCharacterToCloud which has all the linking logic\r\n      const result = await browserAPI.runtime.sendMessage({\r\n        action: 'syncCharacterToCloud',\r\n        characterData: {\r\n          ...characterData,\r\n          id: selectedId,\r\n          dicecloudUserId: dicecloudUserId, // Include DiceCloud user ID\r\n          userId: dicecloudUserId // Also as userId for backwards compatibility\r\n        }\r\n      });\r\n\r\n      if (result.success) {\r\n        showSuccess('Character synced to cloud!');\r\n      } else {\r\n        showError('Cloud sync failed: ' + (result.error || 'Unknown error'));\r\n      }\r\n      \r\n      // If sync was successful, remove highlights and update Discord button\r\n      if (result && result.success) {\r\n        // Remove highlight effects from character selector and sync button\r\n        const characterSelector = document.getElementById('characterSelector');\r\n        const syncBtn = document.getElementById('syncBtn');\r\n        \r\n        if (characterSelector) {\r\n          characterSelector.style.border = '';\r\n          characterSelector.style.boxShadow = '';\r\n        }\r\n        \r\n        if (syncBtn) {\r\n          syncBtn.style.border = '';\r\n          syncBtn.style.boxShadow = '';\r\n        }\r\n        \r\n        // Update Discord button state\r\n        await showDiscordNotConnected();\r\n        \r\n        showSuccess('Character synced successfully! You can now set up Discord.');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error syncing character to cloud:', error);\r\n      showError('Cloud sync error: ' + error.message);\r\n    } finally {\r\n      syncCharacterToCloudBtn.disabled = false;\r\n      syncCharacterToCloudBtn.textContent = '\u2601\uFE0F Sync Character to Cloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles clear local data button click\r\n   */\r\n  async function handleClearLocal() {\r\n    try {\r\n      // Get currently selected character ID\r\n      const selectedId = characterSelect.value;\r\n      const characterName = charName.textContent || 'this character';\r\n\r\n      if (selectedId) {\r\n        if (!confirm(`Clear local data for ${characterName}?\\n\\nThis removes the character from this browser only. Cloud data will not be affected.`)) {\r\n          return;\r\n        }\r\n        clearLocalBtn.disabled = true;\r\n        await browserAPI.runtime.sendMessage({\r\n          action: 'clearCharacterData',\r\n          characterId: selectedId\r\n        });\r\n        showSuccess('Local character data cleared');\r\n      } else {\r\n        if (!confirm('Clear ALL local character data?\\n\\nThis removes all characters from this browser. Cloud data will not be affected.')) {\r\n          return;\r\n        }\r\n        clearLocalBtn.disabled = true;\r\n        await browserAPI.runtime.sendMessage({ action: 'clearCharacterData' });\r\n        showSuccess('All local character data cleared');\r\n      }\r\n\r\n      // Reload to update UI\r\n      await loadCharacterData();\r\n    } catch (error) {\r\n      debug.error('Error clearing local data:', error);\r\n      showError('Error clearing local data');\r\n    } finally {\r\n      if (clearLocalBtn) clearLocalBtn.disabled = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles clear cloud data button click\r\n   */\r\n  async function handleClearCloud() {\r\n    try {\r\n      // Get currently selected character ID\r\n      const selectedId = characterSelect.value;\r\n      const characterName = charName.textContent || 'this character';\r\n\r\n      if (!selectedId) {\r\n        showError('Please select a character to delete from cloud');\r\n        return;\r\n      }\r\n\r\n      if (!confirm(`\u26A0\uFE0F DELETE ${characterName} from cloud?\\n\\nThis permanently removes the character from cloud storage. This action cannot be undone!\\n\\nLocal data will also be removed.`)) {\r\n        return;\r\n      }\r\n\r\n      clearCloudBtn.disabled = true;\r\n      clearCloudBtn.textContent = '\u23F3 Deleting...';\r\n\r\n      // Delete from cloud first\r\n      await browserAPI.runtime.sendMessage({\r\n        action: 'deleteCharacterFromCloud',\r\n        characterId: selectedId\r\n      });\r\n\r\n      // Then clear local data\r\n      await browserAPI.runtime.sendMessage({\r\n        action: 'clearCharacterData',\r\n        characterId: selectedId\r\n      });\r\n\r\n      showSuccess('Character deleted from cloud and local storage');\r\n\r\n      // Reload to update UI\r\n      await loadCharacterData();\r\n    } catch (error) {\r\n      debug.error('Error clearing cloud data:', error);\r\n      showError('Error deleting from cloud: ' + error.message);\r\n    } finally {\r\n      if (clearCloudBtn) {\r\n        clearCloudBtn.disabled = false;\r\n        clearCloudBtn.textContent = '\u2601\uFE0F Clear Cloud Data';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles export button click - exports all characters to JSON file\r\n   */\r\n  async function handleExport() {\r\n    try {\r\n      exportBtn.disabled = true;\r\n      exportBtn.textContent = '\u23F3 Exporting...';\r\n\r\n      // Get all character profiles\r\n      const profilesResponse = await browserAPI.runtime.sendMessage({ action: 'getAllCharacterProfiles' });\r\n      const profiles = profilesResponse.success ? profilesResponse.profiles : {};\r\n\r\n      // Filter out non-character entries (like rollcloudPlayer)\r\n      const characterProfiles = {};\r\n      for (const [key, value] of Object.entries(profiles)) {\r\n        if (!key.startsWith('rollcloudPlayer')) {\r\n          characterProfiles[key] = value;\r\n        }\r\n      }\r\n\r\n      if (Object.keys(characterProfiles).length === 0) {\r\n        showError('No characters to export');\r\n        return;\r\n      }\r\n\r\n      // Create export data\r\n      const exportData = {\r\n        version: '1.0',\r\n        exportDate: new Date().toISOString(),\r\n        characters: characterProfiles\r\n      };\r\n\r\n      // Create and download JSON file\r\n      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });\r\n      const url = URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      a.download = `rollcloud-characters-${new Date().toISOString().split('T')[0]}.json`;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      URL.revokeObjectURL(url);\r\n\r\n      showSuccess(`Exported ${Object.keys(characterProfiles).length} character(s)`);\r\n    } catch (error) {\r\n      debug.error('Error exporting characters:', error);\r\n      showError('Error exporting: ' + error.message);\r\n    } finally {\r\n      exportBtn.disabled = false;\r\n      exportBtn.textContent = '\uD83D\uDCE4 Export Characters';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles import file selection - imports characters from JSON file\r\n   */\r\n  async function handleImport(event) {\r\n    const file = event.target.files[0];\r\n    if (!file) return;\r\n\r\n    try {\r\n      importBtn.disabled = true;\r\n      importBtn.textContent = '\u23F3 Importing...';\r\n\r\n      const text = await file.text();\r\n      const importData = JSON.parse(text);\r\n\r\n      // Validate import data\r\n      if (!importData.characters || typeof importData.characters !== 'object') {\r\n        showError('Invalid import file format');\r\n        return;\r\n      }\r\n\r\n      // Import each character\r\n      let importedCount = 0;\r\n      for (const [characterId, characterData] of Object.entries(importData.characters)) {\r\n        await browserAPI.runtime.sendMessage({\r\n          action: 'storeCharacterData',\r\n          data: characterData,\r\n          slotId: characterId\r\n        });\r\n        importedCount++;\r\n      }\r\n\r\n      // Reload character data\r\n      await loadCharacterData();\r\n      showSuccess(`Imported ${importedCount} character(s)`);\r\n    } catch (error) {\r\n      debug.error('Error importing characters:', error);\r\n      if (error instanceof SyntaxError) {\r\n        showError('Invalid JSON file');\r\n      } else {\r\n        showError('Error importing: ' + error.message);\r\n      }\r\n    } finally {\r\n      importBtn.disabled = false;\r\n      importBtn.textContent = '\uD83D\uDCE5 Import Characters';\r\n      // Reset file input so the same file can be selected again\r\n      event.target.value = '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles cloud sync button click - manually syncs token to Supabase\r\n   */\r\n  async function handleCloudSync() {\r\n    try {\r\n      cloudSyncBtn.disabled = true;\r\n      cloudSyncBtn.textContent = '\u23F3 Syncing...';\r\n\r\n      // Get current token from storage\r\n      const result = await browserAPI.storage.local.get(['diceCloudToken', 'username', 'tokenExpires', 'diceCloudUserId', 'authId']);\r\n\r\n      if (!result.diceCloudToken) {\r\n        showError('No token to sync. Please log in first.');\r\n        return;\r\n      }\r\n\r\n      // Check if Supabase is available\r\n      if (typeof SupabaseTokenManager === 'undefined') {\r\n        showError('Cloud sync not available');\r\n        return;\r\n      }\r\n\r\n      const supabaseManager = new SupabaseTokenManager();\r\n      debug.log('\uD83C\uDF10 Manual cloud sync - Browser ID:', supabaseManager.generateUserId());\r\n\r\n      const supabaseResult = await supabaseManager.storeToken({\r\n        token: result.diceCloudToken,\r\n        userId: result.diceCloudUserId,\r\n        tokenExpires: result.tokenExpires,\r\n        username: result.username || 'DiceCloud User',\r\n        authId: result.authId || result.diceCloudUserId\r\n      });\r\n\r\n      if (supabaseResult.success) {\r\n        showSuccess('Token synced to cloud!');\r\n      } else {\r\n        showError('Cloud sync failed: ' + (supabaseResult.error || 'Unknown error'));\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error syncing to cloud:', error);\r\n      showError('Cloud sync error: ' + error.message);\r\n    } finally {\r\n      cloudSyncBtn.disabled = false;\r\n      cloudSyncBtn.textContent = '\u2601\uFE0F Sync to Cloud';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows success message\r\n   */\r\n  function showSuccess(message) {\r\n    statusIcon.textContent = '\u2705';\r\n    statusText.textContent = message;\r\n    setTimeout(() => {\r\n      loadCharacterData();\r\n    }, 2000);\r\n  }\r\n\r\n  /**\r\n   * Shows error message\r\n   */\r\n  function showError(message) {\r\n    statusIcon.textContent = '\u274C';\r\n    statusText.textContent = message;\r\n    setTimeout(() => {\r\n      loadCharacterData();\r\n    }, 3000);\r\n  }\r\n\r\n  /**\r\n   * Loads the auto backwards sync state from storage\r\n   */\r\n  async function loadAutoBackwardsSyncState() {\r\n    try {\r\n      const result = await browserAPI.storage.local.get(['autoBackwardsSync']);\r\n      const isEnabled = result.autoBackwardsSync !== false; // Default to true\r\n\r\n      if (autoBackwardsSyncToggle) {\r\n        autoBackwardsSyncToggle.checked = isEnabled;\r\n      }\r\n\r\n      debug.log('Auto backwards sync state loaded:', isEnabled);\r\n    } catch (error) {\r\n      debug.error('Error loading auto backwards sync state:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles auto backwards sync toggle change\r\n   */\r\n  async function handleAutoBackwardsSyncToggle() {\r\n    try {\r\n      const isEnabled = autoBackwardsSyncToggle.checked;\r\n\r\n      // Save to storage\r\n      await browserAPI.storage.local.set({ autoBackwardsSync: isEnabled });\r\n\r\n      // Notify Roll20 content script to enable/disable sync\r\n      const tabs = await browserAPI.tabs.query({ url: '*://app.roll20.net/*' });\r\n      for (const tab of tabs) {\r\n        try {\r\n          await browserAPI.tabs.sendMessage(tab.id, {\r\n            action: 'setAutoBackwardsSync',\r\n            enabled: isEnabled\r\n          });\r\n          debug.log('Sent auto backwards sync state to Roll20 tab:', tab.id, isEnabled);\r\n        } catch (error) {\r\n          debug.log('Could not send message to tab:', tab.id, error.message);\r\n        }\r\n      }\r\n\r\n      debug.log('Auto backwards sync toggled:', isEnabled);\r\n\r\n      // Show feedback\r\n      const previousText = statusText.textContent;\r\n      const previousIcon = statusIcon.textContent;\r\n      statusIcon.textContent = '\u2705';\r\n      statusText.textContent = `Auto backwards sync ${isEnabled ? 'enabled' : 'disabled'}`;\r\n      setTimeout(() => {\r\n        statusIcon.textContent = previousIcon;\r\n        statusText.textContent = previousText;\r\n      }, 2000);\r\n    } catch (error) {\r\n      debug.error('Error toggling auto backwards sync:', error);\r\n      showError('Failed to toggle auto backwards sync');\r\n    }\r\n  }\r\n\r\n  // ============================================================================\r\n  // Discord Integration (Pip Bot Pairing)\r\n  // ============================================================================\r\n\r\n  let pairingPollInterval = null;\r\n  let pairingExpiresAt = null;\r\n\r\n  /**\r\n   * Load Discord connection state on popup open\r\n   */\r\n  async function loadDiscordConnectionState() {\r\n    try {\r\n      const response = await browserAPI.runtime.sendMessage({ action: 'getDiscordWebhook' });\r\n      if (response.success && response.webhookUrl) {\r\n        // Already connected\r\n        showDiscordConnected(response.serverName || 'Discord Server');\r\n      } else {\r\n        // Not connected - skip sync check on initial load to force resync after reinstall\r\n        showDiscordNotConnected(true);\r\n      }\r\n    } catch (error) {\r\n      debug.error('Error loading Discord state:', error);\r\n      // Skip sync check on initial load to force resync after reinstall\r\n      showDiscordNotConnected(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the \"not connected\" state\r\n   * @param {boolean} skipSessionCheck - If true, skip checking session match and always show \"Sync Account\"\r\n   */\r\n  async function showDiscordNotConnected(skipSessionCheck = false) {\r\n    const discordNotConnected = document.getElementById('discordNotConnected');\r\n    const discordPairing = document.getElementById('discordPairing');\r\n    const discordConnected = document.getElementById('discordConnected');\r\n\r\n    if (discordNotConnected) discordNotConnected.style.display = 'block';\r\n    if (discordPairing) discordPairing.style.display = 'none';\r\n    if (discordConnected) discordConnected.style.display = 'none';\r\n    \r\n    // Check if current session matches auth token session\r\n    // Skip session check on initial load to force resync after reinstall\r\n    try {\r\n      const setupBtn = document.getElementById('setupDiscordBtn');\r\n      \r\n      if (setupBtn) {\r\n        if (skipSessionCheck) {\r\n          // Always show \"Sync Account\" on initial load (fresh install)\r\n          setupBtn.textContent = '\uD83D\uDD04 Sync Account';\r\n          setupBtn.title = 'Sync your DiceCloud characters first, then set up Discord';\r\n          debug.log('\uD83D\uDCCB Initial load - forcing sync prompt');\r\n        } else {\r\n          const sessionMatches = await checkIfSessionMatches();\r\n          \r\n          if (sessionMatches) {\r\n            // User's session matches - show Discord setup\r\n            setupBtn.textContent = '\uD83C\uDFAE Setup Discord';\r\n            setupBtn.title = 'Connect RollCloud to Discord for bot commands';\r\n          } else {\r\n            // User's session doesn't match - show sync prompt\r\n            setupBtn.textContent = '\uD83D\uDD04 Sync Account';\r\n            setupBtn.title = 'Your session has changed. Please sync your DiceCloud characters first, then set up Discord';\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      debug.warn('Could not check session status for Discord button:', error);\r\n      // Fallback to default text\r\n      const setupBtn = document.getElementById('setupDiscordBtn');\r\n      if (setupBtn) {\r\n        setupBtn.textContent = '\uD83D\uDD04 Sync Account';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if the current session matches the auth token's session\r\n   * Simple validation - if sessions don't match, user needs to resync\r\n   */\r\n  async function checkIfSessionMatches() {\r\n    try {\r\n      // Get current session ID from local storage\r\n      const { currentSessionId } = await browserAPI.storage.local.get(['currentSessionId']);\r\n      \r\n      if (!currentSessionId) {\r\n        debug.log('\uD83D\uDCCB No current session ID - user needs to login');\r\n        return false;\r\n      }\r\n\r\n      // Get auth token from database to check its session\r\n      const supabaseManager = new SupabaseTokenManager();\r\n      const tokenCheck = await supabaseManager.getTokenFromDatabase();\r\n      \r\n      if (!tokenCheck.success || !tokenCheck.tokenData) {\r\n        debug.log('\uD83D\uDCCB No auth token found - user needs to login');\r\n        return false;\r\n      }\r\n\r\n      const tokenSessionId = tokenCheck.tokenData.session_id;\r\n      \r\n      if (!tokenSessionId) {\r\n        debug.log('\uD83D\uDCCB No session ID in auth token - user needs to resync');\r\n        return false;\r\n      }\r\n\r\n      // Simple check: do the session IDs match?\r\n      const sessionsMatch = currentSessionId === tokenSessionId;\r\n      \r\n      debug.log('\uD83D\uDCCB Session check:', {\r\n        current: currentSessionId,\r\n        token: tokenSessionId,\r\n        match: sessionsMatch\r\n      });\r\n\r\n      if (sessionsMatch) {\r\n        debug.log('\u2705 Sessions match - user is properly synced');\r\n        return true;\r\n      } else {\r\n        debug.log('\u26A0\uFE0F Sessions don\\'t match - user needs to resync');\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      debug.warn('Error checking session match:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show the \"pairing in progress\" state\r\n   */\r\n  function showDiscordPairing(code) {\r\n    document.getElementById('discordNotConnected').style.display = 'none';\r\n    document.getElementById('discordPairing').style.display = 'block';\r\n    document.getElementById('discordConnected').style.display = 'none';\r\n    document.getElementById('pairingCode').textContent = code;\r\n  }\r\n\r\n  /**\r\n   * Show the \"connected\" state\r\n   */\r\n  function showDiscordConnected(serverName) {\r\n    document.getElementById('discordNotConnected').style.display = 'none';\r\n    document.getElementById('discordPairing').style.display = 'none';\r\n    document.getElementById('discordConnected').style.display = 'block';\r\n    document.getElementById('discordServerName').textContent = serverName || 'Discord Server';\r\n  }\r\n\r\n  /**\r\n   * Generate a random 6-character pairing code\r\n   */\r\n  function generatePairingCode() {\r\n    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // No I, O, 0, 1\r\n    let code = '';\r\n    for (let i = 0; i < 6; i++) {\r\n      code += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return code;\r\n  }\r\n\r\n  /**\r\n   * Handle \"Setup Discord\" button click\r\n   */\r\n  async function handleSetupDiscord() {\r\n    try {\r\n      const setupBtn = document.getElementById('setupDiscordBtn');\r\n      setupBtn.disabled = true;\r\n      setupBtn.textContent = '\u23F3 Checking...';\r\n\r\n      // Check if user's session matches the auth token session\r\n      const sessionMatches = await checkIfSessionMatches();\r\n\r\n      if (!sessionMatches) {\r\n        // User's session doesn't match - sync current session to cloud\r\n        debug.log('\uD83D\uDCCB Session mismatch detected, syncing current session to cloud...');\r\n        showDiscordStatus('Syncing your account...', 'info');\r\n\r\n        try {\r\n          // Get current token from storage\r\n          const result = await browserAPI.storage.local.get(['diceCloudToken', 'username', 'tokenExpires', 'diceCloudUserId', 'authId']);\r\n\r\n          if (!result.diceCloudToken) {\r\n            showDiscordStatus('No active session found. Please log in first.', 'error');\r\n            setupBtn.disabled = false;\r\n            setupBtn.textContent = '\uD83D\uDD04 Sync Account';\r\n            return;\r\n          }\r\n\r\n          // Sync to cloud (override cloud session with current session)\r\n          const supabaseManager = new SupabaseTokenManager();\r\n          const supabaseResult = await supabaseManager.storeToken({\r\n            token: result.diceCloudToken,\r\n            userId: result.diceCloudUserId,\r\n            tokenExpires: result.tokenExpires,\r\n            username: result.username || 'DiceCloud User',\r\n            authId: result.authId || result.diceCloudUserId\r\n          });\r\n\r\n          if (!supabaseResult.success) {\r\n            showDiscordStatus('Failed to sync account: ' + (supabaseResult.error || 'Unknown error'), 'error');\r\n            setupBtn.disabled = false;\r\n            setupBtn.textContent = '\uD83D\uDD04 Sync Account';\r\n            return;\r\n          }\r\n\r\n          debug.log('\u2705 Session synced to cloud successfully');\r\n          showDiscordStatus('Account synced! Setting up Discord...', 'success');\r\n        } catch (syncError) {\r\n          debug.error('\u274C Failed to sync session:', syncError);\r\n          showDiscordStatus('Sync failed: ' + syncError.message, 'error');\r\n          setupBtn.disabled = false;\r\n          setupBtn.textContent = '\uD83D\uDD04 Sync Account';\r\n          return;\r\n        }\r\n      }\r\n\r\n      // User's session matches - proceed with Discord setup\r\n      setupBtn.textContent = '\u23F3 Setting up...';\r\n\r\n      // Check for installer-provided pairing code first\r\n      let code = null;\r\n      let installerProvided = false;\r\n\r\n      try {\r\n        // First, request fresh code from installer via native messaging\r\n        debug.log('\uD83D\uDD0D Requesting pairing code from installer...');\r\n        await browserAPI.runtime.sendMessage({ action: 'requestPairingCodeFromInstaller' });\r\n\r\n        // Small delay to allow native messaging response\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n\r\n        // Check if installer provided a code\r\n        const stored = await browserAPI.storage.local.get(['installerPairingCode']);\r\n        if (stored.installerPairingCode) {\r\n          code = stored.installerPairingCode;\r\n          installerProvided = true;\r\n          debug.log('\uD83D\uDCE5 Using installer-provided pairing code:', code);\r\n          // Clear the stored code so it's not reused\r\n          await browserAPI.storage.local.remove(['installerPairingCode']);\r\n        }\r\n      } catch (e) {\r\n        debug.warn('Could not check for installer pairing code:', e);\r\n      }\r\n\r\n      // If no installer code, generate one locally\r\n      if (!code) {\r\n        code = generatePairingCode();\r\n        debug.log('\uD83C\uDFB2 Generated local pairing code:', code);\r\n      }\r\n\r\n      // Get DiceCloud user info for pairing\r\n      let diceCloudUsername = 'Unknown';\r\n      let diceCloudUserId = null;\r\n      \r\n      try {\r\n        const loginStatus = await browserAPI.runtime.sendMessage({ action: 'checkLoginStatus' });\r\n        diceCloudUsername = loginStatus.username || 'Unknown';\r\n        diceCloudUserId = loginStatus.userId;\r\n      } catch (e) {\r\n        debug.warn('Could not get DiceCloud user info:', e);\r\n      }\r\n\r\n      // Store in Supabase (only if we generated locally - installer code already exists)\r\n      if (!installerProvided && diceCloudUserId) {\r\n        const storeResult = await browserAPI.runtime.sendMessage({\r\n          action: 'createDiscordPairing',\r\n          code: code,\r\n          username: diceCloudUsername,\r\n          diceCloudUserId: diceCloudUserId\r\n        });\r\n\r\n        if (!storeResult.success) {\r\n          throw new Error(storeResult.error || 'Failed to create pairing');\r\n        }\r\n      }\r\n\r\n      // Show pairing state with instructions\r\n      showDiscordPairing(code);\r\n\r\n      // Start polling for connection\r\n      pairingExpiresAt = Date.now() + 30 * 60 * 1000; // 30 minutes\r\n      startPairingPoll(code);\r\n\r\n    } catch (error) {\r\n      debug.error('Discord setup error:', error);\r\n      showDiscordStatus(`Setup failed: ${error.message}`, 'error');\r\n      showDiscordNotConnected();\r\n    } finally {\r\n      const setupBtn = document.getElementById('setupDiscordBtn');\r\n      if (setupBtn) {\r\n        setupBtn.disabled = false;\r\n        // Reset button text based on current session status\r\n        const sessionMatches = await checkIfSessionMatches();\r\n        if (sessionMatches) {\r\n          setupBtn.textContent = '\uD83C\uDFAE Setup Discord';\r\n        } else {\r\n          setupBtn.textContent = '\uD83D\uDD04 Sync Account';\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start polling Supabase for pairing completion\r\n   */\r\n  function startPairingPoll(code) {\r\n    // Update countdown display\r\n    const updateCountdown = () => {\r\n      const remaining = Math.max(0, Math.floor((pairingExpiresAt - Date.now()) / 1000));\r\n      const mins = Math.floor(remaining / 60);\r\n      const secs = remaining % 60;\r\n      const countdownEl = document.getElementById('pairingCountdown');\r\n      if (countdownEl) {\r\n        countdownEl.textContent = `(${mins}:${secs.toString().padStart(2, '0')})`;\r\n      }\r\n      if (remaining <= 0) {\r\n        handleCancelPairing();\r\n        showDiscordStatus('Pairing expired. Please try again.', 'error');\r\n      }\r\n    };\r\n\r\n    // Poll every 3 seconds\r\n    pairingPollInterval = setInterval(async () => {\r\n      updateCountdown();\r\n\r\n      try {\r\n        const result = await browserAPI.runtime.sendMessage({\r\n          action: 'checkDiscordPairing',\r\n          code: code\r\n        });\r\n\r\n        debug.log('\uD83D\uDCE5 Pairing check result:', {\r\n          success: result.success,\r\n          connected: result.connected,\r\n          hasWebhookUrl: !!result.webhookUrl,\r\n          webhookUrlPreview: result.webhookUrl ? `${result.webhookUrl.substring(0, 50)}...` : '(empty)',\r\n          serverName: result.serverName,\r\n          pairingId: result.pairingId\r\n        });\r\n\r\n        if (result.success && result.connected && result.webhookUrl) {\r\n          // Connected! Save webhook and update UI\r\n          clearInterval(pairingPollInterval);\r\n          pairingPollInterval = null;\r\n\r\n          debug.log('\uD83D\uDD17 Saving Discord webhook from pairing:', {\r\n            webhookUrl: result.webhookUrl ? `${result.webhookUrl.substring(0, 50)}...` : '(empty)',\r\n            serverName: result.serverName,\r\n            pairingId: result.pairingId\r\n          });\r\n\r\n          const setResult = await browserAPI.runtime.sendMessage({\r\n            action: 'setDiscordWebhook',\r\n            webhookUrl: result.webhookUrl,\r\n            enabled: true,\r\n            serverName: result.serverName,\r\n            pairingId: result.pairingId, // For command polling\r\n            discordUserId: result.discordUserId // Link to auth_tokens\r\n          });\r\n\r\n          debug.log('\uD83D\uDCDD setDiscordWebhook response:', setResult);\r\n\r\n          showDiscordConnected(result.serverName);\r\n          showDiscordStatus('Connected to Discord!', 'success');\r\n\r\n          // Re-sync character to cloud with the new Discord user ID\r\n          debug.log('\uD83D\uDD04 Re-syncing character to cloud with Discord user ID');\r\n          try {\r\n            await handleSyncCharacterToCloud();\r\n          } catch (e) {\r\n            debug.warn('Could not re-sync character after Discord link:', e);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        debug.error('Pairing poll error:', error);\r\n      }\r\n    }, 3000);\r\n\r\n    // Initial countdown update\r\n    updateCountdown();\r\n  }\r\n\r\n  /**\r\n   * Handle cancel pairing button\r\n   */\r\n  function handleCancelPairing() {\r\n    if (pairingPollInterval) {\r\n      clearInterval(pairingPollInterval);\r\n      pairingPollInterval = null;\r\n    }\r\n    showDiscordNotConnected();\r\n  }\r\n\r\n  /**\r\n   * Handle disconnect Discord button\r\n   */\r\n  async function handleDisconnectDiscord() {\r\n    try {\r\n      await browserAPI.runtime.sendMessage({\r\n        action: 'setDiscordWebhook',\r\n        webhookUrl: '',\r\n        enabled: false\r\n      });\r\n      showDiscordNotConnected();\r\n      showDiscordStatus('Disconnected from Discord', 'success');\r\n    } catch (error) {\r\n      debug.error('Disconnect error:', error);\r\n      showDiscordStatus(`Error: ${error.message}`, 'error');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles testing the Discord webhook\r\n   */\r\n  async function handleTestDiscordWebhook() {\r\n    const testBtn = document.getElementById('testDiscordWebhook');\r\n\r\n    try {\r\n      testBtn.disabled = true;\r\n      testBtn.textContent = '\u23F3 Testing...';\r\n\r\n      const response = await browserAPI.runtime.sendMessage({\r\n        action: 'testDiscordWebhook'\r\n      });\r\n\r\n      if (response.success) {\r\n        showDiscordStatus('Test sent! Check Discord.', 'success');\r\n      } else {\r\n        showDiscordStatus(`Test failed: ${response.error}`, 'error');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Discord test error:', error);\r\n      showDiscordStatus(`Error: ${error.message}`, 'error');\r\n    } finally {\r\n      testBtn.disabled = false;\r\n      testBtn.textContent = '\uD83E\uDDEA Test';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles saving manual webhook URL\r\n   */\r\n  async function handleSaveDiscordWebhook() {\r\n    const webhookUrl = document.getElementById('discordWebhookUrl').value.trim();\r\n    const saveBtn = document.getElementById('saveDiscordWebhook');\r\n\r\n    if (!webhookUrl) {\r\n      showDiscordStatus('Please enter a webhook URL', 'error');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      saveBtn.disabled = true;\r\n      saveBtn.textContent = '\u23F3 Saving...';\r\n\r\n      await browserAPI.runtime.sendMessage({\r\n        action: 'setDiscordWebhook',\r\n        webhookUrl: webhookUrl,\r\n        enabled: true\r\n      });\r\n\r\n      showDiscordConnected('Manual Webhook');\r\n      showDiscordStatus('Webhook saved!', 'success');\r\n    } catch (error) {\r\n      debug.error('Save webhook error:', error);\r\n      showDiscordStatus(`Error: ${error.message}`, 'error');\r\n    } finally {\r\n      saveBtn.disabled = false;\r\n      saveBtn.textContent = '\uD83D\uDCBE Save Webhook URL';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles checking Discord integration for current character\r\n   */\r\n  async function handleCheckDiscordIntegration() {\r\n    // Get the button that was clicked (could be either connected or not connected state)\r\n    const checkBtn = document.getElementById('checkDiscordIntegration') || document.getElementById('checkDiscordIntegrationNotConnected');\r\n    \r\n    if (!checkBtn) {\r\n      debug.error('Check Discord integration button not found');\r\n      showDiscordStatus('Error: Button not found', 'error');\r\n      return;\r\n    }\r\n\r\n    const originalText = checkBtn.textContent;\r\n\r\n    try {\r\n      checkBtn.disabled = true;\r\n      checkBtn.textContent = '\u23F3 Checking...';\r\n\r\n      // Get current character data from local storage first\r\n      const result = await browserAPI.storage.local.get(['activeCharacterId', 'characterProfiles', 'diceCloudUserId']);\r\n      const activeCharacterId = result.activeCharacterId;\r\n      const characterProfiles = result.characterProfiles || {};\r\n\r\n      let currentCharacter = null;\r\n\r\n      // First try local storage\r\n      if (activeCharacterId && characterProfiles[activeCharacterId]) {\r\n        currentCharacter = characterProfiles[activeCharacterId];\r\n        debug.log('\uD83D\uDD0D Found active character in local storage:', currentCharacter.name);\r\n      }\r\n\r\n      // If no local character, try to get active character from Supabase\r\n      if (!currentCharacter) {\r\n        debug.log('\uD83D\uDCCB No local active character, checking Supabase...');\r\n        const supabaseManager = new SupabaseTokenManager();\r\n        const userId = await supabaseManager.getOrCreatePersistentUserId();\r\n\r\n        // Get auth token to find Discord user ID\r\n        const tokenResult = await supabaseManager.getTokenFromDatabase();\r\n        if (tokenResult.success && tokenResult.tokenData) {\r\n          const discordUserId = tokenResult.tokenData.discord_user_id;\r\n          const dicecloudUserId = tokenResult.tokenData.user_id_dicecloud || result.diceCloudUserId;\r\n\r\n          if (discordUserId || dicecloudUserId) {\r\n            // Query Supabase for active character\r\n            let charQuery = discordUserId\r\n              ? `discord_user_id=eq.${discordUserId}&is_active=eq.true`\r\n              : `user_id_dicecloud=eq.${dicecloudUserId}&is_active=eq.true`;\r\n\r\n            const charResponse = await fetch(\r\n              `${supabaseManager.supabaseUrl}/rest/v1/rollcloud_characters?${charQuery}&select=*&limit=1`,\r\n              {\r\n                headers: {\r\n                  'apikey': supabaseManager.supabaseKey,\r\n                  'Authorization': `Bearer ${supabaseManager.supabaseKey}`\r\n                }\r\n              }\r\n            );\r\n\r\n            if (charResponse.ok) {\r\n              const characters = await charResponse.json();\r\n              if (characters.length > 0) {\r\n                const dbChar = characters[0];\r\n                currentCharacter = {\r\n                  name: dbChar.character_name,\r\n                  id: dbChar.dicecloud_character_id,\r\n                  level: dbChar.level,\r\n                  class: dbChar.class,\r\n                  race: dbChar.race\r\n                };\r\n                debug.log('\uD83D\uDD0D Found active character in Supabase:', currentCharacter.name);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!currentCharacter) {\r\n        showDiscordStatus('No active character found. Set one with /character in Discord or open a character on DiceCloud.', 'error');\r\n        return;\r\n      }\r\n\r\n      debug.log('\uD83D\uDD0D Checking Discord integration for character:', currentCharacter.name);\r\n\r\n      // Send message to background script to check Discord integration\r\n      const response = await browserAPI.runtime.sendMessage({\r\n        action: 'checkDiscordCharacterIntegration',\r\n        characterName: currentCharacter.name,\r\n        characterId: currentCharacter.id\r\n      });\r\n\r\n      if (response.success) {\r\n        if (response.found) {\r\n          showDiscordStatus(`\u2705 ${currentCharacter.name} is active in Discord server: ${response.serverName}`, 'success');\r\n        } else {\r\n          let message = `\u274C ${currentCharacter.name} is not currently active in any Discord server`;\r\n          \r\n          if (response.message === 'Discord integration not configured') {\r\n            message = `\u274C Discord integration not configured. Please set up Discord integration first.`;\r\n          } else if (response.availableCharacter && response.availableCharacter.name !== currentCharacter.name) {\r\n            message = `\u274C ${currentCharacter.name} is not active. Currently active: ${response.availableCharacter.name} (Level ${response.availableCharacter.level} ${response.availableCharacter.race} ${response.availableCharacter.class})`;\r\n          }\r\n          \r\n          showDiscordStatus(message, 'warning');\r\n        }\r\n      } else {\r\n        showDiscordStatus(`Error checking integration: ${response.error}`, 'error');\r\n      }\r\n    } catch (error) {\r\n      debug.error('Check Discord integration error:', error);\r\n      showDiscordStatus(`Error: ${error.message}`, 'error');\r\n    } finally {\r\n      if (checkBtn) {\r\n        checkBtn.disabled = false;\r\n        checkBtn.textContent = originalText;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows Discord status message\r\n   */\r\n  function showDiscordStatus(message, type) {\r\n    const statusDiv = document.getElementById('discordStatus');\r\n    if (statusDiv) {\r\n      statusDiv.style.display = 'block';\r\n      statusDiv.textContent = message;\r\n      statusDiv.style.color = type === 'success' ? '#c2185b' : '#e74c3c';\r\n\r\n      setTimeout(() => {\r\n        statusDiv.style.display = 'none';\r\n      }, 3000);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks if this is an experimental build and updates UI accordingly\r\n   */\r\n  function checkExperimentalBuild() {\r\n    // Check for experimental build indicators\r\n    // Only explicit indicators - manifest name or version suffix\r\n    const experimentalIndicators = [\r\n      () => {\r\n        try {\r\n          const manifest = browserAPI.runtime.getManifest();\r\n          return manifest && manifest.name && manifest.name.includes('Experimental');\r\n        } catch (e) {\r\n          debug.log('\uD83D\uDD0D Could not check manifest name:', e);\r\n          return false;\r\n        }\r\n      },\r\n      () => {\r\n        try {\r\n          const manifest = browserAPI.runtime.getManifest();\r\n          // Only mark as experimental if version has 4 parts ending in .1 (e.g., 1.2.2.1)\r\n          const version = manifest && manifest.version;\r\n          if (!version) return false;\r\n          const parts = version.split('.');\r\n          return parts.length === 4 && parts[3] === '1';\r\n        } catch (e) {\r\n          debug.log('\uD83D\uDD0D Could not check manifest version:', e);\r\n          return false;\r\n        }\r\n      }\r\n    ];\r\n\r\n    // Check if any indicator returns true (using Promise.all for compatibility)\r\n    Promise.all(experimentalIndicators.map(check => \r\n      Promise.resolve(check()).catch(() => false)\r\n    )).then(results => {\r\n      const isExperimental = results.some(result => result === true);\r\n      \r\n      if (isExperimental) {\r\n        const experimentalNotice = document.getElementById('experimentalNotice');\r\n        const versionDisplay = document.getElementById('versionDisplay');\r\n        const experimentalInstructions = document.getElementById('experimentalInstructions');\r\n        \r\n        if (experimentalNotice) {\r\n          experimentalNotice.classList.remove('hidden');\r\n        }\r\n        \r\n        if (versionDisplay) {\r\n          try {\r\n            const manifest = browserAPI.runtime.getManifest();\r\n            versionDisplay.textContent = `v${manifest.version} - Experimental Sync`;\r\n          } catch (e) {\r\n            versionDisplay.textContent = 'Experimental Sync';\r\n          }\r\n        }\r\n        \r\n        if (experimentalInstructions) {\r\n          experimentalInstructions.classList.remove('hidden');\r\n        }\r\n        \r\n        debug.log('\uD83E\uDDEA Experimental build detected');\r\n      } else {\r\n        debug.log('\uD83D\uDCE6 Standard build detected');\r\n      }\r\n    }).catch(error => {\r\n      debug.log('\uD83D\uDD0D Error checking experimental build:', error);\r\n      debug.log('\uD83D\uDCE6 Assuming standard build');\r\n    });\r\n  }\r\n} // End initializePopup\r\n}); // End DOMContentLoaded\r\n", "/**\r\n * RollCloud Adapter\r\n * Roll20 integration for CarmaClouds\r\n * Loads the full RollCloud popup UI\r\n */\r\n\r\nexport async function init(containerEl) {\r\n  console.log('Initializing RollCloud adapter...');\r\n\r\n  try {\r\n    // Fetch the RollCloud popup HTML\r\n    const htmlPath = chrome.runtime.getURL('src/popup/adapters/rollcloud/popup.html');\r\n    const response = await fetch(htmlPath);\r\n    const html = await response.text();\r\n\r\n    // Extract only the main content (not the full HTML document with header/footer)\r\n    const parser = new DOMParser();\r\n    const doc = parser.parseFromString(html, 'text/html');\r\n    const mainContent = doc.querySelector('main');\r\n\r\n    // Wrap content in a scoped container to prevent CSS conflicts\r\n    const wrapper = document.createElement('div');\r\n    wrapper.className = 'rollcloud-adapter-scope';\r\n    wrapper.innerHTML = mainContent ? mainContent.innerHTML : doc.body.innerHTML;\r\n    containerEl.innerHTML = '';\r\n    containerEl.appendChild(wrapper);\r\n\r\n    // Load and inject the CSS with scoping\r\n    const cssPath = chrome.runtime.getURL('src/popup/adapters/rollcloud/popup.css');\r\n    const cssResponse = await fetch(cssPath);\r\n    let css = await cssResponse.text();\r\n\r\n    // Scope all CSS rules to the adapter container\r\n    css = css.replace(/(^|\\})\\s*([^{}@]+)\\s*\\{/gm, (match, closer, selector) => {\r\n      // Don't scope @media, @keyframes, etc.\r\n      if (selector.trim().startsWith('@')) return match;\r\n      // Scope the selector\r\n      const scopedSelector = selector.split(',').map(s => `.rollcloud-adapter-scope ${s.trim()}`).join(', ');\r\n      return `${closer} ${scopedSelector} {`;\r\n    });\r\n\r\n    const style = document.createElement('style');\r\n    style.textContent = css;\r\n    containerEl.appendChild(style);\r\n\r\n    // Import and initialize the RollCloud popup logic\r\n    const { default: initRollCloud } = await import('./rollcloud-popup.js');\r\n    if (typeof initRollCloud === 'function') {\r\n      initRollCloud();\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Failed to load RollCloud UI:', error);\r\n    containerEl.innerHTML = `\r\n      <div class=\"error\">\r\n        <strong>Failed to load RollCloud</strong>\r\n        <p>${error.message}</p>\r\n      </div>\r\n    `;\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": ["browserAPI", "response", "characterSelector", "syncBtn"]
}
