{
  "version": 3,
  "sources": ["../../../src/content/character-sheet-overlay.js"],
  "sourcesContent": ["/**\r\n * Custom Character Sheet Overlay for Roll20\r\n * Displays Dice Cloud character data in a beautiful, interactive overlay\r\n */\r\n\r\n// Initialize debug and browserAPI globals\r\nif (typeof window !== 'undefined' && !window.debug) {\r\n  window.debug = {\r\n    log: console.log.bind(console),\r\n    warn: console.warn.bind(console),\r\n    error: console.error.bind(console),\r\n    info: console.info.bind(console),\r\n    group: console.group.bind(console),\r\n    groupEnd: console.groupEnd.bind(console),\r\n    table: console.table.bind(console),\r\n    time: console.time.bind(console),\r\n    timeEnd: console.timeEnd.bind(console),\r\n    isEnabled: () => true\r\n  };\r\n}\r\nconst debug = window.debug;\r\n// Make browserAPI available both as const and on window for functions that need it\r\nconst browserAPI = typeof chrome !== 'undefined' ? chrome : (typeof browser !== 'undefined' ? browser : {});\r\nwindow.browserAPI = browserAPI;\r\n\r\n(function() {\r\n  'use strict';\r\n\r\n  debug.log('\uD83C\uDFB2 RollCloud: Custom sheet overlay loaded');\r\n\r\n  let characterData = null;\r\n  let overlayVisible = false;\r\n  let overlayElement = null;\r\n  let activePopupWindow = null; // Track the currently open popup to ensure only one at a time\r\n\r\n  // Standardized DiceCloud variable names\r\n  const STANDARD_VARS = {\r\n    abilities: ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma'],\r\n    abilityMods: ['strengthMod', 'dexterityMod', 'constitutionMod', 'intelligenceMod', 'wisdomMod', 'charismaMod'],\r\n    saves: ['strengthSave', 'dexteritySave', 'constitutionSave', 'intelligenceSave', 'wisdomSave', 'charismaSave'],\r\n    skills: [\r\n      'acrobatics', 'animalHandling', 'arcana', 'athletics', 'deception', 'history',\r\n      'insight', 'intimidation', 'investigation', 'medicine', 'nature', 'perception',\r\n      'performance', 'persuasion', 'religion', 'sleightOfHand', 'stealth', 'survival'\r\n    ],\r\n    combat: ['armorClass', 'hitPoints', 'speed', 'initiative', 'proficiencyBonus']\r\n  };\r\n\r\n  /**\r\n   * Parse raw DiceCloud data into Roll20-specific format\r\n   * Inlined from dicecloud-extraction.js to avoid module loading issues\r\n   */\r\n  function parseForRollCloud(rawData) {\r\n    if (!rawData || !rawData.creature || !rawData.variables || !rawData.properties) {\r\n      throw new Error('Invalid raw data format');\r\n    }\r\n\r\n    const { creature, variables, properties } = rawData;\r\n\r\n    // Extract race, class, level\r\n    let race = 'Unknown';\r\n    let characterClass = '';\r\n    let level = 0;\r\n    const uniqueClasses = new Set();\r\n    let raceFound = false;\r\n\r\n    for (const prop of properties) {\r\n      if (!prop) continue;\r\n\r\n      // Check for race as a folder (DiceCloud often stores races as folders)\r\n      if (!raceFound && prop.type === 'folder' && prop.name) {\r\n        const commonRaces = ['human', 'elf', 'dwarf', 'halfling', 'gnome', 'half-elf', 'half-orc', 'dragonborn', 'tiefling', 'orc', 'goblin', 'kobold', 'warforged', 'tabaxi', 'kenku', 'aarakocra', 'genasi', 'aasimar', 'firbolg', 'goliath', 'triton', 'yuan-ti', 'tortle', 'lizardfolk', 'bugbear', 'hobgoblin', 'changeling', 'shifter', 'kalashtar'];\r\n        const nameMatchesRace = commonRaces.some(r => prop.name.toLowerCase().includes(r));\r\n        if (nameMatchesRace) {\r\n          const parentDepth = prop.ancestors ? prop.ancestors.length : 0;\r\n          if (parentDepth <= 2) {\r\n            race = prop.name;\r\n            raceFound = true;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Check for race property types\r\n      if (!raceFound && (prop.type === 'race' || prop.type === 'species' || prop.type === 'characterRace')) {\r\n        if (prop.name) {\r\n          race = prop.name;\r\n          raceFound = true;\r\n        }\r\n      }\r\n\r\n      // DiceCloud v2 stores race as a constant\r\n      if (!raceFound && prop.type === 'constant' && prop.name && prop.name.toLowerCase() === 'race') {\r\n        if (prop.value) {\r\n          race = prop.value;\r\n          raceFound = true;\r\n        }\r\n      }\r\n\r\n      if (prop.type === 'class' && prop.name && !prop.inactive && !prop.disabled) {\r\n        const cleanName = prop.name.replace(/\\s*\\[Multiclass\\]/i, '').trim();\r\n        const normalizedClassName = cleanName.toLowerCase().trim();\r\n        if (!uniqueClasses.has(normalizedClassName)) {\r\n          uniqueClasses.add(normalizedClassName);\r\n          characterClass = characterClass ? `${characterClass} / ${cleanName}` : cleanName;\r\n        }\r\n      }\r\n\r\n      if (prop.type === 'classLevel' && !prop.inactive && !prop.disabled) {\r\n        level += 1;\r\n      }\r\n    }\r\n\r\n    // Fallback: Check for race in variables if not found in properties\r\n    if (!raceFound && (!race || race === 'Unknown')) {\r\n      const raceVars = Object.keys(variables).filter(key =>\r\n        key.toLowerCase().includes('race') || key.toLowerCase().includes('species')\r\n      );\r\n\r\n      if (raceVars.length > 0) {\r\n        const formatRaceName = (name) => {\r\n          if (!name) return null;\r\n          if (name.toLowerCase() === 'custom' || name.toLowerCase() === 'customlineage') {\r\n            return 'Custom Lineage';\r\n          }\r\n          let formatted = name.replace(/([a-z])([A-Z])/g, '$1 $2');\r\n          formatted = formatted.split(' ').map(word =>\r\n            word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()\r\n          ).join(' ');\r\n          return formatted;\r\n        };\r\n\r\n        let raceName = null;\r\n        let subraceName = null;\r\n\r\n        // Check for subRace first\r\n        const subRaceVar = raceVars.find(key => key.toLowerCase() === 'subrace');\r\n        if (subRaceVar) {\r\n          const subRaceValue = variables[subRaceVar];\r\n          if (typeof subRaceValue === 'object' && subRaceValue !== null) {\r\n            if (subRaceValue.name) {\r\n              subraceName = formatRaceName(subRaceValue.name);\r\n            } else if (subRaceValue.text) {\r\n              subraceName = formatRaceName(subRaceValue.text);\r\n            } else if (subRaceValue.value) {\r\n              subraceName = formatRaceName(subRaceValue.value);\r\n            }\r\n          } else if (typeof subRaceValue === 'string') {\r\n            subraceName = formatRaceName(subRaceValue);\r\n          }\r\n        }\r\n\r\n        // Check for race variable\r\n        const raceVar = raceVars.find(key => key.toLowerCase() === 'race');\r\n        if (raceVar) {\r\n          const raceValue = variables[raceVar];\r\n          if (typeof raceValue === 'object' && raceValue !== null) {\r\n            if (raceValue.value && typeof raceValue.value === 'object' && raceValue.value.value) {\r\n              raceName = formatRaceName(raceValue.value.value);\r\n            } else if (raceValue.value && typeof raceValue.value === 'string') {\r\n              raceName = formatRaceName(raceValue.value);\r\n            } else if (raceValue.name) {\r\n              raceName = formatRaceName(raceValue.name);\r\n            } else if (raceValue.text) {\r\n              raceName = formatRaceName(raceValue.text);\r\n            }\r\n          } else if (typeof raceValue === 'string') {\r\n            raceName = formatRaceName(raceValue);\r\n          }\r\n        }\r\n\r\n        // Combine race and subrace if we have both\r\n        if (raceName && subraceName) {\r\n          race = `${raceName} - ${subraceName}`;\r\n        } else if (subraceName) {\r\n          race = subraceName;\r\n        } else if (raceName) {\r\n          race = raceName;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Build attributes\r\n    const attributes = {};\r\n    STANDARD_VARS.abilities.forEach(ability => {\r\n      attributes[ability] = variables[ability]?.total || variables[ability]?.value || 10;\r\n    });\r\n\r\n    // Calculate modifiers\r\n    const attributeMods = {};\r\n    Object.keys(attributes).forEach(attr => {\r\n      attributeMods[attr] = Math.floor((attributes[attr] - 10) / 2);\r\n    });\r\n\r\n    // Extract saves\r\n    const saves = {};\r\n    STANDARD_VARS.saves.forEach(save => {\r\n      if (variables[save]) {\r\n        const abilityName = save.replace('Save', '');\r\n        saves[abilityName] = variables[save].total || variables[save].value || 0;\r\n      }\r\n    });\r\n\r\n    // Extract skills\r\n    const skills = {};\r\n    STANDARD_VARS.skills.forEach(skill => {\r\n      if (variables[skill]) {\r\n        skills[skill] = variables[skill].total || variables[skill].value || 0;\r\n      }\r\n    });\r\n\r\n    // Calculate AC\r\n    const calculateAC = () => {\r\n      const extractNumeric = (val) => {\r\n        if (val === null || val === undefined) return null;\r\n        if (typeof val === 'number' && !isNaN(val)) return val;\r\n        if (typeof val === 'string') {\r\n          const parsed = parseFloat(val);\r\n          return isNaN(parsed) ? null : parsed;\r\n        }\r\n        if (typeof val === 'object') {\r\n          if (val.total !== undefined && typeof val.total === 'number') return val.total;\r\n          if (val.value !== undefined && typeof val.value === 'number') return val.value;\r\n        }\r\n        return null;\r\n      };\r\n\r\n      if (variables.armorClass?.total || variables.armorClass?.value) {\r\n        return variables.armorClass.total || variables.armorClass.value;\r\n      }\r\n\r\n      if (creature.denormalizedStats) {\r\n        const tryKeys = ['armorClass', 'ac', 'armor'];\r\n        for (const k of tryKeys) {\r\n          if (creature.denormalizedStats.hasOwnProperty(k)) {\r\n            const num = extractNumeric(creature.denormalizedStats[k]);\r\n            if (num !== null) return num;\r\n          }\r\n        }\r\n      }\r\n\r\n      const varNamesToCheck = ['armor', 'armorClass', 'armor_class', 'ac', 'acTotal'];\r\n      for (const vn of varNamesToCheck) {\r\n        if (variables.hasOwnProperty(vn)) {\r\n          const candidate = extractNumeric(variables[vn]?.total ?? variables[vn]?.value ?? variables[vn]);\r\n          if (candidate !== null) return candidate;\r\n        }\r\n      }\r\n\r\n      let baseAC = 10;\r\n      let armorAC = null;\r\n      const acBonuses = [];\r\n\r\n      properties.forEach(prop => {\r\n        if (prop.inactive || prop.disabled) return;\r\n\r\n        const hasArmorStat = prop.stat === 'armor' || (Array.isArray(prop.stats) && prop.stats.includes('armor'));\r\n\r\n        if (hasArmorStat) {\r\n          let amount = typeof prop.amount === 'number' ? prop.amount : parseFloat(prop.amount);\r\n          if (!isNaN(amount)) {\r\n            const operation = prop.operation || '';\r\n            if (operation === 'base' || operation === 'Base value') {\r\n              if (armorAC === null || amount > armorAC) armorAC = amount;\r\n            } else if (operation === 'add' || operation === 'Add') {\r\n              acBonuses.push({ name: prop.name, amount });\r\n            }\r\n          }\r\n        }\r\n      });\r\n\r\n      let finalAC = armorAC !== null ? armorAC : baseAC;\r\n      acBonuses.forEach(bonus => finalAC += bonus.amount);\r\n      return finalAC;\r\n    };\r\n\r\n    // Extract spells and actions from properties\r\n    const spells = [];\r\n    const actions = [];\r\n\r\n    properties.forEach(prop => {\r\n      if (!prop || prop.inactive || prop.disabled) return;\r\n\r\n      // Extract spells\r\n      if (prop.type === 'spell') {\r\n        spells.push({\r\n          _id: prop._id,\r\n          name: prop.name || 'Unnamed Spell',\r\n          description: prop.description || '',\r\n          level: prop.level || 0,\r\n          castingTime: prop.castingTime || '1 action',\r\n          range: prop.range || 'Self',\r\n          duration: prop.duration || 'Instantaneous',\r\n          components: prop.components || '',\r\n          ritual: prop.ritual || false,\r\n          concentration: prop.concentration || false,\r\n          prepared: prop.prepared !== false, // Default to true\r\n          alwaysPrepared: prop.alwaysPrepared || false,\r\n          damage: prop.damage || '',\r\n          attackRoll: prop.attackRoll || '',\r\n          savingThrow: prop.savingThrow || '',\r\n          uses: prop.uses || null,\r\n          usesUsed: prop.usesUsed || 0,\r\n          reset: prop.reset || '',\r\n        });\r\n      }\r\n\r\n      // Extract actions (attacks, features, etc.)\r\n      if (['action', 'attack', 'feature', 'classFeature'].includes(prop.type)) {\r\n        actions.push({\r\n          _id: prop._id,\r\n          name: prop.name || 'Unnamed Action',\r\n          description: prop.description || '',\r\n          type: prop.type,\r\n          actionType: prop.actionType || 'action',\r\n          damage: prop.damage || '',\r\n          attackRoll: prop.attackRoll || '',\r\n          savingThrow: prop.savingThrow || '',\r\n          uses: prop.uses || null,\r\n          usesUsed: prop.usesUsed || 0,\r\n          reset: prop.reset || '',\r\n          range: prop.range || '',\r\n          resources: prop.resources || null,\r\n        });\r\n      }\r\n    });\r\n\r\n    return {\r\n      race,\r\n      class: characterClass || 'Unknown',\r\n      level,\r\n      background: '',\r\n      alignment: creature.alignment || '',\r\n      attributes,\r\n      attributeMods,\r\n      saves,\r\n      skills,\r\n      hitPoints: {\r\n        current: variables.hitPoints?.currentValue ?? variables.hitPoints?.value ?? 0,\r\n        max: variables.hitPoints?.total ?? variables.hitPoints?.max ?? 0\r\n      },\r\n      temporaryHP: variables.temporaryHitPoints?.value ?? variables.temporaryHitPoints?.currentValue ?? 0,\r\n      armorClass: calculateAC(),\r\n      speed: variables.speed?.total || variables.speed?.value || 30,\r\n      initiative: variables.initiative?.total || variables.initiative?.value || 0,\r\n      proficiencyBonus: variables.proficiencyBonus?.total || variables.proficiencyBonus?.value || 0,\r\n      spells: spells,\r\n      actions: actions\r\n    };\r\n  }\r\n\r\n  // Roll statistics and history\r\n  const rollStats = {\r\n    history: [],\r\n    settings: {\r\n      enabled: true,\r\n      showNotifications: true,\r\n      showHistory: true,\r\n      maxHistorySize: 20,\r\n      advantageMode: 'normal' // 'normal', 'advantage', 'disadvantage'\r\n    },\r\n    stats: {\r\n      totalRolls: 0,\r\n      averageRoll: 0,\r\n      highestRoll: 0,\r\n      lowestRoll: Infinity,\r\n      criticalSuccesses: 0,\r\n      criticalFailures: 0\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Utility function to position popup within viewport bounds\r\n   * Cached viewport dimensions to avoid forced reflows\r\n   * @param {number} x - Initial X position (clientX)\r\n   * @param {number} y - Initial Y position (clientY)\r\n   * @param {number} width - Popup width (default: 200)\r\n   * @param {number} height - Popup height (default: 150)\r\n   * @returns {Object} - Adjusted x, y coordinates within viewport\r\n   */\r\n  const viewportCache = { width: 0, height: 0, lastUpdate: 0 };\r\n  function getPopupPosition(x, y, width = 200, height = 150) {\r\n    // Cache viewport dimensions for 100ms to avoid repeated layout reads\r\n    const now = Date.now();\r\n    if (now - viewportCache.lastUpdate > 100) {\r\n      viewportCache.width = window.innerWidth;\r\n      viewportCache.height = window.innerHeight;\r\n      viewportCache.lastUpdate = now;\r\n    }\r\n\r\n    const viewportWidth = viewportCache.width;\r\n    const viewportHeight = viewportCache.height;\r\n\r\n    // Adjust horizontal position\r\n    let adjustedX = x;\r\n    if (x + width > viewportWidth) {\r\n      adjustedX = viewportWidth - width - 10; // 10px margin from edge\r\n      if (adjustedX < 10) adjustedX = 10; // Ensure minimum margin from left edge\r\n    }\r\n\r\n    // Adjust vertical position\r\n    let adjustedY = y;\r\n    if (y + height > viewportHeight) {\r\n      adjustedY = viewportHeight - height - 10; // 10px margin from edge\r\n      if (adjustedY < 10) adjustedY = 10; // Ensure minimum margin from top edge\r\n    }\r\n\r\n    return { x: adjustedX, y: adjustedY };\r\n  }\r\n\r\n  /**\r\n   * Creates the custom character sheet overlay\r\n   */\r\n  function createOverlay() {\r\n    if (overlayElement) return;\r\n\r\n    overlayElement = document.createElement('div');\r\n    overlayElement.id = 'rollcloud-character-overlay';\r\n    overlayElement.innerHTML = `\r\n      <div class=\"rollcloud-sheet-container\">\r\n        <div class=\"rollcloud-header\">\r\n          <div class=\"sheet-title\">\r\n            <h2 id=\"character-name\">Character Name</h2>\r\n            <div class=\"character-subtitle\">\r\n              <span id=\"character-class\">Class</span> \r\n              <span id=\"character-level\">Level 1</span> \u2022 \r\n              <span id=\"character-race\">Race</span>\r\n            </div>\r\n          </div>\r\n          <div class=\"sheet-controls\">\r\n            <button class=\"control-btn\" id=\"popout-btn\">\uD83D\uDD17 Pop Out</button>\r\n            <button class=\"control-btn\" id=\"sync-btn\">\uD83D\uDD04 Sync Data</button>\r\n            <button class=\"control-btn\" id=\"close-btn\">\u2715 Close</button>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"rollcloud-content\">\r\n          <!-- Abilities -->\r\n          <div class=\"section\">\r\n            <h3>\u26A1 Abilities</h3>\r\n            <div class=\"abilities-grid\">\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Strength Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">STR</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Dexterity Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">DEX</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Constitution Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">CON</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Intelligence Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">INT</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Wisdom Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">WIS</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n              <div class=\"ability-card\" data-roll=\"1d20+0\" data-name=\"Charisma Check\">\r\n                <div class=\"roll-indicator\">\uD83C\uDFB2</div>\r\n                <div class=\"ability-name\">CHA</div>\r\n                <div class=\"ability-score\">10</div>\r\n                <div class=\"ability-mod\">+0</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Combat Stats -->\r\n          <div class=\"section\">\r\n            <h3>\u2694\uFE0F Combat</h3>\r\n            <div class=\"combat-stats\">\r\n              <div class=\"combat-stat\">\r\n                <label>Armor Class</label>\r\n                <div class=\"value\" id=\"ac\">10</div>\r\n              </div>\r\n              <div class=\"combat-stat\">\r\n                <label>Hit Points</label>\r\n                <div class=\"hp-input-group\">\r\n                  <input type=\"number\" id=\"hp-current\" class=\"hp-input\" value=\"10\" min=\"0\">\r\n                  <span class=\"hp-separator\">/</span>\r\n                  <input type=\"number\" id=\"hp-max\" class=\"hp-input\" value=\"10\" min=\"0\">\r\n                </div>\r\n              </div>\r\n              <div class=\"combat-stat\">\r\n                <label>Speed</label>\r\n                <div class=\"value\" id=\"speed\">30</div>\r\n              </div>\r\n              <div class=\"combat-stat\">\r\n                <label>Initiative</label>\r\n                <button class=\"initiative-btn\" id=\"initiative-btn\">+0</button>\r\n              </div>\r\n              <div class=\"combat-stat\">\r\n                <label>Proficiency</label>\r\n                <div class=\"value\" id=\"proficiency\">+2</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Saving Throws -->\r\n          <div class=\"section\">\r\n            <h3>\uD83D\uDEE1\uFE0F Saving Throws</h3>\r\n            <div class=\"saves-grid\">\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">STR</span>\r\n                <span class=\"save-bonus\" id=\"strength-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">DEX</span>\r\n                <span class=\"save-bonus\" id=\"dexterity-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">CON</span>\r\n                <span class=\"save-bonus\" id=\"constitution-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">INT</span>\r\n                <span class=\"save-bonus\" id=\"intelligence-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">WIS</span>\r\n                <span class=\"save-bonus\" id=\"wisdom-save\">+0</span>\r\n              </div>\r\n              <div class=\"save-card\">\r\n                <span class=\"save-name\">CHA</span>\r\n                <span class=\"save-bonus\" id=\"charisma-save\">+0</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Skills -->\r\n          <div class=\"section\">\r\n            <h3> Skills</h3>\r\n            <div class=\"skills-grid\">\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Acrobatics</span>\r\n                <span class=\"skill-bonus\" id=\"acrobatics\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Animal Handling</span>\r\n                <span class=\"skill-bonus\" id=\"animal-handling\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Arcana</span>\r\n                <span class=\"skill-bonus\" id=\"arcana\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Athletics</span>\r\n                <span class=\"skill-bonus\" id=\"athletics\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Deception</span>\r\n                <span class=\"skill-bonus\" id=\"deception\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">History</span>\r\n                <span class=\"skill-bonus\" id=\"history\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Insight</span>\r\n                <span class=\"skill-bonus\" id=\"insight\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Intimidation</span>\r\n                <span class=\"skill-bonus\" id=\"intimidation\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Investigation</span>\r\n                <span class=\"skill-bonus\" id=\"investigation\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Medicine</span>\r\n                <span class=\"skill-bonus\" id=\"medicine\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Nature</span>\r\n                <span class=\"skill-bonus\" id=\"nature\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Perception</span>\r\n                <span class=\"skill-bonus\" id=\"perception\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Performance</span>\r\n                <span class=\"skill-bonus\" id=\"performance\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Persuasion</span>\r\n                <span class=\"skill-bonus\" id=\"persuasion\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Religion</span>\r\n                <span class=\"skill-bonus\" id=\"religion\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Sleight of Hand</span>\r\n                <span class=\"skill-bonus\" id=\"sleight-of-hand\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Stealth</span>\r\n                <span class=\"skill-bonus\" id=\"stealth\">+0</span>\r\n              </div>\r\n              <div class=\"skill-card\">\r\n                <span class=\"skill-name\">Survival</span>\r\n                <span class=\"skill-bonus\" id=\"survival\">+0</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Resources (Vexus Fields) -->\r\n          <div class=\"section\">\r\n            <h3>\uD83D\uDD2E Resources</h3>\r\n            <div class=\"resources-grid\">\r\n              <div class=\"resource-card\">\r\n                <label>Level 1 Slots</label>\r\n                <div class=\"value\" id=\"level1-slots\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Level 2 Slots</label>\r\n                <div class=\"value\" id=\"level2-slots\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Level 3 Slots</label>\r\n                <div class=\"value\" id=\"level3-slots\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Ki Points</label>\r\n                <div class=\"value\" id=\"ki\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Sorcery Points</label>\r\n                <div class=\"value\" id=\"sorcery-points\">0</div>\r\n              </div>\r\n              <div class=\"resource-card\">\r\n                <label>Rages</label>\r\n                <div class=\"value\" id=\"rages\">0</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Additional Variables -->\r\n          <div class=\"section\" id=\"additional-variables\">\r\n            <h3>\uD83D\uDCCA Additional Variables</h3>\r\n            <div id=\"variables-grid\">\r\n              <!-- Dynamic content will be added here -->\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Spells -->\r\n          <div class=\"section spells-section\">\r\n            <h3>\uD83D\uDD2E Spells</h3>\r\n            <div class=\"spells-grid\" id=\"spells-grid\">\r\n              <div class=\"empty-state\">No spells available</div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Spell Slots -->\r\n          <div class=\"section spell-slots-section\">\r\n            <h3>\u2728 Spell Slots</h3>\r\n            <div class=\"spell-slots-grid\" id=\"spell-slots-grid\">\r\n              <div class=\"empty-state\">No spell slots available</div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Dice Cloud Panels -->\r\n          <div class=\"dicecloud-panels\">\r\n            <!-- Roll History Panel -->\r\n            <div class=\"panel-section\" id=\"roll-history-panel\">\r\n              <div class=\"panel-header\">\r\n                <span class=\"panel-title\">\uD83C\uDFB2 Roll History</span>\r\n                <button class=\"panel-toggle\" id=\"history-toggle\">\u2212</button>\r\n              </div>\r\n              <div class=\"panel-content\">\r\n                <div class=\"history-list\" id=\"roll-history-list\">\r\n                  <div class=\"empty-state\">No rolls yet. Make some rolls!</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Statistics Panel -->\r\n            <div class=\"panel-section\" id=\"stats-panel\">\r\n              <div class=\"panel-header\">\r\n                <span class=\"panel-title\">\uD83D\uDCCA Statistics</span>\r\n                <button class=\"panel-toggle\" id=\"stats-toggle\">\u2212</button>\r\n              </div>\r\n              <div class=\"panel-content\">\r\n                <div class=\"stats-grid\">\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">Total Rolls</span>\r\n                    <span class=\"stat-value\" id=\"stat-total\">0</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">Average</span>\r\n                    <span class=\"stat-value\" id=\"stat-average\">0.0</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">Highest</span>\r\n                    <span class=\"stat-value\" id=\"stat-highest\">0</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">Lowest</span>\r\n                    <span class=\"stat-value\" id=\"stat-lowest\">\u221E</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">\u2B50 Critical Hits</span>\r\n                    <span class=\"stat-value\" id=\"stat-crits\">0</span>\r\n                  </div>\r\n                  <div class=\"stat-item\">\r\n                    <span class=\"stat-label\">\uD83D\uDC80 Critical Fails</span>\r\n                    <span class=\"stat-value\" id=\"stat-fails\">0</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Settings Panel -->\r\n            <div class=\"panel-section\" id=\"settings-panel\">\r\n              <div class=\"panel-header\">\r\n                <span class=\"panel-title\">\u2699\uFE0F Roll Settings</span>\r\n                <button class=\"panel-toggle\" id=\"settings-toggle\">\u2212</button>\r\n              </div>\r\n              <div class=\"panel-content\">\r\n                <div class=\"setting-group\">\r\n                  <label class=\"setting-label\">Roll Mode</label>\r\n                  <div class=\"toggle-buttons\">\r\n                    <button class=\"toggle-btn active\" data-mode=\"normal\">Normal</button>\r\n                    <button class=\"toggle-btn\" data-mode=\"advantage\">Advantage</button>\r\n                    <button class=\"toggle-btn\" data-mode=\"disadvantage\">Disadvantage</button>\r\n                  </div>\r\n                </div>\r\n                <div class=\"setting-description\">\r\n                  Choose how d20 rolls are calculated when forwarded to Roll20\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    // Add styles\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      #rollcloud-character-overlay {\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        background: rgba(0, 0, 0, 0.8);\r\n        backdrop-filter: blur(5px);\r\n        z-index: 999999;\r\n        display: none;\r\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n      }\r\n\r\n      .rollcloud-sheet-container {\r\n        position: absolute;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        width: 90%;\r\n        max-width: 1200px;\r\n        max-height: 90vh;\r\n        background: #1a1a1a;\r\n        border-radius: 16px;\r\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\r\n        overflow: hidden;\r\n        display: flex;\r\n        flex-direction: column;\r\n        border: 2px solid #FC57F9;\r\n      }\r\n\r\n      .rollcloud-header {\r\n        background: #3d0638;\r\n        color: white;\r\n        padding: 20px;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        border-bottom: 2px solid #FC57F9;\r\n      }\r\n\r\n      .sheet-title h2 {\r\n        margin: 0 0 5px 0;\r\n        font-size: 1.8em;\r\n      }\r\n\r\n      .character-subtitle {\r\n        font-size: 1.1em;\r\n        opacity: 0.9;\r\n      }\r\n\r\n      .sheet-controls {\r\n        display: flex;\r\n        gap: 10px;\r\n      }\r\n\r\n      .control-btn {\r\n        background: rgba(255, 255, 255, 0.2);\r\n        border: none;\r\n        color: white;\r\n        padding: 8px 12px;\r\n        border-radius: 8px;\r\n        cursor: pointer;\r\n        font-size: 16px;\r\n        transition: background 0.2s;\r\n      }\r\n\r\n      .control-btn:hover {\r\n        background: rgba(255, 255, 255, 0.3);\r\n      }\r\n\r\n      .rollcloud-content {\r\n        padding: 20px;\r\n        overflow-y: auto;\r\n        flex: 1;\r\n      }\r\n\r\n      .section {\r\n        margin-bottom: 25px;\r\n      }\r\n\r\n      .section h3 {\r\n        margin: 0 0 15px 0;\r\n        color: #e0e0e0;\r\n        border-bottom: 2px solid #FC57F9;\r\n        padding-bottom: 5px;\r\n      }\r\n\r\n      .abilities-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\r\n        gap: 15px;\r\n      }\r\n\r\n      .ability-card {\r\n        background: #3d0638;\r\n        padding: 15px;\r\n        border-radius: 12px;\r\n        text-align: center;\r\n        border: 2px solid #FC57F9;\r\n        transition: transform 0.2s;\r\n        position: relative;\r\n        cursor: pointer;\r\n      }\r\n\r\n      .ability-card:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);\r\n      }\r\n\r\n      .ability-card:active {\r\n        transform: translateY(0);\r\n      }\r\n\r\n      .roll-indicator {\r\n        position: absolute;\r\n        top: 5px;\r\n        right: 5px;\r\n        background: #FC57F9;\r\n        color: white;\r\n        border: none;\r\n        width: 24px;\r\n        height: 24px;\r\n        border-radius: 50%;\r\n        font-size: 12px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);\r\n        pointer-events: none;\r\n      }\r\n\r\n      .skill-roll-btn {\r\n        background: #FC57F9;\r\n        color: white;\r\n        border: none;\r\n        padding: 4px 8px;\r\n        border-radius: 4px;\r\n        font-size: 12px;\r\n        cursor: pointer;\r\n        transition: background 0.2s;\r\n      }\r\n\r\n      .skill-roll-btn:hover {\r\n        background: #8E0682;\r\n      }\r\n\r\n      .ability-name {\r\n        font-weight: bold;\r\n        color: #e0e0e0;\r\n        font-size: 0.9em;\r\n        margin-bottom: 5px;\r\n      }\r\n\r\n      .ability-score {\r\n        font-size: 2em;\r\n        font-weight: bold;\r\n        color: #FC57F9;\r\n        line-height: 1;\r\n      }\r\n\r\n      .ability-mod {\r\n        color: #FC57F9;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .combat-stats, .resources-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));\r\n        gap: 15px;\r\n      }\r\n\r\n      .combat-stat, .resource-card {\r\n        background: #3d0638;\r\n        padding: 15px;\r\n        border-radius: 8px;\r\n        text-align: center;\r\n        border: 1px solid #FC57F9;\r\n      }\r\n\r\n      .combat-stat label, .resource-card label {\r\n        display: block;\r\n        font-weight: bold;\r\n        color: #e0e0e0;\r\n        margin-bottom: 8px;\r\n        font-size: 0.9em;\r\n      }\r\n\r\n      .combat-stat .value, .resource-card .value {\r\n        font-size: 1.4em;\r\n        font-weight: bold;\r\n        color: #FC57F9;\r\n      }\r\n\r\n      .hp-input-group {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 5px;\r\n      }\r\n\r\n      .hp-input {\r\n        width: 50px;\r\n        text-align: center;\r\n        font-size: 1.2em;\r\n        font-weight: bold;\r\n        color: #FC57F9;\r\n        background: #1a1a1a;\r\n        border: 2px solid #FC57F9;\r\n        border-radius: 4px;\r\n        padding: 4px;\r\n      }\r\n\r\n      .hp-separator {\r\n        font-weight: bold;\r\n        color: #FC57F9;\r\n        font-size: 1.2em;\r\n      }\r\n\r\n      .initiative-btn {\r\n        background: #FC57F9;\r\n        color: white;\r\n        border: none;\r\n        padding: 8px 12px;\r\n        border-radius: 6px;\r\n        font-size: 1.2em;\r\n        font-weight: bold;\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .initiative-btn:hover {\r\n        background: #8E0682;\r\n        transform: translateY(-1px);\r\n        box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3);\r\n      }\r\n\r\n      .saves-grid, .skills-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\r\n        gap: 10px;\r\n      }\r\n\r\n      .save-card, .skill-card {\r\n        background: #3d0638;\r\n        padding: 10px;\r\n        border-radius: 8px;\r\n        border: 1px solid #FC57F9;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        cursor: pointer;\r\n        transition: transform 0.2s, box-shadow 0.2s;\r\n      }\r\n\r\n      .save-card:hover, .skill-card:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);\r\n      }\r\n\r\n      .save-name, .skill-name {\r\n        font-weight: bold;\r\n        color: #e0e0e0;\r\n      }\r\n\r\n      .save-bonus, .skill-bonus {\r\n        font-weight: bold;\r\n        color: #FC57F9;\r\n        background: #1a1a1a;\r\n        padding: 2px 8px;\r\n        border-radius: 12px;\r\n        border: 1px solid #FC57F9;\r\n      }\r\n\r\n      #variables-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n        gap: 10px;\r\n      }\r\n\r\n      .variable-card {\r\n        background: #3d0638;\r\n        padding: 10px;\r\n        border-radius: 8px;\r\n        border: 1px solid #FC57F9;\r\n      }\r\n\r\n      .variable-name {\r\n        font-weight: bold;\r\n        color: #e0e0e0;\r\n        font-size: 0.9em;\r\n      }\r\n\r\n      .variable-value {\r\n        color: #FC57F9;\r\n        font-weight: bold;\r\n      }\r\n\r\n      /* Dice Cloud Panels */\r\n      .dicecloud-panels {\r\n        display: grid;\r\n        grid-template-columns: 1fr;\r\n        gap: 20px;\r\n        margin-top: 20px;\r\n      }\r\n\r\n      .panel-section {\r\n        background: #3d0638;\r\n        border-radius: 12px;\r\n        border: 1px solid #FC57F9;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .panel-header {\r\n        background: #3d0638;\r\n        color: white;\r\n        padding: 15px 20px;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        cursor: pointer;\r\n      }\r\n\r\n      .panel-title {\r\n        font-weight: bold;\r\n        font-size: 1.1em;\r\n      }\r\n\r\n      .panel-toggle {\r\n        background: rgba(255, 255, 255, 0.2);\r\n        border: none;\r\n        color: white;\r\n        font-size: 20px;\r\n        cursor: pointer;\r\n        padding: 0;\r\n        width: 30px;\r\n        height: 30px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        border-radius: 6px;\r\n        transition: background 0.2s;\r\n      }\r\n\r\n      .panel-toggle:hover {\r\n        background: rgba(255, 255, 255, 0.3);\r\n      }\r\n\r\n      .panel-content {\r\n        padding: 20px;\r\n      }\r\n\r\n      .history-list {\r\n        max-height: 300px;\r\n        overflow-y: auto;\r\n      }\r\n\r\n      .history-item {\r\n        background: #1a1a1a;\r\n        padding: 12px;\r\n        border-radius: 8px;\r\n        margin-bottom: 8px;\r\n        border: 1px solid #FC57F9;\r\n        animation: slideIn 0.3s ease-out;\r\n      }\r\n\r\n      .history-item-header {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        margin-bottom: 5px;\r\n      }\r\n\r\n      .history-name {\r\n        font-weight: bold;\r\n        color: #e0e0e0;\r\n      }\r\n\r\n      .history-time {\r\n        color: #6c757d;\r\n        font-size: 0.9em;\r\n      }\r\n\r\n      .history-formula {\r\n        font-family: 'Courier New', monospace;\r\n        color: #FC57F9;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .history-badges {\r\n        margin-top: 5px;\r\n        display: flex;\r\n        gap: 5px;\r\n        flex-wrap: wrap;\r\n      }\r\n\r\n      .history-badge {\r\n        background: #e9ecef;\r\n        color: #495057;\r\n        padding: 2px 8px;\r\n        border-radius: 12px;\r\n        font-size: 0.8em;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .critical-success {\r\n        background: #d4edda;\r\n        color: #155724;\r\n      }\r\n\r\n      .critical-failure {\r\n        background: #f8d7da;\r\n        color: #721c24;\r\n      }\r\n\r\n      .stats-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(3, 1fr);\r\n        gap: 15px;\r\n      }\r\n\r\n      .stat-item {\r\n        background: #1a1a1a;\r\n        padding: 15px;\r\n        border-radius: 8px;\r\n        text-align: center;\r\n        border: 1px solid #dee2e6;\r\n      }\r\n\r\n      .stat-label {\r\n        display: block;\r\n        font-weight: bold;\r\n        color: #6c757d;\r\n        font-size: 0.9em;\r\n        margin-bottom: 8px;\r\n      }\r\n\r\n      .stat-value {\r\n        font-size: 1.5em;\r\n        font-weight: bold;\r\n        color: #FC57F9;\r\n      }\r\n\r\n      .setting-group {\r\n        margin-bottom: 20px;\r\n      }\r\n\r\n      .setting-label {\r\n        display: block;\r\n        font-weight: bold;\r\n        color: #495057;\r\n        margin-bottom: 10px;\r\n      }\r\n\r\n      .toggle-buttons {\r\n        display: grid;\r\n        grid-template-columns: repeat(3, 1fr);\r\n        gap: 8px;\r\n      }\r\n\r\n      .toggle-btn {\r\n        background: #e9ecef;\r\n        border: 2px solid #dee2e6;\r\n        color: #495057;\r\n        padding: 12px 16px;\r\n        border-radius: 8px;\r\n        cursor: pointer;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        transition: all 0.2s;\r\n        text-align: center;\r\n      }\r\n\r\n      .toggle-btn:hover {\r\n        background: #f8f9fa;\r\n        border-color: #adb5bd;\r\n        transform: translateY(-1px);\r\n      }\r\n\r\n      .toggle-btn.active {\r\n        background: #3d0638;\r\n        border-color: #FC57F9;\r\n        color: white;\r\n        box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3);\r\n      }\r\n\r\n      .setting-description {\r\n        background: rgba(78, 205, 196, 0.1);\r\n        padding: 12px;\r\n        border-radius: 8px;\r\n        font-size: 0.9em;\r\n        color: #e0e0e0;\r\n        text-align: center;\r\n        margin-top: 10px;\r\n        border: 1px solid #FC57F9;\r\n      }\r\n\r\n      .empty-state {\r\n        text-align: center;\r\n        padding: 40px;\r\n        color: #6c757d;\r\n        font-style: italic;\r\n      }\r\n\r\n      /* Spells Section */\r\n      .spells-grid {\r\n        display: grid;\r\n        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\r\n        gap: 12px;\r\n      }\r\n\r\n      .spell-card {\r\n        background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);\r\n        padding: 12px;\r\n        border-radius: 8px;\r\n        border: 1px solid #FC57F9;\r\n        cursor: pointer;\r\n        transition: transform 0.2s, box-shadow 0.2s;\r\n      }\r\n\r\n      .spell-card.spell-attack:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);\r\n        border-color: #e74c3c;\r\n      }\r\n\r\n      .spell-card.spell-utility:hover {\r\n        transform: translateY(-2px);\r\n        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);\r\n        border-color: #3498db;\r\n      }\r\n\r\n      .spell-header {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      .spell-name {\r\n        font-weight: bold;\r\n        color: #e0e0e0;\r\n      }\r\n\r\n      .spell-action {\r\n        font-size: 16px;\r\n        opacity: 0.8;\r\n      }\r\n\r\n      .spell-details {\r\n        display: flex;\r\n        gap: 8px;\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      .spell-level, .spell-school {\r\n        font-size: 11px;\r\n        padding: 2px 6px;\r\n        border-radius: 4px;\r\n        background: #FC57F9;\r\n        color: white;\r\n      }\r\n\r\n      .spell-casting-time {\r\n        font-size: 11px;\r\n        color: #7f8c8d;\r\n        font-style: italic;\r\n      }\r\n\r\n      @keyframes slideIn {\r\n        from {\r\n          opacity: 0;\r\n          transform: translateY(10px);\r\n        }\r\n        to {\r\n          opacity: 1;\r\n          transform: translateY(0);\r\n        }\r\n      }\r\n\r\n      @keyframes slideOut {\r\n        from {\r\n          opacity: 1;\r\n          transform: translateY(0);\r\n        }\r\n        to {\r\n          opacity: 0;\r\n          transform: translateY(-10px);\r\n        }\r\n      }\r\n\r\n      @keyframes fadeIn {\r\n        from {\r\n          opacity: 0;\r\n        }\r\n        to {\r\n          opacity: 1;\r\n        }\r\n      }\r\n\r\n      @keyframes fadeOut {\r\n        from {\r\n          opacity: 1;\r\n        }\r\n        to {\r\n          opacity: 0;\r\n        }\r\n      }\r\n    `;\r\n\r\n    document.head.appendChild(style);\r\n    document.body.appendChild(overlayElement);\r\n\r\n    // Add event listeners\r\n    const closeBtn = document.getElementById('close-btn');\r\n    const popoutBtn = document.getElementById('popout-btn');\r\n    const syncBtn = document.getElementById('sync-btn');\r\n    \r\n    if (closeBtn) {\r\n      closeBtn.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        debug.log('\uD83D\uDD34 Close button clicked');\r\n        hideOverlay();\r\n      });\r\n    } else {\r\n      debug.error('\u274C Close button not found');\r\n    }\r\n    \r\n    if (popoutBtn) {\r\n      popoutBtn.addEventListener('click', (e) => {\r\n        e.preventDefault();\r\n        debug.log('\uD83D\uDD17 Pop out button clicked');\r\n        popOutCharacterSheet();\r\n      });\r\n    } else {\r\n      debug.error('\u274C Pop out button not found');\r\n    }\r\n    \r\n    if (syncBtn) {\r\n      syncBtn.addEventListener('click', () => {\r\n        debug.log('\uD83D\uDD04 Manual sync triggered from character sheet');\r\n        \r\n        // Show loading state\r\n        const originalText = syncBtn.innerHTML;\r\n        syncBtn.innerHTML = '\uD83D\uDD04 Syncing...';\r\n        syncBtn.disabled = true;\r\n        \r\n        // Reload character data from extension storage\r\n        loadCharacterData();\r\n        \r\n        // Reset button after a delay\r\n        setTimeout(() => {\r\n          syncBtn.innerHTML = originalText;\r\n          syncBtn.disabled = false;\r\n        }, 2000);\r\n      });\r\n    } else {\r\n      debug.error('\u274C Sync button not found');\r\n    }\r\n\r\n    // Add panel event listeners\r\n    document.getElementById('history-toggle').addEventListener('click', () => togglePanel('history'));\r\n    document.getElementById('stats-toggle').addEventListener('click', () => togglePanel('stats'));\r\n    document.getElementById('settings-toggle').addEventListener('click', () => togglePanel('settings'));\r\n\r\n    // Note: Dragging is not needed as overlay is shown in popup window\r\n  }\r\n\r\n  /**\r\n   * Opens the character sheet in a popup window\r\n   */\r\n  function popOutCharacterSheet() {\r\n    debug.log('\uD83D\uDD17 Opening character sheet in popup...');\r\n    showOverlay();\r\n  }\r\n\r\n  /**\r\n   * Loads character data from extension storage\r\n   * Opera-compatible with timeout, retry logic, and direct storage fallback\r\n   */\r\n  async function loadCharacterData() {\r\n    debug.log('\uD83D\uDCCB Loading character data from storage...');\r\n\r\n    // Create a timeout to handle unresponsive background scripts (Opera issue)\r\n    let timeoutId;\r\n    let messageHandled = false;\r\n\r\n    const timeoutPromise = new Promise((_, reject) => {\r\n      timeoutId = setTimeout(() => {\r\n        if (!messageHandled) {\r\n          reject(new Error('Background script timeout - service worker may be inactive'));\r\n        }\r\n      }, 3000); // 3 second timeout (reduced for faster fallback)\r\n    });\r\n\r\n    // Try to send message with Promise wrapper for better error handling\r\n    const messagePromise = new Promise((resolve, reject) => {\r\n      try {\r\n        browserAPI.runtime.sendMessage({ action: 'getCharacterData' }, (response) => {\r\n          messageHandled = true;\r\n          clearTimeout(timeoutId);\r\n\r\n          if (browserAPI.runtime.lastError) {\r\n            debug.error('\uD83D\uDCCB Extension context error:', browserAPI.runtime.lastError);\r\n            reject(new Error(browserAPI.runtime.lastError.message || 'Extension context error'));\r\n            return;\r\n          }\r\n\r\n          resolve(response);\r\n        });\r\n      } catch (error) {\r\n        messageHandled = true;\r\n        clearTimeout(timeoutId);\r\n        reject(error);\r\n      }\r\n    });\r\n\r\n    try {\r\n      // Race between message and timeout\r\n      const response = await Promise.race([messagePromise, timeoutPromise]);\r\n\r\n      if (response && response.data) {\r\n        debug.log('\uD83D\uDCCB Character data loaded via background script:', response.data.name);\r\n        characterData = response.data.raw; // Extract raw data from character object\r\n        showNotification('Character data synced! \u2705', 'success');\r\n\r\n        // Add roll event listeners after character data is loaded\r\n        addRollEventListeners();\r\n        return;\r\n      } else {\r\n        debug.log('\uD83D\uDCCB No character data found');\r\n        showNotification('No character data found. Please sync from Dice Cloud first.', 'error');\r\n        return;\r\n      }\r\n    } catch (error) {\r\n      debug.warn('\uD83D\uDCCB Background script unavailable:', error.message);\r\n      debug.log('\uD83D\uDCCB Attempting direct storage access fallback...');\r\n\r\n      // FALLBACK: Access storage directly (Opera compatibility when service worker is asleep)\r\n      try {\r\n        // Use CarmaClouds storage format\r\n        const result = await browserAPI.storage.local.get('carmaclouds_characters');\r\n        const characters = result.carmaclouds_characters || [];\r\n\r\n        if (characters.length > 0) {\r\n          // Get the first character (for now - later we'll add character selection)\r\n          const character = characters[0];\r\n          characterData = character.raw;\r\n\r\n          debug.log('\uD83D\uDCCB Character data loaded via direct storage:', character.name);\r\n          showNotification('Character data synced! \u2705', 'success');\r\n\r\n          // Add roll event listeners after character data is loaded\r\n          addRollEventListeners();\r\n        } else {\r\n          debug.log('\uD83D\uDCCB No character data found in direct storage');\r\n          showNotification('No character data found. Please sync from Dice Cloud first.', 'error');\r\n        }\r\n      } catch (storageError) {\r\n        debug.error('\uD83D\uDCCB Direct storage access failed:', storageError);\r\n        showNotification('Failed to load character data. Try refreshing the page.', 'error');\r\n\r\n        // Last resort: try to wake service worker\r\n        debug.log('\uD83D\uDCCB Attempting to wake service worker...');\r\n        try {\r\n          browserAPI.runtime.sendMessage({ action: 'ping' });\r\n        } catch (e) {\r\n          debug.error('\uD83D\uDCCB Failed to ping service worker:', e);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Posts spell description to Roll20 chat\r\n   */\r\n  function postSpellDescriptionToChat(spellName, spellLevel, spellDescription) {\r\n    debug.log('\uD83D\uDD2E Posting spell description to chat:', spellName);\r\n\r\n    const message = `/em casts **${spellName}** (Level ${spellLevel})\\n${spellDescription || 'No description available'}`;\r\n\r\n    const success = postChatMessage(message);\r\n    if (success) {\r\n      showNotification(`${spellName} description posted to chat! \u2728`, 'success');\r\n    } else {\r\n      showNotification('Failed to post to chat. Make sure you are on Roll20.', 'error');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Adds roll event listeners to all rollable elements\r\n   */\r\n  function addRollEventListeners() {\r\n    // Add roll button listeners\r\n    document.querySelectorAll('.ability-card').forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const roll = card.getAttribute('data-roll');\r\n        const name = card.getAttribute('data-name');\r\n        debug.log(` Clicked ability card: ${name} (${roll})`);\r\n        \r\n        // Make announcement in Roll20 chat first\r\n        const characterName = characterData?.name || 'Character';\r\n        const announcement = `&{template:default} {{name=${characterName} - ${name}}} {{description=Ability Check}}`;\r\n        postChatMessage(announcement);\r\n        \r\n        // Then roll the dice\r\n        setTimeout(() => rollSimultaneously(name, roll), 100);\r\n      });\r\n    });\r\n\r\n    // Add spell card listeners\r\n    document.querySelectorAll('.spell-card').forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        debug.log(' Spell card clicked, checking data attributes...');\r\n        \r\n        const spellName = card.getAttribute('data-spell');\r\n        const spellLevel = card.getAttribute('data-spell-level');\r\n        const spellDescription = card.getAttribute('data-spell-description');\r\n        const spellSchool = card.getAttribute('data-spell-school');\r\n        const spellCastingTime = card.getAttribute('data-spell-casting-time');\r\n        const spellRange = card.getAttribute('data-spell-range');\r\n        const spellDuration = card.getAttribute('data-spell-duration');\r\n        const spellComponents = card.getAttribute('data-spell-components');\r\n        const clickAction = card.getAttribute('data-click-action');\r\n        const castLevel = card.getAttribute('data-cast-level') || spellLevel;\r\n        \r\n        debug.log(` Clicked spell: ${spellName} (Level ${spellLevel}) - Action: ${clickAction}`);\r\n        debug.log(' Spell description:', spellDescription);\r\n        \r\n        // Make detailed spell announcement in Roll20 chat\r\n        const characterName = characterData?.name || 'Character';\r\n        let announcement = `&{template:default} {{name= ${characterName} casts ${spellName}!}}`;\r\n        \r\n        // Add spell level and school information\r\n        if (spellLevel > 0) {\r\n          let levelText = castLevel > spellLevel\r\n            ? `Level ${castLevel} (upcast from ${spellLevel})`\r\n            : `Level ${spellLevel}`;\r\n          if (spellSchool) levelText += ` ${spellSchool}`;\r\n          announcement += ` {{Level=${levelText}}}`;\r\n        } else if (spellSchool) {\r\n          announcement += ` {{Level=${spellSchool} cantrip}}`;\r\n        }\r\n        \r\n        // Add casting details\r\n        if (spellCastingTime) announcement += ` {{Casting Time=${spellCastingTime}}}`;\r\n        if (spellRange) announcement += ` {{Range=${spellRange}}}`;\r\n        if (spellDuration) announcement += ` {{Duration=${spellDuration}}}`;\r\n        if (spellComponents) announcement += ` {{Components=${spellComponents}}}`;\r\n        \r\n        // Add description if available\r\n        if (spellDescription) {\r\n          // Truncate description if too long for Roll20 template\r\n          const truncatedDesc = spellDescription.length > 300 \r\n            ? spellDescription.substring(0, 297) + '...' \r\n            : spellDescription;\r\n          announcement += ` {{Description=${truncatedDesc}}}`;\r\n        }\r\n        \r\n        debug.log(' Posting detailed spell announcement to chat');\r\n        postChatMessage(announcement);\r\n        \r\n        // Then roll if it's an attack spell\r\n        if (clickAction === 'rollAttack') {\r\n          setTimeout(() => {\r\n            // Create a spell attack roll (d20 + spell level + proficiency)\r\n            const spellAttackRoll = `1d20+${parseInt(spellLevel) || 0}+${characterData.proficiencyBonus || 2}`;\r\n            debug.log(' Rolling spell attack:', spellAttackRoll);\r\n            rollSimultaneously(`${spellName} Spell Attack`, spellAttackRoll);\r\n          }, 200);\r\n        }\r\n      });\r\n    });\r\n\r\n    // Add skill card listeners\r\n    document.querySelectorAll('.skill-card').forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const skillName = card.querySelector('.skill-name').textContent;\r\n        const skillBonus = card.querySelector('.skill-bonus').textContent;\r\n        debug.log(` Clicked skill card: ${skillName} (${skillBonus})`);\r\n        \r\n        // Make announcement in Roll20 chat first\r\n        const characterName = characterData?.name || 'Character';\r\n        const announcement = `&{template:default} {{name=${characterName} - ${skillName}}} {{description=Skill Check}}`;\r\n        postChatMessage(announcement);\r\n        \r\n        // Then roll the dice\r\n        setTimeout(() => rollSimultaneously(skillName, `1d20${skillBonus}`), 100);\r\n      });\r\n    });\r\n\r\n    // Add save card listeners\r\n    document.querySelectorAll('.save-card').forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const saveName = card.querySelector('.save-name').textContent;\r\n        const saveBonus = card.querySelector('.save-bonus').textContent;\r\n        debug.log(` Clicked save card: ${saveName} (${saveBonus})`);\r\n        \r\n        // Make announcement in Roll20 chat first\r\n        const characterName = characterData?.name || 'Character';\r\n        const announcement = `&{template:default} {{name=${characterName} - ${saveName} Save}}} {{description=Saving Throw}}`;\r\n        postChatMessage(announcement);\r\n        \r\n        // Then roll the dice\r\n        setTimeout(() => rollSimultaneously(`${saveName} Save`, `1d20${saveBonus}`), 100);\r\n      });\r\n    });\r\n\r\n    // Add settings toggle listeners (moved here to ensure buttons exist)\r\n    document.querySelectorAll('.toggle-btn').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        const mode = e.target.getAttribute('data-mode');\r\n        setAdvantageMode(mode);\r\n      });\r\n    });\r\n\r\n    // Add initiative button listener\r\n    const initiativeBtn = document.getElementById('initiative-btn');\r\n    if (initiativeBtn) {\r\n      initiativeBtn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const initiative = characterData.initiative || 0;\r\n        debug.log(` Initiative check: 1d20+${initiative}`);\r\n        \r\n        // Make announcement in Roll20 chat first\r\n        const characterName = characterData?.name || 'Character';\r\n        const announcement = `&{template:default} {{name=${characterName} - Initiative Check}}} {{description=Rolling for initiative}}`;\r\n        postChatMessage(announcement);\r\n        \r\n        // Then roll the dice\r\n        setTimeout(() => rollSimultaneously('Initiative Check', `1d20+${initiative}`), 100);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles panel visibility\r\n   */\r\n  function togglePanel(panelName) {\r\n    const panel = document.getElementById(`${panelName}-panel`);\r\n    const content = panel.querySelector('.panel-content');\r\n    const toggle = document.getElementById(`${panelName}-toggle`);\r\n    \r\n    if (content.style.display === 'none') {\r\n      content.style.display = 'block';\r\n      toggle.textContent = '\u2212';\r\n    } else {\r\n      content.style.display = 'none';\r\n      toggle.textContent = '+';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets the advantage mode\r\n   */\r\n  function setAdvantageMode(mode) {\r\n    rollStats.settings.advantageMode = mode;\r\n    \r\n    // Update button states\r\n    document.querySelectorAll('.toggle-btn').forEach(btn => {\r\n      const btnMode = btn.getAttribute('data-mode');\r\n      if (btnMode === mode) {\r\n        btn.classList.add('active');\r\n      } else {\r\n        btn.classList.remove('active');\r\n      }\r\n    });\r\n    \r\n    debug.log(`\uD83C\uDFB2 Roll mode set to: ${mode}`);\r\n  }\r\n\r\n  /**\r\n   * Updates roll statistics\r\n   */\r\n  function updateRollStatistics(rollData) {\r\n    const result = parseInt(rollData.result);\r\n    if (isNaN(result)) return;\r\n\r\n    rollStats.stats.totalRolls++;\r\n    rollStats.stats.highestRoll = Math.max(rollStats.stats.highestRoll, result);\r\n    rollStats.stats.lowestRoll = Math.min(rollStats.stats.lowestRoll, result);\r\n\r\n    // Update average (running average)\r\n    rollStats.stats.averageRoll =\r\n      (rollStats.stats.averageRoll * (rollStats.stats.totalRolls - 1) + result) /\r\n      rollStats.stats.totalRolls;\r\n\r\n    // Check for criticals\r\n    const formula = rollData.formula.toLowerCase();\r\n    if (formula.includes('d20') || formula.includes('1d20')) {\r\n      if (result === 20) {\r\n        rollStats.stats.criticalSuccesses++;\r\n      } else if (result === 1) {\r\n        rollStats.stats.criticalFailures++;\r\n      }\r\n    }\r\n\r\n    updateStatsDisplay();\r\n  }\r\n\r\n  /**\r\n   * Updates statistics display\r\n   */\r\n  function updateStatsDisplay() {\r\n    // Check if elements exist (they won't exist if overlay is in popup window)\r\n    const statTotal = document.getElementById('stat-total');\r\n    if (!statTotal) return; // Overlay not on this page\r\n\r\n    statTotal.textContent = rollStats.stats.totalRolls;\r\n    document.getElementById('stat-average').textContent = rollStats.stats.averageRoll.toFixed(1);\r\n    document.getElementById('stat-highest').textContent = rollStats.stats.highestRoll;\r\n    document.getElementById('stat-lowest').textContent =\r\n      rollStats.stats.lowestRoll === Infinity ? '\u221E' : rollStats.stats.lowestRoll;\r\n    document.getElementById('stat-crits').textContent = rollStats.stats.criticalSuccesses;\r\n    document.getElementById('stat-fails').textContent = rollStats.stats.criticalFailures;\r\n  }\r\n\r\n  /**\r\n   * Adds roll to history\r\n   */\r\n  function addToRollHistory(rollData) {\r\n    const advantageType = rollStats.settings.advantageMode;\r\n    const criticalType = detectCritical(rollData);\r\n\r\n    rollStats.history.unshift({\r\n      ...rollData,\r\n      advantageType,\r\n      criticalType,\r\n      timestamp: Date.now()\r\n    });\r\n\r\n    // Trim history\r\n    if (rollStats.history.length > rollStats.settings.maxHistorySize) {\r\n      rollStats.history = rollStats.history.slice(0, rollStats.settings.maxHistorySize);\r\n    }\r\n\r\n    updateRollHistoryDisplay();\r\n    updateRollStatistics(rollData);\r\n  }\r\n\r\n  /**\r\n   * Updates roll history display\r\n   */\r\n  function updateRollHistoryDisplay() {\r\n    const historyList = document.getElementById('roll-history-list');\r\n    if (!historyList) return;\r\n\r\n    if (rollStats.history.length === 0) {\r\n      historyList.innerHTML = '<div class=\"empty-state\">No rolls yet. Make some rolls!</div>';\r\n      return;\r\n    }\r\n\r\n    historyList.innerHTML = rollStats.history.map((roll, index) => {\r\n      const timeAgo = getTimeAgo(roll.timestamp);\r\n      const criticalClass = roll.criticalType || '';\r\n\r\n      let badges = '';\r\n      if (roll.criticalType) {\r\n        badges += `<span class=\"history-badge ${roll.criticalType}\">${roll.criticalType.replace('-', ' ')}</span>`;\r\n      }\r\n      if (roll.advantageType && roll.advantageType !== 'normal') {\r\n        badges += `<span class=\"history-badge\">${roll.advantageType}</span>`;\r\n      }\r\n\r\n      return `\r\n        <div class=\"history-item ${criticalClass}\" style=\"animation-delay: ${index * 0.05}s\">\r\n          <div class=\"history-item-header\">\r\n            <span class=\"history-name\">${roll.name}</span>\r\n            <span class=\"history-time\">${timeAgo}</span>\r\n          </div>\r\n          <div class=\"history-formula\">${roll.formula} = <strong>${roll.result}</strong></div>\r\n          ${badges ? `<div class=\"history-badges\">${badges}</div>` : ''}\r\n        </div>\r\n      `;\r\n    }).join('');\r\n  }\r\n\r\n  /**\r\n   * Gets time ago string\r\n   */\r\n  function getTimeAgo(timestamp) {\r\n    const seconds = Math.floor((Date.now() - timestamp) / 1000);\r\n    if (seconds < 60) return 'just now';\r\n    if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\r\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\r\n    return `${Math.floor(seconds / 86400)}d ago`;\r\n  }\r\n\r\n  /**\r\n   * Rolls in Dice Cloud and then forwards to Roll20\r\n   */\r\n  function rollSimultaneously(name, formula) {\r\n    debug.log(`\uD83C\uDFB2 Rolling ${name} with formula ${formula}...`);\r\n\r\n    // Check advantage mode and modify formula for Roll20 syntax\r\n    const advantageMode = rollStats.settings.advantageMode;\r\n    let modifiedFormula = formula;\r\n\r\n    if (advantageMode === 'advantage') {\r\n      // Roll20 syntax for advantage: 2d20kh1 (keep highest)\r\n      modifiedFormula = formula.replace(/^1d20/, '2d20kh1');\r\n      debug.log(`\uD83C\uDFB2 Advantage mode: ${formula} \u2192 ${modifiedFormula}`);\r\n    } else if (advantageMode === 'disadvantage') {\r\n      // Roll20 syntax for disadvantage: 2d20kl1 (keep lowest)\r\n      modifiedFormula = formula.replace(/^1d20/, '2d20kl1');\r\n      debug.log(`\uD83C\uDFB2 Disadvantage mode: ${formula} \u2192 ${modifiedFormula}`);\r\n    }\r\n\r\n    // Post roll directly to Roll20 - no DiceCloud needed!\r\n    debug.log('\uD83C\uDFAF Posting roll directly to Roll20 (no DiceCloud!)');\r\n    showNotification(`Rolling ${name}... \uD83C\uDFB2`, 'info');\r\n\r\n    // Format roll for Roll20\r\n    const rollMessage = `&{template:default} {{name=${name}}} {{Roll=[[${modifiedFormula}]]}}`;\r\n\r\n    // Post to Roll20 chat\r\n    const success = postChatMessage(rollMessage);\r\n\r\n    if (success) {\r\n      debug.log('\u2705 Roll posted directly to Roll20!');\r\n      showNotification(`${name} rolled! \uD83C\uDFB2`, 'success');\r\n\r\n      // Track the roll in overlay history\r\n      addToRollHistory({\r\n        name: name,\r\n        formula: modifiedFormula,\r\n        timestamp: Date.now()\r\n      });\r\n\r\n      // Update overlay display if visible\r\n      if (overlayVisible) {\r\n        updateRollHistoryDisplay();\r\n        updateStatsDisplay();\r\n      }\r\n    } else {\r\n      debug.error('\u274C Failed to post roll to Roll20');\r\n      showNotification('Failed to roll. Make sure you\\'re on Roll20!', 'error');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initiates a roll in Dice Cloud by finding and clicking the appropriate button\r\n   */\r\n  function rollInDiceCloud(name, formula) {\r\n    return new Promise((resolve, reject) => {\r\n      // Check if we're on Dice Cloud\r\n      if (!window.location.hostname.includes('dicecloud.com')) {\r\n        reject(new Error('Not on Dice Cloud'));\r\n        return;\r\n      }\r\n\r\n      // Try to find the roll button in Dice Cloud\r\n      // This is a simplified approach - you may need to adjust based on Dice Cloud's actual UI\r\n      const rollButtons = document.querySelectorAll('[class*=\"roll\"], [class*=\"dice\"], button');\r\n      let found = false;\r\n\r\n      rollButtons.forEach(button => {\r\n        const buttonText = button.textContent || button.innerText || '';\r\n        if (buttonText.toLowerCase().includes(name.toLowerCase()) || \r\n            buttonText.toLowerCase().includes('roll')) {\r\n          debug.log('\uD83C\uDFAF Found potential roll button:', buttonText);\r\n          found = true;\r\n          button.click();\r\n          resolve();\r\n        }\r\n      });\r\n\r\n      if (!found) {\r\n        // Try to find by searching for the roll name in the page\r\n        const allElements = document.querySelectorAll('*');\r\n        for (let element of allElements) {\r\n          const text = element.textContent || element.innerText || '';\r\n          if (text.toLowerCase().includes(name.toLowerCase()) && \r\n              (element.tagName === 'BUTTON' || element.onclick)) {\r\n            debug.log('\uD83C\uDFAF Found roll element by text:', text);\r\n            element.click();\r\n            resolve();\r\n            return;\r\n          }\r\n        }\r\n        \r\n        reject(new Error('Could not find roll button in Dice Cloud'));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Direct roll in Roll20 (fallback)\r\n   */\r\n  function rollInRoll20(name, formula) {\r\n    const rollData = {\r\n      name: name,\r\n      formula: formula,\r\n      result: Math.floor(Math.random() * 20) + 1, // Simple fallback\r\n      timestamp: Date.now()\r\n    };\r\n\r\n    // Send to Roll20\r\n    browserAPI.runtime.sendMessage({\r\n      action: 'postRollToChat',\r\n      roll: rollData\r\n    }, (response) => {\r\n      if (browserAPI.runtime.lastError) {\r\n        debug.error('\u274C Error sending roll to Roll20:', browserAPI.runtime.lastError);\r\n      } else {\r\n        debug.log('\u2705 Roll sent to Roll20 directly');\r\n        showNotification(`${name} roll sent to Roll20! \uD83C\uDFB2`, 'success');\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Posts a message to Roll20 chat (fallback for character sheet overlay)\r\n   */\r\n  function postChatMessage(message) {\r\n    try {\r\n      // Find the chat input textarea\r\n      const chatInput = document.querySelector('#textchat-input textarea');\r\n      if (chatInput) {\r\n        chatInput.value = message;\r\n        chatInput.focus();\r\n        \r\n        // Trigger the send button\r\n        const sendButton = document.querySelector('#textchat-input .btn');\r\n        if (sendButton) {\r\n          sendButton.click();\r\n          debug.log('\u2705 Message posted to Roll20 chat:', message);\r\n          return true;\r\n        } else {\r\n          debug.error('\u274C Could not find Roll20 chat send button');\r\n          return false;\r\n        }\r\n      } else {\r\n        debug.error('\u274C Could not find Roll20 chat input');\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      debug.error('\u274C Error posting to Roll20 chat:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Detects critical hits/misses\r\n   */\r\n  function detectCritical(rollData) {\r\n    const result = parseInt(rollData.result);\r\n    const formula = rollData.formula.toLowerCase();\r\n\r\n    // Check for d20 rolls\r\n    if (formula.includes('d20') || formula.includes('1d20')) {\r\n      if (result === 20) return 'critical-success';\r\n      if (result === 1) return 'critical-failure';\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Shows a notification message\r\n   */\r\n  function showNotification(message, type = 'info') {\r\n    // Add animation styles if not already present\r\n    if (!document.querySelector('#notification-styles')) {\r\n      const style = document.createElement('style');\r\n      style.id = 'notification-styles';\r\n      style.textContent = `\r\n        @keyframes slideIn {\r\n          from {\r\n            opacity: 0;\r\n            transform: translateX(100%);\r\n          }\r\n          to {\r\n            opacity: 1;\r\n            transform: translateX(0);\r\n          }\r\n        }\r\n        \r\n        @keyframes slideOut {\r\n          from {\r\n            opacity: 1;\r\n            transform: translateX(0);\r\n          }\r\n          to {\r\n            opacity: 0;\r\n            transform: translateX(100%);\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n\r\n    const notification = document.createElement('div');\r\n    notification.style.cssText = `\r\n      position: fixed;\r\n      top: 20px;\r\n      right: 20px;\r\n      background: ${type === 'success' ? '#FC57F9' : type === 'error' ? '#E74C3C' : '#FC57F9'};\r\n      color: white;\r\n      padding: 15px 20px;\r\n      border-radius: 8px;\r\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\r\n      z-index: 100002;\r\n      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n      font-size: 14px;\r\n      max-width: 300px;\r\n      animation: slideIn 0.3s ease-out;\r\n    `;\r\n    notification.textContent = message;\r\n    \r\n    document.body.appendChild(notification);\r\n    \r\n    setTimeout(() => {\r\n      notification.style.animation = 'slideOut 0.3s ease-in';\r\n      setTimeout(() => notification.remove(), 300);\r\n    }, 3000);\r\n  }\r\n\r\n  /**\r\n   * Shows the overlay in a popup window instead of inline\r\n   */\r\n  function showOverlay() {\r\n    // Load character data first\r\n    browserAPI.runtime.sendMessage({ action: 'getCharacterData' }, (response) => {\r\n      if (browserAPI.runtime.lastError) {\r\n        debug.error('\u274C Extension context error:', browserAPI.runtime.lastError);\r\n        showNotification('Extension context error. Please refresh the page.', 'error');\r\n        return;\r\n      }\r\n\r\n      if (response && response.data) {\r\n        debug.log('\u2705 Character data loaded for popup:', response.data.name);\r\n\r\n        // Parse the raw data for the character sheet\r\n        const parsedData = parseForRollCloud(response.data.raw);\r\n        debug.log('\u2705 Parsed character data for sheet:', parsedData);\r\n\r\n        // Get the popup HTML file URL\r\n        const popupURL = browserAPI.runtime.getURL('src/popup-sheet.html');\r\n\r\n        let messageSent = false;\r\n        let popupWindow = null;\r\n\r\n        // Set up message listener BEFORE opening the window to avoid race condition\r\n        const messageHandler = (event) => {\r\n          if (event.data && event.data.action === 'popupReady' && popupWindow && !messageSent) {\r\n            debug.log('\u2705 Popup is ready, sending character data...');\r\n            messageSent = true;\r\n            try {\r\n              popupWindow.postMessage({\r\n                action: 'initCharacterSheet',\r\n                data: parsedData // Send PARSED character data to popup\r\n              }, '*');\r\n              debug.log('\u2705 Character data sent to popup via postMessage');\r\n            } catch (error) {\r\n              debug.warn('\u26A0\uFE0F Could not send message to popup (Firefox security):', error.message);\r\n              // The popup will use storage fallback if postMessage fails\r\n            }\r\n            // Clean up listener after a delay\r\n            setTimeout(() => {\r\n              window.removeEventListener('message', messageHandler);\r\n            }, 1000);\r\n          }\r\n        };\r\n        window.addEventListener('message', messageHandler);\r\n\r\n        // Close any existing popup window before opening a new one\r\n        // Firefox can throw errors when accessing properties of closed windows\r\n        try {\r\n          if (activePopupWindow && !activePopupWindow.closed) {\r\n            debug.log('\uD83D\uDCCB Closing existing popup window...');\r\n            activePopupWindow.close();\r\n          }\r\n        } catch (error) {\r\n          // Firefox throws \"can't access dead object\" error for closed windows\r\n          debug.log('\uD83D\uDCCB Existing popup already closed (Firefox)');\r\n        }\r\n        // Always reset the reference before opening new window\r\n        activePopupWindow = null;\r\n\r\n        // Now open the popup window\r\n        try {\r\n          popupWindow = window.open(popupURL, 'rollcloud-character-sheet', 'width=900,height=700,scrollbars=yes,resizable=yes,menubar=no,toolbar=no,location=no,status=no');\r\n        } catch (error) {\r\n          debug.error(' Error opening popup window:', error);\r\n          popupWindow = null;\r\n        }\r\n\r\n        if (!popupWindow) {\r\n          debug.error(' Failed to open popup window. Please allow popups for this site.');\r\n          showNotification('Popup blocked. Please allow popups for this site. Retrying...', 'error');\r\n          window.removeEventListener('message', messageHandler);\r\n          \r\n          // Retry after a short delay\r\n          setTimeout(() => {\r\n            debug.log(' Retrying popup window open...');\r\n            showOverlay();\r\n          }, 1000);\r\n          return;\r\n        }\r\n\r\n        // Store reference to the active popup\r\n        activePopupWindow = popupWindow;\r\n\r\n        // Fallback: Send data after a delay if popup hasn't sent ready message\r\n        // This handles cases where the popup loads faster than expected\r\n        setTimeout(() => {\r\n          if (!messageSent && popupWindow) {\r\n            try {\r\n              // Firefox can throw \"dead object\" error even when accessing .closed property\r\n              if (!popupWindow.closed) {\r\n                debug.log('\u23F1\uFE0F Fallback: Sending character data after timeout...');\r\n                messageSent = true;\r\n                popupWindow.postMessage({\r\n                  action: 'initCharacterSheet',\r\n                  data: response.data\r\n                }, '*');\r\n                debug.log('\u2705 Character data sent via fallback');\r\n              }\r\n            } catch (error) {\r\n              debug.warn('\u26A0\uFE0F Could not send fallback message to popup (Firefox security):', error.message);\r\n              // The popup will load data from storage if postMessage fails\r\n            }\r\n          }\r\n        }, 500);\r\n\r\n        overlayVisible = true;\r\n        showNotification('Character sheet opened! \uD83C\uDFB2', 'success');\r\n        debug.log('\u2705 Popup window opened successfully');\r\n\r\n      } else {\r\n        debug.log('\uD83D\uDCCB No character data found - asking user about GM mode');\r\n\r\n        // Ask user if they want to open GM mode instead\r\n        const userConfirmed = confirm('No character data found.\\n\\nWould you like to open GM mode instead?');\r\n\r\n        if (userConfirmed) {\r\n          // User clicked \"Yes\" - trigger GM mode via roll20.js\r\n          debug.log('\u2705 User confirmed - requesting GM mode via showCharacterSheet');\r\n          // Send message to roll20.js to open GM mode\r\n          // This will trigger the same flow as the popup button\r\n          const event = new CustomEvent('openGMMode');\r\n          document.dispatchEvent(event);\r\n          showNotification('Opening GM mode...', 'success');\r\n        } else {\r\n          // User clicked \"Cancel\" - just show error\r\n          debug.log('\u2139\uFE0F User cancelled GM mode opening');\r\n          showNotification('No character data found. Please sync from Dice Cloud first.', 'error');\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Hides the overlay\r\n   */\r\n  function hideOverlay() {\r\n    if (overlayElement) {\r\n      overlayElement.style.display = 'none';\r\n    }\r\n    overlayVisible = false;\r\n  }\r\n\r\n  // NOTE: announceToRoll20() function removed - spell announcements now handled solely by roll20.js to prevent duplicates\r\n\r\n  // Listen for messages from popout window\r\n  window.addEventListener('message', (event) => {\r\n    // NOTE: rollFromPopout is handled by roll20.js - do NOT handle it here to avoid duplicate rolls\r\n    if (event.data.action === 'updateCharacterData') {\r\n      debug.log('\uD83D\uDCBE Received character data update from popup:', event.data.data);\r\n\r\n      // Save updated character data to storage\r\n      browserAPI.runtime.sendMessage({\r\n        action: 'storeCharacterData',\r\n        data: event.data.data\r\n      }, (response) => {\r\n        if (response && response.success) {\r\n          debug.log('\u2705 Character data updated successfully');\r\n        } else {\r\n          debug.error('\u274C Failed to update character data');\r\n        }\r\n      });\r\n    }\r\n\r\n    // NOTE: announceSpell is handled by roll20.js to prevent duplicate messages\r\n  });\r\n\r\n  // Listen for messages from background script\r\n  /**\r\n   * Makes a button draggable and adds hide/show functionality\r\n   */\r\n  function makeButtonDraggable(button, storageKey) {\r\n    let isDragging = false;\r\n    let startX, startY, initialLeft, initialTop;\r\n\r\n    // Helper function to validate if position is within viewport\r\n    function isPositionValid(left, top) {\r\n      const leftPx = parseFloat(left);\r\n      const topPx = parseFloat(top);\r\n\r\n      // Check if position is within reasonable viewport bounds\r\n      // Allow some negative values but not completely off-screen\r\n      const minTop = -20; // Allow slightly above viewport (for aesthetic dragging)\r\n      const maxTop = window.innerHeight - 20; // Ensure at least 20px visible at bottom\r\n      const minLeft = -100; // Allow partially off left edge\r\n      const maxLeft = window.innerWidth - 20; // Ensure at least 20px visible on right\r\n\r\n      return topPx >= minTop && topPx <= maxTop && leftPx >= minLeft && leftPx <= maxLeft;\r\n    }\r\n\r\n    // Load saved position\r\n    const savedPosition = localStorage.getItem(`${storageKey}_position`);\r\n    if (savedPosition) {\r\n      const { left, top } = JSON.parse(savedPosition);\r\n\r\n      // Validate position before applying it\r\n      if (isPositionValid(left, top)) {\r\n        button.style.left = left;\r\n        button.style.top = top;\r\n        button.style.transform = 'none'; // Remove centering transform when positioned\r\n      } else {\r\n        // Invalid position detected - clear it and log\r\n        debug.log(`\uD83D\uDD27 Clearing invalid button position: left=${left}, top=${top}`);\r\n        localStorage.removeItem(`${storageKey}_position`);\r\n        // Keep default centered position\r\n      }\r\n    }\r\n\r\n    // Load saved visibility\r\n    const savedVisibility = localStorage.getItem(`${storageKey}_hidden`);\r\n    if (savedVisibility === 'true') {\r\n      button.style.display = 'none';\r\n    }\r\n\r\n    button.addEventListener('mousedown', (e) => {\r\n      // Only start dragging on left click\r\n      if (e.button === 0) {\r\n        isDragging = true;\r\n        startX = e.clientX;\r\n        startY = e.clientY;\r\n\r\n        // Batch layout read before style writes to avoid forced reflow\r\n        const rect = button.getBoundingClientRect();\r\n        initialLeft = rect.left;\r\n        initialTop = rect.top;\r\n\r\n        // Defer style writes to next frame\r\n        requestAnimationFrame(() => {\r\n          button.style.cursor = 'grabbing';\r\n          button.style.transform = 'none'; // Remove any transform during drag\r\n        });\r\n\r\n        e.preventDefault();\r\n      }\r\n    });\r\n\r\n    document.addEventListener('mousemove', (e) => {\r\n      if (isDragging) {\r\n        const deltaX = e.clientX - startX;\r\n        const deltaY = e.clientY - startY;\r\n\r\n        const newLeft = initialLeft + deltaX;\r\n        const newTop = initialTop + deltaY;\r\n\r\n        // Use requestAnimationFrame to avoid forced reflow\r\n        requestAnimationFrame(() => {\r\n          button.style.left = `${newLeft}px`;\r\n          button.style.top = `${newTop}px`;\r\n        });\r\n      }\r\n    });\r\n\r\n    document.addEventListener('mouseup', () => {\r\n      if (isDragging) {\r\n        isDragging = false;\r\n        button.style.cursor = 'pointer';\r\n\r\n        // Validate and save position only if it's within viewport\r\n        if (isPositionValid(button.style.left, button.style.top)) {\r\n          localStorage.setItem(`${storageKey}_position`, JSON.stringify({\r\n            left: button.style.left,\r\n            top: button.style.top\r\n          }));\r\n        } else {\r\n          // Position is off-screen, don't save it\r\n          debug.log('\u26A0\uFE0F Button position is off-screen, not saving');\r\n        }\r\n      }\r\n    });\r\n\r\n    // Right-click context menu\r\n    button.addEventListener('contextmenu', (e) => {\r\n      e.preventDefault();\r\n\r\n      // Create context menu\r\n      const existingMenu = document.getElementById('rollcloud-context-menu');\r\n      if (existingMenu) existingMenu.remove();\r\n\r\n      const menu = document.createElement('div');\r\n      menu.id = 'rollcloud-context-menu';\r\n\r\n      // Get adjusted position within viewport bounds\r\n      const position = getPopupPosition(e.clientX, e.clientY, 200, 150);\r\n\r\n      menu.style.cssText = `\r\n        position: fixed;\r\n        left: ${position.x}px;\r\n        top: ${position.y}px;\r\n        background: #1a1a1a;\r\n        border: 1px solid #ccc;\r\n        border-radius: 4px;\r\n        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\r\n        z-index: 1000000;\r\n        padding: 5px 0;\r\n      `;\r\n\r\n      const hideOption = document.createElement('div');\r\n      hideOption.textContent = '\uD83D\uDE48 Hide Button';\r\n      hideOption.style.cssText = `\r\n        padding: 8px 16px;\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n      `;\r\n      hideOption.addEventListener('mouseenter', () => {\r\n        hideOption.style.background = '#f0f0f0';\r\n      });\r\n      hideOption.addEventListener('mouseleave', () => {\r\n        hideOption.style.background = 'white';\r\n      });\r\n      hideOption.addEventListener('click', () => {\r\n        button.style.display = 'none';\r\n        localStorage.setItem(`${storageKey}_hidden`, 'true');\r\n        menu.remove();\r\n        showNotification('Button hidden. Use extension popup to show it again.', 'info');\r\n      });\r\n\r\n      const resetOption = document.createElement('div');\r\n      resetOption.textContent = '\uD83D\uDD04 Reset Position';\r\n      resetOption.style.cssText = `\r\n        padding: 8px 16px;\r\n        cursor: pointer;\r\n        font-size: 14px;\r\n        border-top: 1px solid #eee;\r\n      `;\r\n      resetOption.addEventListener('mouseenter', () => {\r\n        resetOption.style.background = '#f0f0f0';\r\n      });\r\n      resetOption.addEventListener('mouseleave', () => {\r\n        resetOption.style.background = 'white';\r\n      });\r\n      resetOption.addEventListener('click', () => {\r\n        localStorage.removeItem(`${storageKey}_position`);\r\n        if (storageKey === 'rollcloud-sheet-toggle') {\r\n          button.style.left = '50%';\r\n          button.style.top = '20px';\r\n          button.style.transform = 'translateX(-50%)';\r\n        } else {\r\n          button.style.left = '20px';\r\n          button.style.top = 'auto';\r\n          button.style.bottom = '20px';\r\n        }\r\n        menu.remove();\r\n        showNotification('Button position reset', 'success');\r\n      });\r\n\r\n      menu.appendChild(hideOption);\r\n      menu.appendChild(resetOption);\r\n      document.body.appendChild(menu);\r\n\r\n      // Close menu when clicking outside\r\n      setTimeout(() => {\r\n        document.addEventListener('click', () => {\r\n          menu.remove();\r\n        }, { once: true });\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Creates the toggle button for opening the character sheet\r\n   */\r\n  function createToggleButton() {\r\n    // Check if button already exists\r\n    if (document.getElementById('rollcloud-sheet-toggle')) {\r\n      debug.log('\u26A0\uFE0F Character sheet button already exists');\r\n      return;\r\n    }\r\n\r\n    const button = document.createElement('button');\r\n    button.id = 'rollcloud-sheet-toggle';\r\n    button.innerHTML = '\uD83D\uDCCB Character Sheet';\r\n    button.style.cssText = `\r\n      position: fixed;\r\n      top: 20px;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      background: linear-gradient(135deg, #FC57F9 0%, #8E0682 100%);\r\n      color: white;\r\n      border: none;\r\n      padding: 12px 20px;\r\n      border-radius: 8px;\r\n      cursor: pointer;\r\n      font-size: 14px;\r\n      font-weight: bold;\r\n      box-shadow: 0 4px 15px rgba(252, 87, 249, 0.3);\r\n      z-index: 999998;\r\n      transition: transform 0.2s, box-shadow 0.2s;\r\n      user-select: none;\r\n    `;\r\n\r\n    // Hover effects\r\n    button.addEventListener('mouseenter', () => {\r\n      if (!button.style.left || button.style.left === '50%') {\r\n        button.style.transform = 'translateX(-50%) translateY(-2px)';\r\n      }\r\n      button.style.boxShadow = '0 6px 20px rgba(252, 87, 249, 0.5)';\r\n    });\r\n\r\n    button.addEventListener('mouseleave', () => {\r\n      if (!button.style.left || button.style.left === '50%') {\r\n        button.style.transform = 'translateX(-50%) translateY(0)';\r\n      }\r\n      button.style.boxShadow = '0 4px 15px rgba(252, 87, 249, 0.3)';\r\n    });\r\n\r\n    // Click to open popup\r\n    button.addEventListener('click', () => {\r\n      showOverlay();\r\n    });\r\n\r\n    document.body.appendChild(button);\r\n\r\n    // Make it draggable and add hide/show functionality\r\n    makeButtonDraggable(button, 'rollcloud-sheet-toggle');\r\n\r\n    debug.log('\u2705 Character sheet button created');\r\n  }\r\n\r\n  // Listen for messages from background script\r\n  browserAPI.runtime.onMessage.addListener((request, sender, sendResponse) => {\r\n    if (request.action === 'postRollToChat') {\r\n      // Handle roll from DiceCloud\r\n      if (request.roll) {\r\n        debug.log('\uD83C\uDFB2 Received roll in overlay:', request.roll);\r\n\r\n        // Only add to history if it's an actual roll (has a formula)\r\n        // Announcements like spells/actions don't have formulas\r\n        if (request.roll.formula) {\r\n          addToRollHistory(request.roll);\r\n        }\r\n\r\n        // Show notification\r\n        showNotification(`Roll received: ${request.roll.name || 'dice roll'}`, 'success');\r\n\r\n        // Update overlay if visible\r\n        if (overlayVisible) {\r\n          updateRollHistoryDisplay();\r\n          updateStatsDisplay();\r\n        }\r\n      }\r\n      sendResponse({ success: true });\r\n    } else if (request.action === 'showCharacterSheetButton') {\r\n      // Show the character sheet button\r\n      const button = document.getElementById('rollcloud-sheet-toggle');\r\n      if (button) {\r\n        button.style.display = '';\r\n        localStorage.removeItem('rollcloud-sheet-toggle_hidden');\r\n        showNotification('Character Sheet button shown', 'success');\r\n      }\r\n      sendResponse({ success: true });\r\n    } else if (request.action === 'showStatusBar') {\r\n      // Show the status bar\r\n      showStatusBar();\r\n      showNotification('Status bar shown', 'success');\r\n      sendResponse({ success: true });\r\n    } else if (request.action === 'hideStatusBar') {\r\n      // Hide the status bar\r\n      hideStatusBar();\r\n      sendResponse({ success: true });\r\n    } else if (request.action === 'toggleStatusBar') {\r\n      // Toggle the status bar visibility\r\n      toggleStatusBar();\r\n      sendResponse({ success: true, visible: statusBarVisible });\r\n    } else if (request.action === 'refreshStatusBar') {\r\n      // Refresh status bar with latest character data\r\n      loadStatusBarData();\r\n      sendResponse({ success: true });\r\n    }\r\n    return true;\r\n  });\r\n\r\n  // ============================================\r\n  // STATUS BAR OVERLAY\r\n  // ============================================\r\n\r\n  let statusBarElement = null;\r\n  let statusBarVisible = true; // Start visible by default\r\n  let statusBarAdvantageState = 'normal';\r\n\r\n  /**\r\n   * Creates the compact status bar overlay\r\n   */\r\n  function createStatusBarOverlay() {\r\n    if (statusBarElement) return;\r\n\r\n    statusBarElement = document.createElement('div');\r\n    statusBarElement.id = 'rollcloud-status-bar';\r\n    statusBarElement.innerHTML = `\r\n      <div class=\"status-bar-container\">\r\n        <div class=\"status-bar-header\">\r\n          <span class=\"status-char-name\" id=\"status-char-name\">Loading...</span>\r\n          <button class=\"status-close-btn\" id=\"status-close-btn\">\u2715</button>\r\n        </div>\r\n\r\n        <!-- HP Row -->\r\n        <div class=\"status-hp-row\">\r\n          <span class=\"status-hp-icon\">\u2764\uFE0F</span>\r\n          <div class=\"status-hp-bar\">\r\n            <div class=\"status-hp-fill\" id=\"status-hp-fill\"></div>\r\n            <div class=\"status-hp-text\" id=\"status-hp-text\">0/0</div>\r\n          </div>\r\n          <span class=\"status-temp-hp\" id=\"status-temp-hp\"></span>\r\n        </div>\r\n\r\n        <!-- Advantage Toggle -->\r\n        <div class=\"status-adv-row\">\r\n          <button class=\"status-adv-btn adv\" id=\"status-adv-btn\" title=\"Advantage\">\u2B06\uFE0F</button>\r\n          <button class=\"status-adv-btn norm active\" id=\"status-norm-btn\" title=\"Normal\">\uD83C\uDFB2</button>\r\n          <button class=\"status-adv-btn dis\" id=\"status-dis-btn\" title=\"Disadvantage\">\u2B07\uFE0F</button>\r\n        </div>\r\n\r\n        <!-- Concentration -->\r\n        <div class=\"status-conc-row inactive\" id=\"status-concentration\">\r\n          <span>\uD83E\uDDE0</span>\r\n          <span class=\"status-conc-spell\" id=\"status-conc-spell\">\u2014</span>\r\n        </div>\r\n\r\n        <!-- Spell Slots Dropdown -->\r\n        <div class=\"status-slots-row\" id=\"status-slots-row\">\r\n          <div class=\"status-slots-header\" id=\"status-slots-header\">\r\n            <span>\u2728</span>\r\n            <span class=\"status-slots-summary\" id=\"status-slots-summary\">Slots</span>\r\n            <span class=\"status-slots-arrow\">\u25BC</span>\r\n          </div>\r\n          <div class=\"status-slots-dropdown\" id=\"status-slots-dropdown\"></div>\r\n        </div>\r\n\r\n        <!-- Resources -->\r\n        <div class=\"status-resources-row\" id=\"status-resources-row\" style=\"display: none;\">\r\n          <div id=\"status-resources-list\"></div>\r\n        </div>\r\n\r\n        <!-- Effects -->\r\n        <div class=\"status-effects-row\" id=\"status-effects-row\">\r\n          <span class=\"status-no-effects\">No effects</span>\r\n        </div>\r\n\r\n        <!-- Resize Handle -->\r\n        <div class=\"status-resize-handle\" id=\"status-resize-handle\"></div>\r\n      </div>\r\n    `;\r\n\r\n    // Add styles\r\n    const style = document.createElement('style');\r\n    style.id = 'rollcloud-status-bar-styles';\r\n    style.textContent = `\r\n      #rollcloud-status-bar {\r\n        position: fixed;\r\n        bottom: 20px;\r\n        right: 20px;\r\n        width: 180px;\r\n        min-width: 150px;\r\n        max-width: 400px;\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n        font-size: 14px;\r\n        z-index: 999997;\r\n        user-select: none;\r\n      }\r\n\r\n      .status-bar-container {\r\n        background: #1a1a1a;\r\n        color: #e0e0e0;\r\n        padding: 8px;\r\n        border-radius: 8px;\r\n        box-shadow: 0 4px 15px rgba(0,0,0,0.4);\r\n        border: 1px solid #FC57F9;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 5px;\r\n        position: relative;\r\n      }\r\n\r\n      .status-bar-header {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        padding-bottom: 5px;\r\n        border-bottom: 1px solid #333;\r\n      }\r\n\r\n      .status-char-name {\r\n        font-size: 14px;\r\n        font-weight: bold;\r\n        color: #FC57F9;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        flex: 1;\r\n      }\r\n\r\n      .status-close-btn {\r\n        background: none;\r\n        border: none;\r\n        color: #555;\r\n        font-size: 15px;\r\n        cursor: pointer;\r\n        padding: 2px;\r\n        line-height: 1;\r\n      }\r\n\r\n      .status-close-btn:hover { color: #e74c3c; }\r\n\r\n      /* HP Row */\r\n      .status-hp-row {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 5px;\r\n        background: #2a2a2a;\r\n        border-radius: 4px;\r\n        padding: 5px;\r\n      }\r\n\r\n      .status-hp-icon { font-size: 15px; }\r\n\r\n      .status-hp-bar {\r\n        flex: 1;\r\n        height: 18px;\r\n        background: #1a1a1a;\r\n        border-radius: 3px;\r\n        overflow: hidden;\r\n        position: relative;\r\n      }\r\n\r\n      .status-hp-fill {\r\n        height: 100%;\r\n        background: linear-gradient(90deg, #8E0682, #FC57F9);\r\n        transition: width 0.3s ease;\r\n      }\r\n\r\n      .status-hp-fill.low { background: linear-gradient(90deg, #e67e22, #f39c12); }\r\n      .status-hp-fill.critical { background: linear-gradient(90deg, #c0392b, #e74c3c); }\r\n\r\n      .status-hp-text {\r\n        position: absolute;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        font-size: 11px;\r\n        font-weight: bold;\r\n        color: white;\r\n        text-shadow: 0 0 2px rgba(0,0,0,0.8);\r\n      }\r\n\r\n      .status-temp-hp {\r\n        font-size: 11px;\r\n        color: #3498db;\r\n        font-weight: bold;\r\n      }\r\n\r\n      /* Advantage Toggle */\r\n      .status-adv-row {\r\n        display: flex;\r\n        gap: 3px;\r\n        background: #2a2a2a;\r\n        border-radius: 4px;\r\n        padding: 4px;\r\n      }\r\n\r\n      .status-adv-btn {\r\n        flex: 1;\r\n        padding: 5px 3px;\r\n        border: none;\r\n        border-radius: 3px;\r\n        cursor: pointer;\r\n        font-size: 15px;\r\n        background: #1a1a1a;\r\n        transition: all 0.2s;\r\n      }\r\n\r\n      .status-adv-btn.adv { color: #8E0682; }\r\n      .status-adv-btn.norm { color: #888; }\r\n      .status-adv-btn.dis { color: #e74c3c; }\r\n\r\n      .status-adv-btn.active.adv { background: #8E0682; color: white; }\r\n      .status-adv-btn.active.norm { background: #3498db; color: white; }\r\n      .status-adv-btn.active.dis { background: #e74c3c; color: white; }\r\n\r\n      /* Concentration */\r\n      .status-conc-row {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 5px;\r\n        background: #2a2a2a;\r\n        border-radius: 4px;\r\n        padding: 5px;\r\n        font-size: 12px;\r\n      }\r\n\r\n      .status-conc-row.active {\r\n        background: #2c3e50;\r\n        border: 1px solid #9b59b6;\r\n      }\r\n\r\n      .status-conc-spell {\r\n        flex: 1;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        color: #9b59b6;\r\n      }\r\n\r\n      .status-conc-row.inactive .status-conc-spell { color: #555; }\r\n\r\n      /* Spell Slots */\r\n      .status-slots-row {\r\n        position: relative;\r\n        background: #2a2a2a;\r\n        border-radius: 4px;\r\n        padding: 5px;\r\n      }\r\n\r\n      .status-slots-header {\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 5px;\r\n        cursor: pointer;\r\n        font-size: 12px;\r\n      }\r\n\r\n      .status-slots-summary {\r\n        flex: 1;\r\n        color: #9b59b6;\r\n      }\r\n\r\n      .status-slots-arrow {\r\n        font-size: 10px;\r\n        transition: transform 0.2s;\r\n      }\r\n\r\n      .status-slots-row.open .status-slots-arrow {\r\n        transform: rotate(180deg);\r\n      }\r\n\r\n      .status-slots-dropdown {\r\n        display: none;\r\n        margin-top: 5px;\r\n        padding-top: 5px;\r\n        border-top: 1px solid #333;\r\n      }\r\n\r\n      .status-slots-row.open .status-slots-dropdown { display: block; }\r\n\r\n      .status-slot-item {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        padding: 3px 0;\r\n        font-size: 11px;\r\n      }\r\n\r\n      .status-slot-item .lvl { color: #888; }\r\n      .status-slot-item .val { color: #9b59b6; font-weight: bold; }\r\n      .status-slot-item .val.empty { color: #555; }\r\n      .status-slot-item.pact .val { color: #1abc9c; }\r\n\r\n      /* Resources */\r\n      .status-resources-row {\r\n        background: #2a2a2a;\r\n        border-radius: 4px;\r\n        padding: 4px;\r\n      }\r\n\r\n      .status-resource-item {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        padding: 2px 0;\r\n        font-size: 11px;\r\n      }\r\n\r\n      .status-resource-item .name {\r\n        color: #888;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        max-width: 88px;\r\n      }\r\n\r\n      .status-resource-item .val { color: #f39c12; font-weight: bold; }\r\n\r\n      /* Effects */\r\n      .status-effects-row {\r\n        display: flex;\r\n        flex-wrap: wrap;\r\n        gap: 3px;\r\n        background: #2a2a2a;\r\n        border-radius: 4px;\r\n        padding: 4px;\r\n        min-height: 24px;\r\n      }\r\n\r\n      .status-effect-badge {\r\n        font-size: 10px;\r\n        padding: 2px 6px;\r\n        border-radius: 4px;\r\n        white-space: nowrap;\r\n        font-weight: 500;\r\n      }\r\n\r\n      .status-effect-badge.buff {\r\n        background: #8E0682;\r\n        color: white;\r\n      }\r\n\r\n      .status-effect-badge.debuff {\r\n        background: #c0392b;\r\n        color: white;\r\n      }\r\n\r\n      .status-no-effects {\r\n        color: #555;\r\n        font-size: 11px;\r\n        text-align: center;\r\n        width: 100%;\r\n      }\r\n\r\n      /* Resize Handle */\r\n      .status-resize-handle {\r\n        position: absolute;\r\n        bottom: 0;\r\n        right: 0;\r\n        width: 16px;\r\n        height: 16px;\r\n        cursor: nwse-resize;\r\n        background: linear-gradient(135deg, transparent 50%, #FC57F9 50%);\r\n        border-radius: 0 0 8px 0;\r\n        opacity: 0.5;\r\n        transition: opacity 0.2s;\r\n      }\r\n\r\n      .status-resize-handle:hover {\r\n        opacity: 1;\r\n      }\r\n\r\n      .status-resize-handle::before {\r\n        content: '';\r\n        position: absolute;\r\n        bottom: 3px;\r\n        right: 3px;\r\n        width: 6px;\r\n        height: 6px;\r\n        border-right: 2px solid #1a1a1a;\r\n        border-bottom: 2px solid #1a1a1a;\r\n      }\r\n    `;\r\n\r\n    document.head.appendChild(style);\r\n    document.body.appendChild(statusBarElement);\r\n\r\n    // Event listeners\r\n    document.getElementById('status-close-btn').addEventListener('click', () => {\r\n      hideStatusBar();\r\n    });\r\n\r\n    // Advantage toggle buttons\r\n    document.getElementById('status-adv-btn').addEventListener('click', () => setStatusBarAdvantage('advantage'));\r\n    document.getElementById('status-norm-btn').addEventListener('click', () => setStatusBarAdvantage('normal'));\r\n    document.getElementById('status-dis-btn').addEventListener('click', () => setStatusBarAdvantage('disadvantage'));\r\n\r\n    // Spell slots dropdown toggle\r\n    document.getElementById('status-slots-header').addEventListener('click', () => {\r\n      document.getElementById('status-slots-row').classList.toggle('open');\r\n    });\r\n\r\n    // Make status bar draggable\r\n    makeStatusBarDraggable();\r\n\r\n    // Make status bar resizable\r\n    makeStatusBarResizable();\r\n\r\n    // Load character data\r\n    loadStatusBarData();\r\n\r\n    debug.log('\u2705 Status bar overlay created');\r\n  }\r\n\r\n  /**\r\n   * Makes the status bar draggable with viewport bounds checking\r\n   */\r\n  function makeStatusBarDraggable() {\r\n    const statusBar = statusBarElement;\r\n    let isDragging = false;\r\n    let startX, startY, initialLeft, initialTop;\r\n\r\n    const header = statusBar.querySelector('.status-bar-header');\r\n\r\n    // Status bar dimensions (approximate)\r\n    const STATUS_BAR_WIDTH = 150;\r\n    const STATUS_BAR_HEIGHT = 200;\r\n\r\n    /**\r\n     * Validates if a position is within viewport bounds\r\n     */\r\n    function isPositionValid(leftPx, topPx) {\r\n      const minTop = -20;\r\n      const maxTop = window.innerHeight - 40; // Ensure at least 40px visible\r\n      const minLeft = -STATUS_BAR_WIDTH + 40; // Allow partial off left edge\r\n      const maxLeft = window.innerWidth - 40; // Ensure at least 40px visible on right\r\n\r\n      return topPx >= minTop && topPx <= maxTop && leftPx >= minLeft && leftPx <= maxLeft;\r\n    }\r\n\r\n    /**\r\n     * Clamps a position to viewport bounds\r\n     */\r\n    function clampPosition(leftPx, topPx) {\r\n      const minTop = 0;\r\n      const maxTop = window.innerHeight - 40;\r\n      const minLeft = 0;\r\n      const maxLeft = window.innerWidth - STATUS_BAR_WIDTH;\r\n\r\n      return {\r\n        left: Math.max(minLeft, Math.min(maxLeft, leftPx)),\r\n        top: Math.max(minTop, Math.min(maxTop, topPx))\r\n      };\r\n    }\r\n\r\n    // Load saved position with validation\r\n    const savedPosition = localStorage.getItem('rollcloud-status-bar_position');\r\n    if (savedPosition) {\r\n      const { left, top } = JSON.parse(savedPosition);\r\n      const leftPx = parseFloat(left);\r\n      const topPx = parseFloat(top);\r\n\r\n      if (isPositionValid(leftPx, topPx)) {\r\n        statusBar.style.left = left;\r\n        statusBar.style.top = top;\r\n        statusBar.style.right = 'auto';\r\n        statusBar.style.bottom = 'auto';\r\n      } else {\r\n        // Invalid position - clear it and use default\r\n        debug.log(`\uD83D\uDD27 Clearing invalid status bar position: left=${left}, top=${top}`);\r\n        localStorage.removeItem('rollcloud-status-bar_position');\r\n      }\r\n    }\r\n\r\n    header.style.cursor = 'grab';\r\n\r\n    header.addEventListener('mousedown', (e) => {\r\n      if (e.target.classList.contains('status-close-btn')) return;\r\n\r\n      isDragging = true;\r\n      startX = e.clientX;\r\n      startY = e.clientY;\r\n\r\n      const rect = statusBar.getBoundingClientRect();\r\n      initialLeft = rect.left;\r\n      initialTop = rect.top;\r\n\r\n      header.style.cursor = 'grabbing';\r\n      e.preventDefault();\r\n    });\r\n\r\n    document.addEventListener('mousemove', (e) => {\r\n      if (!isDragging) return;\r\n\r\n      const deltaX = e.clientX - startX;\r\n      const deltaY = e.clientY - startY;\r\n\r\n      let newLeft = initialLeft + deltaX;\r\n      let newTop = initialTop + deltaY;\r\n\r\n      // Clamp to viewport bounds during drag\r\n      const clamped = clampPosition(newLeft, newTop);\r\n      newLeft = clamped.left;\r\n      newTop = clamped.top;\r\n\r\n      requestAnimationFrame(() => {\r\n        statusBar.style.left = `${newLeft}px`;\r\n        statusBar.style.top = `${newTop}px`;\r\n        statusBar.style.right = 'auto';\r\n        statusBar.style.bottom = 'auto';\r\n      });\r\n    });\r\n\r\n    document.addEventListener('mouseup', () => {\r\n      if (isDragging) {\r\n        isDragging = false;\r\n        header.style.cursor = 'grab';\r\n\r\n        // Validate and save position only if within bounds\r\n        const leftPx = parseFloat(statusBar.style.left);\r\n        const topPx = parseFloat(statusBar.style.top);\r\n\r\n        if (isPositionValid(leftPx, topPx)) {\r\n          localStorage.setItem('rollcloud-status-bar_position', JSON.stringify({\r\n            left: statusBar.style.left,\r\n            top: statusBar.style.top\r\n          }));\r\n        } else {\r\n          debug.log('\u26A0\uFE0F Status bar position is off-screen, not saving');\r\n        }\r\n      }\r\n    });\r\n\r\n    // Right-click context menu for reset\r\n    statusBar.addEventListener('contextmenu', (e) => {\r\n      e.preventDefault();\r\n\r\n      const existingMenu = document.getElementById('status-bar-context-menu');\r\n      if (existingMenu) existingMenu.remove();\r\n\r\n      const menu = document.createElement('div');\r\n      menu.id = 'status-bar-context-menu';\r\n      menu.style.cssText = `\r\n        position: fixed;\r\n        left: ${e.clientX}px;\r\n        top: ${e.clientY}px;\r\n        background: #1a1a1a;\r\n        border: 1px solid #ccc;\r\n        border-radius: 4px;\r\n        box-shadow: 0 2px 10px rgba(0,0,0,0.2);\r\n        z-index: 1000000;\r\n        padding: 5px 0;\r\n      `;\r\n\r\n      const resetPositionOption = document.createElement('div');\r\n      resetPositionOption.textContent = '\uD83D\uDD04 Reset Position';\r\n      resetPositionOption.style.cssText = `padding: 8px 16px; cursor: pointer; font-size: 14px;`;\r\n      resetPositionOption.addEventListener('mouseenter', () => resetPositionOption.style.background = '#f0f0f0');\r\n      resetPositionOption.addEventListener('mouseleave', () => resetPositionOption.style.background = 'white');\r\n      resetPositionOption.addEventListener('click', () => {\r\n        localStorage.removeItem('rollcloud-status-bar_position');\r\n        statusBar.style.left = 'auto';\r\n        statusBar.style.top = 'auto';\r\n        statusBar.style.right = '20px';\r\n        statusBar.style.bottom = '20px';\r\n        menu.remove();\r\n        showNotification('Status bar position reset', 'success');\r\n      });\r\n\r\n      const resetSizeOption = document.createElement('div');\r\n      resetSizeOption.textContent = '\uD83D\uDCD0 Reset Size';\r\n      resetSizeOption.style.cssText = `padding: 8px 16px; cursor: pointer; font-size: 14px; border-top: 1px solid #eee;`;\r\n      resetSizeOption.addEventListener('mouseenter', () => resetSizeOption.style.background = '#f0f0f0');\r\n      resetSizeOption.addEventListener('mouseleave', () => resetSizeOption.style.background = 'white');\r\n      resetSizeOption.addEventListener('click', () => {\r\n        localStorage.removeItem('rollcloud-status-bar_size');\r\n        statusBar.style.width = '150px';\r\n        const container = statusBar.querySelector('.status-bar-container');\r\n        if (container) {\r\n          container.style.height = '';\r\n          container.style.overflowY = '';\r\n        }\r\n        menu.remove();\r\n        showNotification('Status bar size reset', 'success');\r\n      });\r\n\r\n      menu.appendChild(resetPositionOption);\r\n      menu.appendChild(resetSizeOption);\r\n      document.body.appendChild(menu);\r\n\r\n      setTimeout(() => {\r\n        document.addEventListener('click', () => menu.remove(), { once: true });\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Makes the status bar resizable (width and height)\r\n   */\r\n  function makeStatusBarResizable() {\r\n    const statusBar = statusBarElement;\r\n    const container = statusBar.querySelector('.status-bar-container');\r\n    const resizeHandle = document.getElementById('status-resize-handle');\r\n    let isResizing = false;\r\n    let startX, startY, startWidth, startHeight;\r\n\r\n    // Load saved size\r\n    const savedSize = localStorage.getItem('rollcloud-status-bar_size');\r\n    if (savedSize) {\r\n      const { width, height } = JSON.parse(savedSize);\r\n      if (width >= 120 && width <= 400) {\r\n        statusBar.style.width = `${width}px`;\r\n      }\r\n      if (height >= 100 && height <= 600) {\r\n        container.style.height = `${height}px`;\r\n        container.style.overflowY = 'auto';\r\n      }\r\n    }\r\n\r\n    resizeHandle.addEventListener('mousedown', (e) => {\r\n      isResizing = true;\r\n      startX = e.clientX;\r\n      startY = e.clientY;\r\n      startWidth = statusBar.offsetWidth;\r\n      startHeight = container.offsetHeight;\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    });\r\n\r\n    document.addEventListener('mousemove', (e) => {\r\n      if (!isResizing) return;\r\n\r\n      const deltaX = e.clientX - startX;\r\n      const deltaY = e.clientY - startY;\r\n\r\n      // Calculate new dimensions\r\n      let newWidth = startWidth + deltaX;\r\n      let newHeight = startHeight + deltaY;\r\n\r\n      // Clamp to min/max\r\n      newWidth = Math.max(120, Math.min(400, newWidth));\r\n      newHeight = Math.max(100, Math.min(600, newHeight));\r\n\r\n      requestAnimationFrame(() => {\r\n        statusBar.style.width = `${newWidth}px`;\r\n        container.style.height = `${newHeight}px`;\r\n        container.style.overflowY = 'auto';\r\n      });\r\n    });\r\n\r\n    document.addEventListener('mouseup', () => {\r\n      if (isResizing) {\r\n        isResizing = false;\r\n\r\n        // Save size\r\n        localStorage.setItem('rollcloud-status-bar_size', JSON.stringify({\r\n          width: statusBar.offsetWidth,\r\n          height: container.offsetHeight\r\n        }));\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sets the advantage state in the status bar\r\n   */\r\n  function setStatusBarAdvantage(state) {\r\n    statusBarAdvantageState = state;\r\n\r\n    // Update UI\r\n    document.querySelectorAll('.status-adv-btn').forEach(btn => btn.classList.remove('active'));\r\n\r\n    if (state === 'advantage') {\r\n      document.getElementById('status-adv-btn').classList.add('active');\r\n    } else if (state === 'disadvantage') {\r\n      document.getElementById('status-dis-btn').classList.add('active');\r\n    } else {\r\n      document.getElementById('status-norm-btn').classList.add('active');\r\n    }\r\n\r\n    // Sync with overlay roll settings\r\n    rollStats.settings.advantageMode = state;\r\n\r\n    // Update overlay toggle buttons if they exist\r\n    document.querySelectorAll('.toggle-btn').forEach(btn => {\r\n      const btnMode = btn.getAttribute('data-mode');\r\n      if (btnMode === state) {\r\n        btn.classList.add('active');\r\n      } else {\r\n        btn.classList.remove('active');\r\n      }\r\n    });\r\n\r\n    debug.log(`\uD83C\uDFB2 Status bar advantage set to: ${state}`);\r\n  }\r\n\r\n  /**\r\n   * Loads character data into status bar\r\n   */\r\n  function loadStatusBarData() {\r\n    browserAPI.runtime.sendMessage({ action: 'getCharacterData' }, (response) => {\r\n      if (browserAPI.runtime.lastError) {\r\n        debug.error('\u274C Error loading status bar data:', browserAPI.runtime.lastError);\r\n        return;\r\n      }\r\n\r\n      if (response && response.data) {\r\n        characterData = response.data;\r\n        updateStatusBarDisplay();\r\n        debug.log('\u2705 Status bar data loaded:', response.data.name);\r\n      } else {\r\n        document.getElementById('status-char-name').textContent = 'No character';\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Updates the status bar display with current character data\r\n   */\r\n  function updateStatusBarDisplay() {\r\n    if (!characterData) return;\r\n\r\n    // Character name\r\n    document.getElementById('status-char-name').textContent = characterData.name || 'Unknown';\r\n\r\n    updateStatusBarHP();\r\n    updateStatusBarConcentration();\r\n    updateStatusBarSpellSlots();\r\n    updateStatusBarResources();\r\n    updateStatusBarEffects();\r\n  }\r\n\r\n  function updateStatusBarHP() {\r\n    const hp = characterData.hitPoints || characterData.hit_points || {};\r\n    const current = hp.current || 0;\r\n    const max = hp.max || 1;\r\n    const tempHP = characterData.temporaryHP || hp.temp || 0;\r\n\r\n    const percentage = Math.max(0, Math.min(100, (current / max) * 100));\r\n\r\n    const hpFill = document.getElementById('status-hp-fill');\r\n    const hpText = document.getElementById('status-hp-text');\r\n    const tempHPEl = document.getElementById('status-temp-hp');\r\n\r\n    hpFill.style.width = `${percentage}%`;\r\n    hpText.textContent = `${current}/${max}`;\r\n\r\n    hpFill.className = 'status-hp-fill';\r\n    if (percentage <= 25) hpFill.classList.add('critical');\r\n    else if (percentage <= 50) hpFill.classList.add('low');\r\n\r\n    tempHPEl.textContent = tempHP > 0 ? `+${tempHP}` : '';\r\n  }\r\n\r\n  function updateStatusBarConcentration() {\r\n    const concEl = document.getElementById('status-concentration');\r\n    const spellEl = document.getElementById('status-conc-spell');\r\n\r\n    // Hide concentration row if character has no spell slots (e.g., rogues)\r\n    const spellSlots = characterData.spellSlots || {};\r\n    let hasSpellSlots = false;\r\n    for (let level = 1; level <= 9; level++) {\r\n      if ((spellSlots[`level${level}SpellSlotsMax`] || 0) > 0) {\r\n        hasSpellSlots = true;\r\n        break;\r\n      }\r\n    }\r\n    // Also check for pact magic\r\n    if ((spellSlots.pactMagicSlotsMax || 0) > 0) {\r\n      hasSpellSlots = true;\r\n    }\r\n\r\n    if (!hasSpellSlots) {\r\n      concEl.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    concEl.style.display = 'flex';\r\n\r\n    // Support both formats: concentrationSpell (from postMessage) and concentration (from storage)\r\n    const spell = characterData.concentrationSpell || characterData.concentration || '';\r\n\r\n    if (spell) {\r\n      concEl.classList.remove('inactive');\r\n      concEl.classList.add('active');\r\n      spellEl.textContent = spell;\r\n    } else {\r\n      concEl.classList.remove('active');\r\n      concEl.classList.add('inactive');\r\n      spellEl.textContent = '\u2014';\r\n    }\r\n  }\r\n\r\n  function updateStatusBarSpellSlots() {\r\n    const spellSlots = characterData.spellSlots || {};\r\n    const slotsRow = document.getElementById('status-slots-row');\r\n    const dropdown = document.getElementById('status-slots-dropdown');\r\n    const summary = document.getElementById('status-slots-summary');\r\n\r\n    const slots = [];\r\n    let totalCurrent = 0;\r\n    let totalMax = 0;\r\n\r\n    // Regular spell slots (levels 1-9)\r\n    for (let level = 1; level <= 9; level++) {\r\n      const current = spellSlots[`level${level}SpellSlots`] || 0;\r\n      const max = spellSlots[`level${level}SpellSlotsMax`] || 0;\r\n\r\n      if (max > 0) {\r\n        slots.push({ level: level, current, max, type: 'regular' });\r\n        totalCurrent += current;\r\n        totalMax += max;\r\n      }\r\n    }\r\n\r\n    // Pact Magic\r\n    const pactCurrent = spellSlots.pactMagicSlots || 0;\r\n    const pactMax = spellSlots.pactMagicSlotsMax || 0;\r\n    const pactLevel = spellSlots.pactMagicLevel || 0;\r\n\r\n    if (pactMax > 0) {\r\n      slots.push({ level: `P${pactLevel}`, current: pactCurrent, max: pactMax, type: 'pact' });\r\n      totalCurrent += pactCurrent;\r\n      totalMax += pactMax;\r\n    }\r\n\r\n    if (slots.length === 0) {\r\n      slotsRow.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    slotsRow.style.display = 'block';\r\n    summary.textContent = `${totalCurrent}/${totalMax}`;\r\n\r\n    dropdown.innerHTML = slots.map(slot => `\r\n      <div class=\"status-slot-item ${slot.type === 'pact' ? 'pact' : ''}\">\r\n        <span class=\"lvl\">${slot.type === 'pact' ? 'Pact' : 'Lv' + slot.level}</span>\r\n        <span class=\"val ${slot.current === 0 ? 'empty' : ''}\">${slot.current}/${slot.max}</span>\r\n      </div>\r\n    `).join('');\r\n  }\r\n\r\n  function updateStatusBarResources() {\r\n    const resources = characterData.resources || [];\r\n    const resourcesRow = document.getElementById('status-resources-row');\r\n    const resourcesList = document.getElementById('status-resources-list');\r\n\r\n    // Filter out HP, Lucky, Spell Level, and zero-max resources\r\n    const filteredResources = resources.filter(r => {\r\n      const name = (r.name || '').toLowerCase();\r\n      return r.max > 0 && !name.includes('hit points') && !name.includes('lucky') && !name.includes('spell level');\r\n    });\r\n\r\n    if (filteredResources.length === 0) {\r\n      resourcesRow.style.display = 'none';\r\n      return;\r\n    }\r\n\r\n    resourcesRow.style.display = 'block';\r\n    resourcesList.innerHTML = filteredResources.slice(0, 4).map(r => `\r\n      <div class=\"status-resource-item\">\r\n        <span class=\"name\" title=\"${r.name}\">${r.name}</span>\r\n        <span class=\"val\">${r.current}/${r.max}</span>\r\n      </div>\r\n    `).join('');\r\n  }\r\n\r\n  function updateStatusBarEffects() {\r\n    // Support both data formats:\r\n    // - Direct: activeBuffs/activeDebuffs (from postMessage)\r\n    // - Nested: activeEffects.buffs/debuffs (from storage)\r\n    const activeEffects = characterData.activeEffects || {};\r\n    const buffs = characterData.activeBuffs || activeEffects.buffs || [];\r\n    const debuffs = characterData.activeDebuffs || activeEffects.debuffs || [];\r\n    const effectsRow = document.getElementById('status-effects-row');\r\n\r\n    const allEffects = [\r\n      ...buffs.map(b => ({ name: typeof b === 'string' ? b : b.name, type: 'buff' })),\r\n      ...debuffs.map(d => ({ name: typeof d === 'string' ? d : d.name, type: 'debuff' }))\r\n    ];\r\n\r\n    if (allEffects.length === 0) {\r\n      effectsRow.innerHTML = '<span class=\"status-no-effects\">No effects</span>';\r\n      return;\r\n    }\r\n\r\n    effectsRow.innerHTML = allEffects.map(e => {\r\n      return `<span class=\"status-effect-badge ${e.type}\">${e.name}</span>`;\r\n    }).join('');\r\n  }\r\n\r\n  /**\r\n   * Shows the status bar\r\n   */\r\n  function showStatusBar() {\r\n    if (statusBarElement) {\r\n      statusBarElement.style.display = 'block';\r\n      statusBarVisible = true;\r\n      localStorage.removeItem('rollcloud-status-bar_hidden');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hides the status bar\r\n   */\r\n  function hideStatusBar() {\r\n    if (statusBarElement) {\r\n      statusBarElement.style.display = 'none';\r\n      statusBarVisible = false;\r\n      localStorage.setItem('rollcloud-status-bar_hidden', 'true');\r\n      showNotification('Status bar hidden. Use extension popup to show again.', 'info');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles the status bar visibility\r\n   */\r\n  function toggleStatusBar() {\r\n    if (statusBarVisible) {\r\n      hideStatusBar();\r\n    } else {\r\n      showStatusBar();\r\n      showNotification('Status bar shown', 'success');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initializes the status bar overlay\r\n   */\r\n  function initializeStatusBar() {\r\n    createStatusBarOverlay();\r\n\r\n    // Check if it was previously hidden\r\n    const wasHidden = localStorage.getItem('rollcloud-status-bar_hidden');\r\n    if (wasHidden === 'true') {\r\n      statusBarElement.style.display = 'none';\r\n      statusBarVisible = false;\r\n    } else {\r\n      // Start visible by default\r\n      statusBarElement.style.display = 'block';\r\n      statusBarVisible = true;\r\n    }\r\n\r\n    debug.log('\u2705 Status bar overlay initialized');\r\n  }\r\n\r\n  // Listen for status bar data updates\r\n  window.addEventListener('message', (event) => {\r\n    if (event.data && event.data.action === 'updateStatusData') {\r\n      characterData = event.data.data;\r\n      if (statusBarElement) {\r\n        updateStatusBarDisplay();\r\n      }\r\n    } else if (event.data && event.data.action === 'updateAdvantageState') {\r\n      setStatusBarAdvantage(event.data.state);\r\n    }\r\n  });\r\n\r\n  // Periodic refresh of status bar data (fallback)\r\n  setInterval(() => {\r\n    if (statusBarVisible && statusBarElement) {\r\n      loadStatusBarData();\r\n    }\r\n  }, 5000);\r\n\r\n  // Listen for storage changes to update status bar immediately\r\n  browserAPI.storage.onChanged.addListener((changes, areaName) => {\r\n    if (areaName === 'local' && statusBarVisible && statusBarElement) {\r\n      // Check if character data changed (CarmaClouds format)\r\n      const relevantKeys = ['carmaclouds_characters'];\r\n      const hasRelevantChange = Object.keys(changes).some(key => relevantKeys.includes(key));\r\n\r\n      if (hasRelevantChange) {\r\n        debug.log('\uD83D\uDCCA Storage changed, refreshing status bar');\r\n        loadStatusBarData();\r\n      }\r\n    }\r\n  });\r\n\r\n  // Initialize - wait for page to be fully loaded\r\n  function initializeButton() {\r\n    if (document.body) {\r\n      // Clear any accidentally hidden state to ensure button is visible\r\n      const wasHidden = localStorage.getItem('rollcloud-sheet-toggle_hidden');\r\n      if (wasHidden === 'true') {\r\n        debug.log('\uD83D\uDD27 Clearing accidentally hidden button state');\r\n        localStorage.removeItem('rollcloud-sheet-toggle_hidden');\r\n      }\r\n\r\n      // Clear any off-screen position to ensure button is visible\r\n      const savedPosition = localStorage.getItem('rollcloud-sheet-toggle_position');\r\n      if (savedPosition) {\r\n        const { left, top } = JSON.parse(savedPosition);\r\n        const leftPx = parseFloat(left);\r\n        const topPx = parseFloat(top);\r\n\r\n        // Check if position is off-screen (especially negative Y or far outside viewport)\r\n        if (topPx < -20 || topPx > window.innerHeight - 20 || leftPx < -100 || leftPx > window.innerWidth - 20) {\r\n          debug.log(`\uD83D\uDD27 Clearing off-screen button position: left=${left}, top=${top}`);\r\n          localStorage.removeItem('rollcloud-sheet-toggle_position');\r\n        }\r\n      }\r\n\r\n      createToggleButton();\r\n      debug.log('\u2705 RollCloud character sheet toggle button added');\r\n\r\n      // Initialize status bar overlay\r\n      initializeStatusBar();\r\n    } else {\r\n      debug.log('\u23F3 Waiting for document.body...');\r\n      setTimeout(initializeButton, 100);\r\n    }\r\n  }\r\n\r\n  if (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n      setTimeout(initializeButton, 1000);\r\n    });\r\n  } else {\r\n    setTimeout(initializeButton, 1000);\r\n  }\r\n\r\n  debug.log('\u2705 RollCloud character sheet overlay script loaded');\r\n\r\n})();\r\n   "],
  "mappings": "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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+U3B,YAAM,QAAQ,SAAS,cAAc,OAAO;AAC5C,YAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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A;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA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",
  "names": []
}
