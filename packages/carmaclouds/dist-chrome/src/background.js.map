{
  "version": 3,
  "sources": ["../../src/background.js"],
  "sourcesContent": ["/**\r\n * CarmaClouds Unified Background Service Worker\r\n * Handles cross-platform character sync and messaging\r\n */\r\n\r\nconsole.log('CarmaClouds background service worker initialized');\r\n\r\n// Listen for messages from content scripts\r\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n  console.log('Background received message:', message);\r\n\r\n  // Handle different message types\r\n  switch (message.type) {\r\n    case 'CHARACTER_UPDATED':\r\n      handleCharacterUpdate(message.data);\r\n      break;\r\n    case 'SYNC_REQUEST':\r\n      handleSyncRequest(message.data);\r\n      break;\r\n    case 'SYNC_CHARACTER_TO_CARMACLOUDS':\r\n      handleSyncToCarmaClouds(message.data, sendResponse);\r\n      return true; // Keep channel open for async response\r\n    default:\r\n      console.warn('Unknown message type:', message.type);\r\n  }\r\n\r\n  return true; // Keep channel open for async response\r\n});\r\n\r\n// Handle character updates\r\nasync function handleCharacterUpdate(data) {\r\n  console.log('Character updated:', data);\r\n  // TODO: Sync to Supabase\r\n}\r\n\r\n// Handle sync requests\r\nasync function handleSyncRequest(data) {\r\n  console.log('Sync requested:', data);\r\n  // TODO: Fetch from Supabase\r\n}\r\n\r\n// Handle sync to CarmaClouds from DiceCloud\r\nasync function handleSyncToCarmaClouds(characterData, sendResponse) {\r\n  try {\r\n    console.log('Syncing character to CarmaClouds:', characterData);\r\n    \r\n    // Store character data in chrome.storage.local\r\n    const storageKey = `carmaclouds_character_${characterData.name || 'unknown'}`;\r\n    await chrome.storage.local.set({\r\n      [storageKey]: {\r\n        ...characterData,\r\n        syncedAt: new Date().toISOString(),\r\n        platforms: ['dicecloud'] // Mark as available from DiceCloud\r\n      }\r\n    });\r\n    \r\n    // Also update the characters list\r\n    const result = await chrome.storage.local.get('carmaclouds_characters');\r\n    const characters = result.carmaclouds_characters || [];\r\n    \r\n    // Add or update character in the list\r\n    const existingIndex = characters.findIndex(c => c.name === characterData.name);\r\n    if (existingIndex >= 0) {\r\n      characters[existingIndex] = {\r\n        ...characters[existingIndex],\r\n        ...characterData,\r\n        syncedAt: new Date().toISOString(),\r\n        platforms: [...(characters[existingIndex].platforms || []), 'dicecloud']\r\n      };\r\n    } else {\r\n      characters.push({\r\n        ...characterData,\r\n        syncedAt: new Date().toISOString(),\r\n        platforms: ['dicecloud']\r\n      });\r\n    }\r\n    \r\n    await chrome.storage.local.set({ carmaclouds_characters: characters });\r\n    \r\n    console.log('Character successfully synced to CarmaClouds storage');\r\n    \r\n    sendResponse({ \r\n      success: true, \r\n      message: 'Character synced successfully',\r\n      characterCount: characters.length\r\n    });\r\n    \r\n  } catch (error) {\r\n    console.error('Error syncing character to CarmaClouds:', error);\r\n    sendResponse({ \r\n      success: false, \r\n      error: error.message \r\n    });\r\n  }\r\n}\r\n\r\n// Handle extension installation\r\nchrome.runtime.onInstalled.addListener((details) => {\r\n  console.log('CarmaClouds extension installed/updated:', details.reason);\r\n  \r\n  if (details.reason === 'install') {\r\n    console.log('CarmaClouds: First time installation');\r\n  } else if (details.reason === 'update') {\r\n    console.log('CarmaClouds: Extension updated');\r\n  }\r\n});\r\n"],
  "mappings": ";;;;;;;;;;AAKA,UAAQ,IAAI,mDAAmD;AAG/D,SAAO,QAAQ,UAAU,YAAY,CAAC,SAAS,QAAQ,iBAAiB;AACtE,YAAQ,IAAI,gCAAgC,OAAO;AAGnD,YAAQ,QAAQ,MAAM;AAAA,MACpB,KAAK;AACH,8BAAsB,QAAQ,IAAI;AAClC;AAAA,MACF,KAAK;AACH,0BAAkB,QAAQ,IAAI;AAC9B;AAAA,MACF,KAAK;AACH,gCAAwB,QAAQ,MAAM,YAAY;AAClD,eAAO;AAAA,MACT;AACE,gBAAQ,KAAK,yBAAyB,QAAQ,IAAI;AAAA,IACtD;AAEA,WAAO;AAAA,EACT,CAAC;AAGD,iBAAe,sBAAsB,MAAM;AACzC,YAAQ,IAAI,sBAAsB,IAAI;AAAA,EAExC;AAGA,iBAAe,kBAAkB,MAAM;AACrC,YAAQ,IAAI,mBAAmB,IAAI;AAAA,EAErC;AAGA,iBAAe,wBAAwB,eAAe,cAAc;AAClE,QAAI;AACF,cAAQ,IAAI,qCAAqC,aAAa;AAG9D,YAAM,aAAa,yBAAyB,cAAc,QAAQ,SAAS;AAC3E,YAAM,OAAO,QAAQ,MAAM,IAAI;AAAA,QAC7B,CAAC,UAAU,GAAG;AAAA,UACZ,GAAG;AAAA,UACH,WAAU,oBAAI,KAAK,GAAE,YAAY;AAAA,UACjC,WAAW,CAAC,WAAW;AAAA;AAAA,QACzB;AAAA,MACF,CAAC;AAGD,YAAM,SAAS,MAAM,OAAO,QAAQ,MAAM,IAAI,wBAAwB;AACtE,YAAM,aAAa,OAAO,0BAA0B,CAAC;AAGrD,YAAM,gBAAgB,WAAW,UAAU,OAAK,EAAE,SAAS,cAAc,IAAI;AAC7E,UAAI,iBAAiB,GAAG;AACtB,mBAAW,aAAa,IAAI;AAAA,UAC1B,GAAG,WAAW,aAAa;AAAA,UAC3B,GAAG;AAAA,UACH,WAAU,oBAAI,KAAK,GAAE,YAAY;AAAA,UACjC,WAAW,CAAC,GAAI,WAAW,aAAa,EAAE,aAAa,CAAC,GAAI,WAAW;AAAA,QACzE;AAAA,MACF,OAAO;AACL,mBAAW,KAAK;AAAA,UACd,GAAG;AAAA,UACH,WAAU,oBAAI,KAAK,GAAE,YAAY;AAAA,UACjC,WAAW,CAAC,WAAW;AAAA,QACzB,CAAC;AAAA,MACH;AAEA,YAAM,OAAO,QAAQ,MAAM,IAAI,EAAE,wBAAwB,WAAW,CAAC;AAErE,cAAQ,IAAI,sDAAsD;AAElE,mBAAa;AAAA,QACX,SAAS;AAAA,QACT,SAAS;AAAA,QACT,gBAAgB,WAAW;AAAA,MAC7B,CAAC;AAAA,IAEH,SAAS,OAAO;AACd,cAAQ,MAAM,2CAA2C,KAAK;AAC9D,mBAAa;AAAA,QACX,SAAS;AAAA,QACT,OAAO,MAAM;AAAA,MACf,CAAC;AAAA,IACH;AAAA,EACF;AAGA,SAAO,QAAQ,YAAY,YAAY,CAAC,YAAY;AAClD,YAAQ,IAAI,4CAA4C,QAAQ,MAAM;AAEtE,QAAI,QAAQ,WAAW,WAAW;AAChC,cAAQ,IAAI,sCAAsC;AAAA,IACpD,WAAW,QAAQ,WAAW,UAAU;AACtC,cAAQ,IAAI,gCAAgC;AAAA,IAC9C;AAAA,EACF,CAAC;",
  "names": []
}
